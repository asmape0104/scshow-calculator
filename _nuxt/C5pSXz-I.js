import{c as ke,m as N,a as ue,b as be,s as Z,d as O,e as _e,u as he,f as ve,g as oe,h as $e,i as Ce,_ as Me,j as we,k as Ve,p as Ue,l as Se}from"./C6Yf6Nxo.js";import{d as ae,y as A,z as V,A as e,F as xe,G as ge,_ as Te,r as $,k as F,H as L,I as me,D as Ae,J as y,K as U,L as T,M as s,N as q,O as J,P as Ne,B as w,Q as ne,R as le,E as K,x as Ee,C as De,S as pe,T as Be}from"./CP22eeDx.js";const Pe=d=>d<=2100?Math.floor((-5+Math.sqrt(25+20*d))/10):Math.floor(20+(d-2100)/200),fe=(d,k,b)=>(1+d/100)*(1+k*(b?2:1)/10),se=d=>d<10?1:d<20?1.1:d<30?1.2:d<40?1.3:d<50?1.4:1.5,Re=({notes:d,convertedMembers:k,center:b,appealSum:S,mentalSum:f,masteryLevel:v,playStyle:_="perfect",noLog:i=!1})=>{const u=k.find(n=>n.name===b),C=u?.centerSkillCondition,E=u?.centerSkills||[],j=u?.centerAbilities||[],x=j.find(n=>n.type==="cooltime_reduce"),I=j.find(n=>n.type==="ap_reduce"),m=5-Number(x?.value.amount||0),a=Number(I?.value.amount||0),r=k.slice();let D=m,B=0,c=f,t=0;const g={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=Pe(n)},get lv(){return this._lv}},l=[0],P=[0];let o=0,ie=0;const re=ke(d);let G=0,ce=0;const ee=new WeakMap,ye=60/re;let Q,h="";const W=(n,M)=>{const H=g.lv,X=c*100/f;e:for(const p of M){if(p.condition){const[R,Y,te]=p.condition;let z=0;switch(R){case"skill_count":z=ee.get(n)||0;break;case"total_skill_count":z=ce;break;case"vol_lv":z=H;break;case"mental_rate":z=X;break;default:throw new Error(`条件式が不正です: ${R}`)}if(te===void 0)throw new Error(`条件式が不正です: ${R}`);switch(Y){case"<=":if(!(z<=te))continue e;break;case">=":if(!(z>=te))continue e;break}}switch(p.type){case"vol_buff":P[0]=(P[0]||0)+(p.value||0),i||(h+=`${N[n.name]} vol_buff: +${p.value}
`);break;case"vol_up":{const R=P[0]??0;P[0]=0,g.point+=Math.ceil((p.value||0)*(1+R/100)),i||(h+=`${N[n.name]} vol_up: +${Math.ceil((p.value||0)*(1+R/100))}
`,h+=`now voltagePoint: ${g.point}
`);break}case"vol_down":g.point-=p.value||0,g.point<0&&(g.point=0),i||(h+=`${N[n.name]} vol_down: -${p.value||0}
`);break;case"score_buff":l[0]=(l[0]||0)+(p.value||0),i||(h+=`${N[n.name]} score_buff: +${p.value}
`);break;case"score_up":{const R=l[0]??0;l[0]=0;const Y=(p.value||0)/100*(1+R/100)*fe(v,g.lv,Q?.fever||!1);t+=Math.ceil(S*Y),i||(h+=`${N[n.name]} score_up: +${Math.ceil(S*Y)}
`);break}case"mental_up":c+=Math.ceil((p.value||0)/100*f),i||(h+=`${N[n.name]} mental_up: +${Math.ceil((p.value||0)/100*f)}
`);break;case"mental_down":c-=Math.ceil((p.value||0)/100*f),i||(h+=`${N[n.name]} mental_down: -${Math.ceil((p.value||0)/100*f)}
`),c<=0&&(c=1);break;case"ap_up":B+=Math.ceil((p.value||0)*se(G)*1e4),i||(h+=`${N[n.name]} ap_up: +${(p.value||0)*se(G)}
`);break;case"ap_down":B-=(p.value||0)*1e4,i||(h+=`${N[n.name]} ap_down: -${p.value||0}
`);break;case"reset":o=r.length-1,i||(h+=`${N[n.name]} reset
`);break;case"splice":r.splice(r.indexOf(n),1),o--,i||(h+=`${N[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};u&&C==="start"&&W(u,E);const de=()=>{if(r.length===0)return!1;const n=r[o];if(!n)throw new Error("メンバーが見つかりません");const M=Math.max(n.ap-a,0);return M*1e4<=B&&D<=0?(B-=M*1e4,ee.set(n,(ee.get(n)||0)+1),ce++,W(n,n.skills),o=r.length-1===o?0:o+1,D+=m,!0):!1};for(let n=0;n<d.length;n++){const M=d[n];if(Q=d[n-1],!M)throw new Error("noteが見つかりません");for(u&&M.fever&&!Q?.fever&&C==="fever_start"&&(i||(h+=`FEVER START
`),W(u,E)),!M.fever&&Q?.fever&&(i||(h+=`FEVER END
`)),D-=M.time-ie,ie=M.time;de(););D=Math.max(0,D);for(let H=0;H<M.normalCount+M.slideCount;H++){if(_==="desperate"&&c*10>f){H<M.normalCount?c-=Math.ceil(f/15):c-=Math.ceil(f*2/75),i||(h+=`miss, apPoint: ${B}, mental: ${c}, vol_lv: ${g.lv*(M.fever?2:1)}
`);continue}G++,B+=Math.ceil(ye*se(G)*1e4),de();const X=Math.ceil(S/re*30*fe(v,g.lv,M.fever));t+=X,i||(h+=`combo: ${G}, score: ${t} (+${X}), apPoint: ${B}, mental: ${c}, vol_lv: ${g.lv*(M.fever?2:1)}
`)}}return u&&C==="end"&&W(u,E),{score:t,log:h}},Fe={class:"card-body"},Oe=ae({__name:"MPopup",props:{onClose:{type:Function,default:()=>{}}},setup(d){return(k,b)=>(V(),A("div",{class:"popup-wrapper",onClick:b[1]||(b[1]=S=>k.onClose(null))},[e("div",{class:"popup card overflow-scroll h-100 w-100",onClick:b[0]||(b[0]=ge(()=>{},["stop"]))},[e("div",Fe,[xe(k.$slots,"default",{},void 0)])])]))}}),je=Object.assign(Te(Oe,[["__scopeId","data-v-eec55aae"]]),{__name:"MPopup"}),Ie={class:"my-2"},ze={class:"input-group mb-3"},Ge=["value"],He={class:"card my-2"},qe={class:"card-body"},Je={key:0,class:"my-2"},Ke={class:"alert alert-info"},Qe={class:"card my-2"},We={class:"card-body"},Xe={key:0,class:"my-2"},Ye={class:"alert alert-info"},Ze={class:"card my-2"},Le={class:"card-body"},et={key:0,class:"my-2"},tt={class:"alert alert-info"},lt=ae({__name:"MdCardSelect",props:{onClose:{}},setup(d){const k=$(""),b=m=>`[${m.series}] ${m.key!=="other"?ve[m.key]:m.otherName}`,S=F(()=>ue.filter(m=>b(m).includes(k.value))),f=$(0),v=F(()=>ue[f.value]),_=F(()=>v.value?be(v.value,u.value,C.value):null),i=F(()=>_.value?Z(O(_.value).skills):""),u=$(14),C=$(14),E=F(()=>_.value?Z(O(_.value).centerSkills):""),j=F(()=>_.value?_e(O(_.value).centerAbilities):""),x=he("skillCache",{}),I=m=>`${m.key}-${m.series}`;return L(v,()=>{v.value&&(u.value=x.value[I(v.value)]?.skillLevel||14,C.value=x.value[I(v.value)]?.centerSkillLevel||14)}),L([u,C],()=>{v.value&&(x.value[I(v.value)]={centerSkillLevel:C.value,skillLevel:u.value})}),(m,a)=>(V(),me(je,{"on-close":m.onClose},{default:Ae(()=>[e("div",Ie,[e("div",ze,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),y(e("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>U(k)?k.value=r:null),type:"text",class:"form-control"},null,512),[[T,s(k)]])]),y(e("select",{"onUpdate:modelValue":a[1]||(a[1]=r=>U(f)?f.value=r:null),class:"form-select"},[(V(!0),A(q,null,J(s(S),(r,D)=>(V(),A("option",{key:`${r.key}-${r.series}`,class:Ne(["card",{"bg-primary":s(v)?.key===r.key}]),value:D}," ["+w(r.series)+"] "+w(r.key!=="other"?s(ve)[r.key]:r.otherName),11,Ge))),128))],512),[[ne,s(f)]])]),e("div",He,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",qe,[e("div",null,[a[6]||(a[6]=K(" スキルレベル： ",-1)),y(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>U(u)?u.value=r:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(u)]])]),s(v)?(V(),A("div",Je,[e("div",Ke,w(s(i)),1)])):le("",!0)])]),e("div",Qe,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",We,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),y(e("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>U(C)?C.value=r:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(C)]]),s(v)?(V(),A("div",Xe,[e("div",Ye," 【"+w(s(oe)(s(v).centerSkillCondition))+"】"+w(s(E)),1)])):le("",!0)])]),e("div",Ze,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Le,[s(v)?(V(),A("div",et,[e("div",tt,w(s(j)),1)])):le("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=r=>m.onClose(s(_)))}," 選択 ")]),_:1},8,["on-close"]))}}),st=Object.assign(lt,{__name:"MdCardSelect"}),ot=$e(()=>{const d=$([]);return{modals:d,openModal:b=>{let S;const f=new Promise(i=>{S=i}),_={component:b,onClose:i=>{d.value.splice(d.value.indexOf(_),1),S(i)}};return d.value.push(_),f}}}),nt={class:"container-md"},at={class:"card my-2"},it={class:"card-body"},rt={class:"card-header"},ct={class:"card-body"},dt=["onClick"],ut={class:"row my-2 align-items-center justify-content-start"},vt={class:"col-auto"},pt=["onUpdate:modelValue"],ft=["value"],_t={class:"row my-2 align-items-center justify-content-start"},mt={class:"col-auto"},yt=["onUpdate:modelValue"],kt={class:"row row-gap-1"},bt={class:"col-md"},ht=["onUpdate:modelValue"],$t={class:"col-md"},Ct=["onUpdate:modelValue"],Mt={class:"col-md"},wt=["onUpdate:modelValue"],Vt={class:"col-md"},Ut={class:"input-group"},St=["onUpdate:modelValue"],xt={class:"my-2"},gt={class:"row"},Tt={class:"col-sm"},At=["onUpdate:modelValue"],Nt={class:"col-sm"},Et={class:"alert alert-secondary"},Dt={class:"my-2"},Bt={class:"row"},Pt={class:"col-sm"},Rt=["onUpdate:modelValue"],Ft=["value"],Ot=["onUpdate:modelValue"],jt={class:"col-sm"},It={class:"alert alert-secondary"},zt={class:"my-2"},Gt={class:"row"},Ht={class:"col-sm"},qt=["onUpdate:modelValue"],Jt={class:"col-sm"},Kt={class:"alert alert-secondary"},Qt={class:"row"},Wt={class:"col"},Xt={class:"form-label"},Yt={class:"col"},Zt={class:"form-label"},Lt={class:"card my-2"},el={class:"card-body"},tl={class:"mb-2"},ll={class:"row"},sl={class:"col-auto"},ol={class:"col-auto"},nl={class:"my-2"},al={class:"my-2"},cl=ae({__name:"index",setup(d){const k=$(""),b=$(""),S=$(0),f=$(0),v=$("smile"),_=$("perfect"),i=$(80820),u=$(2960),C=$(50),E=$(""),j=$(0),x=$(Se),I=()=>{const c=x.value.map(O),t=Ue(k.value,S.value),{score:g,log:l}=Re({notes:t,convertedMembers:c,center:b.value,appealSum:i.value,mentalSum:u.value,masteryLevel:C.value,playStyle:_.value});j.value=g,E.value=l},m=F(()=>x.value.reduce((c,t)=>c+t.mental,0)),a=F(()=>{const c=x.value.map(O);return Ce(c,v.value,b.value)});L(m,()=>{x.value.every(c=>c.mental)&&(u.value=m.value)}),L(a,()=>{x.value.every(c=>c.smile&&c.pure&&c.cool)&&(i.value=a.value)}),Ee({title:"スクショウ計算機"});const{modals:r,openModal:D}=ot(),B=async c=>{const t=await D(st);t&&x.value.splice(x.value.indexOf(c),1,t)};return(c,t)=>{const g=Me;return V(),A("div",nt,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),De(g,{"note-text":s(k),"onUpdate:noteText":t[0]||(t[0]=l=>U(k)?k.value=l:null),center:s(b),"onUpdate:center":t[1]||(t[1]=l=>U(b)?b.value=l:null),offset:s(S),"onUpdate:offset":t[2]||(t[2]=l=>U(S)?S.value=l:null),"combo-offset":s(f),"onUpdate:comboOffset":t[3]||(t[3]=l=>U(f)?f.value=l:null),attribute:s(v),"onUpdate:attribute":t[4]||(t[4]=l=>U(v)?v.value=l:null),"mastery-level":s(C),"onUpdate:masteryLevel":t[5]||(t[5]=l=>U(C)?C.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",at,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",it,[(V(!0),A(q,null,J(s(x),(l,P)=>(V(),A("div",{key:P,class:"card m-3"},[e("div",rt,w(P+1)+"人目 ",1),e("div",ct,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>B(l)}," カードを選択して入力 ",8,dt)]),e("div",ut,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",vt,[y(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(V(!0),A(q,null,J(s(we),o=>(V(),A("option",{key:o,value:o},w(s(N)[o]),9,ft))),128))],8,pt),[[ne,l.name]])])]),e("div",_t,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",mt,[y(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,yt),[[T,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",kt,[e("div",bt,[y(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,ht),[[T,l.smile,void 0,{number:!0}]])]),e("div",$t,[y(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Ct),[[T,l.pure,void 0,{number:!0}]])]),e("div",Mt,[y(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,wt),[[T,l.cool,void 0,{number:!0}]])]),e("div",Vt,[e("div",Ut,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),y(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,St),[[T,l.mental,void 0,{number:!0}]])])])]),e("div",xt,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",gt,[e("div",Tt,[y(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,At),[[T,l.skill]])]),e("div",Nt,[e("div",Et,w(s(Z)(s(O)(l).skills)),1)])])]),e("div",Dt,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Bt,[e("div",Pt,[y(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(V(!0),A(q,null,J(s(Ve),o=>(V(),A("option",{key:o,value:o},w(s(oe)(o)),9,Ft))),128))],8,Rt),[[ne,l.centerSkillCondition]]),y(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Ot),[[T,l.centerSkill]])]),e("div",jt,[e("div",It," 【"+w(s(oe)(l.centerSkillCondition))+"】"+w(s(Z)(s(O)(l).centerSkills)),1)])])]),e("div",zt,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Gt,[e("div",Ht,[y(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,qt),[[T,l.centerAbilityText]])]),e("div",Jt,[e("div",Kt,w(s(_e)(s(O)(l).centerAbilities)),1)])])])])]))),128)),e("div",Qt,[e("div",Wt,[e("label",Xt,"総合アピール値（"+w(s(a))+"）：",1),y(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>U(i)?i.value=l:null),type:"number",class:"form-control"},null,512),[[T,s(i),void 0,{number:!0}]])]),e("div",Yt,[e("label",Zt,"総合メンタル値（"+w(s(m))+"）：",1),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>U(u)?u.value=l:null),type:"number",class:"form-control"},null,512),[[T,s(u),void 0,{number:!0}]])])])])]),e("div",Lt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",el,[e("div",tl,[t[21]||(t[21]=K(" プレイスタイル： ",-1)),e("div",ll,[e("div",sl,[e("label",null,[y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>U(_)?_.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[pe,s(_)]]),t[19]||(t[19]=K(" 渾身 ",-1))])]),e("div",ol,[e("label",null,[y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>U(_)?_.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[pe,s(_)]]),t[20]||(t[20]=K(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:I}," 計算 "),e("div",nl," 計算結果: "+w(s(j)),1),e("div",al,[t[22]||(t[22]=K(" ログ： ",-1)),y(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>U(E)?E.value=l:null),rows:"6",class:"form-control"},null,512),[[T,s(E)]])])])]),(V(!0),A(q,null,J(s(r),(l,P)=>(V(),me(Be(l.component),{key:`modal-${P}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{cl as default};
