import{q as C,u as ke,r as A,t as z,_ as oe,v as le,d as be,b as H,w as ge,g as Ce,s as te,e as Le,h as $e,a as _e,j as we,p as xe,x as Ue,k as Ve}from"./O97x0dHo.js";import{f as W,y as Me,z as Y,A as Se,B as De,c as d,C as Te,D as Fe,g as P,r as p,h as ne,o as r,a as e,d as w,t as y,l as t,b as M,n as se,j as k,v as E,s as D,k as f,_ as Oe,E as Re,i as X,w as ae,F as x,m as U,q as G,u as Ae,G as I,H as ze,I as Ne,x as he}from"./BHj6X5Sm.js";const je=Symbol.for("nuxt:client-only"),qe=W({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(V,{slots:b,attrs:g}){const L=Me(!1);Y(()=>{L.value=!0});const _=Te();return _&&(_._nuxtClientOnly=!0),Fe(je,!0),()=>{if(L.value){const o=b.default?.();return o&&o.length===1?[Se(o[0],g)]:o}const v=b.fallback||b.placeholder;if(v)return De(v);const a=V.fallback||V.placeholder||"",n=V.fallbackTag||V.placeholderTag||"span";return d(n,g,a)}}}),Be=["max"],Ie={class:"row"},Pe={class:"col form-check-label"},Ee={class:"col form-check-label"},Ge={class:"col form-check-label"},He=W({__name:"MMemberRow",props:{card:{},openCardDetailsModal:{type:Function}},emits:["update:skillLevel"],setup(V,{emit:b}){const g=V,L=b,_=P(()=>C(g.card)),v=p("optional"),a=ke(_,{level:A[g.card.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"});return a.value.level||(a.value.level=A[g.card.rarity]||1),ne(v,n=>{a.value.selected=n}),ne(a,n=>{L("update:skillLevel",n)}),Y(()=>{v.value=a.value.selected||"optional",L("update:skillLevel",a.value)}),(n,o)=>{const i=oe;return r(),d("tr",null,[e("td",null,[w(y(t(z)(n.card))+" ",1),e("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:o[0]||(o[0]=u=>n.openCardDetailsModal(n.card))},[M(i,{icon:"circle-info"})])]),e("td",{class:se({"gained-ap":t(le)(n.card,t(a).level)>0})},y(n.card.ap+t(le)(n.card,t(a).level)),3),e("td",null,[k(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>t(a).level=u),class:se(["form-control",{"not-max":t(a).level!==t(A)[n.card.rarity]}]),type:"number",min:"1",max:t(A)[n.card.rarity],onChange:o[2]||(o[2]=u=>L("update:skillLevel",t(a)))},null,42,Be),[[E,t(a).level,void 0,{number:!0}]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>t(a).skillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[E,t(a).skillLevel,void 0,{number:!0}]])]),e("td",null,[k(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>t(a).centerSkillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[E,t(a).centerSkillLevel,void 0,{number:!0}]])]),e("td",null,[e("div",Ie,[e("label",Pe,[k(e("input",{"onUpdate:modelValue":o[5]||(o[5]=u=>f(v)?v.value=u:null),class:"form-check-input",type:"radio",value:"required"},null,512),[[D,t(v)]]),o[8]||(o[8]=w(" 必須 ",-1))]),e("label",Ee,[k(e("input",{"onUpdate:modelValue":o[6]||(o[6]=u=>f(v)?v.value=u:null),class:"form-check-input",type:"radio",value:"optional"},null,512),[[D,t(v)]]),o[9]||(o[9]=w(" 任意 ",-1))]),e("label",Ge,[k(e("input",{"onUpdate:modelValue":o[7]||(o[7]=u=>f(v)?v.value=u:null),class:"form-check-input",type:"radio",value:"excluded"},null,512),[[D,t(v)]]),o[10]||(o[10]=w(" 除外 ",-1))])])])])}}}),We=Object.assign(Oe(He,[["__scopeId","data-v-da7cd786"]]),{__name:"MMemberRow"}),Ke={class:"mb-3"},Je={class:"my-2"},Qe={class:"card my-2"},Xe={class:"card-body"},Ye={class:"table"},Ze={class:"card my-2"},el={class:"card-body"},ll={class:"table"},tl={key:0,rowspan:"14"},nl={class:"card my-2"},sl={class:"card-body"},ol={class:"table"},al={class:"card my-2"},rl={class:"card-body"},il=W({__name:"MdCardDetails",props:{onClose:{},card:{},displayLevel:{}},setup(V){const b=V,g=P(()=>Array.from({length:14},(a,n)=>be(H(b.card,n+1,n+1)))),L=Re(new Set([...ge[b.card.rarity].map(([a])=>a),b.displayLevel])),_=P(()=>Array.from(L).sort((a,n)=>a-n)),v=P(()=>_.value.map(a=>H(b.card,1,1,a)));return(a,n)=>{const o=$e;return r(),X(o,{"on-close":a.onClose},{default:ae(()=>[e("h3",Ke,y(t(z)(a.card)),1),e("div",Je,[e("div",Qe,[n[6]||(n[6]=e("div",{class:"card-header"}," ステータス ",-1)),e("div",Xe,[e("table",Ye,[e("thead",null,[e("tr",null,[n[1]||(n[1]=e("th",null,"ステータス",-1)),(r(!0),d(x,null,U(t(_),i=>(r(),d("th",{key:`status-${i}`}," Lv."+y(i),1))),128))])]),e("tbody",null,[e("tr",null,[n[2]||(n[2]=e("td",null,"スマイル",-1)),(r(!0),d(x,null,U(t(v),i=>(r(),d("td",{key:`status-smile-${i.key}`},y(i.smile),1))),128))]),e("tr",null,[n[3]||(n[3]=e("td",null,"ピュア",-1)),(r(!0),d(x,null,U(t(v),i=>(r(),d("td",{key:`status-pure-${i.key}`},y(i.pure),1))),128))]),e("tr",null,[n[4]||(n[4]=e("td",null,"クール",-1)),(r(!0),d(x,null,U(t(v),i=>(r(),d("td",{key:`status-cool-${i.key}`},y(i.cool),1))),128))]),e("tr",null,[n[5]||(n[5]=e("td",null,"メンタル",-1)),(r(!0),d(x,null,U(t(v),i=>(r(),d("td",{key:`status-mental-${i.key}`},y(i.mental),1))),128))])])])])]),e("div",Ze,[n[8]||(n[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",el,[e("table",ll,[n[7]||(n[7]=e("thead",null,[e("tr",null,[e("th",null,"スキルLv."),e("th",null,"発動条件"),e("th",null,"効果")])],-1)),e("tbody",null,[(r(!0),d(x,null,U(t(g),(i,u)=>(r(),d("tr",{key:`center-skill-${u}`},[e("td",null,y(u+1),1),u===0?(r(),d("td",tl,y(t(Ce)(i.centerSkillCondition)),1)):G("",!0),e("td",null,y(t(te)(i.centerSkills)),1)]))),128))])])])]),e("div",nl,[n[10]||(n[10]=e("div",{class:"card-header"}," スキル ",-1)),e("div",sl,[e("table",ol,[n[9]||(n[9]=e("thead",null,[e("tr",null,[e("th",null,"スキルLv."),e("th",null,"効果")])],-1)),e("tbody",null,[(r(!0),d(x,null,U(t(g),(i,u)=>(r(),d("tr",{key:`skill-${u}`},[e("td",null,y(u+1),1),e("td",null,y(t(te)(i.skills)),1)]))),128))])])])]),e("div",al,[n[11]||(n[11]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",rl,y(t(Le)(t(g)[0].centerAbilities)),1)]),e("button",{class:"btn btn-primary",onClick:n[0]||(n[0]=i=>a.onClose(null))}," 閉じる ")])]),_:1},8,["on-close"])}}}),ul=Object.assign(il,{__name:"MdCardDetails"}),dl={class:"container-md"},vl={class:"card my-2"},pl={class:"card-body"},cl={class:"table"},ml={scope:"col"},fl={class:"d-flex align-items-end"},yl={class:""},kl={class:"input-group"},bl={class:"input-group-prepend"},gl={class:"input-group-text"},Cl={style:{"min-height":"1.5em"}},Ll={class:"card my-2"},$l={class:"card-body"},_l={class:"mb-2"},wl={class:"row"},xl={class:"col-auto"},Ul={class:"col-auto"},Vl={class:"mb-2"},Ml={class:"row"},Sl={class:"col-auto"},Dl={class:"col-auto"},Tl={class:"mb-2"},Fl={class:"form-check"},Ol={class:"form-check"},Rl={class:"form-check"},Al={class:"form-check"},zl={key:2},Nl={class:"card my-2"},hl={class:"card-body"},jl=["value"],Il=W({__name:"auto-formation",setup(V){const b=p(""),g=p(""),L=p(0),_=p(0),v=p("smile"),a=p(50),n=p("perfect"),o=p("current"),i=p([]),u=p(""),N=p(!0),h=p(!0),j=p(!0),q=p(!0),T=p([..._e]),$=p(Object.fromEntries(T.value.map(m=>[C(m),{level:A[m.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),re=(m,l)=>{$.value[m]=l},B=p(null),S=p(null),K=p(0),Z=p(Promise.resolve()),F=p("finished"),ee=()=>{B.value=new Worker(new URL(""+new URL("calc-worker-CUMaVOqb.js",import.meta.url).href,import.meta.url),{type:"module"}),B.value.onmessage=m=>{switch(m.data.message){case"calcScore":Z.value=Z.value.then(async()=>{m.data.data.score>(S.value?.score||0)&&(S.value={score:m.data.data.score,members:m.data.data.members,log:m.data.data.log})});break;case"progress":K.value=m.data.data.progress;break;case"end":F.value="finished";break}}};Y(()=>{ee()});const ie=()=>{S.value=null,K.value=0;const m=xe(b.value,L.value),l=T.value.filter(c=>$.value[C(c)]&&$.value[C(c)].selected==="required").map(c=>H(c,$.value[C(c)]?.skillLevel||10,$.value[C(c)]?.centerSkillLevel||10,$.value[C(c)]?.level||1));if(l.length>6){O("必要メンバーが6人を超えています");return}const R=T.value.filter(c=>!$.value[C(c)]?.selected||$.value[C(c)].selected==="optional").map(c=>H(c,$.value[C(c)]?.skillLevel||10,$.value[C(c)]?.centerSkillLevel||10,$.value[C(c)]?.level||1));F.value="running",B.value?.postMessage({requiredMembers:l,optionalMembers:R,notes:m,center:g.value,attribute:v.value,masteryLevel:a.value,playStyle:n.value,formationRule:o.value,includingCenterOnly:N.value,noLog:h.value,noDamagedFormation:j.value,noCuredFormation:q.value})},ue=()=>{B.value?.terminate(),ee(),F.value="finished"},O=m=>{window.alert(m)},{modals:de,openModal:ve}=we(),pe=async m=>{await ve(ul,{card:m,displayLevel:$.value[C(m)]?.level||1})},J=p(null),ce=()=>{const m=J.value?.files?.[0];if(m){const l=new FileReader;l.onload=R=>{const c=R.target?.result;T.value=T.value.concat(Ue(c))},l.readAsText(m)}},me=p(null);return Ae({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"}]}),(m,l)=>{const R=Ve,c=oe,fe=We,ye=qe;return r(),d("div",dl,[l[41]||(l[41]=e("h1",null,"スクショウ自動編成",-1)),M(R,{"note-text":t(b),"onUpdate:noteText":l[0]||(l[0]=s=>f(b)?b.value=s:null),center:t(g),"onUpdate:center":l[1]||(l[1]=s=>f(g)?g.value=s:null),offset:t(L),"onUpdate:offset":l[2]||(l[2]=s=>f(L)?L.value=s:null),"combo-offset":t(_),"onUpdate:comboOffset":l[3]||(l[3]=s=>f(_)?_.value=s:null),attribute:t(v),"onUpdate:attribute":l[4]||(l[4]=s=>f(v)?v.value=s:null),"mastery-level":t(a),"onUpdate:masteryLevel":l[5]||(l[5]=s=>f(a)?a.value=s:null),singers:t(i),"onUpdate:singers":l[6]||(l[6]=s=>f(i)?i.value=s:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",vl,[l[27]||(l[27]=e("div",{class:"card-header"}," メンバー ",-1)),e("div",pl,[e("table",cl,[e("thead",null,[e("tr",null,[e("th",ml,[e("div",fl,[l[21]||(l[21]=e("div",{style:{"margin-right":"8px"}}," カード ",-1)),e("div",yl,[e("div",kl,[e("div",bl,[e("div",gl,[e("div",Cl,[M(c,{icon:["fas","magnifying-glass"]})])])]),k(e("input",{"onUpdate:modelValue":l[7]||(l[7]=s=>f(u)?u.value=s:null),type:"text",class:"form-control"},null,512),[[E,t(u)]])])])])]),l[22]||(l[22]=e("th",{scope:"col"},"AP",-1)),l[23]||(l[23]=e("th",{scope:"col"},"Lv.",-1)),l[24]||(l[24]=e("th",{scope:"col"},"スキルLv.",-1)),l[25]||(l[25]=e("th",{scope:"col"},"センターSLv.",-1)),l[26]||(l[26]=e("th",{scope:"col"},"選択",-1))])]),e("tbody",null,[M(ye,null,{default:ae(()=>[(r(!0),d(x,null,U(t(T),s=>k((r(),X(fe,{key:t(z)(s),card:s,"open-card-details-modal":pe,"onUpdate:skillLevel":Q=>re(t(C)(s),Q)},null,8,["card","onUpdate:skillLevel"])),[[ze,t(z)(s).toLowerCase().includes(t(u).toLowerCase())]])),128))]),_:1})])]),e("button",{type:"button",class:"btn btn-primary",onClick:l[8]||(l[8]=s=>t(J)?.click())}," TSVインポート "),e("input",{ref_key:"tsvFileInput",ref:J,type:"file",class:"d-none",onChange:ce},null,544)])]),e("div",Ll,[l[40]||(l[40]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",$l,[e("div",_l,[l[30]||(l[30]=w(" プレイスタイル： ",-1)),e("div",wl,[e("div",xl,[e("label",null,[k(e("input",{"onUpdate:modelValue":l[9]||(l[9]=s=>f(n)?n.value=s:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[D,t(n)]]),l[28]||(l[28]=w(" 渾身 ",-1))]),e("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:l[10]||(l[10]=s=>O("メンタルを100%以上に保つプレイ"))},[M(c,{icon:"circle-info"})])]),e("div",Ul,[e("label",null,[k(e("input",{"onUpdate:modelValue":l[11]||(l[11]=s=>f(n)?n.value=s:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[D,t(n)]]),l[29]||(l[29]=w(" 背水 ",-1))]),e("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:l[12]||(l[12]=s=>O("メンタルを10%以下に保つプレイ"))},[M(c,{icon:"circle-info"})])])])]),e("div",Vl,[l[33]||(l[33]=w(" 編成ルール ",-1)),e("div",Ml,[e("div",Sl,[e("label",null,[k(e("input",{"onUpdate:modelValue":l[13]||(l[13]=s=>f(o)?o.value=s:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[D,t(o)]]),l[31]||(l[31]=w(" 現状のルール ",-1))]),e("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:l[14]||(l[14]=s=>O(`・メンバー1人あたり1種類まで
・カード制限なし`))},[M(c,{icon:"circle-info"})])]),e("div",Dl,[e("label",null,[k(e("input",{"onUpdate:modelValue":l[15]||(l[15]=s=>f(o)?o.value=s:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[D,t(o)]]),l[32]||(l[32]=w(" 新ライグラルール ",-1))]),e("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:l[16]||(l[16]=s=>O(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[M(c,{icon:"circle-info"})])])])]),e("div",Tl,[l[38]||(l[38]=w(" オプション： ",-1)),e("div",Fl,[k(e("input",{id:"includingCenterOnly","onUpdate:modelValue":l[17]||(l[17]=s=>f(N)?N.value=s:null),class:"form-check-input",type:"checkbox"},null,512),[[I,t(N)]]),l[34]||(l[34]=e("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),e("div",Ol,[k(e("input",{id:"noLog","onUpdate:modelValue":l[18]||(l[18]=s=>f(h)?h.value=s:null),class:"form-check-input",type:"checkbox"},null,512),[[I,t(h)]]),l[35]||(l[35]=e("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),e("div",Rl,[k(e("input",{id:"noDamagedFormation","onUpdate:modelValue":l[19]||(l[19]=s=>f(j)?j.value=s:null),class:"form-check-input",type:"checkbox"},null,512),[[I,t(j)]]),l[36]||(l[36]=e("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),e("div",Al,[k(e("input",{id:"noCuredFormation","onUpdate:modelValue":l[20]||(l[20]=s=>f(q)?q.value=s:null),class:"form-check-input",type:"checkbox"},null,512),[[I,t(q)]]),l[37]||(l[37]=e("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),t(F)!=="running"?(r(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:ie}," 計算 ")):G("",!0),t(F)==="running"?(r(),d("button",{key:1,type:"button",class:"btn btn-primary",onClick:ue}," 中止 ")):G("",!0),t(S)?(r(),d("div",zl,[e("p",{ref_key:"progressView",ref:me},y(t(F)==="running"?`計算中... ${t(K).toFixed(2)}%`:"計算完了"),513),e("div",Nl,[e("div",hl,[e("p",null,"最高得点: "+y(t(S).score),1),l[39]||(l[39]=e("p",null,"メンバー:",-1)),e("ul",null,[(r(!0),d(x,null,U(t(S).members,s=>(r(),d("li",{key:t(C)(s)},y(t(z)(s)),1))),128))]),e("textarea",{class:"form-control",value:t(S).log,readonly:"",rows:"5"},null,8,jl)])])])):G("",!0)])]),(r(!0),d(x,null,U(t(de),(s,Q)=>(r(),X(he(s.component),Ne({key:`modal-${Q}`,"on-close":s.onClose},{ref_for:!0},s.args),null,16,["on-close"]))),128))])}}});export{Il as default};
