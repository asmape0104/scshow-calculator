import{c as ke,m as T,a as de,b as be,s as Z,d as P,e as fe,u as he,f as ue,g as oe,_ as $e,h as Ce,i as we,j as Me,k as Ve,l as Ue,p as xe,n as Se}from"./D8zPO0AM.js";import{d as _e,r as $,k as O,F as L,G as me,z as M,D as ge,A as e,H as f,I as w,J as S,K as s,y as g,L as G,M as J,N as Te,B as C,O as ne,P as le,E as K,x as Ae,C as Ne,Q as ve,R as Ee}from"./rtXwUnbY.js";const De=_=>_<=2100?Math.floor((-5+Math.sqrt(25+20*_))/10):Math.floor(20+(_-2100)/200),pe=(_,V,A)=>(1+_/100)*(1+V*(A?2:1)/10),se=_=>_<10?1:_<20?1.1:_<30?1.2:_<40?1.3:_<50?1.4:1.5,Be=({notes:_,convertedMembers:V,center:A,appealSum:N,mentalSum:m,masteryLevel:u,playStyle:y="perfect",noLog:c=!1})=>{const d=V.find(n=>n.name===A),b=d?.centerSkillCondition,E=d?.centerSkills||[],j=d?.centerAbilities||[],U=j.find(n=>n.type==="cooltime_reduce"),z=j.find(n=>n.type==="ap_reduce"),p=5-Number(U?.value.amount||0),a=Number(z?.value.amount||0),i=V.slice();let D=p,B=0,r=m,t=0;const x={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=De(n)},get lv(){return this._lv}},l=[0],R=[0];let o=0,ae=0;const ie=ke(_);let I=0,re=0;const ee=new WeakMap,ye=60/ie;let Q,k="";const W=(n,h)=>{const q=x.lv,X=r*100/m;e:for(const v of h){if(v.condition){const[F,Y,te]=v.condition;let H=0;switch(F){case"skill_count":H=ee.get(n)||0;break;case"total_skill_count":H=re;break;case"vol_lv":H=q;break;case"mental_rate":H=X;break;default:throw new Error(`条件式が不正です: ${F}`)}if(te===void 0)throw new Error(`条件式が不正です: ${F}`);switch(Y){case"<=":if(!(H<=te))continue e;break;case">=":if(!(H>=te))continue e;break}}switch(v.type){case"vol_buff":R[0]=(R[0]||0)+(v.value||0),c||(k+=`${T[n.name]} vol_buff: +${v.value}
`);break;case"vol_up":{const F=R[0]??0;R[0]=0,x.point+=Math.ceil((v.value||0)*(1+F/100)),c||(k+=`${T[n.name]} vol_up: +${Math.ceil((v.value||0)*(1+F/100))}
`,k+=`now voltagePoint: ${x.point}
`);break}case"vol_down":x.point-=v.value||0,x.point<0&&(x.point=0),c||(k+=`${T[n.name]} vol_down: -${v.value||0}
`);break;case"score_buff":l[0]=(l[0]||0)+(v.value||0),c||(k+=`${T[n.name]} score_buff: +${v.value}
`);break;case"score_up":{const F=l[0]??0;l[0]=0;const Y=(v.value||0)/100*(1+F/100)*pe(u,x.lv,Q?.fever||!1);t+=Math.ceil(N*Y),c||(k+=`${T[n.name]} score_up: +${Math.ceil(N*Y)}
`);break}case"mental_up":r+=Math.ceil((v.value||0)/100*m),c||(k+=`${T[n.name]} mental_up: +${Math.ceil((v.value||0)/100*m)}
`);break;case"mental_down":r-=Math.ceil((v.value||0)/100*m),c||(k+=`${T[n.name]} mental_down: -${Math.ceil((v.value||0)/100*m)}
`),r<=0&&(r=1);break;case"ap_up":B+=Math.ceil((v.value||0)*se(I)*1e4),c||(k+=`${T[n.name]} ap_up: +${(v.value||0)*se(I)}
`);break;case"ap_down":B-=(v.value||0)*1e4,c||(k+=`${T[n.name]} ap_down: -${v.value||0}
`);break;case"reset":o=i.length-1,c||(k+=`${T[n.name]} reset
`);break;case"splice":i.splice(i.indexOf(n),1),o--,c||(k+=`${T[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};d&&b==="start"&&W(d,E);const ce=()=>{if(i.length===0)return!1;const n=i[o];if(!n)throw new Error("メンバーが見つかりません");const h=Math.max(n.ap-a,0);return h*1e4<=B&&D<=0?(B-=h*1e4,ee.set(n,(ee.get(n)||0)+1),re++,W(n,n.skills),o=i.length-1===o?0:o+1,D+=p,!0):!1};for(let n=0;n<_.length;n++){const h=_[n];if(Q=_[n-1],!h)throw new Error("noteが見つかりません");for(d&&h.fever&&!Q?.fever&&b==="fever_start"&&(c||(k+=`FEVER START
`),W(d,E)),!h.fever&&Q?.fever&&(c||(k+=`FEVER END
`)),D-=h.time-ae,ae=h.time;ce(););D=Math.max(0,D);for(let q=0;q<h.normalCount+h.slideCount;q++){if(y==="desperate"&&r*10>m){q<h.normalCount?r-=Math.ceil(m/15):r-=Math.ceil(m*2/75),c||(k+=`miss, apPoint: ${B}, mental: ${r}, vol_lv: ${x.lv*(h.fever?2:1)}
`);continue}I++,B+=Math.ceil(ye*se(I)*1e4),ce();const X=Math.ceil(N/ie*30*pe(u,x.lv,h.fever));t+=X,c||(k+=`combo: ${I}, score: ${t} (+${X}), apPoint: ${B}, mental: ${r}, vol_lv: ${x.lv*(h.fever?2:1)}
`)}}return d&&b==="end"&&W(d,E),{score:t,log:k}},Re={class:"my-2"},Fe={class:"input-group mb-3"},Oe=["value"],Pe={class:"card my-2"},je={class:"card-body"},ze={key:0,class:"my-2"},He={class:"alert alert-info"},Ie={class:"card my-2"},qe={class:"card-body"},Ge={key:0,class:"my-2"},Je={class:"alert alert-info"},Ke={class:"card my-2"},Qe={class:"card-body"},We={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye=_e({__name:"MdCardSelect",props:{onClose:{}},setup(_){const V=$(""),A=p=>`[${p.series}] ${p.key!=="other"?ue[p.key]:p.otherName}`,N=O(()=>de.filter(p=>A(p).includes(V.value))),m=$(0),u=O(()=>de[m.value]),y=O(()=>u.value?be(u.value,d.value,b.value):null),c=O(()=>y.value?Z(P(y.value).skills):""),d=$(14),b=$(14),E=O(()=>y.value?Z(P(y.value).centerSkills):""),j=O(()=>y.value?fe(P(y.value).centerAbilities):""),U=he("skillCache",{}),z=p=>`${p.key}-${p.series}`;return L(u,()=>{u.value&&(d.value=U.value[z(u.value)]?.skillLevel||14,b.value=U.value[z(u.value)]?.centerSkillLevel||14)}),L([d,b],()=>{u.value&&(U.value[z(u.value)]={centerSkillLevel:b.value,skillLevel:d.value})}),(p,a)=>(M(),me($e,{"on-close":p.onClose},{default:ge(()=>[e("div",Re,[e("div",Fe,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),f(e("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>w(V)?V.value=i:null),type:"text",class:"form-control"},null,512),[[S,s(V)]])]),f(e("select",{"onUpdate:modelValue":a[1]||(a[1]=i=>w(m)?m.value=i:null),class:"form-select"},[(M(!0),g(G,null,J(s(N),(i,D)=>(M(),g("option",{key:`${i.key}-${i.series}`,class:Te(["card",{"bg-primary":s(u)?.key===i.key}]),value:D}," ["+C(i.series)+"] "+C(i.key!=="other"?s(ue)[i.key]:i.otherName),11,Oe))),128))],512),[[ne,s(m)]])]),e("div",Pe,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",je,[e("div",null,[a[6]||(a[6]=K(" スキルレベル： ",-1)),f(e("input",{"onUpdate:modelValue":a[2]||(a[2]=i=>w(d)?d.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(d)]])]),s(u)?(M(),g("div",ze,[e("div",He,C(s(c)),1)])):le("",!0)])]),e("div",Ie,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",qe,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),f(e("input",{"onUpdate:modelValue":a[3]||(a[3]=i=>w(b)?b.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(b)]]),s(u)?(M(),g("div",Ge,[e("div",Je," 【"+C(s(oe)(s(u).centerSkillCondition))+"】"+C(s(E)),1)])):le("",!0)])]),e("div",Ke,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Qe,[s(u)?(M(),g("div",We,[e("div",Xe,C(s(j)),1)])):le("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=i=>p.onClose(s(y)))}," 選択 ")]),_:1},8,["on-close"]))}}),Ze=Object.assign(Ye,{__name:"MdCardSelect"}),Le={class:"container-md"},et={class:"card my-2"},tt={class:"card-body"},lt={class:"card-header"},st={class:"card-body"},ot=["onClick"],nt={class:"row my-2 align-items-center justify-content-start"},at={class:"col-auto"},it=["onUpdate:modelValue"],rt=["value"],ct={class:"row my-2 align-items-center justify-content-start"},dt={class:"col-auto"},ut=["onUpdate:modelValue"],vt={class:"row row-gap-1"},pt={class:"col-md"},ft=["onUpdate:modelValue"],_t={class:"col-md"},mt=["onUpdate:modelValue"],yt={class:"col-md"},kt=["onUpdate:modelValue"],bt={class:"col-md"},ht={class:"input-group"},$t=["onUpdate:modelValue"],Ct={class:"my-2"},wt={class:"row"},Mt={class:"col-sm"},Vt=["onUpdate:modelValue"],Ut={class:"col-sm"},xt={class:"alert alert-secondary"},St={class:"my-2"},gt={class:"row"},Tt={class:"col-sm"},At=["onUpdate:modelValue"],Nt=["value"],Et=["onUpdate:modelValue"],Dt={class:"col-sm"},Bt={class:"alert alert-secondary"},Rt={class:"my-2"},Ft={class:"row"},Ot={class:"col-sm"},Pt=["onUpdate:modelValue"],jt={class:"col-sm"},zt={class:"alert alert-secondary"},Ht={class:"row"},It={class:"col"},qt={class:"form-label"},Gt={class:"col"},Jt={class:"form-label"},Kt={class:"card my-2"},Qt={class:"card-body"},Wt={class:"mb-2"},Xt={class:"row"},Yt={class:"col-auto"},Zt={class:"col-auto"},Lt={class:"my-2"},el={class:"my-2"},sl=_e({__name:"index",setup(_){const V=$(""),A=$(""),N=$(0),m=$(0),u=$("smile"),y=$("perfect"),c=$(80820),d=$(2960),b=$(50),E=$(""),j=$(0),U=$(Se),z=()=>{const r=U.value.map(P),t=xe(V.value,N.value),{score:x,log:l}=Be({notes:t,convertedMembers:r,center:A.value,appealSum:c.value,mentalSum:d.value,masteryLevel:b.value,playStyle:y.value});j.value=x,E.value=l},p=O(()=>U.value.reduce((r,t)=>r+t.mental,0)),a=O(()=>{const r=U.value.map(P);return Ce(r,u.value,A.value)});L(p,()=>{U.value.every(r=>r.mental)&&(d.value=p.value)}),L(a,()=>{U.value.every(r=>r.smile&&r.pure&&r.cool)&&(c.value=a.value)}),Ae({title:"スクショウ計算機"});const{modals:i,openModal:D}=we(),B=async r=>{const t=await D(Ze);t&&U.value.splice(U.value.indexOf(r),1,t)};return(r,t)=>{const x=Me;return M(),g("div",Le,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),Ne(x,{"note-text":s(V),"onUpdate:noteText":t[0]||(t[0]=l=>w(V)?V.value=l:null),center:s(A),"onUpdate:center":t[1]||(t[1]=l=>w(A)?A.value=l:null),offset:s(N),"onUpdate:offset":t[2]||(t[2]=l=>w(N)?N.value=l:null),"combo-offset":s(m),"onUpdate:comboOffset":t[3]||(t[3]=l=>w(m)?m.value=l:null),attribute:s(u),"onUpdate:attribute":t[4]||(t[4]=l=>w(u)?u.value=l:null),"mastery-level":s(b),"onUpdate:masteryLevel":t[5]||(t[5]=l=>w(b)?b.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",et,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",tt,[(M(!0),g(G,null,J(s(U),(l,R)=>(M(),g("div",{key:R,class:"card m-3"},[e("div",lt,C(R+1)+"人目 ",1),e("div",st,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>B(l)}," カードを選択して入力 ",8,ot)]),e("div",nt,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",at,[f(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(M(!0),g(G,null,J(s(Ve),o=>(M(),g("option",{key:o,value:o},C(s(T)[o]),9,rt))),128))],8,it),[[ne,l.name]])])]),e("div",ct,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",dt,[f(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,ut),[[S,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",vt,[e("div",pt,[f(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,ft),[[S,l.smile,void 0,{number:!0}]])]),e("div",_t,[f(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,mt),[[S,l.pure,void 0,{number:!0}]])]),e("div",yt,[f(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,kt),[[S,l.cool,void 0,{number:!0}]])]),e("div",bt,[e("div",ht,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),f(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,$t),[[S,l.mental,void 0,{number:!0}]])])])]),e("div",Ct,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",wt,[e("div",Mt,[f(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,Vt),[[S,l.skill]])]),e("div",Ut,[e("div",xt,C(s(Z)(s(P)(l).skills)),1)])])]),e("div",St,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",gt,[e("div",Tt,[f(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(M(!0),g(G,null,J(s(Ue),o=>(M(),g("option",{key:o,value:o},C(s(oe)(o)),9,Nt))),128))],8,At),[[ne,l.centerSkillCondition]]),f(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Et),[[S,l.centerSkill]])]),e("div",Dt,[e("div",Bt," 【"+C(s(oe)(l.centerSkillCondition))+"】"+C(s(Z)(s(P)(l).centerSkills)),1)])])]),e("div",Rt,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Ft,[e("div",Ot,[f(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,Pt),[[S,l.centerAbilityText]])]),e("div",jt,[e("div",zt,C(s(fe)(s(P)(l).centerAbilities)),1)])])])])]))),128)),e("div",Ht,[e("div",It,[e("label",qt,"総合アピール値（"+C(s(a))+"）：",1),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>w(c)?c.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(c),void 0,{number:!0}]])]),e("div",Gt,[e("label",Jt,"総合メンタル値（"+C(s(p))+"）：",1),f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>w(d)?d.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(d),void 0,{number:!0}]])])])])]),e("div",Kt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Qt,[e("div",Wt,[t[21]||(t[21]=K(" プレイスタイル： ",-1)),e("div",Xt,[e("div",Yt,[e("label",null,[f(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>w(y)?y.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[ve,s(y)]]),t[19]||(t[19]=K(" 渾身 ",-1))])]),e("div",Zt,[e("label",null,[f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>w(y)?y.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[ve,s(y)]]),t[20]||(t[20]=K(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:z}," 計算 "),e("div",Lt," 計算結果: "+C(s(j)),1),e("div",el,[t[22]||(t[22]=K(" ログ： ",-1)),f(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>w(E)?E.value=l:null),rows:"6",class:"form-control"},null,512),[[S,s(E)]])])])]),(M(!0),g(G,null,J(s(i),(l,R)=>(M(),me(Ee(l.component),{key:`modal-${R}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{sl as default};
