import{n as d,u as D,o as O,a as x,p as K,b as h,_ as P}from"./-VOKLqiR.js";import{d as $,k as z,r as c,H as N,o as j,y as L,z as f,A as e,B as g,M as t,J as _,L as R,E as w,T as S,K as m,C as A,N as T,O as B,R as F,I as H}from"./DCfhQPcS.js";const I={class:"row"},J={class:"col form-check-label"},W={class:"col form-check-label"},Z={class:"col form-check-label"},G=$({__name:"MMemberRow",props:{card:{}},emits:["update:skillLevel"],setup(C,{emit:b}){const k=C,p=b,y=z(()=>d(k.card)),a=c("optional"),s=D(y,{centerSkillLevel:10,skillLevel:10,selected:"optional"});return N(a,v=>{s.value.selected=v}),N(s,v=>{p("update:skillLevel",v)}),j(()=>{a.value=s.value.selected||"optional",p("update:skillLevel",s.value)}),(v,o)=>(f(),L("tr",null,[e("td",null,g(t(O)(v.card)),1),e("td",null,[_(e("input",{"onUpdate:modelValue":o[0]||(o[0]=n=>t(s).skillLevel=n),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[R,t(s).skillLevel,void 0,{number:!0}]])]),e("td",null,[_(e("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>t(s).centerSkillLevel=n),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[R,t(s).centerSkillLevel,void 0,{number:!0}]])]),e("td",null,[e("div",I,[e("label",J,[_(e("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>m(a)?a.value=n:null),class:"form-check-input",type:"radio",value:"required"},null,512),[[S,t(a)]]),o[5]||(o[5]=w(" 必須 "))]),e("label",W,[_(e("input",{"onUpdate:modelValue":o[3]||(o[3]=n=>m(a)?a.value=n:null),class:"form-check-input",type:"radio",value:"optional"},null,512),[[S,t(a)]]),o[6]||(o[6]=w(" 任意 "))]),e("label",Z,[_(e("input",{"onUpdate:modelValue":o[4]||(o[4]=n=>m(a)?a.value=n:null),class:"form-check-input",type:"radio",value:"excluded"},null,512),[[S,t(a)]]),o[7]||(o[7]=w(" 除外 "))])])])]))}}),Q=Object.assign(G,{__name:"MMemberRow"}),X={class:"container-md"},Y={class:"card my-2"},ee={class:"card-body"},le={class:"table"},te={class:"card my-2"},oe={class:"card-body"},se={key:0},ne=["value"],ue=$({__name:"auto-formation",setup(C){const b=c(""),k=c(""),p=c(0),y=c(0),a=c("smile"),s=c(Object.fromEntries(x.map(i=>[d(i),{centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),v=(i,l)=>{s.value[i]=l},o=c(null),n=c(null),V=c(Promise.resolve()),U=c("finished");j(()=>{o.value=new Worker(new URL(""+new URL("calc-worker-CZfMnhmy.js",import.meta.url).href,import.meta.url),{type:"module"}),o.value.onmessage=i=>{switch(i.data.message){case"calcScore":V.value=V.value.then(async()=>{i.data.data.score>(n.value?.score||0)&&(n.value={score:i.data.data.score,members:i.data.data.members,log:i.data.data.log})});break;case"end":U.value="finished";break}}});const q=()=>{const i=K(b.value,p.value),l=x.filter(u=>s.value[d(u)]&&s.value[d(u)].selected==="required").map(u=>h(u,s.value[d(u)]?.skillLevel||10,s.value[d(u)]?.centerSkillLevel||10));if(l.length>6){alert("必要メンバーが6人を超えています");return}const M=x.filter(u=>!s.value[d(u)]?.selected||s.value[d(u)].selected==="optional").map(u=>h(u,s.value[d(u)]?.skillLevel||10,s.value[d(u)]?.centerSkillLevel||10));U.value="running",o.value?.postMessage({requiredMembers:l,optionalMembers:M,notes:i,center:k.value,attribute:a.value})};return(i,l)=>{const M=P,u=Q;return f(),L("div",X,[l[8]||(l[8]=e("h1",null,"スクショウ自動編成",-1)),A(M,{"note-text":t(b),"onUpdate:noteText":l[0]||(l[0]=r=>m(b)?b.value=r:null),center:t(k),"onUpdate:center":l[1]||(l[1]=r=>m(k)?k.value=r:null),offset:t(p),"onUpdate:offset":l[2]||(l[2]=r=>m(p)?p.value=r:null),"combo-offset":t(y),"onUpdate:comboOffset":l[3]||(l[3]=r=>m(y)?y.value=r:null),attribute:t(a),"onUpdate:attribute":l[4]||(l[4]=r=>m(a)?a.value=r:null)},null,8,["note-text","center","offset","combo-offset","attribute"]),e("div",Y,[l[6]||(l[6]=e("div",{class:"card-header"}," メンバー ",-1)),e("div",ee,[e("table",le,[l[5]||(l[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"カード"),e("th",{scope:"col"},"スキルLv."),e("th",{scope:"col"},"センタースキルLv."),e("th",{scope:"col"},"選択")])],-1)),e("tbody",null,[(f(!0),L(T,null,B(t(x),r=>(f(),H(u,{key:r.key,card:r,"onUpdate:skillLevel":E=>v(t(d)(r),E)},null,8,["card","onUpdate:skillLevel"]))),128))])])])]),e("div",te,[l[7]||(l[7]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",oe,[e("button",{type:"button",class:"btn btn-primary",onClick:q}," 計算 "),t(n)?(f(),L("div",se,[e("p",null,g(t(U)==="running"?"計算中...":"計算完了"),1),e("p",null,"最高得点: "+g(t(n).score),1),e("p",null,"メンバー:"+g(t(n).members.length)+"人",1),e("ul",null,[(f(!0),L(T,null,B(t(n).members,r=>(f(),L("li",{key:t(d)(r)},g(t(O)(r)),1))),128))]),e("textarea",{class:"form-control",value:t(n).log,readonly:""},null,8,ne)])):F("",!0)])])])}}});export{ue as default};
