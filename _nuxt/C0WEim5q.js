import{u as ce,a as fe,r as i,t as ge,j as ye,p as be,b as Y,v as ke,k as xe,o as U}from"./Bp1kd8r1.js";import{f as Ce,r as n,g as E,z as Le,u as _e,c as g,a as l,b as p,l as r,m as o,j as d,v as we,w as Z,t as x,s as I,d as m,x as L,A as j,F as J,n as H,o as c,k as Ue,i as h,B as Fe,C as Ve,D as Me,y as Se}from"./dsB_qwEm.js";import{a as De,c as Pe,b as ze,d as Re,M as Te}from"./BdRpcogy.js";const Oe={class:"container-md"},Ne={class:"card my-2"},$e={class:"card-body"},Be={class:"table"},je={scope:"col"},qe={class:"d-flex align-items-end"},Ae={class:""},Ge={class:"input-group"},We={class:"input-group-prepend"},Ee={class:"input-group-text"},Ie={style:{"min-height":"1.5em"}},Je={style:{"text-align":"right"}},He={class:"card my-2"},Ke={class:"card-body"},Qe={class:"mb-2"},Xe={class:"row"},Ye={class:"col-auto"},Ze={class:"col-auto"},he={class:"mb-2"},el={class:"row"},ll={class:"col-auto"},tl={class:"col-auto"},ol={class:"mb-2"},sl={class:"row"},nl={class:"col-auto"},al={class:"col-auto"},rl={class:"mb-2"},il={class:"form-check"},ul={class:"form-check"},dl={class:"form-check"},vl={class:"form-check"},pl={key:2},ml={class:"card my-2"},cl={class:"card-body"},fl=["value"],xl=Ce({__name:"auto-formation-single",setup(gl){const F=n(""),V=n(""),M=n(0),q=n(0),S=n("smile"),D=n(50),y=n("perfect"),b=n("current"),k=n("score"),P=n([]),z=ce("seasonFanLvs",{kaho:1,sayaka:1,rurino:1,ginko:1,kosuzu:1,hime:1,ceras:1,izumi:1,kozue:1,tsuzuri:1,megumi:1}),R=n(""),T=n(!0),O=n(!0),N=n(!1),$=n(!1),f=n([...fe]),u=n(Object.fromEntries(f.value.map(s=>[i(s),{level:ge[s.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),ee=(s,e)=>{u.value[s]=e},le=E(()=>f.value.filter(s=>u.value[i(s)]?.selected==="required").length),te=E(()=>f.value.filter(s=>u.value[i(s)]?.selected==="excluded").length),oe=E(()=>f.value.filter(s=>u.value[i(s)]?.selected==="optional").length),B=n(null),v=n(null),A=n(0),K=n(Promise.resolve()),C=n("finished"),Q=()=>{B.value=new Worker(new URL(""+new URL("calc-worker-DLcUns7p.js",import.meta.url).href,import.meta.url),{type:"module"}),B.value.onmessage=s=>{switch(s.data.message){case"calcScore":K.value=K.value.then(async()=>{s.data.data.score>(v.value?.score||0)&&(v.value={score:s.data.data.score,liveGrandPrixPt:s.data.data.liveGrandPrixPt,members:s.data.data.members,centerMember:s.data.data.centerMember,log:s.data.data.log})});break;case"progress":A.value=s.data.data.progress;break;case"end":C.value="finished";break}}};Le(()=>{Q()});const se=()=>{v.value=null,A.value=0;const s=be(F.value,M.value),e=f.value.filter(a=>u.value[i(a)]&&u.value[i(a)].selected==="required").map(a=>Y(a,u.value[i(a)]?.skillLevel||10,u.value[i(a)]?.centerSkillLevel||10,u.value[i(a)]?.level||1));if(e.length>6){_("必要メンバーが6人を超えています");return}const w=f.value.filter(a=>!u.value[i(a)]?.selected||u.value[i(a)].selected==="optional").map(a=>Y(a,u.value[i(a)]?.skillLevel||10,u.value[i(a)]?.centerSkillLevel||10,u.value[i(a)]?.level||1));C.value="running",B.value?.postMessage(JSON.parse(JSON.stringify({requiredMembers:e,optionalMembers:w,notes:s,center:V.value,attribute:S.value,masteryLevel:D.value,playStyle:y.value,formationRule:b.value,includingCenterOnly:T.value,noLog:O.value,noDamagedFormation:N.value,noCuredFormation:$.value,scoreComparisonRule:k.value,seasonFanLvs:z.value,singers:P.value})))},ne=()=>{B.value?.terminate(),Q(),C.value="finished"},_=s=>{window.alert(s)},{modals:ae,openModal:re}=ye(),ie=async s=>{await re(Te,{card:s,displayLevel:u.value[i(s)]?.level||1})},G=n(null),ue=()=>{const s=G.value?.files?.[0];if(s){const e=new FileReader;e.onload=w=>{const a=w.target?.result;f.value=f.value.concat(ke(a))},e.readAsText(s)}},de=n(null);return _e({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"}]}),(s,e)=>{const w=xe,a=Ue,ve=Pe,X=De,pe=ze,me=Re;return c(),g("div",Oe,[e[48]||(e[48]=l("h1",null,"スクショウ自動編成",-1)),e[49]||(e[49]=l("a",{href:"https://note.com/asmape/n/nefd46574f4e3",target:"_blank"},"note",-1)),p(w,{"note-text":o(F),"onUpdate:noteText":e[0]||(e[0]=t=>r(F)?F.value=t:null),center:o(V),"onUpdate:center":e[1]||(e[1]=t=>r(V)?V.value=t:null),offset:o(M),"onUpdate:offset":e[2]||(e[2]=t=>r(M)?M.value=t:null),"combo-offset":o(q),"onUpdate:comboOffset":e[3]||(e[3]=t=>r(q)?q.value=t:null),attribute:o(S),"onUpdate:attribute":e[4]||(e[4]=t=>r(S)?S.value=t:null),"mastery-level":o(D),"onUpdate:masteryLevel":e[5]||(e[5]=t=>r(D)?D.value=t:null),singers:o(P),"onUpdate:singers":e[6]||(e[6]=t=>r(P)?P.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),l("div",Ne,[e[31]||(e[31]=l("div",{class:"card-header"}," メンバー ",-1)),l("div",$e,[l("table",Be,[l("thead",null,[l("tr",null,[l("th",je,[l("div",qe,[e[24]||(e[24]=l("div",{style:{"margin-right":"8px"}}," カード ",-1)),l("div",Ae,[l("div",Ge,[l("div",We,[l("div",Ee,[l("div",Ie,[p(a,{icon:["fas","magnifying-glass"]})])])]),d(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>r(R)?R.value=t:null),type:"text",class:"form-control"},null,512),[[we,o(R)]])])])])]),e[25]||(e[25]=l("th",{scope:"col"},"AP",-1)),e[26]||(e[26]=l("th",{scope:"col"},"Lv.",-1)),e[27]||(e[27]=l("th",{scope:"col"},"スキルLv.",-1)),e[28]||(e[28]=l("th",{scope:"col"},"センターSLv.",-1)),e[29]||(e[29]=l("th",{scope:"col"},"凸数",-1)),e[30]||(e[30]=l("th",{scope:"col"},"選択",-1))])]),l("tbody",null,[p(X,null,{default:Z(()=>[(c(!0),g(J,null,H(o(f),t=>d((c(),h(ve,{key:o(U)(t),card:t,"open-card-details-modal":ie,"onUpdate:skillLevel":W=>ee(o(i)(t),W)},null,8,["card","onUpdate:skillLevel"])),[[Fe,o(U)(t).toLowerCase().includes(o(R).toLowerCase())]])),128))]),_:1})])]),l("div",Je," 必須："+x(o(le))+" 任意："+x(o(oe))+" 除外："+x(o(te)),1),l("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=t=>o(G)?.click())}," TSVインポート "),l("input",{ref_key:"tsvFileInput",ref:G,type:"file",class:"d-none",onChange:ue},null,544)])]),p(X,null,{default:Z(()=>[p(pe,{"season-fan-lvs":o(z),"onUpdate:seasonFanLvs":e[9]||(e[9]=t=>r(z)?z.value=t:null)},null,8,["season-fan-lvs"])]),_:1}),l("div",He,[e[47]||(e[47]=l("div",{class:"card-header"}," 計算 ",-1)),l("div",Ke,[l("div",Qe,[e[34]||(e[34]=m(" プレイスタイル： ",-1)),l("div",Xe,[l("div",Ye,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>r(y)?y.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[L,o(y)]]),e[32]||(e[32]=m(" 渾身 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[11]||(e[11]=t=>_("メンタルを100%以上に保つプレイ"))},[p(a,{icon:"circle-info"})])]),l("div",Ze,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>r(y)?y.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[L,o(y)]]),e[33]||(e[33]=m(" 背水 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[13]||(e[13]=t=>_("メンタルを10%以下に保つプレイ"))},[p(a,{icon:"circle-info"})])])])]),l("div",he,[e[37]||(e[37]=m(" 編成ルール ",-1)),l("div",el,[l("div",ll,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>r(b)?b.value=t:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[L,o(b)]]),e[35]||(e[35]=m(" 現状のルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[15]||(e[15]=t=>_(`・メンバー1人あたり1種類まで
・カード制限なし`))},[p(a,{icon:"circle-info"})])]),l("div",tl,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>r(b)?b.value=t:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[L,o(b)]]),e[36]||(e[36]=m(" 新ライグラルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[17]||(e[17]=t=>_(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[p(a,{icon:"circle-info"})])])])]),l("div",ol,[e[40]||(e[40]=m(" スコア比較基準 ",-1)),l("div",sl,[l("div",nl,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>r(k)?k.value=t:null),class:"form-check-input",type:"radio",value:"score"},null,512),[[L,o(k)]]),e[38]||(e[38]=m(" スコア ",-1))])]),l("div",al,[l("label",null,[d(l("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>r(k)?k.value=t:null),class:"form-check-input",type:"radio",value:"grandPrixPt"},null,512),[[L,o(k)]]),e[39]||(e[39]=m(" グランプリpt ",-1))])])])]),l("div",rl,[e[45]||(e[45]=m(" オプション： ",-1)),l("div",il,[d(l("input",{id:"includingCenterOnly","onUpdate:modelValue":e[20]||(e[20]=t=>r(T)?T.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[j,o(T)]]),e[41]||(e[41]=l("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),l("div",ul,[d(l("input",{id:"noLog","onUpdate:modelValue":e[21]||(e[21]=t=>r(O)?O.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[j,o(O)]]),e[42]||(e[42]=l("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),l("div",dl,[d(l("input",{id:"noDamagedFormation","onUpdate:modelValue":e[22]||(e[22]=t=>r(N)?N.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[j,o(N)]]),e[43]||(e[43]=l("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),l("div",vl,[d(l("input",{id:"noCuredFormation","onUpdate:modelValue":e[23]||(e[23]=t=>r($)?$.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[j,o($)]]),e[44]||(e[44]=l("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),o(C)!=="running"?(c(),g("button",{key:0,type:"button",class:"btn btn-primary",onClick:se}," 計算 ")):I("",!0),o(C)==="running"?(c(),g("button",{key:1,type:"button",class:"btn btn-primary",onClick:ne}," 中止 ")):I("",!0),o(v)?(c(),g("div",pl,[l("p",{ref_key:"progressView",ref:de},x(o(C)==="running"?`計算中... ${o(A).toFixed(2)}%`:"計算完了"),513),l("div",ml,[l("div",cl,[l("p",null,"最高得点: "+x(o(v).score)+" ("+x(o(v).liveGrandPrixPt)+"pt)",1),e[46]||(e[46]=l("p",null,"メンバー:",-1)),l("ul",null,[(c(!0),g(J,null,H(o(v).members,t=>(c(),g("li",{key:o(i)(t),style:Ve({fontWeight:o(v).centerMember&&o(U)(t)===o(U)(o(v).centerMember)?"bold":"normal"})},x(o(U)(t)),5))),128))]),l("textarea",{class:"form-control",value:o(v).log,readonly:"",rows:"5"},null,8,fl)])])])):I("",!0)])]),p(me),(c(!0),g(J,null,H(o(ae),(t,W)=>(c(),h(Se(t.component),Me({key:`modal-${W}`,"on-close":t.onClose},{ref_for:!0},t.args),null,16,["on-close"]))),128))])}}});export{xl as default};
