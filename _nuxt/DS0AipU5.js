import{c as ke,m as A,a as de,b as ye,s as W,d as F,e as pe,u as be,f as ue,g as le,h as he,i as $e,_ as Ce,j as we,k as Me,p as Ve,l as Se}from"./Djlki0hQ.js";import{d as ne,y as g,z as M,A as e,F as Ue,G as ge,_ as xe,r as C,k as O,H as X,I as fe,D as Te,J as y,K as x,L as U,M as s,N as z,O as G,P as Ae,B as w,Q as se,R as ee,E as me,x as Ne,C as Le,S as Ee}from"./DiSg5hTn.js";const oe=r=>r<=2100?Math.floor((-5+Math.sqrt(25+20*r))/10):Math.floor(20+(r-2100)/200),ve=(r,p,f)=>(1+r/100)*(1+oe(p)*(f?2:1)/10),te=r=>r<10?1:r<20?1.1:r<30?1.2:r<40?1.3:r<50?1.4:1.5,De=({notes:r,convertedMembers:p,center:f,appealSum:V,mentalSum:m,masteryLevel:c,comboOffset:_})=>{const d=p.find(n=>n.name===f),b=d?.centerSkillCondition,h=d?.centerSkills||[],P=d?.centerAbilities||[],T=P.find(n=>n.type==="cooltime_reduce"),R=P.find(n=>n.type==="ap_reduce"),L=5-Number(T?.value[0]||0),k=Number(R?.value[1]||0),a=p.slice();let i=L,E=0,u=m,t=0,N=0;const l=[],D=[];let o=0,ae=0;const re=ke(r);let I=0,ie=0;const Y=new WeakMap,_e=60/(re-(_||0));let H,$="";const q=(n,S)=>{const J=oe(N),K=u*100/m;e:for(const v of S){if(v.condition){const[B,Q,Z]=v.condition;let j=0;switch(B){case"skill_count":j=Y.get(n)||0;break;case"total_skill_count":j=ie;break;case"vol_lv":j=J;break;case"mental_rate":j=K;break;default:throw new Error(`条件式が不正です: ${B}`)}if(Z===void 0)throw new Error(`条件式が不正です: ${B}`);switch(Q){case"<=":if(!(j<=Z))continue e;break;case">=":if(!(j>=Z))continue e;break}}switch(v.type){case"vol_buff":D[0]=(D[0]||0)+(v.value||0),$+=`${A[n.name]} vol_buff: +${v.value}
`;break;case"vol_up":{const B=D.shift()||0;N+=Math.ceil((v.value||0)*(1+B/100)),$+=`${A[n.name]} vol_up: +${Math.ceil((v.value||0)*(1+B/100))}
`,$+=`now voltagePoint: ${N}
`;break}case"vol_down":N-=v.value||0,$+=`${A[n.name]} vol_down: -${v.value||0}
`;break;case"score_buff":l[0]=(l[0]||0)+(v.value||0),$+=`${A[n.name]} score_buff: +${v.value}
`;break;case"score_up":{const B=l.shift()||0,Q=(v.value||0)/100*(1+B/100)*ve(c,N,H?.fever||!1);t+=Math.ceil(V*Q),$+=`${A[n.name]} score_up: +${Math.ceil(V*Q)}
`;break}case"mental_up":u+=Math.ceil((v.value||0)/100*m),$+=`${A[n.name]} mental_up: +${Math.ceil((v.value||0)/100*m)}
`;break;case"mental_down":u-=Math.ceil((v.value||0)/100*m),$+=`${A[n.name]} mental_down: -${Math.ceil((v.value||0)/100*m)}
`,u<=0&&(u=1);break;case"ap_up":E+=Math.ceil((v.value||0)*te(I)*1e4)/1e4,$+=`${A[n.name]} ap_up: +${(v.value||0)*te(I)}
`;break;case"ap_down":E-=v.value||0,$+=`${A[n.name]} ap_down: -${v.value||0}
`;break;case"reset":o=a.length-1,$+=`${A[n.name]} reset
`;break;case"splice":a.splice(a.indexOf(n),1),o--,$+=`${A[n.name]} splice
`;break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};d&&b==="start"&&q(d,h);const ce=()=>{const n=a[o];if(!n)throw new Error("メンバーが見つかりません");const S=Math.max(n.ap-k,0);return S<=E&&i<=0?(E-=S,Y.set(n,(Y.get(n)||0)+1),ie++,q(n,n.skills),o=a.length-1===o?0:o+1,i+=L,!0):!1};for(let n=0;n<r.length;n++){const S=r[n];if(H=r[n-1],!S)throw new Error("noteが見つかりません");for(d&&S.fever&&!H?.fever&&b==="fever_start"&&($+=`FEVER START
`,q(d,h)),!S.fever&&H?.fever&&($+=`FEVER END
`),i-=S.time-ae,ae=S.time;ce(););i=Math.max(0,i);for(let J=0;J<S.normalCount+S.slideCount;J++){I++,E+=Math.ceil(_e*te(I)*1e4)/1e4,ce();const K=Math.ceil(V/re*30*ve(c,N,S.fever));t+=K,$+=`combo: ${I}, score: ${t} (+${K}), ap: ${E}, mental: ${u}, vol_lv: ${oe(N)*(S.fever?2:1)}
`}}return d&&b==="end"&&q(d,h),{score:t,log:$}},Be={class:"card-body"},Oe=ne({__name:"MPopup",props:{onClose:{type:Function,default:()=>{}}},setup(r){return(p,f)=>(M(),g("div",{class:"popup-wrapper",onClick:f[1]||(f[1]=V=>p.onClose(null))},[e("div",{class:"popup card overflow-scroll h-100 w-100",onClick:f[0]||(f[0]=ge(()=>{},["stop"]))},[e("div",Be,[Ue(p.$slots,"default",{},void 0)])])]))}}),Fe=Object.assign(xe(Oe,[["__scopeId","data-v-eec55aae"]]),{__name:"MPopup"}),Pe={class:"my-2"},Re={class:"input-group mb-3"},je=["value"],Ie={class:"card my-2"},ze={class:"card-body"},Ge={key:0,class:"my-2"},He={class:"alert alert-info"},qe={class:"card my-2"},Je={class:"card-body"},Ke={key:0,class:"my-2"},Qe={class:"alert alert-info"},We={class:"card my-2"},Xe={class:"card-body"},Ye={key:0,class:"my-2"},Ze={class:"alert alert-info"},et=ne({__name:"MdCardSelect",props:{onClose:{}},setup(r){const p=C(""),f=k=>`[${k.series}] ${k.key!=="other"?ue[k.key]:k.otherName}`,V=O(()=>de.filter(k=>f(k).includes(p.value))),m=C(0),c=O(()=>de[m.value]),_=O(()=>c.value?ye(c.value,b.value,h.value):null),d=O(()=>_.value?W(F(_.value).skills):""),b=C(14),h=C(14),P=O(()=>_.value?W(F(_.value).centerSkills):""),T=O(()=>_.value?pe(F(_.value).centerAbilities):""),R=be("skillCache",{}),L=k=>`${k.key}-${k.series}`;return X(c,()=>{c.value&&(b.value=R.value[L(c.value)]?.skillLevel||14,h.value=R.value[L(c.value)]?.centerSkillLevel||14)}),X([b,h],()=>{c.value&&(R.value[L(c.value)]={centerSkillLevel:h.value,skillLevel:b.value})}),(k,a)=>(M(),fe(Fe,{"on-close":k.onClose},{default:Te(()=>[e("div",Pe,[e("div",Re,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),y(e("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>x(p)?p.value=i:null),type:"text",class:"form-control"},null,512),[[U,s(p)]])]),y(e("select",{"onUpdate:modelValue":a[1]||(a[1]=i=>x(m)?m.value=i:null),class:"form-select"},[(M(!0),g(z,null,G(s(V),(i,E)=>(M(),g("option",{key:`${i.key}-${i.series}`,class:Ae(["card",{"bg-primary":s(c)?.key===i.key}]),value:E}," ["+w(i.series)+"] "+w(i.key!=="other"?s(ue)[i.key]:i.otherName),11,je))),128))],512),[[se,s(m)]])]),e("div",Ie,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",ze,[e("div",null,[a[6]||(a[6]=me(" スキルレベル： ")),y(e("input",{"onUpdate:modelValue":a[2]||(a[2]=i=>x(b)?b.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[U,s(b)]])]),s(c)?(M(),g("div",Ge,[e("div",He,w(s(d)),1)])):ee("",!0)])]),e("div",qe,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Je,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),y(e("input",{"onUpdate:modelValue":a[3]||(a[3]=i=>x(h)?h.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[U,s(h)]]),s(c)?(M(),g("div",Ke,[e("div",Qe," 【"+w(s(le)(s(c).centerSkillCondition))+"】"+w(s(P)),1)])):ee("",!0)])]),e("div",We,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Xe,[s(c)?(M(),g("div",Ye,[e("div",Ze,w(s(T)),1)])):ee("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=i=>k.onClose(s(_)))}," 選択 ")]),_:1},8,["on-close"]))}}),tt=Object.assign(et,{__name:"MdCardSelect"}),lt=he(()=>{const r=C([]);return{modals:r,openModal:f=>{let V;const m=new Promise(d=>{V=d}),_={component:f,onClose:d=>{r.value.splice(r.value.indexOf(_),1),V(d)}};return r.value.push(_),m}}}),st={class:"container-md"},ot={class:"card my-2"},nt={class:"card-body"},at={class:"card-header"},rt={class:"card-body"},it=["onClick"],ct={class:"row my-2 align-items-center justify-content-start"},dt={class:"col-auto"},ut=["onUpdate:modelValue"],vt=["value"],pt={class:"row my-2 align-items-center justify-content-start"},ft={class:"col-auto"},mt=["onUpdate:modelValue"],_t={class:"row row-gap-1"},kt={class:"col-md"},yt=["onUpdate:modelValue"],bt={class:"col-md"},ht=["onUpdate:modelValue"],$t={class:"col-md"},Ct=["onUpdate:modelValue"],wt={class:"col-md"},Mt={class:"input-group"},Vt=["onUpdate:modelValue"],St={class:"my-2"},Ut={class:"row"},gt={class:"col-sm"},xt=["onUpdate:modelValue"],Tt={class:"col-sm"},At={class:"alert alert-secondary"},Nt={class:"my-2"},Lt={class:"row"},Et={class:"col-sm"},Dt=["onUpdate:modelValue"],Bt=["value"],Ot=["onUpdate:modelValue"],Ft={class:"col-sm"},Pt={class:"alert alert-secondary"},Rt={class:"my-2"},jt={class:"row"},It={class:"col-sm"},zt=["onUpdate:modelValue"],Gt={class:"col-sm"},Ht={class:"alert alert-secondary"},qt={class:"row"},Jt={class:"col"},Kt={class:"form-label"},Qt={class:"col"},Wt={class:"form-label"},Xt={class:"card my-2"},Yt={class:"card-body"},Zt={class:"my-2"},el={class:"my-2"},sl=ne({__name:"index",setup(r){const p=C(""),f=C(""),V=C(0),m=C(0),c=C("smile"),_=C(80820),d=C(2960),b=C(50),h=C(""),P=C(0),T=C(Se),R=()=>{const u=T.value.map(F),t=Ve(p.value,V.value),{score:N,log:l}=De({notes:t,convertedMembers:u,center:f.value,appealSum:_.value,mentalSum:d.value,masteryLevel:b.value,comboOffset:m.value});P.value=N,h.value=l},L=O(()=>T.value.reduce((u,t)=>u+t.mental,0)),k=O(()=>{const u=T.value.map(F);return $e(u,c.value,f.value)});X(L,()=>{T.value.every(u=>u.mental)&&(d.value=L.value)}),X(k,()=>{T.value.every(u=>u.smile&&u.pure&&u.cool)&&(_.value=k.value)}),Ne({title:"スクショウ計算機"});const{modals:a,openModal:i}=lt(),E=async u=>{const t=await i(tt);t&&T.value.splice(T.value.indexOf(u),1,t)};return(u,t)=>{const N=Ce;return M(),g("div",st,[t[19]||(t[19]=e("h1",null,"スクショウ計算機",-1)),Le(N,{"note-text":s(p),"onUpdate:noteText":t[0]||(t[0]=l=>x(p)?p.value=l:null),center:s(f),"onUpdate:center":t[1]||(t[1]=l=>x(f)?f.value=l:null),offset:s(V),"onUpdate:offset":t[2]||(t[2]=l=>x(V)?V.value=l:null),"combo-offset":s(m),"onUpdate:comboOffset":t[3]||(t[3]=l=>x(m)?m.value=l:null),attribute:s(c),"onUpdate:attribute":t[4]||(t[4]=l=>x(c)?c.value=l:null),"mastery-level":s(b),"onUpdate:masteryLevel":t[5]||(t[5]=l=>x(b)?b.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",ot,[t[16]||(t[16]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",nt,[(M(!0),g(z,null,G(s(T),(l,D)=>(M(),g("div",{key:D,class:"card m-3"},[e("div",at,w(D+1)+"人目 ",1),e("div",rt,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>E(l)}," カードを選択して入力 ",8,it)]),e("div",ct,[t[9]||(t[9]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",dt,[y(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(M(!0),g(z,null,G(s(we),o=>(M(),g("option",{key:o,value:o},w(s(A)[o]),9,vt))),128))],8,ut),[[se,l.name]])])]),e("div",pt,[t[10]||(t[10]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",ft,[y(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,mt),[[U,l.ap,void 0,{number:!0}]])])]),t[15]||(t[15]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",_t,[e("div",kt,[y(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,yt),[[U,l.smile,void 0,{number:!0}]])]),e("div",bt,[y(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,ht),[[U,l.pure,void 0,{number:!0}]])]),e("div",$t,[y(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,Ct),[[U,l.cool,void 0,{number:!0}]])]),e("div",wt,[e("div",Mt,[t[11]||(t[11]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),y(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Vt),[[U,l.mental,void 0,{number:!0}]])])])]),e("div",St,[t[12]||(t[12]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Ut,[e("div",gt,[y(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,xt),[[U,l.skill]])]),e("div",Tt,[e("div",At,w(s(W)(s(F)(l).skills)),1)])])]),e("div",Nt,[t[13]||(t[13]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Lt,[e("div",Et,[y(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(M(!0),g(z,null,G(s(Me),o=>(M(),g("option",{key:o,value:o},w(s(le)(o)),9,Bt))),128))],8,Dt),[[se,l.centerSkillCondition]]),y(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Ot),[[U,l.centerSkill]])]),e("div",Ft,[e("div",Pt," 【"+w(s(le)(l.centerSkillCondition))+"】"+w(s(W)(s(F)(l).centerSkills)),1)])])]),e("div",Rt,[t[14]||(t[14]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",jt,[e("div",It,[y(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,zt),[[U,l.centerAbilityText]])]),e("div",Gt,[e("div",Ht,w(s(pe)(s(F)(l).centerAbilities)),1)])])])])]))),128)),e("div",qt,[e("div",Jt,[e("label",Kt,"総合アピール値（"+w(s(k))+"）：",1),y(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>x(_)?_.value=l:null),type:"number",class:"form-control"},null,512),[[U,s(_),void 0,{number:!0}]])]),e("div",Qt,[e("label",Wt,"総合メンタル値（"+w(s(L))+"）：",1),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>x(d)?d.value=l:null),type:"number",class:"form-control"},null,512),[[U,s(d),void 0,{number:!0}]])])])])]),e("div",Xt,[t[18]||(t[18]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Yt,[e("button",{type:"button",class:"btn btn-primary",onClick:R}," 計算 "),e("div",Zt," 計算結果: "+w(s(P)),1),e("div",el,[t[17]||(t[17]=me(" ログ： ")),y(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>x(h)?h.value=l:null),rows:"6",class:"form-control"},null,512),[[U,s(h)]])])])]),(M(!0),g(z,null,G(s(a),(l,D)=>(M(),fe(Ee(l.component),{key:`modal-${D}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{sl as default};
