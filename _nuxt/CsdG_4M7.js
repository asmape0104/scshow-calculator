import{c as ke,m as A,a as de,b as be,s as W,d as F,e as pe,u as ye,f as ue,g as le,h as he,i as $e,_ as Ce,j as we,k as Me,p as Ve,l as Se}from"./DGkR7up4.js";import{d as ne,y as g,z as w,A as e,F as Ue,G as ge,_ as xe,r as $,k as O,H as X,I as fe,D as Te,J as b,K as x,L as V,M as s,N as z,O as G,P as Ae,B as C,Q as se,R as ee,E as _e,x as Ne,C as Ee,S as Le}from"./DPU6DC-r.js";const oe=r=>r<=2100?Math.floor((-5+Math.sqrt(25+20*r))/10):Math.floor(20+(r-2100)/200),ve=(r,p,f)=>(1+r/100)*(1+oe(p)*(f?2:1)/10),te=r=>r<10?1:r<20?1.1:r<30?1.2:r<40?1.3:r<50?1.4:1.5,De=({notes:r,convertedMembers:p,center:f,appealSum:S,mentalSum:_,masteryLevel:c,comboOffset:m})=>{const d=p.find(n=>n.name===f),y=d?.centerSkillCondition,h=d?.centerSkills||[],R=d?.centerAbilities||[],T=R.find(n=>n.type==="cooltime_reduce"),P=R.find(n=>n.type==="ap_reduce"),N=5-Number(T?.value[0]||0),k=Number(P?.value[1]||0),a=p.slice();let i=N,E=0,u=_,t=0,L=0;const l=[],D=[];let o=0,ae=0;const re=ke(r);let I=0,ie=0;const Y=new WeakMap,me=60/(re-(m||0));let H,M="";const q=(n,U)=>{const J=oe(L),K=u*100/_;e:for(const v of U){if(v.condition){const[B,Q,Z]=v.condition;let j=0;switch(B){case"skill_count":j=Y.get(n)||0;break;case"total_skill_count":j=ie;break;case"vol_lv":j=J;break;case"mental_rate":j=K;break;default:throw new Error(`条件式が不正です: ${B}`)}if(Z===void 0)throw new Error(`条件式が不正です: ${B}`);switch(Q){case"<=":if(!(j<=Z))continue e;break;case">=":if(!(j>=Z))continue e;break}}switch(v.type){case"vol_buff":D[0]=(D[0]||0)+(v.value||0),M+=`${A[n.name]} vol_buff: +${v.value}
`;break;case"vol_up":{const B=D.shift()||0;L+=(v.value||0)*(1+B/100),M+=`${A[n.name]} vol_up: +${(v.value||0)*(1+B/100)}
`;break}case"vol_down":L-=v.value||0,M+=`${A[n.name]} vol_down: -${v.value||0}
`;break;case"score_buff":l[0]=(l[0]||0)+(v.value||0),M+=`${A[n.name]} score_buff: +${v.value}
`;break;case"score_up":{const B=l.shift()||0,Q=(v.value||0)/100*(1+B/100)*ve(c,L,H?.fever||!1);t+=Math.ceil(S*Q),M+=`${A[n.name]} score_up: +${Math.ceil(S*Q)}
`;break}case"mental_up":u+=Math.ceil((v.value||0)/100*_),M+=`${A[n.name]} mental_up: +${Math.ceil((v.value||0)/100*_)}
`;break;case"mental_down":u-=Math.ceil((v.value||0)/100*_),M+=`${A[n.name]} mental_down: -${Math.ceil((v.value||0)/100*_)}
`,u<=0&&(u=1);break;case"ap_up":E+=Math.ceil((v.value||0)*te(I)*1e4)/1e4,M+=`${A[n.name]} ap_up: +${(v.value||0)*te(I)}
`;break;case"ap_down":E-=v.value||0,M+=`${A[n.name]} ap_down: -${v.value||0}
`;break;case"reset":o=a.length-1,M+=`${A[n.name]} reset
`;break;case"splice":a.splice(a.indexOf(n),1),o--,M+=`${A[n.name]} splice
`;break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};d&&y==="start"&&q(d,h);const ce=()=>{const n=a[o];if(!n)throw new Error("メンバーが見つかりません");const U=Math.max(n.ap-k,0);return U<=E&&i<=0?(E-=U,Y.set(n,(Y.get(n)||0)+1),ie++,q(n,n.skills),o=a.length-1===o?0:o+1,i+=N,!0):!1};for(let n=0;n<r.length;n++){const U=r[n];if(H=r[n-1],!U)throw new Error("noteが見つかりません");for(d&&U.fever&&!H?.fever&&y==="fever_start"&&(M+=`FEVER START
`,q(d,h)),!U.fever&&H?.fever&&(M+=`FEVER END
`),i-=U.time-ae,ae=U.time;ce(););i=Math.max(0,i);for(let J=0;J<U.normalCount+U.slideCount;J++){I++,E+=Math.ceil(me*te(I)*1e4)/1e4,ce();const K=Math.ceil(S/re*30*ve(c,L,U.fever));t+=K,M+=`combo: ${I}, score: ${t} (+${K}), ap: ${E}, mental: ${u}, vol_lv: ${oe(L)*(U.fever?2:1)}
`}}return d&&y==="end"&&q(d,h),{score:t,log:M}},Be={class:"card-body"},Oe=ne({__name:"MPopup",props:{onClose:{type:Function,default:()=>{}}},setup(r){return(p,f)=>(w(),g("div",{class:"popup-wrapper",onClick:f[1]||(f[1]=S=>p.onClose(null))},[e("div",{class:"popup card overflow-scroll h-100 w-100",onClick:f[0]||(f[0]=ge(()=>{},["stop"]))},[e("div",Be,[Ue(p.$slots,"default",{},void 0)])])]))}}),Fe=Object.assign(xe(Oe,[["__scopeId","data-v-eec55aae"]]),{__name:"MPopup"}),Re={class:"my-2"},Pe={class:"input-group mb-3"},je=["value"],Ie={class:"card my-2"},ze={class:"card-body"},Ge={key:0,class:"my-2"},He={class:"alert alert-info"},qe={class:"card my-2"},Je={class:"card-body"},Ke={key:0,class:"my-2"},Qe={class:"alert alert-info"},We={class:"card my-2"},Xe={class:"card-body"},Ye={key:0,class:"my-2"},Ze={class:"alert alert-info"},et=ne({__name:"MdCardSelect",props:{onClose:{}},setup(r){const p=$(""),f=k=>`[${k.series}] ${k.key!=="other"?ue[k.key]:k.otherName}`,S=O(()=>de.filter(k=>f(k).includes(p.value))),_=$(0),c=O(()=>de[_.value]),m=O(()=>c.value?be(c.value,y.value,h.value):null),d=O(()=>m.value?W(F(m.value).skills):""),y=$(14),h=$(14),R=O(()=>m.value?W(F(m.value).centerSkills):""),T=O(()=>m.value?pe(F(m.value).centerAbilities):""),P=ye("skillCache",{}),N=k=>`${k.key}-${k.series}`;return X(c,()=>{c.value&&(y.value=P.value[N(c.value)]?.skillLevel||14,h.value=P.value[N(c.value)]?.centerSkillLevel||14)}),X([y,h],()=>{c.value&&(P.value[N(c.value)]={centerSkillLevel:h.value,skillLevel:y.value})}),(k,a)=>(w(),fe(Fe,{"on-close":k.onClose},{default:Te(()=>[e("div",Re,[e("div",Pe,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),b(e("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>x(p)?p.value=i:null),type:"text",class:"form-control"},null,512),[[V,s(p)]])]),b(e("select",{"onUpdate:modelValue":a[1]||(a[1]=i=>x(_)?_.value=i:null),class:"form-select"},[(w(!0),g(z,null,G(s(S),(i,E)=>(w(),g("option",{key:`${i.key}-${i.series}`,class:Ae(["card",{"bg-primary":s(c)?.key===i.key}]),value:E}," ["+C(i.series)+"] "+C(i.key!=="other"?s(ue)[i.key]:i.otherName),11,je))),128))],512),[[se,s(_)]])]),e("div",Ie,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",ze,[e("div",null,[a[6]||(a[6]=_e(" スキルレベル： ")),b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=i=>x(y)?y.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[V,s(y)]])]),s(c)?(w(),g("div",Ge,[e("div",He,C(s(d)),1)])):ee("",!0)])]),e("div",qe,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Je,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),b(e("input",{"onUpdate:modelValue":a[3]||(a[3]=i=>x(h)?h.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[V,s(h)]]),s(c)?(w(),g("div",Ke,[e("div",Qe," 【"+C(s(le)(s(c).centerSkillCondition))+"】"+C(s(R)),1)])):ee("",!0)])]),e("div",We,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Xe,[s(c)?(w(),g("div",Ye,[e("div",Ze,C(s(T)),1)])):ee("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=i=>k.onClose(s(m)))}," 選択 ")]),_:1},8,["on-close"]))}}),tt=Object.assign(et,{__name:"MdCardSelect"}),lt=he(()=>{const r=$([]);return{modals:r,openModal:f=>{let S;const _=new Promise(d=>{S=d}),m={component:f,onClose:d=>{r.value.splice(r.value.indexOf(m),1),S(d)}};return r.value.push(m),_}}}),st={class:"container-md"},ot={class:"card my-2"},nt={class:"card-body"},at={class:"mb-2"},rt={class:"row"},it={class:"col"},ct={class:"card-header"},dt={class:"card-body"},ut=["onClick"],vt={class:"row my-2 align-items-center justify-content-start"},pt={class:"col-auto"},ft=["onUpdate:modelValue"],_t=["value"],mt={class:"row my-2 align-items-center justify-content-start"},kt={class:"col-auto"},bt=["onUpdate:modelValue"],yt={class:"row row-gap-1"},ht={class:"col-md"},$t=["onUpdate:modelValue"],Ct={class:"col-md"},wt=["onUpdate:modelValue"],Mt={class:"col-md"},Vt=["onUpdate:modelValue"],St={class:"col-md"},Ut={class:"input-group"},gt=["onUpdate:modelValue"],xt={class:"my-2"},Tt={class:"row"},At={class:"col-sm"},Nt=["onUpdate:modelValue"],Et={class:"col-sm"},Lt={class:"alert alert-secondary"},Dt={class:"my-2"},Bt={class:"row"},Ot={class:"col-sm"},Ft=["onUpdate:modelValue"],Rt=["value"],Pt=["onUpdate:modelValue"],jt={class:"col-sm"},It={class:"alert alert-secondary"},zt={class:"my-2"},Gt={class:"row"},Ht={class:"col-sm"},qt=["onUpdate:modelValue"],Jt={class:"col-sm"},Kt={class:"alert alert-secondary"},Qt={class:"row"},Wt={class:"col"},Xt={class:"form-label"},Yt={class:"col"},Zt={class:"form-label"},el={class:"card my-2"},tl={class:"card-body"},ll={class:"my-2"},sl={class:"my-2"},al=ne({__name:"index",setup(r){const p=$(""),f=$(""),S=$(0),_=$(0),c=$("smile"),m=$(80820),d=$(2960),y=$(50),h=$(""),R=$(0),T=$(Se),P=()=>{const u=T.value.map(F),t=Ve(p.value,S.value),{score:L,log:l}=De({notes:t,convertedMembers:u,center:f.value,appealSum:m.value,mentalSum:d.value,masteryLevel:y.value,comboOffset:_.value});R.value=L,h.value=l},N=O(()=>T.value.reduce((u,t)=>u+t.mental,0)),k=O(()=>{const u=T.value.map(F);return $e(u,c.value,f.value)});X(N,()=>{T.value.every(u=>u.mental)&&(d.value=N.value)}),X(k,()=>{T.value.every(u=>u.smile&&u.pure&&u.cool)&&(m.value=k.value)}),Ne({title:"スクショウ計算機"});const{modals:a,openModal:i}=lt(),E=async u=>{const t=await i(tt);t&&T.value.splice(T.value.indexOf(u),1,t)};return(u,t)=>{const L=Ce;return w(),g("div",st,[t[20]||(t[20]=e("h1",null,"スクショウ計算機",-1)),Ee(L,{"note-text":s(p),"onUpdate:noteText":t[0]||(t[0]=l=>x(p)?p.value=l:null),center:s(f),"onUpdate:center":t[1]||(t[1]=l=>x(f)?f.value=l:null),offset:s(S),"onUpdate:offset":t[2]||(t[2]=l=>x(S)?S.value=l:null),"combo-offset":s(_),"onUpdate:comboOffset":t[3]||(t[3]=l=>x(_)?_.value=l:null),attribute:s(c),"onUpdate:attribute":t[4]||(t[4]=l=>x(c)?c.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute"]),e("div",ot,[t[17]||(t[17]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",nt,[e("div",at,[e("div",rt,[e("div",it,[t[9]||(t[9]=e("label",{class:"form-label"},"マスタリーレベル：",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>x(y)?y.value=l:null),type:"number",class:"form-control"},null,512),[[V,s(y),void 0,{number:!0}]])])])]),(w(!0),g(z,null,G(s(T),(l,D)=>(w(),g("div",{key:D,class:"card m-3"},[e("div",ct,C(D+1)+"人目 ",1),e("div",dt,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>E(l)}," カードを選択して入力 ",8,ut)]),e("div",vt,[t[10]||(t[10]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",pt,[b(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(w(!0),g(z,null,G(s(we),o=>(w(),g("option",{key:o,value:o},C(s(A)[o]),9,_t))),128))],8,ft),[[se,l.name]])])]),e("div",mt,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",kt,[b(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,bt),[[V,l.ap,void 0,{number:!0}]])])]),t[16]||(t[16]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",yt,[e("div",ht,[b(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,$t),[[V,l.smile,void 0,{number:!0}]])]),e("div",Ct,[b(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,wt),[[V,l.pure,void 0,{number:!0}]])]),e("div",Mt,[b(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,Vt),[[V,l.cool,void 0,{number:!0}]])]),e("div",St,[e("div",Ut,[t[12]||(t[12]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),b(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,gt),[[V,l.mental,void 0,{number:!0}]])])])]),e("div",xt,[t[13]||(t[13]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Tt,[e("div",At,[b(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,Nt),[[V,l.skill]])]),e("div",Et,[e("div",Lt,C(s(W)(s(F)(l).skills)),1)])])]),e("div",Dt,[t[14]||(t[14]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Bt,[e("div",Ot,[b(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(w(!0),g(z,null,G(s(Me),o=>(w(),g("option",{key:o,value:o},C(s(le)(o)),9,Rt))),128))],8,Ft),[[se,l.centerSkillCondition]]),b(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Pt),[[V,l.centerSkill]])]),e("div",jt,[e("div",It," 【"+C(s(le)(l.centerSkillCondition))+"】"+C(s(W)(s(F)(l).centerSkills)),1)])])]),e("div",zt,[t[15]||(t[15]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Gt,[e("div",Ht,[b(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,qt),[[V,l.centerAbilityText]])]),e("div",Jt,[e("div",Kt,C(s(pe)(s(F)(l).centerAbilities)),1)])])])])]))),128)),e("div",Qt,[e("div",Wt,[e("label",Xt,"総合アピール値（"+C(s(k))+"）：",1),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>x(m)?m.value=l:null),type:"number",class:"form-control"},null,512),[[V,s(m),void 0,{number:!0}]])]),e("div",Yt,[e("label",Zt,"総合メンタル値（"+C(s(N))+"）：",1),b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>x(d)?d.value=l:null),type:"number",class:"form-control"},null,512),[[V,s(d),void 0,{number:!0}]])])])])]),e("div",el,[t[19]||(t[19]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",tl,[e("button",{type:"button",class:"btn btn-primary",onClick:P}," 計算 "),e("div",ll," 計算結果: "+C(s(R)),1),e("div",sl,[t[18]||(t[18]=_e(" ログ： ")),b(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>x(h)?h.value=l:null),rows:"6",class:"form-control"},null,512),[[V,s(h)]])])])]),(w(!0),g(z,null,G(s(a),(l,D)=>(w(),fe(Le(l.component),{key:`modal-${D}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{al as default};
