import{c as $e,m as N,a as ve,b as Ce,s as ee,d as q,e as me,u as we,f as pe,g as ae,_ as Me,h as Ve,i as Ue,j as xe,k as Se,l as ge,p as Te,n as Ae}from"./DQR07F7M.js";import{f as ke,r as C,g as P,h as te,i as ye,o as x,w as Ne,a as e,j as m,k as U,v as T,l as s,c as A,F as G,m as J,n as Ee,t as w,p as ie,q as oe,d as K,u as De,b as Be,s as fe,x as Re}from"./Dvem4_Re.js";const Fe=k=>k<=2100?Math.floor((-5+Math.sqrt(25+20*k))/10):Math.floor(20+(k-2100)/200),_e=(k,S,E)=>(1+k/100)*(1+S*(E?2:1)/10),ne=k=>k<10?1:k<20?1.1:k<30?1.2:k<40?1.3:k<50?1.4:1.5,je=({notes:k,convertedMembers:S,center:E,appealSum:D,mentalSum:p,masteryLevel:r,playStyle:_="perfect",noLog:i=!1,noDamagedFormation:M=!1,noCuredFormation:g=!1})=>{const b=S.find(n=>n.name===E),R=b?.centerSkillCondition,h=b?.centerSkills||[],F=b?.centerAbilities||[],y=F.find(n=>n.type==="cooltime_reduce"),a=F.find(n=>n.type==="ap_reduce"),c=5-Number(y?.value.amount||0),I=Number(a?.value.amount||0),j=S.slice();let f=c,t=0,$=p,l=0;const V={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=Fe(n)},get lv(){return this._lv}},o=[0],Q=[0];let z=0,re=0;const ce=$e(k);let W=0,de=0;const le=new WeakMap,be=60/ce;let X,d="";const Y=(n,u,B)=>{const Z=V.lv,he=$*100/p;e:for(const v of u){if(v.condition){const[O,L,se]=v.condition;let H=0;switch(O){case"skill_count":H=le.get(n)||0;break;case"total_skill_count":H=de;break;case"vol_lv":H=Z*(B?2:1);break;case"mental_rate":H=he;break;default:throw new Error(`条件式が不正です: ${O}`)}if(se===void 0)throw new Error(`条件式が不正です: ${O}`);switch(L){case"<=":if(!(H<=se))continue e;break;case">=":if(!(H>=se))continue e;break}}switch(v.type){case"vol_buff":Q[0]=(Q[0]||0)+(v.value||0),i||(d+=`${N[n.name]} vol_buff: +${v.value}
`);break;case"vol_up":{const O=Q[0]??0;Q[0]=0,V.point+=Math.ceil((v.value||0)*(1+O/100)),i||(d+=`${N[n.name]} vol_up: +${Math.ceil((v.value||0)*(1+O/100))}
`,d+=`now voltagePoint: ${V.point}
`);break}case"vol_down":V.point-=v.value||0,V.point<0&&(V.point=0),i||(d+=`${N[n.name]} vol_down: -${v.value||0}
`);break;case"score_buff":o[0]=(o[0]||0)+(v.value||0),i||(d+=`${N[n.name]} score_buff: +${v.value}
`);break;case"score_up":{const O=o[0]??0;o[0]=0;const L=(v.value||0)/100*(1+O/100)*_e(r,V.lv,B);l+=Math.ceil(D*L),i||(d+=`${N[n.name]} score_up: +${Math.ceil(D*L)}
`);break}case"mental_up":$+=Math.ceil((v.value||0)/100*p),i||(d+=`${N[n.name]} mental_up: +${Math.ceil((v.value||0)/100*p)}
`);break;case"mental_down":$-=Math.ceil((v.value||0)/100*p),i||(d+=`${N[n.name]} mental_down: -${Math.ceil((v.value||0)/100*p)}
`),$<=0&&($=1);break;case"ap_up":t+=Math.ceil((v.value||0)*ne(W)*1e4),i||(d+=`${N[n.name]} ap_up: +${(v.value||0)*ne(W)}
`);break;case"ap_down":t-=(v.value||0)*1e4,i||(d+=`${N[n.name]} ap_down: -${v.value||0}
`);break;case"reset":z=j.length-1,i||(d+=`${N[n.name]} reset
`);break;case"splice":j.splice(j.indexOf(n),1),z--,i||(d+=`${N[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};b&&R==="start"&&Y(b,h,!1);const ue=n=>{if(j.length===0)return!1;const u=j[z];if(!u)throw new Error("メンバーが見つかりません");const B=Math.max(u.ap-I,0);return B*1e4<=t&&f<=0?(t-=B*1e4,le.set(u,(le.get(u)||0)+1),de++,Y(u,u.skills,n),z=j.length-1===z?0:z+1,f+=c,!0):!1};for(let n=0;n<k.length;n++){const u=k[n];if(X=k[n-1],!u)throw new Error("noteが見つかりません");for(f-=u.time-re,re=u.time;ue(X?.fever||!1););f=Math.max(0,f),b&&u.fever&&!X?.fever&&R==="fever_start"&&(i||(d+=`FEVER START
`),Y(b,h,!0)),!u.fever&&X?.fever&&(i||(d+=`FEVER END
`));for(let B=0;B<u.normalCount+u.slideCount;B++){if(_==="desperate"&&$*10>p){B<u.normalCount?$-=Math.ceil(p/15):$-=Math.ceil(p*2/75),i||(d+=`miss, apPoint: ${t}, mental: ${$}, vol_lv: ${V.lv*(u.fever?2:1)}
`);continue}W++,t+=Math.ceil(be*ne(W)*1e4),ue(u.fever);const Z=Math.ceil(D/ce*30*_e(r,V.lv,u.fever));if(l+=Z,i||(d+=`combo: ${W}, score: ${l} (+${Z}), apPoint: ${t}, mental: ${$}, vol_lv: ${V.lv*(u.fever?2:1)}
`),_==="perfect"&&M&&$<p)return i||(d+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:l,log:d};if(_==="desperate"&&g&&$*10>p)return i||(d+=`メンタルが10%超になったため計算を打ち切ります
`),{score:l,log:d}}}return b&&R==="end"&&Y(b,h,!1),{score:l,log:d}},Oe={class:"my-2"},Pe={class:"input-group mb-3"},qe=["value"],ze={class:"card my-2"},He={class:"card-body"},Ie={key:0,class:"my-2"},We={class:"alert alert-info"},Ge={class:"card my-2"},Je={class:"card-body"},Ke={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},Le={class:"alert alert-info"},et=ke({__name:"MdCardSelect",props:{onClose:{}},setup(k){const S=C(""),E=y=>`[${y.series}] ${y.key!=="other"?pe[y.key]:y.otherName}`,D=P(()=>ve.filter(y=>E(y).includes(S.value))),p=C(0),r=P(()=>ve[p.value]),_=P(()=>r.value?Ce(r.value,M.value,g.value):null),i=P(()=>_.value?ee(q(_.value).skills):""),M=C(14),g=C(14),b=P(()=>_.value?ee(q(_.value).centerSkills):""),R=P(()=>_.value?me(q(_.value).centerAbilities):""),h=we("skillCache",{}),F=y=>`${y.key}-${y.series}`;return te(r,()=>{r.value&&(M.value=h.value[F(r.value)]?.skillLevel||14,g.value=h.value[F(r.value)]?.centerSkillLevel||14)}),te([M,g],()=>{r.value&&(h.value[F(r.value)]={centerSkillLevel:g.value,skillLevel:M.value})}),(y,a)=>(x(),ye(Me,{"on-close":y.onClose},{default:Ne(()=>[e("div",Oe,[e("div",Pe,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),m(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>U(S)?S.value=c:null),type:"text",class:"form-control"},null,512),[[T,s(S)]])]),m(e("select",{"onUpdate:modelValue":a[1]||(a[1]=c=>U(p)?p.value=c:null),class:"form-select"},[(x(!0),A(G,null,J(s(D),(c,I)=>(x(),A("option",{key:`${c.key}-${c.series}`,class:Ee(["card",{"bg-primary":s(r)?.key===c.key}]),value:I}," ["+w(c.series)+"] "+w(c.key!=="other"?s(pe)[c.key]:c.otherName),11,qe))),128))],512),[[ie,s(p)]])]),e("div",ze,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",He,[e("div",null,[a[6]||(a[6]=K(" スキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>U(M)?M.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(M)]])]),s(r)?(x(),A("div",Ie,[e("div",We,w(s(i)),1)])):oe("",!0)])]),e("div",Ge,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Je,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":a[3]||(a[3]=c=>U(g)?g.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(g)]]),s(r)?(x(),A("div",Ke,[e("div",Qe," 【"+w(s(ae)(s(r).centerSkillCondition))+"】"+w(s(b)),1)])):oe("",!0)])]),e("div",Xe,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Ye,[s(r)?(x(),A("div",Ze,[e("div",Le,w(s(R)),1)])):oe("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=c=>y.onClose(s(_)))}," 選択 ")]),_:1},8,["on-close"]))}}),tt=Object.assign(et,{__name:"MdCardSelect"}),lt={class:"container-md"},st={class:"card my-2"},ot={class:"card-body"},nt={class:"card-header"},at={class:"card-body"},it=["onClick"],rt={class:"row my-2 align-items-center justify-content-start"},ct={class:"col-auto"},dt=["onUpdate:modelValue"],ut=["value"],vt={class:"row my-2 align-items-center justify-content-start"},pt={class:"col-auto"},ft=["onUpdate:modelValue"],_t={class:"row row-gap-1"},mt={class:"col-md"},kt=["onUpdate:modelValue"],yt={class:"col-md"},bt=["onUpdate:modelValue"],ht={class:"col-md"},$t=["onUpdate:modelValue"],Ct={class:"col-md"},wt={class:"input-group"},Mt=["onUpdate:modelValue"],Vt={class:"my-2"},Ut={class:"row"},xt={class:"col-sm"},St=["onUpdate:modelValue"],gt={class:"col-sm"},Tt={class:"alert alert-secondary"},At={class:"my-2"},Nt={class:"row"},Et={class:"col-sm"},Dt=["onUpdate:modelValue"],Bt=["value"],Rt=["onUpdate:modelValue"],Ft={class:"col-sm"},jt={class:"alert alert-secondary"},Ot={class:"my-2"},Pt={class:"row"},qt={class:"col-sm"},zt=["onUpdate:modelValue"],Ht={class:"col-sm"},It={class:"alert alert-secondary"},Wt={class:"row"},Gt={class:"col"},Jt={class:"form-label"},Kt={class:"col"},Qt={class:"form-label"},Xt={class:"card my-2"},Yt={class:"card-body"},Zt={class:"mb-2"},Lt={class:"row"},el={class:"col-auto"},tl={class:"col-auto"},ll={class:"my-2"},sl={class:"my-2"},al=ke({__name:"index",setup(k){const S=C(""),E=C(""),D=C(0),p=C(0),r=C("smile"),_=C("perfect"),i=C(80820),M=C(2960),g=C(50),b=C(""),R=C(0),h=C(Ae),F=()=>{const f=h.value.map(q),t=Te(S.value,D.value),{score:$,log:l}=je({notes:t,convertedMembers:f,center:E.value,appealSum:i.value,mentalSum:M.value,masteryLevel:g.value,playStyle:_.value});R.value=$,b.value=l},y=P(()=>h.value.reduce((f,t)=>f+t.mental,0)),a=P(()=>{const f=h.value.map(q);return Ve(f,r.value,E.value)});te(y,()=>{h.value.every(f=>f.mental)&&(M.value=y.value)}),te(a,()=>{h.value.every(f=>f.smile&&f.pure&&f.cool)&&(i.value=a.value)}),De({title:"スクショウ計算機"});const{modals:c,openModal:I}=Ue(),j=async f=>{const t=await I(tt);t&&h.value.splice(h.value.indexOf(f),1,t)};return(f,t)=>{const $=xe;return x(),A("div",lt,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),Be($,{"note-text":s(S),"onUpdate:noteText":t[0]||(t[0]=l=>U(S)?S.value=l:null),center:s(E),"onUpdate:center":t[1]||(t[1]=l=>U(E)?E.value=l:null),offset:s(D),"onUpdate:offset":t[2]||(t[2]=l=>U(D)?D.value=l:null),"combo-offset":s(p),"onUpdate:comboOffset":t[3]||(t[3]=l=>U(p)?p.value=l:null),attribute:s(r),"onUpdate:attribute":t[4]||(t[4]=l=>U(r)?r.value=l:null),"mastery-level":s(g),"onUpdate:masteryLevel":t[5]||(t[5]=l=>U(g)?g.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",st,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ot,[(x(!0),A(G,null,J(s(h),(l,V)=>(x(),A("div",{key:V,class:"card m-3"},[e("div",nt,w(V+1)+"人目 ",1),e("div",at,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>j(l)}," カードを選択して入力 ",8,it)]),e("div",rt,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",ct,[m(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(x(!0),A(G,null,J(s(Se),o=>(x(),A("option",{key:o,value:o},w(s(N)[o]),9,ut))),128))],8,dt),[[ie,l.name]])])]),e("div",vt,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",pt,[m(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,ft),[[T,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",_t,[e("div",mt,[m(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,kt),[[T,l.smile,void 0,{number:!0}]])]),e("div",yt,[m(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,bt),[[T,l.pure,void 0,{number:!0}]])]),e("div",ht,[m(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,$t),[[T,l.cool,void 0,{number:!0}]])]),e("div",Ct,[e("div",wt,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),m(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Mt),[[T,l.mental,void 0,{number:!0}]])])])]),e("div",Vt,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Ut,[e("div",xt,[m(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,St),[[T,l.skill]])]),e("div",gt,[e("div",Tt,w(s(ee)(s(q)(l).skills)),1)])])]),e("div",At,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Nt,[e("div",Et,[m(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(x(!0),A(G,null,J(s(ge),o=>(x(),A("option",{key:o,value:o},w(s(ae)(o)),9,Bt))),128))],8,Dt),[[ie,l.centerSkillCondition]]),m(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Rt),[[T,l.centerSkill]])]),e("div",Ft,[e("div",jt," 【"+w(s(ae)(l.centerSkillCondition))+"】"+w(s(ee)(s(q)(l).centerSkills)),1)])])]),e("div",Ot,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Pt,[e("div",qt,[m(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,zt),[[T,l.centerAbilityText]])]),e("div",Ht,[e("div",It,w(s(me)(s(q)(l).centerAbilities)),1)])])])])]))),128)),e("div",Wt,[e("div",Gt,[e("label",Jt,"総合アピール値（"+w(s(a))+"）：",1),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>U(i)?i.value=l:null),type:"number",class:"form-control"},null,512),[[T,s(i),void 0,{number:!0}]])]),e("div",Kt,[e("label",Qt,"総合メンタル値（"+w(s(y))+"）：",1),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>U(M)?M.value=l:null),type:"number",class:"form-control"},null,512),[[T,s(M),void 0,{number:!0}]])])])])]),e("div",Xt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Yt,[e("div",Zt,[t[21]||(t[21]=K(" プレイスタイル： ",-1)),e("div",Lt,[e("div",el,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>U(_)?_.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[fe,s(_)]]),t[19]||(t[19]=K(" 渾身 ",-1))])]),e("div",tl,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>U(_)?_.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[fe,s(_)]]),t[20]||(t[20]=K(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:F}," 計算 "),e("div",ll," 計算結果: "+w(s(R)),1),e("div",sl,[t[22]||(t[22]=K(" ログ： ",-1)),m(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>U(b)?b.value=l:null),rows:"6",class:"form-control"},null,512),[[T,s(b)]])])])]),(x(!0),A(G,null,J(s(c),(l,V)=>(x(),ye(Re(l.component),{key:`modal-${V}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{al as default};
