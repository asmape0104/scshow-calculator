import{c as Ce,m as D,a as pe,b as we,s as oe,d as z,e as me,u as Ve,_ as Ue,f as fe,g as de,h as xe,i as Me,j as ge,k as Se,l as Te,n as Ae,o as Ne,p as Ee,q as De}from"./D3UBTnuX.js";import{f as ye,r as k,g as F,h as Z,i as ke,o as $,w as Be,a as e,j as m,b as $e,k as h,v as T,l as s,c as V,F as J,m as Q,n as Re,t as C,p as ue,q as se,d as X,u as Fe,s as ie,x as je}from"./oJLfNmTt.js";const Oe=y=>y<=2100?Math.floor((-5+Math.sqrt(25+20*y))/10):Math.floor(20+(y-2100)/200),_e=(y,g,A)=>(1+y/100)*(1+g*(A?2:1)/10),re=y=>y<10?1:y<20?1.1:y<30?1.2:y<40?1.3:y<50?1.4:1.5,Pe=({notes:y,convertedMembers:g,center:A,appealSum:B,mentalSum:f,masteryLevel:d,playStyle:U="perfect",noLog:i=!1,noDamagedFormation:x=!1,noCuredFormation:M=!1,centerMember:w=g.find(N=>N.name===A)})=>{const N=w?.centerSkillCondition,R=w?.centerSkills||[],b=w?.centerAbilities||[],u=b.find(r=>r.type==="cooltime_reduce"),a=b.find(r=>r.type==="ap_reduce"),W=5-Number(u?.value.amount||0),_=Number(a?.value.amount||0),E=g.slice();let j=W,O=0,S=f,H=0;const n={_point:0,_lv:0,get point(){return this._point},set point(r){this._point=r,this._lv=Oe(r)},get lv(){return this._lv}},l=[0],I=[0];let t=0,P=0;const o=Ce(y);let Y=0,ce=0;const ne=new WeakMap,be=60/o;let L,c="";const ee=(r,v,q)=>{const te=n.lv,he=S*100/f;e:for(const p of v){if(p.condition){const[K,le,ae]=p.condition;let G=0;switch(K){case"skill_count":G=ne.get(r)||0;break;case"total_skill_count":G=ce;break;case"vol_lv":G=te*(q?2:1);break;case"mental_rate":G=he;break;default:throw new Error(`条件式が不正です: ${K}`)}if(ae===void 0)throw new Error(`条件式が不正です: ${K}`);switch(le){case"<=":if(!(G<=ae))continue e;break;case">=":if(!(G>=ae))continue e;break}}switch(p.type){case"vol_buff":I[0]=(I[0]||0)+(p.value||0),i||(c+=`${D[r.name]} vol_buff: +${p.value}
`);break;case"vol_up":{const K=I[0]??0;I[0]=0,n.point+=Math.ceil((p.value||0)*(1+K/100)),i||(c+=`${D[r.name]} vol_up: +${Math.ceil((p.value||0)*(1+K/100))}
`,c+=`now voltagePoint: ${n.point}
`);break}case"vol_down":n.point-=p.value||0,n.point<0&&(n.point=0),i||(c+=`${D[r.name]} vol_down: -${p.value||0}
`);break;case"score_buff":l[0]=(l[0]||0)+(p.value||0),i||(c+=`${D[r.name]} score_buff: +${p.value}
`);break;case"score_up":{const K=l[0]??0;l[0]=0;const le=(p.value||0)/100*(1+K/100)*_e(d,n.lv,q);H+=Math.ceil(B*le),i||(c+=`${D[r.name]} score_up: +${Math.ceil(B*le)}
`);break}case"mental_up":S+=Math.ceil((p.value||0)/100*f),i||(c+=`${D[r.name]} mental_up: +${Math.ceil((p.value||0)/100*f)}
`);break;case"mental_down":S-=Math.ceil((p.value||0)/100*f),i||(c+=`${D[r.name]} mental_down: -${Math.ceil((p.value||0)/100*f)}
`),S<=0&&(S=1);break;case"ap_up":O+=Math.ceil((p.value||0)*re(Y)*1e4),i||(c+=`${D[r.name]} ap_up: +${(p.value||0)*re(Y)}
`);break;case"ap_down":O-=(p.value||0)*1e4,i||(c+=`${D[r.name]} ap_down: -${p.value||0}
`);break;case"reset":t=E.length-1,i||(c+=`${D[r.name]} reset
`);break;case"splice":E.splice(E.indexOf(r),1),t--,i||(c+=`${D[r.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};w&&N==="start"&&ee(w,R,!1);const ve=r=>{if(E.length===0)return!1;const v=E[t];if(!v)throw new Error("メンバーが見つかりません");const q=Math.max(v.ap-_,0);return q*1e4<=O&&j<=0?(O-=q*1e4,ne.set(v,(ne.get(v)||0)+1),ce++,ee(v,v.skills,r),t=E.length-1===t?0:t+1,j+=W,!0):!1};for(let r=0;r<y.length;r++){const v=y[r];if(L=y[r-1],!v)throw new Error("noteが見つかりません");for(j-=v.time-P,P=v.time;ve(L?.fever||!1););j=Math.max(0,j),w&&v.fever&&!L?.fever&&N==="fever_start"&&(i||(c+=`FEVER START
`),ee(w,R,!0)),!v.fever&&L?.fever&&(i||(c+=`FEVER END
`));for(let q=0;q<v.normalCount+v.slideCount;q++){if(U==="desperate"&&S*10>f){q<v.normalCount?S-=Math.ceil(f/15):S-=Math.ceil(f*2/75),i||(c+=`miss, apPoint: ${O}, mental: ${S}, vol_lv: ${n.lv*(v.fever?2:1)}
`);continue}Y++,O+=Math.ceil(be*re(Y)*1e4),ve(v.fever);const te=Math.ceil(B/o*30*_e(d,n.lv,v.fever));if(H+=te,i||(c+=`combo: ${Y}, score: ${H} (+${te}), apPoint: ${O}, mental: ${S}, vol_lv: ${n.lv*(v.fever?2:1)}
`),U==="perfect"&&x&&S<f)return i||(c+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:H,log:c};if(U==="desperate"&&M&&S*10>f)return i||(c+=`メンタルが10%超になったため計算を打ち切ります
`),{score:H,log:c}}}return w&&N==="end"&&ee(w,R,!1),{score:H,log:c}},qe={class:"my-2"},ze={class:"input-group mb-3"},He={class:"input-group-prepend"},Ie={class:"input-group-text"},Ke={style:{"min-height":"1.5em"}},We=["value"],Ge={class:"card my-2"},Je={class:"card-body"},Qe={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye={class:"card my-2"},Ze={class:"card-body"},Le={key:0,class:"my-2"},et={class:"alert alert-info"},tt={class:"card my-2"},lt={class:"card-body"},st={key:0,class:"my-2"},ot={class:"alert alert-info"},nt=ye({__name:"MdCardSelect",props:{onClose:{}},setup(y){const g=k(""),A=u=>`[${u.series}] ${u.key!=="other"?fe[u.key]:u.otherName}`,B=F(()=>pe.filter(u=>A(u).includes(g.value))),f=k(0),d=F(()=>pe[f.value]),U=F(()=>d.value?we(d.value,x.value,M.value):null),i=F(()=>U.value?oe(z(U.value).skills):""),x=k(14),M=k(14),w=F(()=>U.value?oe(z(U.value).centerSkills):""),N=F(()=>U.value?me(z(U.value).centerAbilities):""),R=Ve("skillCache",{}),b=u=>`${u.key}-${u.series}`;return Z(d,()=>{d.value&&(x.value=R.value[b(d.value)]?.skillLevel||14,M.value=R.value[b(d.value)]?.centerSkillLevel||14)}),Z([x,M],()=>{d.value&&(R.value[b(d.value)]={centerSkillLevel:M.value,skillLevel:x.value})}),(u,a)=>{const W=Ue;return $(),ke(xe,{"on-close":u.onClose},{default:Be(()=>[e("div",qe,[e("div",ze,[e("div",He,[e("div",Ie,[e("div",Ke,[$e(W,{icon:["fas","magnifying-glass"]})])])]),m(e("input",{"onUpdate:modelValue":a[0]||(a[0]=_=>h(g)?g.value=_:null),type:"text",class:"form-control"},null,512),[[T,s(g)]])]),m(e("select",{"onUpdate:modelValue":a[1]||(a[1]=_=>h(f)?f.value=_:null),class:"form-select"},[($(!0),V(J,null,Q(s(B),(_,E)=>($(),V("option",{key:`${_.key}-${_.series}`,class:Re(["card",{"bg-primary":s(d)?.key===_.key}]),value:E}," ["+C(_.series)+"] "+C(_.key!=="other"?s(fe)[_.key]:_.otherName),11,We))),128))],512),[[ue,s(f)]])]),e("div",Ge,[a[6]||(a[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Je,[e("div",null,[a[5]||(a[5]=X(" スキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":a[2]||(a[2]=_=>h(x)?x.value=_:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(x)]])]),s(d)?($(),V("div",Qe,[e("div",Xe,C(s(i)),1)])):se("",!0)])]),e("div",Ye,[a[8]||(a[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ze,[a[7]||(a[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":a[3]||(a[3]=_=>h(M)?M.value=_:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[T,s(M)]]),s(d)?($(),V("div",Le,[e("div",et," 【"+C(s(de)(s(d).centerSkillCondition))+"】"+C(s(w)),1)])):se("",!0)])]),e("div",tt,[a[9]||(a[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",lt,[s(d)?($(),V("div",st,[e("div",ot,C(s(N)),1)])):se("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=_=>u.onClose(s(U)))}," 選択 ")]),_:1},8,["on-close"])}}}),at=Object.assign(nt,{__name:"MdCardSelect"}),it={class:"container-md"},rt={class:"card my-2"},dt={class:"card-body"},ut={class:"card-header"},ct={class:"card-body"},vt=["onClick"],pt={class:"row my-2 align-items-center justify-content-start"},ft={class:"col-auto"},_t=["onUpdate:modelValue"],mt=["value"],yt={class:"row my-2 align-items-center justify-content-start"},kt={class:"col-auto"},$t=["onUpdate:modelValue"],bt={class:"row row-gap-1"},ht={class:"col-md"},Ct=["onUpdate:modelValue"],wt={class:"col-md"},Vt=["onUpdate:modelValue"],Ut={class:"col-md"},xt=["onUpdate:modelValue"],Mt={class:"col-md"},gt={class:"input-group"},St=["onUpdate:modelValue"],Tt={class:"my-2"},At={class:"row"},Nt={class:"col-sm"},Et=["onUpdate:modelValue"],Dt={class:"col-sm"},Bt={class:"alert alert-secondary"},Rt={class:"my-2"},Ft={class:"row"},jt={class:"col-sm"},Ot=["onUpdate:modelValue"],Pt=["value"],qt=["onUpdate:modelValue"],zt={class:"col-sm"},Ht={class:"alert alert-secondary"},It={class:"my-2"},Kt={class:"row"},Wt={class:"col-sm"},Gt=["onUpdate:modelValue"],Jt={class:"col-sm"},Qt={class:"alert alert-secondary"},Xt={class:"row"},Yt={class:"col"},Zt={class:"form-label"},Lt={class:"col"},el={class:"form-label"},tl={class:"card my-2"},ll={class:"card-body"},sl={class:"mb-2"},ol={class:"row"},nl={class:"col-auto"},al={class:"col-auto"},il={class:"mb-2"},rl=["value","id"],dl=["for"],ul={key:0},cl={class:"my-2"},vl={class:"my-2"},_l=ye({__name:"index",setup(y){const g=k(""),A=k(""),B=k(0),f=k(0),d=k("smile"),U=k([]),i=k("perfect"),x=k(80820),M=k(2960),w=k(50),N=k(""),R=k(0),b=k(De),u=F(()=>b.value.filter(n=>n.key===A.value)),a=k(null),W=F(()=>{if(a.value)return b.value.find(n=>`${n.key}-${n.series}`===a.value)});Z(u,()=>{a.value=u.value[0]?`${u.value[0].key}-${u.value[0].series}`:null});const _=()=>{const n=b.value.map(z),l=Ee(g.value,B.value),{score:I,log:t}=Pe({notes:l,convertedMembers:n,center:A.value,appealSum:x.value,mentalSum:M.value,masteryLevel:w.value,playStyle:i.value,centerMember:W.value?z(W.value):void 0});R.value=I,N.value=t},E=F(()=>b.value.reduce((n,l)=>n+l.mental,0)),j=F(()=>{const n=b.value.map(z);return Me(n,d.value,A.value)});Z(E,()=>{b.value.every(n=>n.mental)&&(M.value=E.value)}),Z(j,()=>{b.value.every(n=>n.smile&&n.pure&&n.cool)&&(x.value=j.value)}),Fe({title:"スクショウ計算機"});const{modals:O,openModal:S}=ge(),H=async n=>{const l=await S(at);l&&b.value.splice(b.value.indexOf(n),1,l)};return(n,l)=>{const I=Se;return $(),V("div",it,[l[27]||(l[27]=e("h1",null,"スクショウ計算機",-1)),$e(I,{"note-text":s(g),"onUpdate:noteText":l[0]||(l[0]=t=>h(g)?g.value=t:null),center:s(A),"onUpdate:center":l[1]||(l[1]=t=>h(A)?A.value=t:null),offset:s(B),"onUpdate:offset":l[2]||(l[2]=t=>h(B)?B.value=t:null),"combo-offset":s(f),"onUpdate:comboOffset":l[3]||(l[3]=t=>h(f)?f.value=t:null),attribute:s(d),"onUpdate:attribute":l[4]||(l[4]=t=>h(d)?d.value=t:null),"mastery-level":s(w),"onUpdate:masteryLevel":l[5]||(l[5]=t=>h(w)?w.value=t:null),singers:s(U),"onUpdate:singers":l[6]||(l[6]=t=>h(U)?U.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",rt,[l[20]||(l[20]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",dt,[($(!0),V(J,null,Q(s(b),(t,P)=>($(),V("div",{key:P,class:"card m-3"},[e("div",ut,C(P+1)+"人目 ",1),e("div",ct,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>H(t)}," カードを選択して入力 ",8,vt)]),e("div",pt,[l[13]||(l[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",ft,[m(e("select",{"onUpdate:modelValue":o=>t.name=o,class:"form-select"},[($(!0),V(J,null,Q(s(Te),o=>($(),V("option",{key:o,value:o},C(s(D)[o]),9,mt))),128))],8,_t),[[ue,t.name]])])]),e("div",yt,[l[14]||(l[14]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",kt,[m(e("input",{"onUpdate:modelValue":o=>t.ap=o,type:"number",class:"form-control"},null,8,$t),[[T,t.ap,void 0,{number:!0}]])])]),l[19]||(l[19]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",bt,[e("div",ht,[m(e("input",{"onUpdate:modelValue":o=>t.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,Ct),[[T,t.smile,void 0,{number:!0}]])]),e("div",wt,[m(e("input",{"onUpdate:modelValue":o=>t.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Vt),[[T,t.pure,void 0,{number:!0}]])]),e("div",Ut,[m(e("input",{"onUpdate:modelValue":o=>t.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,xt),[[T,t.cool,void 0,{number:!0}]])]),e("div",Mt,[e("div",gt,[l[15]||(l[15]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),m(e("input",{"onUpdate:modelValue":o=>t.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,St),[[T,t.mental,void 0,{number:!0}]])])])]),e("div",Tt,[l[16]||(l[16]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",At,[e("div",Nt,[m(e("textarea",{"onUpdate:modelValue":o=>t.skill=o,class:"form-control"},null,8,Et),[[T,t.skill]])]),e("div",Dt,[e("div",Bt,C(s(oe)(s(z)(t).skills)),1)])])]),e("div",Rt,[l[17]||(l[17]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Ft,[e("div",jt,[m(e("select",{"onUpdate:modelValue":o=>t.centerSkillCondition=o,class:"form-select"},[($(!0),V(J,null,Q(s(Ae),o=>($(),V("option",{key:o,value:o},C(s(de)(o)),9,Pt))),128))],8,Ot),[[ue,t.centerSkillCondition]]),m(e("textarea",{"onUpdate:modelValue":o=>t.centerSkill=o,class:"form-control"},null,8,qt),[[T,t.centerSkill]])]),e("div",zt,[e("div",Ht," 【"+C(s(de)(t.centerSkillCondition))+"】"+C(s(oe)(s(z)(t).centerSkills)),1)])])]),e("div",It,[l[18]||(l[18]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Kt,[e("div",Wt,[m(e("textarea",{"onUpdate:modelValue":o=>t.centerAbilityText=o,class:"form-control"},null,8,Gt),[[T,t.centerAbilityText]])]),e("div",Jt,[e("div",Qt,C(s(me)(s(z)(t).centerAbilities)),1)])])])])]))),128)),e("div",Xt,[e("div",Yt,[e("label",Zt,"総合アピール値（"+C(s(j))+"）：",1),m(e("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>h(x)?x.value=t:null),type:"number",class:"form-control"},null,512),[[T,s(x),void 0,{number:!0}]])]),e("div",Lt,[e("label",el,"総合メンタル値（"+C(s(E))+"）：",1),m(e("input",{"onUpdate:modelValue":l[8]||(l[8]=t=>h(M)?M.value=t:null),type:"number",class:"form-control"},null,512),[[T,s(M),void 0,{number:!0}]])])])])]),e("div",tl,[l[26]||(l[26]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",ll,[e("div",sl,[l[23]||(l[23]=X(" プレイスタイル： ",-1)),e("div",ol,[e("div",nl,[e("label",null,[m(e("input",{"onUpdate:modelValue":l[9]||(l[9]=t=>h(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[ie,s(i)]]),l[21]||(l[21]=X(" 渾身 ",-1))])]),e("div",al,[e("label",null,[m(e("input",{"onUpdate:modelValue":l[10]||(l[10]=t=>h(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[ie,s(i)]]),l[22]||(l[22]=X(" 背水 ",-1))])])])]),e("div",il,[l[24]||(l[24]=X(" センター： ",-1)),($(!0),V(J,null,Q(s(u),t=>($(),V("div",{key:`${t.key}-${t.series}`},[m(e("input",{type:"radio",class:"form-check-input",value:`${t.key}-${t.series}`,"onUpdate:modelValue":l[11]||(l[11]=P=>h(a)?a.value=P:null),id:`${t.key}-${t.series}-center`},null,8,rl),[[ie,s(a)]]),e("label",{for:`${t.key}-${t.series}-center`,class:"form-check-label"},C(s(Ne)(t)),9,dl)]))),128)),s(u).length===0?($(),V("div",ul," （センターなし） ")):se("",!0)]),e("button",{type:"button",class:"btn btn-primary",onClick:_}," 計算 "),e("div",cl," 計算結果: "+C(s(R)),1),e("div",vl,[l[25]||(l[25]=X(" ログ： ",-1)),m(e("textarea",{"onUpdate:modelValue":l[12]||(l[12]=t=>h(N)?N.value=t:null),rows:"6",class:"form-control"},null,512),[[T,s(N)]])])])]),($(!0),V(J,null,Q(s(O),(t,P)=>($(),ke(je(t.component),{key:`modal-${P}`,"on-close":t.onClose},null,40,["on-close"]))),128))])}}});export{_l as default};
