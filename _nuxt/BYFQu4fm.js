import{u as we,a as Le,t as u,v as _e,k as Ue,q as Fe,b as le,w as Ve,x as Me,l as he,_ as Se,p as M}from"./U3HUF5Eg.js";import{_ as De,a as Pe,b as Re,c as Ne,M as ze}from"./81f5tN5C.js";import{f as Oe,r as n,h as Te,g as G,y as $e,u as qe,c as b,a as t,b as m,k as a,l as o,j as v,v as Ae,w as oe,t as y,q as Y,d as f,s as U,z as h,F as X,m as Z,o as g,i as se,A as Be,B as Ee,C as We,x as Ge}from"./BDrL13YQ.js";const je={class:"container-md"},Ie={class:"card my-2"},Ke={class:"card-body"},Je={class:"table"},He={scope:"col"},Qe={class:"d-flex align-items-end"},Ye={class:""},Xe={class:"input-group"},Ze={class:"input-group-prepend"},et={class:"input-group-text"},tt={style:{"min-height":"1.5em"}},lt={style:{"text-align":"right"}},ot={class:"d-flex gap-2"},st=["disabled"],nt={class:"card my-2"},at={class:"card-body"},rt={class:"mb-2"},it={class:"row"},ut={class:"col-auto"},dt={class:"col-auto"},vt={class:"mb-2"},ct={class:"row"},pt={class:"col-auto"},mt={class:"col-auto"},ft={class:"mb-2"},gt={class:"row"},kt={class:"col-auto"},bt={class:"col-auto"},yt={class:"mb-2"},xt={class:"form-check"},Ct={class:"form-check-label",for:"parallel"},wt={class:"form-check"},Lt={class:"form-check"},_t={class:"form-check"},Ut={class:"form-check"},Ft={key:2},Vt={class:"card my-2"},Mt={class:"card-body"},ht=["value"],Nt=Oe({__name:"auto-formation",setup(St){const x=n("finished"),_=n(void 0),ne=async()=>{if(_.value)try{await _.value.release(),_.value=void 0}catch{}if("wakeLock"in navigator)try{_.value=await navigator.wakeLock.request("screen")}catch(s){console.error(s)}};Te(x,async s=>{if(s==="finished")try{await _.value?.release(),_.value=void 0}catch{}});const S=n(""),D=n(""),P=n(0),j=n(0),R=n("smile"),N=n(50),C=n("perfect"),w=n("current"),L=n("score"),z=n(!0),O=n([]),T=we("seasonFanLvs",{kaho:1,sayaka:1,rurino:1,ginko:1,kosuzu:1,hime:1,ceras:1,izumi:1,kozue:1,tsuzuri:1,megumi:1}),$=n(""),q=n(!0),A=n(!0),B=n(!1),E=n(!1),c=n([...Le]),d=n(Object.fromEntries(c.value.map(s=>[u(s),{level:_e[s.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),ae=(s,e)=>{d.value[s]=e},re=G(()=>c.value.filter(s=>d.value[u(s)]?.selected==="required").length),ie=G(()=>c.value.filter(s=>d.value[u(s)]?.selected==="excluded").length),ue=G(()=>c.value.filter(s=>d.value[u(s)]?.selected==="optional").length),F=n([]),I=n([]),K=n(0),J=n(1);$e(()=>{J.value=navigator.hardwareConcurrency||4});const p=n(null),de=G(()=>I.value.reduce((s,e)=>s+e,0)),ee=n(Promise.resolve()),ve=s=>{F.value=Array.from({length:s},()=>new Worker(new URL(""+new URL("calc-worker-parallel-VbB7FMK6.js",import.meta.url).href,import.meta.url),{type:"module"})),F.value.forEach((e,k)=>{e.onmessage=i=>{switch(i.data.message){case"calcScore":ee.value=ee.value.then(async()=>{i.data.data.score>(p.value?.score||0)&&(p.value={score:i.data.data.score,liveGrandPrixPt:i.data.data.liveGrandPrixPt,members:i.data.data.members,centerMember:i.data.data.centerMember,log:i.data.data.log})});break;case"progress":I.value[k]=i.data.data.progress;break;case"end":K.value++,K.value===F.value.length&&(x.value="finished");break}}})},ce=()=>{const s=z.value?J.value:1;ve(s),ne(),p.value=null,I.value=Array.from({length:s.value},()=>0),K.value=0;const e=Fe(S.value,P.value),k=c.value.filter(r=>d.value[u(r)]&&d.value[u(r)].selected==="required").map(r=>le(r,d.value[u(r)]?.skillLevel||10,d.value[u(r)]?.centerSkillLevel||10,d.value[u(r)]?.level||1));if(k.length>6){V("必要メンバーが6人を超えています");return}const i=c.value.filter(r=>!d.value[u(r)]?.selected||d.value[u(r)].selected==="optional").map(r=>le(r,d.value[u(r)]?.skillLevel||10,d.value[u(r)]?.centerSkillLevel||10,d.value[u(r)]?.level||1));x.value="running",F.value.forEach((r,W)=>{r.postMessage(JSON.parse(JSON.stringify({requiredMembers:k,optionalMembers:i,notes:e,center:D.value,attribute:R.value,masteryLevel:N.value,playStyle:C.value,formationRule:w.value,includingCenterOnly:q.value,noLog:A.value,noDamagedFormation:B.value,noCuredFormation:E.value,scoreComparisonRule:L.value,seasonFanLvs:T.value,singers:O.value,batchNum:s,batchIndex:W})))})},pe=()=>{F.value.forEach(s=>{s.terminate()}),x.value="finished"},V=s=>{window.alert(s)},{modals:me,openModal:fe}=Ue(),ge=async s=>{await fe(ze,{card:s,displayLevel:d.value[u(s)]?.level||1})},H=n(null),ke=()=>{const s=H.value?.files?.[0];if(s){const e=new FileReader;e.onload=k=>{const i=k.target?.result;c.value=c.value.concat(Ve(i))},e.readAsText(s)}},be=n(null),te=n(!1),ye=()=>{c.value=c.value.concat(Me),te.value=!0};return qe({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"},{name:"description",content:"スクショウの編成を自動で計算します"}]}),(s,e)=>{const k=he,i=Se,r=Pe,W=De,xe=Re,Ce=Ne;return g(),b("div",je,[e[51]||(e[51]=t("h1",null,"スクショウ自動編成",-1)),e[52]||(e[52]=t("a",{href:"https://note.com/asmape/n/nefd46574f4e3",target:"_blank"},"note",-1)),m(k,{"note-text":o(S),"onUpdate:noteText":e[0]||(e[0]=l=>a(S)?S.value=l:null),center:o(D),"onUpdate:center":e[1]||(e[1]=l=>a(D)?D.value=l:null),offset:o(P),"onUpdate:offset":e[2]||(e[2]=l=>a(P)?P.value=l:null),"combo-offset":o(j),"onUpdate:comboOffset":e[3]||(e[3]=l=>a(j)?j.value=l:null),attribute:o(R),"onUpdate:attribute":e[4]||(e[4]=l=>a(R)?R.value=l:null),"mastery-level":o(N),"onUpdate:masteryLevel":e[5]||(e[5]=l=>a(N)?N.value=l:null),singers:o(O),"onUpdate:singers":e[6]||(e[6]=l=>a(O)?O.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),t("div",Ie,[e[34]||(e[34]=t("div",{class:"card-header"}," メンバー ",-1)),t("div",Ke,[t("table",Je,[t("thead",null,[t("tr",null,[t("th",He,[t("div",Qe,[e[26]||(e[26]=t("div",{style:{"margin-right":"8px"}}," カード ",-1)),t("div",Ye,[t("div",Xe,[t("div",Ze,[t("div",et,[t("div",tt,[m(i,{icon:["fas","magnifying-glass"]})])])]),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a($)?$.value=l:null),type:"text",class:"form-control"},null,512),[[Ae,o($)]])])])])]),e[27]||(e[27]=t("th",{scope:"col"},"AP",-1)),e[28]||(e[28]=t("th",{scope:"col"},"Lv.",-1)),e[29]||(e[29]=t("th",{scope:"col"},"スキルLv.",-1)),e[30]||(e[30]=t("th",{scope:"col"},"センターSLv.",-1)),e[31]||(e[31]=t("th",{scope:"col"},"凸数",-1)),e[32]||(e[32]=t("th",{scope:"col"},"選択",-1))])]),t("tbody",null,[m(W,{"fallback-tag":"tr"},{default:oe(()=>[(g(!0),b(X,null,Z(o(c),l=>v((g(),se(r,{key:o(M)(l),card:l,"open-card-details-modal":ge,"onUpdate:skillLevel":Q=>ae(o(u)(l),Q)},null,8,["card","onUpdate:skillLevel"])),[[Be,o(M)(l).toLowerCase().includes(o($).toLowerCase())]])),128))]),_:1})])]),t("div",lt," 必須："+y(o(re))+" 任意："+y(o(ue))+" 除外："+y(o(ie)),1),t("div",ot,[t("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=l=>o(H)?.click())}," TSVインポート "),t("button",{type:"button",class:"btn btn-primary",disabled:o(te),onClick:e[9]||(e[9]=l=>ye())}," 後衛カード追加 ",8,st)]),e[33]||(e[33]=t("div",null,[t("a",{href:"https://docs.google.com/spreadsheets/d/13moGCQN2fd9_kxc5g3M9go98Sw6Y8fO25nDxKFoDsDk/edit?gid=1837505339#gid=1837505339",target:"_blank"}," 後衛カード一覧 ")],-1)),t("input",{ref_key:"tsvFileInput",ref:H,type:"file",class:"d-none",onChange:ke},null,544)])]),m(W,null,{default:oe(()=>[m(xe,{"season-fan-lvs":o(T),"onUpdate:seasonFanLvs":e[10]||(e[10]=l=>a(T)?T.value=l:null)},null,8,["season-fan-lvs"])]),_:1}),t("div",nt,[e[50]||(e[50]=t("div",{class:"card-header"}," 計算 ",-1)),t("div",at,[t("div",rt,[e[37]||(e[37]=f(" プレイスタイル： ",-1)),t("div",it,[t("div",ut,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>a(C)?C.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[U,o(C)]]),e[35]||(e[35]=f(" 渾身 ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[12]||(e[12]=l=>V("フルコンを目指すプレイ"))},[m(i,{icon:"circle-info"})])]),t("div",dt,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>a(C)?C.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[U,o(C)]]),e[36]||(e[36]=f(" 背水 ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[14]||(e[14]=l=>V("メンタルが10%以下になるようミスをするプレイ"))},[m(i,{icon:"circle-info"})])])])]),t("div",vt,[e[40]||(e[40]=f(" 編成ルール ",-1)),t("div",ct,[t("div",pt,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>a(w)?w.value=l:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[U,o(w)]]),e[38]||(e[38]=f(" 現状のルール ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[16]||(e[16]=l=>V(`・メンバー1人あたり1種類まで
・カード制限なし`))},[m(i,{icon:"circle-info"})])]),t("div",mt,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>a(w)?w.value=l:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[U,o(w)]]),e[39]||(e[39]=f(" 新ライグラルール ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[18]||(e[18]=l=>V(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[m(i,{icon:"circle-info"})])])])]),t("div",ft,[e[43]||(e[43]=f(" スコア比較基準 ",-1)),t("div",gt,[t("div",kt,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>a(L)?L.value=l:null),class:"form-check-input",type:"radio",value:"score"},null,512),[[U,o(L)]]),e[41]||(e[41]=f(" スコア ",-1))])]),t("div",bt,[t("label",null,[v(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>a(L)?L.value=l:null),class:"form-check-input",type:"radio",value:"grandPrixPt"},null,512),[[U,o(L)]]),e[42]||(e[42]=f(" グランプリpt ",-1))])])])]),t("div",yt,[e[48]||(e[48]=f(" オプション： ",-1)),t("div",xt,[v(t("input",{id:"parallel","onUpdate:modelValue":e[21]||(e[21]=l=>a(z)?z.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[h,o(z)]]),t("label",Ct," マルチスレッド ("+y(o(J))+"スレッド) ",1)]),t("div",wt,[v(t("input",{id:"includingCenterOnly","onUpdate:modelValue":e[22]||(e[22]=l=>a(q)?q.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[h,o(q)]]),e[44]||(e[44]=t("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),t("div",Lt,[v(t("input",{id:"noLog","onUpdate:modelValue":e[23]||(e[23]=l=>a(A)?A.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[h,o(A)]]),e[45]||(e[45]=t("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),t("div",_t,[v(t("input",{id:"noDamagedFormation","onUpdate:modelValue":e[24]||(e[24]=l=>a(B)?B.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[h,o(B)]]),e[46]||(e[46]=t("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),t("div",Ut,[v(t("input",{id:"noCuredFormation","onUpdate:modelValue":e[25]||(e[25]=l=>a(E)?E.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[h,o(E)]]),e[47]||(e[47]=t("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),o(x)!=="running"?(g(),b("button",{key:0,type:"button",class:"btn btn-primary",onClick:ce}," 計算 ")):Y("",!0),o(x)==="running"?(g(),b("button",{key:1,type:"button",class:"btn btn-primary",onClick:pe}," 中止 ")):Y("",!0),o(p)?(g(),b("div",Ft,[t("p",{ref_key:"progressView",ref:be},y(o(x)==="running"?`計算中... ${o(de).toFixed(2)}%`:"計算完了"),513),t("div",Vt,[t("div",Mt,[t("p",null,"最高得点: "+y(o(p).score)+" ("+y(o(p).liveGrandPrixPt)+"pt)",1),e[49]||(e[49]=t("p",null,"メンバー:",-1)),t("ul",null,[(g(!0),b(X,null,Z(o(p).members,l=>(g(),b("li",{key:o(u)(l),style:Ee({fontWeight:o(p).centerMember&&o(M)(l)===o(M)(o(p).centerMember)?"bold":"normal"})},y(o(M)(l)),5))),128))]),t("textarea",{class:"form-control",value:o(p).log,readonly:"",rows:"5"},null,8,ht)])])])):Y("",!0)])]),m(Ce),(g(!0),b(X,null,Z(o(me),(l,Q)=>(g(),se(Ge(l.component),We({key:`modal-${Q}`,"on-close":l.onClose},{ref_for:!0},l.args),null,16,["on-close"]))),128))])}}});export{Nt as default};
