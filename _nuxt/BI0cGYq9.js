import{u as be,a as xe,t as u,v as Ce,k as Le,q as we,b as le,w as _e,l as Ue,_ as Fe,p as V}from"./sNM0ck3W.js";import{_ as Ve,a as Me,b as he,c as Se,M as Pe}from"./Cxw5t8ax.js";import{f as De,r as n,g as W,y as ze,u as Ne,c as y,a as l,b as p,k as r,l as o,j as v,v as Re,w as te,t as b,q as X,d as m,s as _,z as M,F as Y,m as Z,o as f,i as oe,A as Te,B as Oe,C as qe,x as $e}from"./DaVUqM8-.js";const Ae={class:"container-md"},Be={class:"card my-2"},Ee={class:"card-body"},We={class:"table"},je={scope:"col"},Ge={class:"d-flex align-items-end"},Ie={class:""},Je={class:"input-group"},He={class:"input-group-prepend"},Ke={class:"input-group-text"},Qe={style:{"min-height":"1.5em"}},Xe={style:{"text-align":"right"}},Ye={class:"card my-2"},Ze={class:"card-body"},el={class:"mb-2"},ll={class:"row"},tl={class:"col-auto"},ol={class:"col-auto"},sl={class:"mb-2"},nl={class:"row"},al={class:"col-auto"},rl={class:"col-auto"},il={class:"mb-2"},ul={class:"row"},dl={class:"col-auto"},vl={class:"col-auto"},cl={class:"mb-2"},pl={class:"form-check"},ml={class:"form-check-label",for:"parallel"},fl={class:"form-check"},kl={class:"form-check"},gl={class:"form-check"},yl={class:"form-check"},bl={key:2},xl={class:"card my-2"},Cl={class:"card-body"},Ll=["value"],Vl=De({__name:"auto-formation",setup(wl){const h=n(""),S=n(""),P=n(0),j=n(0),D=n("smile"),z=n(50),x=n("perfect"),C=n("current"),L=n("score"),N=n(!0),R=n([]),T=be("seasonFanLvs",{kaho:1,sayaka:1,rurino:1,ginko:1,kosuzu:1,hime:1,ceras:1,izumi:1,kozue:1,tsuzuri:1,megumi:1}),O=n(""),q=n(!0),$=n(!0),A=n(!1),B=n(!1),k=n([...xe]),d=n(Object.fromEntries(k.value.map(s=>[u(s),{level:Ce[s.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),se=(s,e)=>{d.value[s]=e},ne=W(()=>k.value.filter(s=>d.value[u(s)]?.selected==="required").length),ae=W(()=>k.value.filter(s=>d.value[u(s)]?.selected==="excluded").length),re=W(()=>k.value.filter(s=>d.value[u(s)]?.selected==="optional").length),U=n([]),G=n([]),I=n(0),J=n(1);ze(()=>{J.value=navigator.hardwareConcurrency||4});const c=n(null),ie=W(()=>G.value.reduce((s,e)=>s+e,0)),ee=n(Promise.resolve()),w=n("finished"),ue=s=>{U.value=Array.from({length:s},()=>new Worker(new URL(""+new URL("calc-worker-parallel-Da3bhAQ5.js",import.meta.url).href,import.meta.url),{type:"module"})),U.value.forEach((e,g)=>{e.onmessage=i=>{switch(i.data.message){case"calcScore":ee.value=ee.value.then(async()=>{i.data.data.score>(c.value?.score||0)&&(c.value={score:i.data.data.score,liveGrandPrixPt:i.data.data.liveGrandPrixPt,members:i.data.data.members,centerMember:i.data.data.centerMember,log:i.data.data.log})});break;case"progress":G.value[g]=i.data.data.progress;break;case"end":if(I.value++,I.value===U.value.length){w.value="finished";try{H.value?.release()}catch(a){console.error("Failed to release wake lock:",a)}}break}}})},H=n(null),de=()=>{const s=N.value?J.value:1;ue(s),c.value=null,G.value=Array.from({length:s.value},()=>0),I.value=0;const e=we(h.value,P.value);"wakeLock"in navigator&&navigator.wakeLock.request("screen").then(a=>{H.value=a}).catch(a=>{console.error("Failed to request wake lock:",a)});const g=k.value.filter(a=>d.value[u(a)]&&d.value[u(a)].selected==="required").map(a=>le(a,d.value[u(a)]?.skillLevel||10,d.value[u(a)]?.centerSkillLevel||10,d.value[u(a)]?.level||1));if(g.length>6){F("必要メンバーが6人を超えています");return}const i=k.value.filter(a=>!d.value[u(a)]?.selected||d.value[u(a)].selected==="optional").map(a=>le(a,d.value[u(a)]?.skillLevel||10,d.value[u(a)]?.centerSkillLevel||10,d.value[u(a)]?.level||1));w.value="running",U.value.forEach((a,E)=>{a.postMessage(JSON.parse(JSON.stringify({requiredMembers:g,optionalMembers:i,notes:e,center:S.value,attribute:D.value,masteryLevel:z.value,playStyle:x.value,formationRule:C.value,includingCenterOnly:q.value,noLog:$.value,noDamagedFormation:A.value,noCuredFormation:B.value,scoreComparisonRule:L.value,seasonFanLvs:T.value,singers:R.value,batchNum:s,batchIndex:E})))})},ve=()=>{U.value.forEach(s=>{s.terminate()}),w.value="finished";try{H.value?.release()}catch(s){console.error("Failed to release wake lock:",s)}},F=s=>{window.alert(s)},{modals:ce,openModal:pe}=Le(),me=async s=>{await pe(Pe,{card:s,displayLevel:d.value[u(s)]?.level||1})},K=n(null),fe=()=>{const s=K.value?.files?.[0];if(s){const e=new FileReader;e.onload=g=>{const i=g.target?.result;k.value=k.value.concat(_e(i))},e.readAsText(s)}},ke=n(null);return Ne({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"}]}),(s,e)=>{const g=Ue,i=Fe,a=Me,E=Ve,ge=he,ye=Se;return f(),y("div",Ae,[e[49]||(e[49]=l("h1",null,"スクショウ自動編成",-1)),e[50]||(e[50]=l("a",{href:"https://note.com/asmape/n/nefd46574f4e3",target:"_blank"},"note",-1)),p(g,{"note-text":o(h),"onUpdate:noteText":e[0]||(e[0]=t=>r(h)?h.value=t:null),center:o(S),"onUpdate:center":e[1]||(e[1]=t=>r(S)?S.value=t:null),offset:o(P),"onUpdate:offset":e[2]||(e[2]=t=>r(P)?P.value=t:null),"combo-offset":o(j),"onUpdate:comboOffset":e[3]||(e[3]=t=>r(j)?j.value=t:null),attribute:o(D),"onUpdate:attribute":e[4]||(e[4]=t=>r(D)?D.value=t:null),"mastery-level":o(z),"onUpdate:masteryLevel":e[5]||(e[5]=t=>r(z)?z.value=t:null),singers:o(R),"onUpdate:singers":e[6]||(e[6]=t=>r(R)?R.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),l("div",Be,[e[32]||(e[32]=l("div",{class:"card-header"}," メンバー ",-1)),l("div",Ee,[l("table",We,[l("thead",null,[l("tr",null,[l("th",je,[l("div",Ge,[e[25]||(e[25]=l("div",{style:{"margin-right":"8px"}}," カード ",-1)),l("div",Ie,[l("div",Je,[l("div",He,[l("div",Ke,[l("div",Qe,[p(i,{icon:["fas","magnifying-glass"]})])])]),v(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>r(O)?O.value=t:null),type:"text",class:"form-control"},null,512),[[Re,o(O)]])])])])]),e[26]||(e[26]=l("th",{scope:"col"},"AP",-1)),e[27]||(e[27]=l("th",{scope:"col"},"Lv.",-1)),e[28]||(e[28]=l("th",{scope:"col"},"スキルLv.",-1)),e[29]||(e[29]=l("th",{scope:"col"},"センターSLv.",-1)),e[30]||(e[30]=l("th",{scope:"col"},"凸数",-1)),e[31]||(e[31]=l("th",{scope:"col"},"選択",-1))])]),l("tbody",null,[p(E,null,{default:te(()=>[(f(!0),y(Y,null,Z(o(k),t=>v((f(),oe(a,{key:o(V)(t),card:t,"open-card-details-modal":me,"onUpdate:skillLevel":Q=>se(o(u)(t),Q)},null,8,["card","onUpdate:skillLevel"])),[[Te,o(V)(t).toLowerCase().includes(o(O).toLowerCase())]])),128))]),_:1})])]),l("div",Xe," 必須："+b(o(ne))+" 任意："+b(o(re))+" 除外："+b(o(ae)),1),l("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=t=>o(K)?.click())}," TSVインポート "),l("input",{ref_key:"tsvFileInput",ref:K,type:"file",class:"d-none",onChange:fe},null,544)])]),p(E,null,{default:te(()=>[p(ge,{"season-fan-lvs":o(T),"onUpdate:seasonFanLvs":e[9]||(e[9]=t=>r(T)?T.value=t:null)},null,8,["season-fan-lvs"])]),_:1}),l("div",Ye,[e[48]||(e[48]=l("div",{class:"card-header"}," 計算 ",-1)),l("div",Ze,[l("div",el,[e[35]||(e[35]=m(" プレイスタイル： ",-1)),l("div",ll,[l("div",tl,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>r(x)?x.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[_,o(x)]]),e[33]||(e[33]=m(" 渾身 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[11]||(e[11]=t=>F("フルコンを目指すプレイ"))},[p(i,{icon:"circle-info"})])]),l("div",ol,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>r(x)?x.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[_,o(x)]]),e[34]||(e[34]=m(" 背水 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[13]||(e[13]=t=>F("メンタルが10%以下になるようミスをするプレイ"))},[p(i,{icon:"circle-info"})])])])]),l("div",sl,[e[38]||(e[38]=m(" 編成ルール ",-1)),l("div",nl,[l("div",al,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[14]||(e[14]=t=>r(C)?C.value=t:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[_,o(C)]]),e[36]||(e[36]=m(" 現状のルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[15]||(e[15]=t=>F(`・メンバー1人あたり1種類まで
・カード制限なし`))},[p(i,{icon:"circle-info"})])]),l("div",rl,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>r(C)?C.value=t:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[_,o(C)]]),e[37]||(e[37]=m(" 新ライグラルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[17]||(e[17]=t=>F(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[p(i,{icon:"circle-info"})])])])]),l("div",il,[e[41]||(e[41]=m(" スコア比較基準 ",-1)),l("div",ul,[l("div",dl,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>r(L)?L.value=t:null),class:"form-check-input",type:"radio",value:"score"},null,512),[[_,o(L)]]),e[39]||(e[39]=m(" スコア ",-1))])]),l("div",vl,[l("label",null,[v(l("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>r(L)?L.value=t:null),class:"form-check-input",type:"radio",value:"grandPrixPt"},null,512),[[_,o(L)]]),e[40]||(e[40]=m(" グランプリpt ",-1))])])])]),l("div",cl,[e[46]||(e[46]=m(" オプション： ",-1)),l("div",pl,[v(l("input",{id:"parallel","onUpdate:modelValue":e[20]||(e[20]=t=>r(N)?N.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[M,o(N)]]),l("label",ml," マルチスレッド ("+b(o(J))+"スレッド) ",1)]),l("div",fl,[v(l("input",{id:"includingCenterOnly","onUpdate:modelValue":e[21]||(e[21]=t=>r(q)?q.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[M,o(q)]]),e[42]||(e[42]=l("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),l("div",kl,[v(l("input",{id:"noLog","onUpdate:modelValue":e[22]||(e[22]=t=>r($)?$.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[M,o($)]]),e[43]||(e[43]=l("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),l("div",gl,[v(l("input",{id:"noDamagedFormation","onUpdate:modelValue":e[23]||(e[23]=t=>r(A)?A.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[M,o(A)]]),e[44]||(e[44]=l("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),l("div",yl,[v(l("input",{id:"noCuredFormation","onUpdate:modelValue":e[24]||(e[24]=t=>r(B)?B.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[M,o(B)]]),e[45]||(e[45]=l("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),o(w)!=="running"?(f(),y("button",{key:0,type:"button",class:"btn btn-primary",onClick:de}," 計算 ")):X("",!0),o(w)==="running"?(f(),y("button",{key:1,type:"button",class:"btn btn-primary",onClick:ve}," 中止 ")):X("",!0),o(c)?(f(),y("div",bl,[l("p",{ref_key:"progressView",ref:ke},b(o(w)==="running"?`計算中... ${o(ie).toFixed(2)}%`:"計算完了"),513),l("div",xl,[l("div",Cl,[l("p",null,"最高得点: "+b(o(c).score)+" ("+b(o(c).liveGrandPrixPt)+"pt)",1),e[47]||(e[47]=l("p",null,"メンバー:",-1)),l("ul",null,[(f(!0),y(Y,null,Z(o(c).members,t=>(f(),y("li",{key:o(u)(t),style:Oe({fontWeight:o(c).centerMember&&o(V)(t)===o(V)(o(c).centerMember)?"bold":"normal"})},b(o(V)(t)),5))),128))]),l("textarea",{class:"form-control",value:o(c).log,readonly:"",rows:"5"},null,8,Ll)])])])):X("",!0)])]),p(ye),(f(!0),y(Y,null,Z(o(ce),(t,Q)=>(f(),oe($e(t.component),qe({key:`modal-${Q}`,"on-close":t.onClose},{ref_for:!0},t.args),null,16,["on-close"]))),128))])}}});export{Vl as default};
