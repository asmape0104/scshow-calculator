import{n as c,u as W,o as q,a as w,p as z,b as T,_ as A}from"./lQy5hNY9.js";import{d as E,k as F,r as m,H as B,o as D,y as f,z as v,A as e,B as U,M as l,J as x,L as O,E as S,T as C,K as p,x as I,C as J,N as $,O as j,R as V,I as G}from"./D2zsbnuM.js";const Q={class:"row"},X={class:"col form-check-label"},Y={class:"col form-check-label"},Z={class:"col form-check-label"},ee=E({__name:"MMemberRow",props:{card:{}},emits:["update:skillLevel"],setup(h,{emit:y}){const L=h,k=y,g=F(()=>c(L.card)),n=m("optional"),i=W(g,{centerSkillLevel:10,skillLevel:10,selected:"optional"});return B(n,a=>{i.value.selected=a}),B(i,a=>{k("update:skillLevel",a)}),D(()=>{n.value=i.value.selected||"optional",k("update:skillLevel",i.value)}),(a,o)=>(v(),f("tr",null,[e("td",null,U(l(q)(a.card)),1),e("td",null,[x(e("input",{"onUpdate:modelValue":o[0]||(o[0]=u=>l(i).skillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[O,l(i).skillLevel,void 0,{number:!0}]])]),e("td",null,[x(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>l(i).centerSkillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[O,l(i).centerSkillLevel,void 0,{number:!0}]])]),e("td",null,[e("div",Q,[e("label",X,[x(e("input",{"onUpdate:modelValue":o[2]||(o[2]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"required"},null,512),[[C,l(n)]]),o[5]||(o[5]=S(" 必須 "))]),e("label",Y,[x(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"optional"},null,512),[[C,l(n)]]),o[6]||(o[6]=S(" 任意 "))]),e("label",Z,[x(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"excluded"},null,512),[[C,l(n)]]),o[7]||(o[7]=S(" 除外 "))])])])]))}}),le=Object.assign(ee,{__name:"MMemberRow"}),te={class:"container-md"},oe={class:"card my-2"},se={class:"card-body"},ne={class:"table"},ae={class:"card my-2"},re={class:"card-body"},ue={key:2},ie={class:"card my-2"},de={class:"card-body"},ce=["value"],pe=E({__name:"auto-formation",setup(h){const y=m(""),L=m(""),k=m(0),g=m(0),n=m("smile"),i=m(50),a=m(Object.fromEntries(w.map(d=>[c(d),{centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),o=(d,t)=>{a.value[d]=t},u=m(null),b=m(null),N=m(Promise.resolve()),_=m("finished"),R=()=>{u.value=new Worker(new URL(""+new URL("calc-worker-ohlx3fta.js",import.meta.url).href,import.meta.url),{type:"module"}),u.value.onmessage=d=>{switch(d.data.message){case"calcScore":N.value=N.value.then(async()=>{d.data.data.score>(b.value?.score||0)&&(b.value={score:d.data.data.score,members:d.data.data.members,log:d.data.data.log})});break;case"end":_.value="finished";break}}};D(()=>{R()});const H=()=>{b.value=null;const d=z(y.value,k.value),t=w.filter(r=>a.value[c(r)]&&a.value[c(r)].selected==="required").map(r=>T(r,a.value[c(r)]?.skillLevel||10,a.value[c(r)]?.centerSkillLevel||10));if(t.length>6){alert("必要メンバーが6人を超えています");return}const M=w.filter(r=>!a.value[c(r)]?.selected||a.value[c(r)].selected==="optional").map(r=>T(r,a.value[c(r)]?.skillLevel||10,a.value[c(r)]?.centerSkillLevel||10));_.value="running",u.value?.postMessage({requiredMembers:t,optionalMembers:M,notes:d,center:L.value,attribute:n.value,masteryLevel:i.value})},K=()=>{u.value?.terminate(),R(),_.value="finished"};return I({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"}]}),(d,t)=>{const M=A,r=le;return v(),f("div",te,[t[9]||(t[9]=e("h1",null,"スクショウ自動編成",-1)),J(M,{"note-text":l(y),"onUpdate:noteText":t[0]||(t[0]=s=>p(y)?y.value=s:null),center:l(L),"onUpdate:center":t[1]||(t[1]=s=>p(L)?L.value=s:null),offset:l(k),"onUpdate:offset":t[2]||(t[2]=s=>p(k)?k.value=s:null),"combo-offset":l(g),"onUpdate:comboOffset":t[3]||(t[3]=s=>p(g)?g.value=s:null),attribute:l(n),"onUpdate:attribute":t[4]||(t[4]=s=>p(n)?n.value=s:null),"mastery-level":l(i),"onUpdate:masteryLevel":t[5]||(t[5]=s=>p(i)?i.value=s:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",oe,[t[7]||(t[7]=e("div",{class:"card-header"}," メンバー ",-1)),e("div",se,[e("table",ne,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"カード"),e("th",{scope:"col"},"スキルLv."),e("th",{scope:"col"},"センタースキルLv."),e("th",{scope:"col"},"選択")])],-1)),e("tbody",null,[(v(!0),f($,null,j(l(w),s=>(v(),G(r,{key:s.key,card:s,"onUpdate:skillLevel":P=>o(l(c)(s),P)},null,8,["card","onUpdate:skillLevel"]))),128))])])])]),e("div",ae,[t[8]||(t[8]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",re,[l(_)!=="running"?(v(),f("button",{key:0,type:"button",class:"btn btn-primary",onClick:H}," 計算 ")):V("",!0),l(_)==="running"?(v(),f("button",{key:1,type:"button",class:"btn btn-primary",onClick:K}," 中止 ")):V("",!0),l(b)?(v(),f("div",ue,[e("p",null,U(l(_)==="running"?"計算中...":"計算完了"),1),e("div",ie,[e("div",de,[e("p",null,"最高得点: "+U(l(b).score),1),e("p",null,"メンバー:"+U(l(b).members.length)+"人",1),e("ul",null,[(v(!0),f($,null,j(l(b).members,s=>(v(),f("li",{key:l(c)(s)},U(l(q)(s)),1))),128))]),e("textarea",{class:"form-control",value:l(b).log,readonly:"",rows:"5"},null,8,ce)])])])):V("",!0)])])])}}});export{pe as default};
