import{c as Ce,m as A,a as ve,b as we,s as ee,d as z,e as me,u as Ve,_ as Ue,f as pe,g as ae,h as xe,i as Me,j as ge,k as Se,l as Te,n as Ae,p as Ne,o as Ee}from"./DElFnfVJ.js";import{f as ye,r as y,g as q,h as te,i as ke,o as x,w as De,a as e,j as _,b as be,k as h,v as g,l as s,c as S,F as J,m as K,n as Be,t as $,p as ie,q as oe,d as Q,u as Re,s as fe,x as Fe}from"./DJFRsMsx.js";const je=m=>m<=2100?Math.floor((-5+Math.sqrt(25+20*m))/10):Math.floor(20+(m-2100)/200),_e=(m,M,N)=>(1+m/100)*(1+M*(N?2:1)/10),ne=m=>m<10?1:m<20?1.1:m<30?1.2:m<40?1.3:m<50?1.4:1.5,Oe=({notes:m,convertedMembers:M,center:N,appealSum:E,mentalSum:p,masteryLevel:c,playStyle:C="perfect",noLog:n=!1,noDamagedFormation:w=!1,noCuredFormation:V=!1,centerMember:k=M.find(T=>T.name===N)})=>{const T=k?.centerSkillCondition,D=k?.centerSkills||[],U=k?.centerAbilities||[],b=U.find(a=>a.type==="cooltime_reduce"),i=U.find(a=>a.type==="ap_reduce"),O=5-Number(b?.value.amount||0),f=Number(i?.value.amount||0),B=M.slice();let H=O,r=0,t=p,R=0;const l={_point:0,_lv:0,get point(){return this._point},set point(a){this._point=a,this._lv=je(a)},get lv(){return this._lv}},F=[0],o=[0];let I=0,re=0;const ce=Ce(m);let G=0,de=0;const le=new WeakMap,he=60/ce;let X,d="";const Y=(a,u,j)=>{const Z=l.lv,$e=t*100/p;e:for(const v of u){if(v.condition){const[P,L,se]=v.condition;let W=0;switch(P){case"skill_count":W=le.get(a)||0;break;case"total_skill_count":W=de;break;case"vol_lv":W=Z*(j?2:1);break;case"mental_rate":W=$e;break;default:throw new Error(`条件式が不正です: ${P}`)}if(se===void 0)throw new Error(`条件式が不正です: ${P}`);switch(L){case"<=":if(!(W<=se))continue e;break;case">=":if(!(W>=se))continue e;break}}switch(v.type){case"vol_buff":o[0]=(o[0]||0)+(v.value||0),n||(d+=`${A[a.name]} vol_buff: +${v.value}
`);break;case"vol_up":{const P=o[0]??0;o[0]=0,l.point+=Math.ceil((v.value||0)*(1+P/100)),n||(d+=`${A[a.name]} vol_up: +${Math.ceil((v.value||0)*(1+P/100))}
`,d+=`now voltagePoint: ${l.point}
`);break}case"vol_down":l.point-=v.value||0,l.point<0&&(l.point=0),n||(d+=`${A[a.name]} vol_down: -${v.value||0}
`);break;case"score_buff":F[0]=(F[0]||0)+(v.value||0),n||(d+=`${A[a.name]} score_buff: +${v.value}
`);break;case"score_up":{const P=F[0]??0;F[0]=0;const L=(v.value||0)/100*(1+P/100)*_e(c,l.lv,j);R+=Math.ceil(E*L),n||(d+=`${A[a.name]} score_up: +${Math.ceil(E*L)}
`);break}case"mental_up":t+=Math.ceil((v.value||0)/100*p),n||(d+=`${A[a.name]} mental_up: +${Math.ceil((v.value||0)/100*p)}
`);break;case"mental_down":t-=Math.ceil((v.value||0)/100*p),n||(d+=`${A[a.name]} mental_down: -${Math.ceil((v.value||0)/100*p)}
`),t<=0&&(t=1);break;case"ap_up":r+=Math.ceil((v.value||0)*ne(G)*1e4),n||(d+=`${A[a.name]} ap_up: +${(v.value||0)*ne(G)}
`);break;case"ap_down":r-=(v.value||0)*1e4,n||(d+=`${A[a.name]} ap_down: -${v.value||0}
`);break;case"reset":I=B.length-1,n||(d+=`${A[a.name]} reset
`);break;case"splice":B.splice(B.indexOf(a),1),I--,n||(d+=`${A[a.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};k&&T==="start"&&Y(k,D,!1);const ue=a=>{if(B.length===0)return!1;const u=B[I];if(!u)throw new Error("メンバーが見つかりません");const j=Math.max(u.ap-f,0);return j*1e4<=r&&H<=0?(r-=j*1e4,le.set(u,(le.get(u)||0)+1),de++,Y(u,u.skills,a),I=B.length-1===I?0:I+1,H+=O,!0):!1};for(let a=0;a<m.length;a++){const u=m[a];if(X=m[a-1],!u)throw new Error("noteが見つかりません");for(H-=u.time-re,re=u.time;ue(X?.fever||!1););H=Math.max(0,H),k&&u.fever&&!X?.fever&&T==="fever_start"&&(n||(d+=`FEVER START
`),Y(k,D,!0)),!u.fever&&X?.fever&&(n||(d+=`FEVER END
`));for(let j=0;j<u.normalCount+u.slideCount;j++){if(C==="desperate"&&t*10>p){j<u.normalCount?t-=Math.ceil(p/15):t-=Math.ceil(p*2/75),n||(d+=`miss, apPoint: ${r}, mental: ${t}, vol_lv: ${l.lv*(u.fever?2:1)}
`);continue}G++,r+=Math.ceil(he*ne(G)*1e4),ue(u.fever);const Z=Math.ceil(E/ce*30*_e(c,l.lv,u.fever));if(R+=Z,n||(d+=`combo: ${G}, score: ${R} (+${Z}), apPoint: ${r}, mental: ${t}, vol_lv: ${l.lv*(u.fever?2:1)}
`),C==="perfect"&&w&&t<p)return n||(d+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:R,log:d};if(C==="desperate"&&V&&t*10>p)return n||(d+=`メンタルが10%超になったため計算を打ち切ります
`),{score:R,log:d}}}return k&&T==="end"&&Y(k,D,!1),{score:R,log:d}},Pe={class:"my-2"},qe={class:"input-group mb-3"},ze={class:"input-group-prepend"},He={class:"input-group-text"},Ie={style:{"min-height":"1.5em"}},We=["value"],Ge={class:"card my-2"},Je={class:"card-body"},Ke={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},Le={class:"alert alert-info"},et={class:"card my-2"},tt={class:"card-body"},lt={key:0,class:"my-2"},st={class:"alert alert-info"},ot=ye({__name:"MdCardSelect",props:{onClose:{}},setup(m){const M=y(""),N=b=>`[${b.series}] ${b.key!=="other"?pe[b.key]:b.otherName}`,E=q(()=>ve.filter(b=>N(b).includes(M.value))),p=y(0),c=q(()=>ve[p.value]),C=q(()=>c.value?we(c.value,w.value,V.value):null),n=q(()=>C.value?ee(z(C.value).skills):""),w=y(14),V=y(14),k=q(()=>C.value?ee(z(C.value).centerSkills):""),T=q(()=>C.value?me(z(C.value).centerAbilities):""),D=Ve("skillCache",{}),U=b=>`${b.key}-${b.series}`;return te(c,()=>{c.value&&(w.value=D.value[U(c.value)]?.skillLevel||14,V.value=D.value[U(c.value)]?.centerSkillLevel||14)}),te([w,V],()=>{c.value&&(D.value[U(c.value)]={centerSkillLevel:V.value,skillLevel:w.value})}),(b,i)=>{const O=Ue;return x(),ke(xe,{"on-close":b.onClose},{default:De(()=>[e("div",Pe,[e("div",qe,[e("div",ze,[e("div",He,[e("div",Ie,[be(O,{icon:["fas","magnifying-glass"]})])])]),_(e("input",{"onUpdate:modelValue":i[0]||(i[0]=f=>h(M)?M.value=f:null),type:"text",class:"form-control"},null,512),[[g,s(M)]])]),_(e("select",{"onUpdate:modelValue":i[1]||(i[1]=f=>h(p)?p.value=f:null),class:"form-select"},[(x(!0),S(J,null,K(s(E),(f,B)=>(x(),S("option",{key:`${f.key}-${f.series}`,class:Be(["card",{"bg-primary":s(c)?.key===f.key}]),value:B}," ["+$(f.series)+"] "+$(f.key!=="other"?s(pe)[f.key]:f.otherName),11,We))),128))],512),[[ie,s(p)]])]),e("div",Ge,[i[6]||(i[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Je,[e("div",null,[i[5]||(i[5]=Q(" スキルレベル： ",-1)),_(e("input",{"onUpdate:modelValue":i[2]||(i[2]=f=>h(w)?w.value=f:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[g,s(w)]])]),s(c)?(x(),S("div",Ke,[e("div",Qe,$(s(n)),1)])):oe("",!0)])]),e("div",Xe,[i[8]||(i[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ye,[i[7]||(i[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),_(e("input",{"onUpdate:modelValue":i[3]||(i[3]=f=>h(V)?V.value=f:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[g,s(V)]]),s(c)?(x(),S("div",Ze,[e("div",Le," 【"+$(s(ae)(s(c).centerSkillCondition))+"】"+$(s(k)),1)])):oe("",!0)])]),e("div",et,[i[9]||(i[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",tt,[s(c)?(x(),S("div",lt,[e("div",st,$(s(T)),1)])):oe("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:i[4]||(i[4]=f=>b.onClose(s(C)))}," 選択 ")]),_:1},8,["on-close"])}}}),nt=Object.assign(ot,{__name:"MdCardSelect"}),at={class:"container-md"},it={class:"card my-2"},rt={class:"card-body"},ct={class:"card-header"},dt={class:"card-body"},ut=["onClick"],vt={class:"row my-2 align-items-center justify-content-start"},pt={class:"col-auto"},ft=["onUpdate:modelValue"],_t=["value"],mt={class:"row my-2 align-items-center justify-content-start"},yt={class:"col-auto"},kt=["onUpdate:modelValue"],bt={class:"row row-gap-1"},ht={class:"col-md"},$t=["onUpdate:modelValue"],Ct={class:"col-md"},wt=["onUpdate:modelValue"],Vt={class:"col-md"},Ut=["onUpdate:modelValue"],xt={class:"col-md"},Mt={class:"input-group"},gt=["onUpdate:modelValue"],St={class:"my-2"},Tt={class:"row"},At={class:"col-sm"},Nt=["onUpdate:modelValue"],Et={class:"col-sm"},Dt={class:"alert alert-secondary"},Bt={class:"my-2"},Rt={class:"row"},Ft={class:"col-sm"},jt=["onUpdate:modelValue"],Ot=["value"],Pt=["onUpdate:modelValue"],qt={class:"col-sm"},zt={class:"alert alert-secondary"},Ht={class:"my-2"},It={class:"row"},Wt={class:"col-sm"},Gt=["onUpdate:modelValue"],Jt={class:"col-sm"},Kt={class:"alert alert-secondary"},Qt={class:"row"},Xt={class:"col"},Yt={class:"form-label"},Zt={class:"col"},Lt={class:"form-label"},el={class:"card my-2"},tl={class:"card-body"},ll={class:"mb-2"},sl={class:"row"},ol={class:"col-auto"},nl={class:"col-auto"},al={class:"my-2"},il={class:"my-2"},dl=ye({__name:"index",setup(m){const M=y(""),N=y(""),E=y(0),p=y(0),c=y("smile"),C=y([]),n=y("perfect"),w=y(80820),V=y(2960),k=y(50),T=y(""),D=y(0),U=y(Ee),b=()=>{const r=U.value.map(z),t=Ne(M.value,E.value),{score:R,log:l}=Oe({notes:t,convertedMembers:r,center:N.value,appealSum:w.value,mentalSum:V.value,masteryLevel:k.value,playStyle:n.value});D.value=R,T.value=l},i=q(()=>U.value.reduce((r,t)=>r+t.mental,0)),O=q(()=>{const r=U.value.map(z);return Me(r,c.value,N.value)});te(i,()=>{U.value.every(r=>r.mental)&&(V.value=i.value)}),te(O,()=>{U.value.every(r=>r.smile&&r.pure&&r.cool)&&(w.value=O.value)}),Re({title:"スクショウ計算機"});const{modals:f,openModal:B}=ge(),H=async r=>{const t=await B(nt);t&&U.value.splice(U.value.indexOf(r),1,t)};return(r,t)=>{const R=Se;return x(),S("div",at,[t[25]||(t[25]=e("h1",null,"スクショウ計算機",-1)),be(R,{"note-text":s(M),"onUpdate:noteText":t[0]||(t[0]=l=>h(M)?M.value=l:null),center:s(N),"onUpdate:center":t[1]||(t[1]=l=>h(N)?N.value=l:null),offset:s(E),"onUpdate:offset":t[2]||(t[2]=l=>h(E)?E.value=l:null),"combo-offset":s(p),"onUpdate:comboOffset":t[3]||(t[3]=l=>h(p)?p.value=l:null),attribute:s(c),"onUpdate:attribute":t[4]||(t[4]=l=>h(c)?c.value=l:null),"mastery-level":s(k),"onUpdate:masteryLevel":t[5]||(t[5]=l=>h(k)?k.value=l:null),singers:s(C),"onUpdate:singers":t[6]||(t[6]=l=>h(C)?C.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",it,[t[19]||(t[19]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",rt,[(x(!0),S(J,null,K(s(U),(l,F)=>(x(),S("div",{key:F,class:"card m-3"},[e("div",ct,$(F+1)+"人目 ",1),e("div",dt,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>H(l)}," カードを選択して入力 ",8,ut)]),e("div",vt,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",pt,[_(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(x(!0),S(J,null,K(s(Te),o=>(x(),S("option",{key:o,value:o},$(s(A)[o]),9,_t))),128))],8,ft),[[ie,l.name]])])]),e("div",mt,[t[13]||(t[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",yt,[_(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,kt),[[g,l.ap,void 0,{number:!0}]])])]),t[18]||(t[18]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",bt,[e("div",ht,[_(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,$t),[[g,l.smile,void 0,{number:!0}]])]),e("div",Ct,[_(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,wt),[[g,l.pure,void 0,{number:!0}]])]),e("div",Vt,[_(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,Ut),[[g,l.cool,void 0,{number:!0}]])]),e("div",xt,[e("div",Mt,[t[14]||(t[14]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),_(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,gt),[[g,l.mental,void 0,{number:!0}]])])])]),e("div",St,[t[15]||(t[15]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Tt,[e("div",At,[_(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,Nt),[[g,l.skill]])]),e("div",Et,[e("div",Dt,$(s(ee)(s(z)(l).skills)),1)])])]),e("div",Bt,[t[16]||(t[16]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Rt,[e("div",Ft,[_(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(x(!0),S(J,null,K(s(Ae),o=>(x(),S("option",{key:o,value:o},$(s(ae)(o)),9,Ot))),128))],8,jt),[[ie,l.centerSkillCondition]]),_(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Pt),[[g,l.centerSkill]])]),e("div",qt,[e("div",zt," 【"+$(s(ae)(l.centerSkillCondition))+"】"+$(s(ee)(s(z)(l).centerSkills)),1)])])]),e("div",Ht,[t[17]||(t[17]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",It,[e("div",Wt,[_(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,Gt),[[g,l.centerAbilityText]])]),e("div",Jt,[e("div",Kt,$(s(me)(s(z)(l).centerAbilities)),1)])])])])]))),128)),e("div",Qt,[e("div",Xt,[e("label",Yt,"総合アピール値（"+$(s(O))+"）：",1),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>h(w)?w.value=l:null),type:"number",class:"form-control"},null,512),[[g,s(w),void 0,{number:!0}]])]),e("div",Zt,[e("label",Lt,"総合メンタル値（"+$(s(i))+"）：",1),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>h(V)?V.value=l:null),type:"number",class:"form-control"},null,512),[[g,s(V),void 0,{number:!0}]])])])])]),e("div",el,[t[24]||(t[24]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",tl,[e("div",ll,[t[22]||(t[22]=Q(" プレイスタイル： ",-1)),e("div",sl,[e("div",ol,[e("label",null,[_(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>h(n)?n.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[fe,s(n)]]),t[20]||(t[20]=Q(" 渾身 ",-1))])]),e("div",nl,[e("label",null,[_(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>h(n)?n.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[fe,s(n)]]),t[21]||(t[21]=Q(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:b}," 計算 "),e("div",al," 計算結果: "+$(s(D)),1),e("div",il,[t[23]||(t[23]=Q(" ログ： ",-1)),_(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=l=>h(T)?T.value=l:null),rows:"6",class:"form-control"},null,512),[[g,s(T)]])])])]),(x(!0),S(J,null,K(s(f),(l,F)=>(x(),ke(Fe(l.component),{key:`modal-${F}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{dl as default};
