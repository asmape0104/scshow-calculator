(function(){"use strict";const K=t=>t.reduce((e,a)=>e+a.normalCount+a.slideCount,0),tt=["kaho","sayaka","kozue","tsuzuri","rurino","megumi","ginko","kosuzu","hime","ceras","izumi","other"],b={kaho:"花帆",sayaka:"さやか",kozue:"梢",tsuzuri:"綴理",rurino:"瑠璃乃",megumi:"慈",ginko:"吟子",kosuzu:"小鈴",hime:"姫芽",ceras:"セラス",izumi:"泉",other:"その他"},et={all:tt,g102:["kozue","tsuzuri","megumi"],g103:["kaho","sayaka","rurino"],g104:["ginko","kosuzu","hime","izumi"],g105:["ceras"],cerise:["kaho","kozue","ginko"],dollche:["sayaka","tsuzuri","kosuzu"],miracra:["rurino","megumi","hime"],edel:["ceras","izumi"]},lt=t=>t<=2100?Math.floor((-5+Math.sqrt(25+20*t))/10):Math.floor(20+(t-2100)/200),D=(t,e,a)=>(1+t/100)*(1+e*(a?2:1)/10),q=t=>t<10?1:t<20?1.1:t<30?1.2:t<40?1.3:t<50?1.4:1.5,ot=({notes:t,convertedMembers:e,center:a,appealSum:f,mentalSum:l,masteryLevel:s,comboOffset:n,playStyle:r="perfect"})=>{const c=e.find(o=>o.name===a),p=c?.centerSkillCondition,d=c?.centerSkills||[],k=c?.centerAbilities||[],w=k.find(o=>o.type==="cooltime_reduce"),y=k.find(o=>o.type==="ap_reduce"),S=5-Number(w?.value.amount||0),C=Number(y?.value.amount||0),x=e.slice();let M=S,g=0,h=l,_=0;const u={_point:0,_lv:0,get point(){return this._point},set point(o){this._point=o,this._lv=lt(o)},get lv(){return this._lv}},V=[0],P=[0];let A=0,Q=0;const X=K(t);let E=0,Y=0;const U=new WeakMap,it=60/(X-0);let R,v="";const L=(o,m)=>{const B=u.lv,j=h*100/l;t:for(const i of m){if(i.condition){const[$,F,W]=i.condition;let N=0;switch($){case"skill_count":N=U.get(o)||0;break;case"total_skill_count":N=Y;break;case"vol_lv":N=B;break;case"mental_rate":N=j;break;default:throw new Error(`条件式が不正です: ${$}`)}if(W===void 0)throw new Error(`条件式が不正です: ${$}`);switch(F){case"<=":if(!(N<=W))continue t;break;case">=":if(!(N>=W))continue t;break}}switch(i.type){case"vol_buff":P[0]=(P[0]||0)+(i.value||0),v+=`${b[o.name]} vol_buff: +${i.value}
`;break;case"vol_up":{const $=P[0]??0;P[0]=0,u.point+=Math.ceil((i.value||0)*(1+$/100)),v+=`${b[o.name]} vol_up: +${Math.ceil((i.value||0)*(1+$/100))}
`,v+=`now voltagePoint: ${u.point}
`;break}case"vol_down":u.point-=i.value||0,u.point<0&&(u.point=0),v+=`${b[o.name]} vol_down: -${i.value||0}
`;break;case"score_buff":V[0]=(V[0]||0)+(i.value||0),v+=`${b[o.name]} score_buff: +${i.value}
`;break;case"score_up":{const $=V[0]??0;V[0]=0;const F=(i.value||0)/100*(1+$/100)*D(s,u.lv,R?.fever||!1);_+=Math.ceil(f*F),v+=`${b[o.name]} score_up: +${Math.ceil(f*F)}
`;break}case"mental_up":h+=Math.ceil((i.value||0)/100*l),v+=`${b[o.name]} mental_up: +${Math.ceil((i.value||0)/100*l)}
`;break;case"mental_down":h-=Math.ceil((i.value||0)/100*l),v+=`${b[o.name]} mental_down: -${Math.ceil((i.value||0)/100*l)}
`,h<=0&&(h=1);break;case"ap_up":g+=Math.ceil((i.value||0)*q(E)*1e4),v+=`${b[o.name]} ap_up: +${(i.value||0)*q(E)}
`;break;case"ap_down":g-=(i.value||0)*1e4,v+=`${b[o.name]} ap_down: -${i.value||0}
`;break;case"reset":A=x.length-1,v+=`${b[o.name]} reset
`;break;case"splice":x.splice(x.indexOf(o),1),A--,v+=`${b[o.name]} splice
`;break;default:throw new Error(`skill typeが不正です: ${i.type}`)}}};c&&p==="start"&&L(c,d);const Z=()=>{const o=x[A];if(!o)throw new Error("メンバーが見つかりません");const m=Math.max(o.ap-C,0);return m*1e4<=g&&M<=0?(g-=m*1e4,U.set(o,(U.get(o)||0)+1),Y++,L(o,o.skills),A=x.length-1===A?0:A+1,M+=S,!0):!1};for(let o=0;o<t.length;o++){const m=t[o];if(R=t[o-1],!m)throw new Error("noteが見つかりません");for(c&&m.fever&&!R?.fever&&p==="fever_start"&&(v+=`FEVER START
`,L(c,d)),!m.fever&&R?.fever&&(v+=`FEVER END
`),M-=m.time-Q,Q=m.time;Z(););M=Math.max(0,M);for(let B=0;B<m.normalCount+m.slideCount;B++){if(r==="desperate"&&h*10>l){B<m.normalCount?h-=Math.ceil(l/15):h-=Math.ceil(l*2/75),v+=`miss, apPoint: ${g}, mental: ${h}, vol_lv: ${u.lv*(m.fever?2:1)}
`;continue}E++,g+=Math.ceil(it*q(E)*1e4),Z();const j=Math.ceil(f/X*30*D(s,u.lv,m.fever));_+=j,v+=`combo: ${E}, score: ${_} (+${j}), apPoint: ${g}, mental: ${h}, vol_lv: ${u.lv*(m.fever?2:1)}
`}}return c&&p==="end"&&L(c,d),{score:_,log:v}};var at=`key	series	other_name	smile	pure	cool	mental	rarity	center_skill_condition	raw_center_skill_text	raw_skill_text	ap	center_ability_text
other	蓮ノ空女学院スクールアイドルクラブ102期生	大賀美沙知	5880	5700	5700	480	ur			ap_up(10);skill_count>=3 ^ splice()	0	
rurino	悠久の舞踏会		4320	7800	5160	480	ur	fever_start	ap_up(8);vol_lv >= 4 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(326.25);vol_lv >= 7 ^ score_buff(435);mental_down(10*)	10	appeal_up(g103, 200);ap_reduce(all, 2)
rurino	アイドゥーミー！		6960	6360	5880	520	ur	fever_start	ap_up(20); mental_rate <= 99 ^ vol_down(1000*)	mental_up(10*); mental_rate >= 100 ^ ap_up(15); mental_rate <= 99 ^ vol_down(1000*); skill_count >= 3 ^ splice()	5	appeal_up(miracra, 200)
megumi	久遠の銀河へ		7200	4920	4800	510	ur	fever_start	score_up(204.75); skill_count >= 6 ^ score_up(286.65)	total_skill_count <= 9 ^ ap_up(15*); total_skill_count >= 10 ^ score_up(522)	10	appeal_up(g102, 200);ap_reduce(all, 2)
kaho	アイドゥーミー！		6000	6240	6960	520	ur	end	score_up(418.5)	mental_up(10*); mental_rate >= 100 ^ score_up(1134); mental_rate <= 99 ^ vol_down(1000*); skill_count >= 3 ^ splice()	12	appeal_up(all, 72)
sayaka	アイドゥーミー！		6120	6960	6120	520	ur	fever_start	score_up(877.5); mental_rate <= 99 ^ vol_down(1000*)	skill_count <= 1 ^ vol_buff(78.75); skill_count >= 2 ^ score_buff(243); mental_rate >= 100 ^ vol_up(945); mental_rate <= 99 ^ vol_down(1000*)	14	appeal_up(dollche, 200)
kozue	輪廻の銀河へ		5160	4680	7440	480	ur	fever_start	ap_up(8); skill_count >= 6 ^ ap_up(8)	skill_count <= 3 ^ vol_buff(324); skill_count <= 3 ^ reset(); skill_count >= 4 ^ score_buff(324)	10	appeal_up(g102, 200);ap_reduce(all, 2)
ceras	16th Birthday		5760	5760	5760	480	br	start	ap_up(10)	ap_up(5); vol_buff(54.45); reset(); skill_count >= 3 ^ splice()	0	appeal_up(ceras, 400)
tsuzuri	幸せのリボン（SLv.12以上）		5760	5160	8520	500	lr	fever_start	vol_up(478)	vol_up(731); skill_count >= 10 ^ vol_up(1170); skill_count <= 12 ^ ap_up(20*); splice()	20	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)
tsuzuri	幸せのリボン（SLv.11以下）		5760	5160	8520	500	lr	fever_start	vol_up(478)	vol_up(731); skill_count >= 10 ^ vol_up(1170); splice()	20	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)
sayaka	真実の舞踏会		5160	4080	7920	490	ur	fever_start	vol_up(170); mental_rate >= 50 ^ vol_up(238)	vol_lv <= 8 ^ vol_up(326); vol_lv >= 7 ^ score_buff(558); vol_lv >= 7 ^ vol_down(50*)	10	appeal_up(g103, 200); ap_reduce(all, 2)
kaho	軌跡の舞踏会		7680	5760	3960	470	ur	end	score_up(204.75); vol_lv >= 4 ^ score_up(286.65)	vol_lv <= 8 ^ score_buff(243); vol_lv >= 7 ^ score_up(522)	10	appeal_up(g103, 200); ap_reduce(all, 2)
megumi	18th Birthday*		5760	5760	5760	480	br	fever_start	score_up(368.28); total_skill_count >= 6 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); skill_count <= 4 ^ ap_up(5*); skill_count <= 2 ^ ap_up(5*)	10	appeal_up(megumi, 400)
hime	BLAST!!		3720	7080	6240	500	ur	fever_start	mental_down(40*); score_up(326.25)	mental_rate >= 30 ^ mental_down(20*); mental_rate >= 30 ^ ap_up(8*); mental_rate >= 30 ^ score_buff(74.25); mental_rate <= 30 ^ score_up(918)	20	appeal_up(miracra, 200)
ginko	輝跡の舞踏会		4320	6720	6120	490	ur	fever_start	ap_up(8); vol_lv >= 4 ^ ap_up(8)	mental_rate <= 10 ^ score_buff(253.12); mental_rate <= 10 ^ vol_buff(253.12); mental_rate <= 10 ^ ap_up(10*); mental_down(50*)	10	appeal_up(g104, 200); ap_reduce(all, 2)
rurino	17th Birthday*		5760	5760	5760	480	br	fever_start	ap_up(12); mental_rate >= 50 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); mental_rate >= 50 ^ ap_up(5*); mental_rate >= 100 ^ ap_up(5*)	10	appeal_up(rurino, 400)
ceras	十六夜セレーネ		4560	5280	7320	490	ur	fever_start	vol_up(348)	vol_lv <= 8 ^ vol_up(243); vol_lv >= 7 ^ score_buff(324); skill_count <= 2 ^ reset()	12	appeal_up(edel, 200)
ceras	天地黎明		6960	6480	3840	480	ur	end	score_up(418.5)	skill_count <= 1 ^ vol_buff(697.5); skill_count >= 2 ^ score_up(502.2); skill_count >= 3 ^ ap_up(8)	17	appeal_up(all, 80)
kozue	奇跡の舞踏会		7200	5160	4920	480	ur	fever_start	ap_up(8); total_skill_count >= 6 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(243); vol_lv >= 7 ^ score_buff(324)	8	appeal_up(g102, 200); ap_reduce(all, 2)
ginko	37.5℃のファンタジー		6720	6120	4440	480	ur	start	mental_down(25); ap_up(5)	score_buff(170.62); mental_rate >= 30 ^ reset(); mental_rate <= 25 ^ ap_up(3)	7	appeal_up(all, 80)
izumi	天地黎明		7080	6240	3960	480	ur	start	vol_up(348)	skill_count <= 1 ^ score_buff(697.5); skill_count >= 2 ^ vol_up(418); skill_count >= 3 ^ ap_up(8)	18	appeal_up(all, 80)
kosuzu	アイマイメーデー		4200	6120	6960	480	ur	fever_start	vol_up(348)	vol_up(202); mental_rate >= 30 ^ mental_down(25); mental_rate <= 25 ^ vol_up(435); mental_rate <= 25 ^ splice()	8	appeal_up(all, 80)`;const nt=t=>t.replace(/_([a-z])/g,(e,a)=>a.toUpperCase()),T=(t=>{const e=t.split(`
`),a=e[0].split("	");return e.slice(1).map(l=>l.split("	")).map(l=>a.reduce((s,n,r)=>(s={...s,[nt(n)]:l[r]===""||isNaN(Number(l[r]))?l[r]:Number(l[r])},s),{}))})(at),rt=["<=",">="],G=Object.freeze({1:1,2:1.1,3:1.2,4:1.3,5:1.4,6:1.5,7:1.6,8:1.7,9:1.8,10:2,11:2.2,12:2.4,13:2.6,14:3}),O=Object.freeze({vol_buff:2,vol_up:2,vol_down:2,score_up:2,score_buff:2,mental_up:2,mental_down:2,ap_up:0,ap_down:0}),z=(t,e,a)=>{const f=t.rawSkillText.replace(/([\w_]+)\(([\d.]+)(?<no_change>\*?)\)/g,(s,n,r,c)=>{if(c)return`${n}(${r})`;const p=Math.floor(Number(r)*G[e]/3*Math.pow(10,O[n])+1e-6)/Math.pow(10,O[n]);return`${n}(${p})`}),l=t.rawCenterSkillText.replace(/([\w_]+)\(([\d.]+)(?<no_change>\*?)\)/g,(s,n,r,c)=>{if(c)return`${n}(${r})`;const p=Math.floor(Number(r)*G[a]/3*Math.pow(10,O[n])+1e-6)/Math.pow(10,O[n]);return`${n}(${p})`});return{...t,name:t.key,skill:f,centerSkillCondition:t.centerSkillCondition,centerSkill:l}};z(T[0],14,14),z(T[6],14,14),z(T[5],14,14),z(T[7],14,14),z(T[4],14,14),z(T[1],14,14);const I=t=>{if(!t)return;const e=rt.find(a=>t?.includes(a));if(e){const[a,f]=t.split(e).map(l=>l.trim());return!a||!f?void 0:[a,e,Number(f)]}else return},st=t=>{const e=[],a=[],f=[],l=t.skill.split(";").map(s=>s.trim());for(const s of l){const[n,r]=s.split("^").map(y=>y.trim()),c=r?n:void 0,p=r||n,[,d,k]=p.match(/^(\w+)\((.*)\)$/)||[],w={type:d,value:k?Number(k):void 0,condition:I(c)};e.push(w)}if(t.centerSkill){const s=t.centerSkill.split(";").map(n=>n.trim());for(const n of s){const[r,c]=n.split("^").map(S=>S.trim()),p=c?r:void 0,d=c||r,[,k,w]=d.match(/^(\w+)\((.*)\)$/)||[],y={type:k,value:w?Number(w):void 0,condition:I(p)};a.push(y)}}if(t.centerAbilityText){const s=t.centerAbilityText.split(";").map(n=>n.trim());for(const n of s){const[,r,c]=n.match(/^(\w+)\((.*)\)$/)||[],p=c?c.split(",").map(k=>k.trim()):[],d={type:r,value:r==="cooltime_reduce"?{target:"all",amount:Number(p[0])}:{target:p[0]||"all",amount:Number(p[1])}};f.push(d)}}return{...t,skills:e,centerSkills:a,centerAbilities:f}},ct=(t,e)=>et[e]?.includes(t)||t===e,ut=(t,e,a)=>{const l=t.find(n=>n.name===a)?.centerAbilities.find(n=>n.type==="appeal_up"),s=t.reduce((n,r)=>{const c=l?ct(r.name,l?.value.target):!1,p=Math.ceil(r.smile*(c?(100+(l?.value.amount||0))/100:1)),d=Math.ceil(r.pure*(c?(100+(l?.value.amount||0))/100:1)),k=Math.ceil(r.cool*(c?(100+(l?.value.amount||0))/100:1));return{smile:n.smile+p,pure:n.pure+d,cool:n.cool+k}},{smile:0,pure:0,cool:0});return s.smile=Math.round(s.smile/(e==="smile"?1:10)),s.pure=Math.round(s.pure/(e==="pure"?1:10)),s.cool=Math.round(s.cool/(e==="cool"?1:10)),s.smile+s.pure+s.cool};function*H(t,e){if(e===0)yield[];else if(e===1)for(const a of t)yield[a];else for(let a=0;a<t.length-e+1;a++){const f=t.slice(a+1);for(const l of H(f,e-1))yield[t[a],...l]}}function*J(t){if(t.length===1)yield t;else for(let e=0;e<t.length;e++){const a=t.slice(0,e).concat(t.slice(e+1));for(const f of J(a))yield[t[e],...f]}}self.onmessage=t=>{const{requiredMembers:e,optionalMembers:a,notes:f,center:l,attribute:s,masteryLevel:n,playStyle:r,includingCenterOnly:c}=t.data;let p=0;const d=6-e.length,k=new WeakMap,w=performance.now();for(const S of H(a,d)){const C=[...e,...S];if(c&&!C.some(_=>_.key===l)||new Set(C.map(_=>_.key!=="other"?_.key:_.otherName)).size!==6)continue;const M=C.map(_=>{if(k.has(_))return k.get(_);const u=st(_);return k.set(_,u),u}),g=ut(M,s,l),h=C.reduce((_,u)=>_+u.mental,0);for(const _ of J(M))try{const u=ot({notes:f,convertedMembers:_,center:l,appealSum:g,mentalSum:h,masteryLevel:n,comboOffset:0,playStyle:r});u.score>p&&(p=u.score,self.postMessage({message:"calcScore",data:{...u,members:_}}))}catch(u){console.error(u)}}const y=performance.now();console.log(y-w),self.postMessage({message:"end"})}})();
