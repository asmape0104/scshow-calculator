import{u as De,a as Te,r as i,t as Re,j as $e,p as Pe,b as ae,v as Ae,w as Ee,k as Ne,o as P}from"./BC2zCICV.js";import{u as ie,_ as de,a as ze,b as qe,c as je,d as We,M as Be}from"./hT6P3woX.js";import{f as ve,r as s,c as w,o as _,a as l,b as p,m as o,l as a,h as Ge,g as A,z as Ie,u as Je,w as re,j as m,v as Ke,t as f,s as le,d as x,x as T,A as E,F as te,n as oe,k as He,i as ue,B as Qe,C as Xe,D as Ye,y as Ze}from"./BxY2FTCB.js";const el={class:"card my-2"},ll={class:"card-body"},tl={class:"d-flex gap-2 align-items-center"},ol=ve({__name:"OCardOperation",setup(ce){const v=s("none"),{skillCaches:k}=ie(),H=()=>{k.forEach(r=>{r.value.mark===v.value&&(console.log("setSelectedMarkToRequired",r.value.mark),r.value={...r.value,selected:"required"})})},S=()=>{k.forEach(r=>{r.value.mark===v.value&&(r.value={...r.value,selected:"optional"})})},h=()=>{k.forEach(r=>{r.value.mark===v.value&&(r.value={...r.value,selected:"excluded"})})},F=()=>{confirm("マークをリセットしますか？")&&k.forEach(r=>{r.value={...r.value,mark:"none"}})};return(r,b)=>{const O=de;return _(),w("div",el,[b[2]||(b[2]=l("div",{class:"card-header"}," カード操作 ",-1)),l("div",ll,[l("div",tl,[l("div",null,[p(O,{modelValue:o(v),"onUpdate:modelValue":b[0]||(b[0]=C=>a(v)?v.value=C:null),class:""},null,8,["modelValue"])]),b[1]||(b[1]=l("div",null,"をすべて",-1)),l("button",{class:"btn btn-primary",onClick:H},"必須に"),l("button",{class:"btn btn-primary",onClick:S},"任意に"),l("button",{class:"btn btn-primary",onClick:h},"除外に")]),l("div",{class:"mt-2"},[l("button",{class:"btn btn-primary",onClick:F},"マークリセット")])])])}}}),nl=Object.assign(ol,{__name:"OCardOperation"}),sl={class:"container-md"},al={class:"card my-2"},rl={class:"card-body"},ul={class:"table"},il={scope:"col"},dl={class:"d-flex align-items-end"},vl={class:""},cl={class:"input-group"},ml={class:"input-group-prepend"},pl={class:"input-group-text"},fl={style:{"min-height":"1.5em"}},kl={style:{"text-align":"right"}},bl={class:"d-flex gap-3 justify-content-end"},gl={class:"d-flex gap-2"},yl=["disabled"],_l={class:"card my-2"},xl={class:"card-body"},Cl={class:"mb-2"},wl={class:"row"},Ll={class:"col-auto"},Ul={class:"col-auto"},Vl={class:"mb-2"},Ml={class:"row"},Sl={class:"col-auto"},hl={class:"col-auto"},Fl={class:"mb-2"},Ol={class:"row"},Dl={class:"col-auto"},Tl={class:"col-auto"},Rl={class:"mb-2"},$l={class:"form-check"},Pl={class:"form-check-label",for:"parallel"},Al={class:"form-check"},El={class:"form-check"},Nl={class:"form-check"},zl={class:"form-check"},ql={key:2},jl={class:"card my-2"},Wl={class:"card-body"},Bl=["value"],Gl={class:"d-flex gap-2 align-items-center"},Hl=ve({__name:"auto-formation",setup(ce){const v=s("finished"),k=s(void 0),H=async()=>{if(k.value)try{await k.value.release(),k.value=void 0}catch{}if("wakeLock"in navigator)try{k.value=await navigator.wakeLock.request("screen")}catch(n){console.error(n)}};Ge(v,async n=>{if(n==="finished")try{await k.value?.release(),k.value=void 0}catch{}});const S=s(""),h=s(""),F=s(0),r=s(0),b=s("smile"),O=s(50),C=s("perfect"),U=s("current"),V=s("score"),N=s(!0),z=s([]),q=De("seasonFanLvs",{kaho:1,sayaka:1,rurino:1,ginko:1,kosuzu:1,hime:1,ceras:1,izumi:1,kozue:1,tsuzuri:1,megumi:1}),j=s(""),W=s(!0),B=s(!0),G=s(!1),I=s(!1),g=s([...Te]),d=s(Object.fromEntries(g.value.map(n=>[i(n),{level:Re[n.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),me=(n,e)=>{d.value[n]=e},pe=A(()=>g.value.filter(n=>d.value[i(n)]?.selected==="required").length),fe=A(()=>g.value.filter(n=>d.value[i(n)]?.selected==="excluded").length),ke=A(()=>g.value.filter(n=>d.value[i(n)]?.selected==="optional").length),R=s([]),Q=s([]),X=s(0),Y=s(1);Ie(()=>{Y.value=navigator.hardwareConcurrency||4});const y=s(null),be=A(()=>Q.value.reduce((n,e)=>n+e,0)),ne=s(Promise.resolve()),ge=n=>{R.value=Array.from({length:n},()=>new Worker(new URL(""+new URL("calc-worker-parallel-rXInW9UD.js",import.meta.url).href,import.meta.url),{type:"module"})),R.value.forEach((e,L)=>{e.onmessage=c=>{switch(c.data.message){case"calcScore":ne.value=ne.value.then(async()=>{c.data.data.score>(y.value?.score||0)&&(y.value={score:c.data.data.score,liveGrandPrixPt:c.data.data.liveGrandPrixPt,members:c.data.data.members,centerMember:c.data.data.centerMember,log:c.data.data.log})});break;case"progress":Q.value[L]=c.data.data.progress;break;case"end":X.value++,X.value===R.value.length&&(v.value="finished");break}}})},ye=()=>{const n=N.value?Y.value:1;ge(n),H(),y.value=null,Q.value=Array.from({length:n.value},()=>0),X.value=0;const e=Pe(S.value,F.value),L=g.value.filter(u=>d.value[i(u)]&&d.value[i(u)].selected==="required").map(u=>ae(u,d.value[i(u)]?.skillLevel||10,d.value[i(u)]?.centerSkillLevel||10,d.value[i(u)]?.level||1));if(L.length>6){$("必要メンバーが6人を超えています");return}const c=g.value.filter(u=>!d.value[i(u)]?.selected||d.value[i(u)].selected==="optional").map(u=>ae(u,d.value[i(u)]?.skillLevel||10,d.value[i(u)]?.centerSkillLevel||10,d.value[i(u)]?.level||1));v.value="running",R.value.forEach((u,M)=>{u.postMessage(JSON.parse(JSON.stringify({requiredMembers:L,optionalMembers:c,notes:e,center:h.value,attribute:b.value,masteryLevel:O.value,playStyle:C.value,formationRule:U.value,includingCenterOnly:W.value,noLog:B.value,noDamagedFormation:G.value,noCuredFormation:I.value,scoreComparisonRule:V.value,seasonFanLvs:q.value,singers:z.value,batchNum:n,batchIndex:M})))})},_e=()=>{R.value.forEach(n=>{n.terminate()}),v.value="finished"},$=n=>{window.alert(n)},{modals:xe,openModal:Ce}=$e(),we=async n=>{await Ce(Be,{card:n,displayLevel:d.value[i(n)]?.level||1})},Z=s(null),Le=()=>{const n=Z.value?.files?.[0];if(n){const e=new FileReader;e.onload=L=>{const c=L.target?.result;g.value=g.value.concat(Ae(c))},e.readAsText(n)}},Ue=s(null),se=s(!1),Ve=()=>{g.value=g.value.concat(Ee),se.value=!0},J=s("none"),{skillCaches:D}=ie(),K=A(()=>({spade:Array.from(D.values()).filter(n=>n.value.mark==="spade").length,heart:Array.from(D.values()).filter(n=>n.value.mark==="heart").length,diamond:Array.from(D.values()).filter(n=>n.value.mark==="diamond").length,club:Array.from(D.values()).filter(n=>n.value.mark==="club").length,none:Array.from(D.values()).filter(n=>n.value.mark==="none").length})),Me=()=>{y.value?.members.forEach(n=>{const e=D.get(i(n));e&&(e.value={...e.value,mark:J.value})})};return Je({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"},{name:"description",content:"スクショウの編成を自動で計算します"}]}),(n,e)=>{const L=Ne,c=qe,u=ze,M=He,Se=je,he=nl,Fe=de,Oe=We;return _(),w("div",sl,[e[55]||(e[55]=l("h1",null,"スクショウ自動編成",-1)),e[56]||(e[56]=l("a",{href:"https://note.com/asmape/n/nefd46574f4e3",target:"_blank"},"note",-1)),p(L,{"note-text":o(S),"onUpdate:noteText":e[0]||(e[0]=t=>a(S)?S.value=t:null),center:o(h),"onUpdate:center":e[1]||(e[1]=t=>a(h)?h.value=t:null),offset:o(F),"onUpdate:offset":e[2]||(e[2]=t=>a(F)?F.value=t:null),"combo-offset":o(r),"onUpdate:comboOffset":e[3]||(e[3]=t=>a(r)?r.value=t:null),attribute:o(b),"onUpdate:attribute":e[4]||(e[4]=t=>a(b)?b.value=t:null),"mastery-level":o(O),"onUpdate:masteryLevel":e[5]||(e[5]=t=>a(O)?O.value=t:null),singers:o(z),"onUpdate:singers":e[6]||(e[6]=t=>a(z)?z.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),p(u,null,{default:re(()=>[p(c,{"season-fan-lvs":o(q),"onUpdate:seasonFanLvs":e[7]||(e[7]=t=>a(q)?q.value=t:null)},null,8,["season-fan-lvs"])]),_:1}),l("div",al,[e[36]||(e[36]=l("div",{class:"card-header"}," メンバー ",-1)),l("div",rl,[l("table",ul,[l("thead",null,[l("tr",null,[l("th",il,[l("div",dl,[e[27]||(e[27]=l("div",{style:{"margin-right":"8px"}}," カード ",-1)),l("div",vl,[l("div",cl,[l("div",ml,[l("div",pl,[l("div",fl,[p(M,{icon:["fas","magnifying-glass"]})])])]),m(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a(j)?j.value=t:null),type:"text",class:"form-control"},null,512),[[Ke,o(j)]])])])])]),e[28]||(e[28]=l("th",{scope:"col"},"AP",-1)),e[29]||(e[29]=l("th",{scope:"col"},"Lv.",-1)),e[30]||(e[30]=l("th",{scope:"col"},"スキルLv.",-1)),e[31]||(e[31]=l("th",{scope:"col"},"センターSLv.",-1)),e[32]||(e[32]=l("th",{scope:"col"},"凸数",-1)),e[33]||(e[33]=l("th",{scope:"col"},"選択",-1)),e[34]||(e[34]=l("th",{scope:"col"},"マーク",-1))])]),l("tbody",null,[p(u,{"fallback-tag":"tr"},{default:re(()=>[(_(!0),w(te,null,oe(o(g),t=>m((_(),ue(Se,{key:o(P)(t),card:t,"open-card-details-modal":we,"onUpdate:skillLevel":ee=>me(o(i)(t),ee)},null,8,["card","onUpdate:skillLevel"])),[[Qe,o(P)(t).toLowerCase().includes(o(j).toLowerCase())]])),128))]),_:1})])]),l("div",kl," 必須："+f(o(pe))+" 任意："+f(o(ke))+" 除外："+f(o(fe)),1),l("div",bl,[l("div",null,"♥："+f(o(K).heart),1),l("div",null,"♦："+f(o(K).diamond),1),l("div",null,"♠："+f(o(K).spade),1),l("div",null,"♣："+f(o(K).club),1)]),l("div",gl,[l("button",{type:"button",class:"btn btn-primary",onClick:e[9]||(e[9]=t=>o(Z)?.click())}," TSVインポート "),l("button",{type:"button",class:"btn btn-primary",disabled:o(se),onClick:e[10]||(e[10]=t=>Ve())}," 後衛カード追加 ",8,yl)]),e[35]||(e[35]=l("div",null,[l("a",{href:"https://docs.google.com/spreadsheets/d/13moGCQN2fd9_kxc5g3M9go98Sw6Y8fO25nDxKFoDsDk/edit?gid=1837505339#gid=1837505339",target:"_blank"}," 後衛カード一覧 ")],-1)),l("input",{ref_key:"tsvFileInput",ref:Z,type:"file",class:"d-none",onChange:Le},null,544)])]),p(he),l("div",_l,[e[54]||(e[54]=l("div",{class:"card-header"}," 計算 ",-1)),l("div",xl,[l("div",Cl,[e[39]||(e[39]=x(" プレイスタイル： ",-1)),l("div",wl,[l("div",Ll,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>a(C)?C.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[T,o(C)]]),e[37]||(e[37]=x(" 渾身 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[12]||(e[12]=t=>$("フルコンを目指すプレイ"))},[p(M,{icon:"circle-info"})])]),l("div",Ul,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>a(C)?C.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[T,o(C)]]),e[38]||(e[38]=x(" 背水 ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[14]||(e[14]=t=>$("メンタルが10%以下になるようミスをするプレイ"))},[p(M,{icon:"circle-info"})])])])]),l("div",Vl,[e[42]||(e[42]=x(" 編成ルール： ",-1)),l("div",Ml,[l("div",Sl,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>a(U)?U.value=t:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[T,o(U)]]),e[40]||(e[40]=x(" 通常ルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[16]||(e[16]=t=>$(`・メンバー1人あたり1種類まで
・カード制限なし`))},[p(M,{icon:"circle-info"})])]),l("div",hl,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>a(U)?U.value=t:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[T,o(U)]]),e[41]||(e[41]=x(" ライグラルール ",-1))]),l("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[18]||(e[18]=t=>$(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[p(M,{icon:"circle-info"})])])])]),l("div",Fl,[e[45]||(e[45]=x(" スコア比較基準： ",-1)),l("div",Ol,[l("div",Dl,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>a(V)?V.value=t:null),class:"form-check-input",type:"radio",value:"score"},null,512),[[T,o(V)]]),e[43]||(e[43]=x(" スコア ",-1))])]),l("div",Tl,[l("label",null,[m(l("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>a(V)?V.value=t:null),class:"form-check-input",type:"radio",value:"grandPrixPt"},null,512),[[T,o(V)]]),e[44]||(e[44]=x(" グランプリpt ",-1))])])])]),l("div",Rl,[e[50]||(e[50]=x(" オプション： ",-1)),l("div",$l,[m(l("input",{id:"parallel","onUpdate:modelValue":e[21]||(e[21]=t=>a(N)?N.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[E,o(N)]]),l("label",Pl," マルチスレッド ("+f(o(Y))+"スレッド) ",1)]),l("div",Al,[m(l("input",{id:"includingCenterOnly","onUpdate:modelValue":e[22]||(e[22]=t=>a(W)?W.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[E,o(W)]]),e[46]||(e[46]=l("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),l("div",El,[m(l("input",{id:"noLog","onUpdate:modelValue":e[23]||(e[23]=t=>a(B)?B.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[E,o(B)]]),e[47]||(e[47]=l("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),l("div",Nl,[m(l("input",{id:"noDamagedFormation","onUpdate:modelValue":e[24]||(e[24]=t=>a(G)?G.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[E,o(G)]]),e[48]||(e[48]=l("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),l("div",zl,[m(l("input",{id:"noCuredFormation","onUpdate:modelValue":e[25]||(e[25]=t=>a(I)?I.value=t:null),class:"form-check-input",type:"checkbox"},null,512),[[E,o(I)]]),e[49]||(e[49]=l("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),o(v)!=="running"?(_(),w("button",{key:0,type:"button",class:"btn btn-primary",onClick:ye}," 計算 ")):le("",!0),o(v)==="running"?(_(),w("button",{key:1,type:"button",class:"btn btn-primary",onClick:_e}," 中止 ")):le("",!0),o(y)?(_(),w("div",ql,[l("p",{ref_key:"progressView",ref:Ue},f(o(v)==="running"?`計算中... ${o(be).toFixed(2)}%`:"計算完了"),513),l("div",jl,[l("div",Wl,[l("p",null,"最高得点: "+f(o(y).score)+" ("+f(o(y).liveGrandPrixPt)+"pt)",1),e[53]||(e[53]=l("p",null,"メンバー:",-1)),l("ul",null,[(_(!0),w(te,null,oe(o(y).members,t=>(_(),w("li",{key:o(i)(t),style:Xe({fontWeight:o(y).centerMember&&o(P)(t)===o(P)(o(y).centerMember)?"bold":"normal"})},f(o(P)(t)),5))),128))]),l("textarea",{class:"form-control",value:o(y).log,readonly:"",rows:"5"},null,8,Bl),l("div",Gl,[e[51]||(e[51]=l("div",null,"編成に使用したカードを",-1)),l("div",null,[p(Fe,{modelValue:o(J),"onUpdate:modelValue":e[26]||(e[26]=t=>a(J)?J.value=t:null),class:""},null,8,["modelValue"])]),e[52]||(e[52]=l("div",null,"にする",-1)),l("button",{class:"btn btn-primary",onClick:Me},"実行")])])])])):le("",!0)])]),p(Oe),(_(!0),w(te,null,oe(o(xe),(t,ee)=>(_(),ue(Ze(t.component),Ye({key:`modal-${ee}`,"on-close":t.onClose},{ref_for:!0},t.args),null,16,["on-close"]))),128))])}}});export{Hl as default};
