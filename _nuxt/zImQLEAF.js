import{c as $e,m as T,a as ve,b as Ce,s as ee,d as q,e as me,u as we,f as pe,g as ae,_ as Me,h as Ve,i as Ue,j as xe,k as Se,l as ge,p as Te,n as Ae}from"./DWh-AcnV.js";import{f as ke,r as k,g as P,h as te,i as ye,o as U,w as Ne,a as e,j as _,k as h,v as S,l as s,c as g,F as J,m as K,n as Ee,t as $,p as ie,q as oe,d as Q,u as De,b as Be,s as fe,x as Re}from"./BVJJh7Sw.js";const Fe=m=>m<=2100?Math.floor((-5+Math.sqrt(25+20*m))/10):Math.floor(20+(m-2100)/200),_e=(m,x,A)=>(1+m/100)*(1+x*(A?2:1)/10),ne=m=>m<10?1:m<20?1.1:m<30?1.2:m<40?1.3:m<50?1.4:1.5,je=({notes:m,convertedMembers:x,center:A,appealSum:N,mentalSum:f,masteryLevel:d,playStyle:C="perfect",noLog:i=!1,noDamagedFormation:w=!1,noCuredFormation:M=!1})=>{const y=x.find(n=>n.name===A),E=y?.centerSkillCondition,D=y?.centerSkills||[],V=y?.centerAbilities||[],b=V.find(n=>n.type==="cooltime_reduce"),a=V.find(n=>n.type==="ap_reduce"),r=5-Number(b?.value.amount||0),W=Number(a?.value.amount||0),j=x.slice();let z=r,c=0,t=f,B=0;const l={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=Fe(n)},get lv(){return this._lv}},R=[0],o=[0];let H=0,re=0;const ce=$e(m);let G=0,de=0;const le=new WeakMap,be=60/ce;let X,u="";const Y=(n,v,F)=>{const Z=l.lv,he=t*100/f;e:for(const p of v){if(p.condition){const[O,L,se]=p.condition;let I=0;switch(O){case"skill_count":I=le.get(n)||0;break;case"total_skill_count":I=de;break;case"vol_lv":I=Z*(F?2:1);break;case"mental_rate":I=he;break;default:throw new Error(`条件式が不正です: ${O}`)}if(se===void 0)throw new Error(`条件式が不正です: ${O}`);switch(L){case"<=":if(!(I<=se))continue e;break;case">=":if(!(I>=se))continue e;break}}switch(p.type){case"vol_buff":o[0]=(o[0]||0)+(p.value||0),i||(u+=`${T[n.name]} vol_buff: +${p.value}
`);break;case"vol_up":{const O=o[0]??0;o[0]=0,l.point+=Math.ceil((p.value||0)*(1+O/100)),i||(u+=`${T[n.name]} vol_up: +${Math.ceil((p.value||0)*(1+O/100))}
`,u+=`now voltagePoint: ${l.point}
`);break}case"vol_down":l.point-=p.value||0,l.point<0&&(l.point=0),i||(u+=`${T[n.name]} vol_down: -${p.value||0}
`);break;case"score_buff":R[0]=(R[0]||0)+(p.value||0),i||(u+=`${T[n.name]} score_buff: +${p.value}
`);break;case"score_up":{const O=R[0]??0;R[0]=0;const L=(p.value||0)/100*(1+O/100)*_e(d,l.lv,F);B+=Math.ceil(N*L),i||(u+=`${T[n.name]} score_up: +${Math.ceil(N*L)}
`);break}case"mental_up":t+=Math.ceil((p.value||0)/100*f),i||(u+=`${T[n.name]} mental_up: +${Math.ceil((p.value||0)/100*f)}
`);break;case"mental_down":t-=Math.ceil((p.value||0)/100*f),i||(u+=`${T[n.name]} mental_down: -${Math.ceil((p.value||0)/100*f)}
`),t<=0&&(t=1);break;case"ap_up":c+=Math.ceil((p.value||0)*ne(G)*1e4),i||(u+=`${T[n.name]} ap_up: +${(p.value||0)*ne(G)}
`);break;case"ap_down":c-=(p.value||0)*1e4,i||(u+=`${T[n.name]} ap_down: -${p.value||0}
`);break;case"reset":H=j.length-1,i||(u+=`${T[n.name]} reset
`);break;case"splice":j.splice(j.indexOf(n),1),H--,i||(u+=`${T[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};y&&E==="start"&&Y(y,D,!1);const ue=n=>{if(j.length===0)return!1;const v=j[H];if(!v)throw new Error("メンバーが見つかりません");const F=Math.max(v.ap-W,0);return F*1e4<=c&&z<=0?(c-=F*1e4,le.set(v,(le.get(v)||0)+1),de++,Y(v,v.skills,n),H=j.length-1===H?0:H+1,z+=r,!0):!1};for(let n=0;n<m.length;n++){const v=m[n];if(X=m[n-1],!v)throw new Error("noteが見つかりません");for(z-=v.time-re,re=v.time;ue(X?.fever||!1););z=Math.max(0,z),y&&v.fever&&!X?.fever&&E==="fever_start"&&(i||(u+=`FEVER START
`),Y(y,D,!0)),!v.fever&&X?.fever&&(i||(u+=`FEVER END
`));for(let F=0;F<v.normalCount+v.slideCount;F++){if(C==="desperate"&&t*10>f){F<v.normalCount?t-=Math.ceil(f/15):t-=Math.ceil(f*2/75),i||(u+=`miss, apPoint: ${c}, mental: ${t}, vol_lv: ${l.lv*(v.fever?2:1)}
`);continue}G++,c+=Math.ceil(be*ne(G)*1e4),ue(v.fever);const Z=Math.ceil(N/ce*30*_e(d,l.lv,v.fever));if(B+=Z,i||(u+=`combo: ${G}, score: ${B} (+${Z}), apPoint: ${c}, mental: ${t}, vol_lv: ${l.lv*(v.fever?2:1)}
`),C==="perfect"&&w&&t<f)return i||(u+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:B,log:u};if(C==="desperate"&&M&&t*10>f)return i||(u+=`メンタルが10%超になったため計算を打ち切ります
`),{score:B,log:u}}}return y&&E==="end"&&Y(y,D,!1),{score:B,log:u}},Oe={class:"my-2"},Pe={class:"input-group mb-3"},qe=["value"],ze={class:"card my-2"},He={class:"card-body"},Ie={key:0,class:"my-2"},We={class:"alert alert-info"},Ge={class:"card my-2"},Je={class:"card-body"},Ke={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},Le={class:"alert alert-info"},et=ke({__name:"MdCardSelect",props:{onClose:{}},setup(m){const x=k(""),A=b=>`[${b.series}] ${b.key!=="other"?pe[b.key]:b.otherName}`,N=P(()=>ve.filter(b=>A(b).includes(x.value))),f=k(0),d=P(()=>ve[f.value]),C=P(()=>d.value?Ce(d.value,w.value,M.value):null),i=P(()=>C.value?ee(q(C.value).skills):""),w=k(14),M=k(14),y=P(()=>C.value?ee(q(C.value).centerSkills):""),E=P(()=>C.value?me(q(C.value).centerAbilities):""),D=we("skillCache",{}),V=b=>`${b.key}-${b.series}`;return te(d,()=>{d.value&&(w.value=D.value[V(d.value)]?.skillLevel||14,M.value=D.value[V(d.value)]?.centerSkillLevel||14)}),te([w,M],()=>{d.value&&(D.value[V(d.value)]={centerSkillLevel:M.value,skillLevel:w.value})}),(b,a)=>(U(),ye(Me,{"on-close":b.onClose},{default:Ne(()=>[e("div",Oe,[e("div",Pe,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>h(x)?x.value=r:null),type:"text",class:"form-control"},null,512),[[S,s(x)]])]),_(e("select",{"onUpdate:modelValue":a[1]||(a[1]=r=>h(f)?f.value=r:null),class:"form-select"},[(U(!0),g(J,null,K(s(N),(r,W)=>(U(),g("option",{key:`${r.key}-${r.series}`,class:Ee(["card",{"bg-primary":s(d)?.key===r.key}]),value:W}," ["+$(r.series)+"] "+$(r.key!=="other"?s(pe)[r.key]:r.otherName),11,qe))),128))],512),[[ie,s(f)]])]),e("div",ze,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",He,[e("div",null,[a[6]||(a[6]=Q(" スキルレベル： ",-1)),_(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>h(w)?w.value=r:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(w)]])]),s(d)?(U(),g("div",Ie,[e("div",We,$(s(i)),1)])):oe("",!0)])]),e("div",Ge,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Je,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),_(e("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>h(M)?M.value=r:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(M)]]),s(d)?(U(),g("div",Ke,[e("div",Qe," 【"+$(s(ae)(s(d).centerSkillCondition))+"】"+$(s(y)),1)])):oe("",!0)])]),e("div",Xe,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Ye,[s(d)?(U(),g("div",Ze,[e("div",Le,$(s(E)),1)])):oe("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=r=>b.onClose(s(C)))}," 選択 ")]),_:1},8,["on-close"]))}}),tt=Object.assign(et,{__name:"MdCardSelect"}),lt={class:"container-md"},st={class:"card my-2"},ot={class:"card-body"},nt={class:"card-header"},at={class:"card-body"},it=["onClick"],rt={class:"row my-2 align-items-center justify-content-start"},ct={class:"col-auto"},dt=["onUpdate:modelValue"],ut=["value"],vt={class:"row my-2 align-items-center justify-content-start"},pt={class:"col-auto"},ft=["onUpdate:modelValue"],_t={class:"row row-gap-1"},mt={class:"col-md"},kt=["onUpdate:modelValue"],yt={class:"col-md"},bt=["onUpdate:modelValue"],ht={class:"col-md"},$t=["onUpdate:modelValue"],Ct={class:"col-md"},wt={class:"input-group"},Mt=["onUpdate:modelValue"],Vt={class:"my-2"},Ut={class:"row"},xt={class:"col-sm"},St=["onUpdate:modelValue"],gt={class:"col-sm"},Tt={class:"alert alert-secondary"},At={class:"my-2"},Nt={class:"row"},Et={class:"col-sm"},Dt=["onUpdate:modelValue"],Bt=["value"],Rt=["onUpdate:modelValue"],Ft={class:"col-sm"},jt={class:"alert alert-secondary"},Ot={class:"my-2"},Pt={class:"row"},qt={class:"col-sm"},zt=["onUpdate:modelValue"],Ht={class:"col-sm"},It={class:"alert alert-secondary"},Wt={class:"row"},Gt={class:"col"},Jt={class:"form-label"},Kt={class:"col"},Qt={class:"form-label"},Xt={class:"card my-2"},Yt={class:"card-body"},Zt={class:"mb-2"},Lt={class:"row"},el={class:"col-auto"},tl={class:"col-auto"},ll={class:"my-2"},sl={class:"my-2"},al=ke({__name:"index",setup(m){const x=k(""),A=k(""),N=k(0),f=k(0),d=k("smile"),C=k([]),i=k("perfect"),w=k(80820),M=k(2960),y=k(50),E=k(""),D=k(0),V=k(Ae),b=()=>{const c=V.value.map(q),t=Te(x.value,N.value),{score:B,log:l}=je({notes:t,convertedMembers:c,center:A.value,appealSum:w.value,mentalSum:M.value,masteryLevel:y.value,playStyle:i.value});D.value=B,E.value=l},a=P(()=>V.value.reduce((c,t)=>c+t.mental,0)),r=P(()=>{const c=V.value.map(q);return Ve(c,d.value,A.value)});te(a,()=>{V.value.every(c=>c.mental)&&(M.value=a.value)}),te(r,()=>{V.value.every(c=>c.smile&&c.pure&&c.cool)&&(w.value=r.value)}),De({title:"スクショウ計算機"});const{modals:W,openModal:j}=Ue(),z=async c=>{const t=await j(tt);t&&V.value.splice(V.value.indexOf(c),1,t)};return(c,t)=>{const B=xe;return U(),g("div",lt,[t[25]||(t[25]=e("h1",null,"スクショウ計算機",-1)),Be(B,{"note-text":s(x),"onUpdate:noteText":t[0]||(t[0]=l=>h(x)?x.value=l:null),center:s(A),"onUpdate:center":t[1]||(t[1]=l=>h(A)?A.value=l:null),offset:s(N),"onUpdate:offset":t[2]||(t[2]=l=>h(N)?N.value=l:null),"combo-offset":s(f),"onUpdate:comboOffset":t[3]||(t[3]=l=>h(f)?f.value=l:null),attribute:s(d),"onUpdate:attribute":t[4]||(t[4]=l=>h(d)?d.value=l:null),"mastery-level":s(y),"onUpdate:masteryLevel":t[5]||(t[5]=l=>h(y)?y.value=l:null),singers:s(C),"onUpdate:singers":t[6]||(t[6]=l=>h(C)?C.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",st,[t[19]||(t[19]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ot,[(U(!0),g(J,null,K(s(V),(l,R)=>(U(),g("div",{key:R,class:"card m-3"},[e("div",nt,$(R+1)+"人目 ",1),e("div",at,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>z(l)}," カードを選択して入力 ",8,it)]),e("div",rt,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",ct,[_(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(U(!0),g(J,null,K(s(Se),o=>(U(),g("option",{key:o,value:o},$(s(T)[o]),9,ut))),128))],8,dt),[[ie,l.name]])])]),e("div",vt,[t[13]||(t[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",pt,[_(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,ft),[[S,l.ap,void 0,{number:!0}]])])]),t[18]||(t[18]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",_t,[e("div",mt,[_(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,kt),[[S,l.smile,void 0,{number:!0}]])]),e("div",yt,[_(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,bt),[[S,l.pure,void 0,{number:!0}]])]),e("div",ht,[_(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,$t),[[S,l.cool,void 0,{number:!0}]])]),e("div",Ct,[e("div",wt,[t[14]||(t[14]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),_(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Mt),[[S,l.mental,void 0,{number:!0}]])])])]),e("div",Vt,[t[15]||(t[15]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Ut,[e("div",xt,[_(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,St),[[S,l.skill]])]),e("div",gt,[e("div",Tt,$(s(ee)(s(q)(l).skills)),1)])])]),e("div",At,[t[16]||(t[16]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Nt,[e("div",Et,[_(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(U(!0),g(J,null,K(s(ge),o=>(U(),g("option",{key:o,value:o},$(s(ae)(o)),9,Bt))),128))],8,Dt),[[ie,l.centerSkillCondition]]),_(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Rt),[[S,l.centerSkill]])]),e("div",Ft,[e("div",jt," 【"+$(s(ae)(l.centerSkillCondition))+"】"+$(s(ee)(s(q)(l).centerSkills)),1)])])]),e("div",Ot,[t[17]||(t[17]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Pt,[e("div",qt,[_(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,zt),[[S,l.centerAbilityText]])]),e("div",Ht,[e("div",It,$(s(me)(s(q)(l).centerAbilities)),1)])])])])]))),128)),e("div",Wt,[e("div",Gt,[e("label",Jt,"総合アピール値（"+$(s(r))+"）：",1),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>h(w)?w.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(w),void 0,{number:!0}]])]),e("div",Kt,[e("label",Qt,"総合メンタル値（"+$(s(a))+"）：",1),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>h(M)?M.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(M),void 0,{number:!0}]])])])])]),e("div",Xt,[t[24]||(t[24]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Yt,[e("div",Zt,[t[22]||(t[22]=Q(" プレイスタイル： ",-1)),e("div",Lt,[e("div",el,[e("label",null,[_(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>h(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[fe,s(i)]]),t[20]||(t[20]=Q(" 渾身 ",-1))])]),e("div",tl,[e("label",null,[_(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>h(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[fe,s(i)]]),t[21]||(t[21]=Q(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:b}," 計算 "),e("div",ll," 計算結果: "+$(s(D)),1),e("div",sl,[t[23]||(t[23]=Q(" ログ： ",-1)),_(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=l=>h(E)?E.value=l:null),rows:"6",class:"form-control"},null,512),[[S,s(E)]])])])]),(U(!0),g(J,null,K(s(W),(l,R)=>(U(),ye(Re(l.component),{key:`modal-${R}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{al as default};
