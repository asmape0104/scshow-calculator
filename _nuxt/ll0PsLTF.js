import{c as Ce,m as B,a as pe,b as Ue,s as ae,d as z,e as me,u as we,_ as Ve,f as fe,g as de,h as ge,i as xe,j as Me,k as Se,l as Ne,n as Te,o as Ae,p as je,q as Ee}from"./3eAKt4OV.js";import{f as ye,r as $,g as P,h as ee,i as ke,o as h,w as Re,a as e,j as c,b as he,k as C,v as g,l as s,c as U,F as Q,m as X,n as Be,t as w,p as ue,q as te,d as Y,u as De,s as re,x as Oe}from"./DCQU3JgC.js";const Fe=b=>b<=2100?Math.floor((-5+Math.sqrt(25+20*b))/10):Math.floor(20+(b-2100)/200),_e=(b,N,A)=>(1+b/100)*(1+N*(A?2:1)/10),ce=b=>b<10?1:b<20?1.1:b<30?1.2:b<40?1.3:b<50?1.4:1.5,Pe=({notes:b,convertedMembers:N,center:A,appealSum:D,mentalSum:_,masteryLevel:d,playStyle:x="perfect",noLog:i=!1,noDamagedFormation:M=!1,noCuredFormation:S=!1,centerMember:V=N.find(j=>j.name===A)})=>{const j=V?.centerSkillCondition,O=V?.centerSkills||[],y=V?.centerAbilities||[],u=y.find(r=>r.type==="cooltime_reduce"),n=y.find(r=>r.type==="ap_reduce"),W=5-Number(u?.value.amount||0),m=Number(n?.value.amount||0),E=N.slice();let J=W,q=0,T=_,H=0;const R={_point:0,_lv:0,get point(){return this._point},set point(r){this._point=r,this._lv=Fe(r)},get lv(){return this._lv}},G=[0],a=[0];let l=0,F=0;const t=Ce(b);let k=0,o=0;const Z=new WeakMap,be=60/t;let le,v="";const se=(r,p,I)=>{const oe=R.lv,$e=T*100/_;e:for(const f of p){if(f.condition){const[K,ne,ie]=f.condition;let L=0;switch(K){case"skill_count":L=Z.get(r)||0;break;case"total_skill_count":L=o;break;case"vol_lv":L=oe*(I?2:1);break;case"mental_rate":L=$e;break;default:throw new Error(`条件式が不正です: ${K}`)}if(ie===void 0)throw new Error(`条件式が不正です: ${K}`);switch(ne){case"<=":if(!(L<=ie))continue e;break;case">=":if(!(L>=ie))continue e;break}}switch(f.type){case"vol_buff":a[0]=(a[0]||0)+(f.value||0),i||(v+=`${B[r.name]} vol_buff: +${f.value}
`);break;case"vol_up":{const K=a[0]??0;a[0]=0,R.point+=Math.ceil((f.value||0)*(1+K/100)),i||(v+=`${B[r.name]} vol_up: +${Math.ceil((f.value||0)*(1+K/100))}
`,v+=`now voltagePoint: ${R.point}
`);break}case"vol_down":R.point-=f.value||0,R.point<0&&(R.point=0),i||(v+=`${B[r.name]} vol_down: -${f.value||0}
`);break;case"score_buff":G[0]=(G[0]||0)+(f.value||0),i||(v+=`${B[r.name]} score_buff: +${f.value}
`);break;case"score_up":{const K=G[0]??0;G[0]=0;const ne=(f.value||0)/100*(1+K/100)*_e(d,R.lv,I);H+=Math.ceil(D*ne),i||(v+=`${B[r.name]} score_up: +${Math.ceil(D*ne)}
`);break}case"mental_up":T+=Math.ceil((f.value||0)/100*_),i||(v+=`${B[r.name]} mental_up: +${Math.ceil((f.value||0)/100*_)}
`);break;case"mental_down":T-=Math.ceil((f.value||0)/100*_),i||(v+=`${B[r.name]} mental_down: -${Math.ceil((f.value||0)/100*_)}
`),T<=0&&(T=1);break;case"ap_up":q+=Math.ceil((f.value||0)*ce(k)*1e4),i||(v+=`${B[r.name]} ap_up: +${(f.value||0)*ce(k)}
`);break;case"ap_down":q-=(f.value||0)*1e4,i||(v+=`${B[r.name]} ap_down: -${f.value||0}
`);break;case"reset":l=E.length-1,i||(v+=`${B[r.name]} reset
`);break;case"splice":E.splice(E.indexOf(r),1),l--,i||(v+=`${B[r.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${f.type}`)}}};V&&j==="start"&&se(V,O,!1);const ve=r=>{if(E.length===0)return!1;const p=E[l];if(!p)throw new Error("メンバーが見つかりません");const I=Math.max(p.ap-m,0);return I*1e4<=q&&J<=0?(q-=I*1e4,Z.set(p,(Z.get(p)||0)+1),o++,se(p,p.skills,r),l=E.length-1===l?0:l+1,J+=W,!0):!1};for(let r=0;r<b.length;r++){const p=b[r];if(le=b[r-1],!p)throw new Error("noteが見つかりません");for(J-=p.time-F,F=p.time;ve(le?.fever||!1););J=Math.max(0,J),V&&p.fever&&!le?.fever&&j==="fever_start"&&(i||(v+=`FEVER START
`),se(V,O,!0)),!p.fever&&le?.fever&&(i||(v+=`FEVER END
`));for(let I=0;I<p.normalCount+p.slideCount;I++){if(x==="desperate"&&T*10>_){I<p.normalCount?T-=Math.ceil(_/15):T-=Math.ceil(_*2/75),i||(v+=`miss, apPoint: ${q}, mental: ${T}, vol_lv: ${R.lv*(p.fever?2:1)}
`);continue}k++,q+=Math.ceil(be*ce(k)*1e4),ve(p.fever);const oe=Math.ceil(D/t*30*_e(d,R.lv,p.fever));if(H+=oe,i||(v+=`combo: ${k}, score: ${H} (+${oe}), apPoint: ${q}, mental: ${T}, vol_lv: ${R.lv*(p.fever?2:1)}
`),x==="perfect"&&M&&T<_)return i||(v+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:H,log:v};if(x==="desperate"&&S&&T*10>_)return i||(v+=`メンタルが10%超になったため計算を打ち切ります
`),{score:H,log:v}}}return V&&j==="end"&&se(V,O,!1),{score:H,log:v}},Je={class:"my-2"},qe={class:"input-group mb-3"},Ie={class:"input-group-prepend"},ze={class:"input-group-text"},He={style:{"min-height":"1.5em"}},Ke=["value"],We={class:"card my-2"},Ge={class:"card-body"},Le={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},et={class:"alert alert-info"},tt={class:"card my-2"},lt={class:"card-body"},st={key:0,class:"my-2"},ot={class:"alert alert-info"},nt=ye({__name:"MdCardSelect",props:{onClose:{}},setup(b){const N=$(""),A=u=>`[${u.series}] ${u.key!=="other"?fe[u.key]:u.otherName}`,D=P(()=>pe.filter(u=>A(u).includes(N.value))),_=$(0),d=P(()=>pe[_.value]),x=P(()=>d.value?Ue(d.value,M.value,S.value):null),i=P(()=>x.value?ae(z(x.value).skills):""),M=$(14),S=$(14),V=P(()=>x.value?ae(z(x.value).centerSkills):""),j=P(()=>x.value?me(z(x.value).centerAbilities):""),O=we("skillCache",{}),y=u=>`${u.key}-${u.series}`;return ee(d,()=>{d.value&&(M.value=O.value[y(d.value)]?.skillLevel||14,S.value=O.value[y(d.value)]?.centerSkillLevel||14)}),ee([M,S],()=>{d.value&&(O.value[y(d.value)]={centerSkillLevel:S.value,skillLevel:M.value})}),(u,n)=>{const W=Ve;return h(),ke(ge,{"on-close":u.onClose},{default:Re(()=>[e("div",Je,[e("div",qe,[e("div",Ie,[e("div",ze,[e("div",He,[he(W,{icon:["fas","magnifying-glass"]})])])]),c(e("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>C(N)?N.value=m:null),type:"text",class:"form-control"},null,512),[[g,s(N)]])]),c(e("select",{"onUpdate:modelValue":n[1]||(n[1]=m=>C(_)?_.value=m:null),class:"form-select"},[(h(!0),U(Q,null,X(s(D),(m,E)=>(h(),U("option",{key:`${m.key}-${m.series}`,class:Be(["card",{"bg-primary":s(d)?.key===m.key}]),value:E}," ["+w(m.series)+"] "+w(m.key!=="other"?s(fe)[m.key]:m.otherName),11,Ke))),128))],512),[[ue,s(_)]])]),e("div",We,[n[6]||(n[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Ge,[e("div",null,[n[5]||(n[5]=Y(" スキルレベル： ",-1)),c(e("input",{"onUpdate:modelValue":n[2]||(n[2]=m=>C(M)?M.value=m:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[g,s(M)]])]),s(d)?(h(),U("div",Le,[e("div",Qe,w(s(i)),1)])):te("",!0)])]),e("div",Xe,[n[8]||(n[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ye,[n[7]||(n[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),c(e("input",{"onUpdate:modelValue":n[3]||(n[3]=m=>C(S)?S.value=m:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[g,s(S)]]),s(d)?(h(),U("div",Ze,[e("div",et," 【"+w(s(de)(s(d).centerSkillCondition))+"】"+w(s(V)),1)])):te("",!0)])]),e("div",tt,[n[9]||(n[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",lt,[s(d)?(h(),U("div",st,[e("div",ot,w(s(j)),1)])):te("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:n[4]||(n[4]=m=>u.onClose(s(x)))}," 選択 ")]),_:1},8,["on-close"])}}}),at=Object.assign(nt,{__name:"MdCardSelect"}),it={class:"container-md"},rt={class:"card my-2"},ct={class:"card-body"},dt={class:"card-header"},ut={class:"card-body"},vt={class:"d-flex gap-2"},pt=["onClick"],ft=["onClick"],_t=["onClick"],mt={class:"row my-2 align-items-center justify-content-start"},yt={class:"col-auto"},kt=["onUpdate:modelValue"],ht=["value"],bt={key:0,class:"col-auto"},$t=["onUpdate:modelValue"],Ct={class:"row my-2 align-items-center justify-content-start"},Ut={class:"col-auto"},wt=["onUpdate:modelValue"],Vt={class:"row my-2 align-items-center justify-content-start"},gt={class:"col-auto"},xt=["onUpdate:modelValue"],Mt={class:"row row-gap-1"},St={class:"col-md"},Nt=["onUpdate:modelValue"],Tt={class:"col-md"},At=["onUpdate:modelValue"],jt={class:"col-md"},Et=["onUpdate:modelValue"],Rt={class:"col-md"},Bt={class:"input-group"},Dt=["onUpdate:modelValue"],Ot={class:"my-2"},Ft={class:"row"},Pt={class:"col-sm"},Jt=["onUpdate:modelValue"],qt={class:"col-sm"},It={class:"alert alert-secondary"},zt={class:"my-2"},Ht={class:"row"},Kt={class:"col-sm"},Wt=["onUpdate:modelValue"],Gt=["value"],Lt=["onUpdate:modelValue"],Qt={class:"col-sm"},Xt={class:"alert alert-secondary"},Yt={class:"my-2"},Zt={class:"row"},el={class:"col-sm"},tl=["onUpdate:modelValue"],ll={class:"col-sm"},sl={class:"alert alert-secondary"},ol={class:"row"},nl={class:"col"},al={class:"form-label"},il={class:"col"},rl={class:"form-label"},cl={class:"card my-2"},dl={class:"card-body"},ul={class:"mb-2"},vl={class:"row"},pl={class:"col-auto"},fl={class:"col-auto"},_l={class:"mb-2"},ml=["value","id"],yl=["for"],kl={key:0},hl={class:"my-2"},bl={class:"my-2"},Ul=ye({__name:"index",setup(b){const N=$(""),A=$(""),D=$(0),_=$(0),d=$("smile"),x=$([]),i=$("perfect"),M=$(80820),S=$(2960),V=$(50),j=$(""),O=$(0),y=$(Ee),u=P(()=>y.value.filter(a=>a.key===A.value)),n=$(null),W=P(()=>{if(n.value)return y.value.find(a=>`${a.key}-${a.series}`===n.value)});ee(u,()=>{n.value=u.value[0]?`${u.value[0].key}-${u.value[0].series}`:null});const m=()=>{const a=y.value.map(z),l=je(N.value,D.value),{score:F,log:t}=Pe({notes:l,convertedMembers:a,center:A.value,appealSum:M.value,mentalSum:S.value,masteryLevel:V.value,playStyle:i.value,centerMember:W.value?z(W.value):void 0});O.value=F,j.value=t},E=P(()=>y.value.reduce((a,l)=>a+l.mental,0)),J=P(()=>{const a=y.value.map(z);return xe(a,d.value,A.value)});ee(E,()=>{y.value.every(a=>a.mental)&&(S.value=E.value)}),ee(J,()=>{y.value.every(a=>a.smile&&a.pure&&a.cool)&&(M.value=J.value)}),De({title:"スクショウ計算機"});const{modals:q,openModal:T}=Me(),H=async a=>{const l=await T(at);l&&y.value.splice(y.value.indexOf(a),1,l)},R=a=>{const l=document.createElement("input");l.type="file",l.accept=".json",l.onchange=F=>{const t=F.target.files?.[0];if(t){const k=new FileReader;k.onload=o=>{const Z=JSON.parse(o.target?.result);y.value.splice(y.value.indexOf(a),1,Z)},k.readAsText(t)}},l.click()},G=a=>{const l=JSON.stringify(a,null,2),F=new Blob([l],{type:"application/json"}),t=URL.createObjectURL(F),k=document.createElement("a");k.href=t,k.download=`member_${a.name||"data"}.json`,k.click(),URL.revokeObjectURL(t)};return(a,l)=>{const F=Se;return h(),U("div",it,[l[28]||(l[28]=e("h1",null,"スクショウ計算機",-1)),he(F,{"note-text":s(N),"onUpdate:noteText":l[0]||(l[0]=t=>C(N)?N.value=t:null),center:s(A),"onUpdate:center":l[1]||(l[1]=t=>C(A)?A.value=t:null),offset:s(D),"onUpdate:offset":l[2]||(l[2]=t=>C(D)?D.value=t:null),"combo-offset":s(_),"onUpdate:comboOffset":l[3]||(l[3]=t=>C(_)?_.value=t:null),attribute:s(d),"onUpdate:attribute":l[4]||(l[4]=t=>C(d)?d.value=t:null),"mastery-level":s(V),"onUpdate:masteryLevel":l[5]||(l[5]=t=>C(V)?V.value=t:null),singers:s(x),"onUpdate:singers":l[6]||(l[6]=t=>C(x)?x.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",rt,[l[21]||(l[21]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ct,[(h(!0),U(Q,null,X(s(y),(t,k)=>(h(),U("div",{key:k,class:"card m-3"},[e("div",dt,w(k+1)+"人目 ",1),e("div",ut,[e("div",vt,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>H(t)}," カードを選択して入力 ",8,pt),e("button",{type:"button",class:"btn btn-primary",onClick:o=>R(t)}," メンバーデータの読み込み ",8,ft),e("button",{type:"button",class:"btn btn-primary",onClick:o=>G(t)}," メンバーデータの書き出し ",8,_t)]),e("div",mt,[l[13]||(l[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",yt,[c(e("select",{"onUpdate:modelValue":o=>t.name=o,class:"form-select"},[(h(!0),U(Q,null,X(s(Ne),o=>(h(),U("option",{key:o,value:o},w(s(B)[o]),9,ht))),128))],8,kt),[[ue,t.name]])]),t.name==="other"?(h(),U("div",bt,[c(e("input",{"onUpdate:modelValue":o=>t.otherName=o,class:"form-control"},null,8,$t),[[g,t.otherName]])])):te("",!0)]),e("div",Ct,[l[14]||(l[14]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," シリーズ： ")],-1)),e("div",Ut,[c(e("input",{"onUpdate:modelValue":o=>t.series=o,class:"form-control"},null,8,wt),[[g,t.series]])])]),e("div",Vt,[l[15]||(l[15]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",gt,[c(e("input",{"onUpdate:modelValue":o=>t.ap=o,type:"number",class:"form-control"},null,8,xt),[[g,t.ap,void 0,{number:!0}]])])]),l[20]||(l[20]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",Mt,[e("div",St,[c(e("input",{"onUpdate:modelValue":o=>t.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,Nt),[[g,t.smile,void 0,{number:!0}]])]),e("div",Tt,[c(e("input",{"onUpdate:modelValue":o=>t.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,At),[[g,t.pure,void 0,{number:!0}]])]),e("div",jt,[c(e("input",{"onUpdate:modelValue":o=>t.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,Et),[[g,t.cool,void 0,{number:!0}]])]),e("div",Rt,[e("div",Bt,[l[16]||(l[16]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),c(e("input",{"onUpdate:modelValue":o=>t.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Dt),[[g,t.mental,void 0,{number:!0}]])])])]),e("div",Ot,[l[17]||(l[17]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Ft,[e("div",Pt,[c(e("textarea",{"onUpdate:modelValue":o=>t.skill=o,class:"form-control"},null,8,Jt),[[g,t.skill]])]),e("div",qt,[e("div",It,w(s(ae)(s(z)(t).skills)),1)])])]),e("div",zt,[l[18]||(l[18]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Ht,[e("div",Kt,[c(e("select",{"onUpdate:modelValue":o=>t.centerSkillCondition=o,class:"form-select"},[(h(!0),U(Q,null,X(s(Te),o=>(h(),U("option",{key:o,value:o},w(s(de)(o)),9,Gt))),128))],8,Wt),[[ue,t.centerSkillCondition]]),c(e("textarea",{"onUpdate:modelValue":o=>t.centerSkill=o,class:"form-control"},null,8,Lt),[[g,t.centerSkill]])]),e("div",Qt,[e("div",Xt," 【"+w(s(de)(t.centerSkillCondition))+"】"+w(s(ae)(s(z)(t).centerSkills)),1)])])]),e("div",Yt,[l[19]||(l[19]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Zt,[e("div",el,[c(e("textarea",{"onUpdate:modelValue":o=>t.centerAbilityText=o,class:"form-control"},null,8,tl),[[g,t.centerAbilityText]])]),e("div",ll,[e("div",sl,w(s(me)(s(z)(t).centerAbilities)),1)])])])])]))),128)),e("div",ol,[e("div",nl,[e("label",al,"総合アピール値（"+w(s(J))+"）：",1),c(e("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>C(M)?M.value=t:null),type:"number",class:"form-control"},null,512),[[g,s(M),void 0,{number:!0}]])]),e("div",il,[e("label",rl,"総合メンタル値（"+w(s(E))+"）：",1),c(e("input",{"onUpdate:modelValue":l[8]||(l[8]=t=>C(S)?S.value=t:null),type:"number",class:"form-control"},null,512),[[g,s(S),void 0,{number:!0}]])])])])]),e("div",cl,[l[27]||(l[27]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",dl,[e("div",ul,[l[24]||(l[24]=Y(" プレイスタイル： ",-1)),e("div",vl,[e("div",pl,[e("label",null,[c(e("input",{"onUpdate:modelValue":l[9]||(l[9]=t=>C(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[re,s(i)]]),l[22]||(l[22]=Y(" 渾身 ",-1))])]),e("div",fl,[e("label",null,[c(e("input",{"onUpdate:modelValue":l[10]||(l[10]=t=>C(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[re,s(i)]]),l[23]||(l[23]=Y(" 背水 ",-1))])])])]),e("div",_l,[l[25]||(l[25]=Y(" センター： ",-1)),(h(!0),U(Q,null,X(s(u),t=>(h(),U("div",{key:`${t.key}-${t.series}`},[c(e("input",{type:"radio",class:"form-check-input",value:`${t.key}-${t.series}`,"onUpdate:modelValue":l[11]||(l[11]=k=>C(n)?n.value=k:null),id:`${t.key}-${t.series}-center`},null,8,ml),[[re,s(n)]]),e("label",{for:`${t.key}-${t.series}-center`,class:"form-check-label"},w(s(Ae)(t)),9,yl)]))),128)),s(u).length===0?(h(),U("div",kl," （センターなし） ")):te("",!0)]),e("button",{type:"button",class:"btn btn-primary",onClick:m}," 計算 "),e("div",hl," 計算結果: "+w(s(O)),1),e("div",bl,[l[26]||(l[26]=Y(" ログ： ",-1)),c(e("textarea",{"onUpdate:modelValue":l[12]||(l[12]=t=>C(j)?j.value=t:null),rows:"6",class:"form-control"},null,512),[[g,s(j)]])])])]),(h(!0),U(Q,null,X(s(q),(t,k)=>(h(),ke(Oe(t.component),{key:`modal-${k}`,"on-close":t.onClose},null,40,["on-close"]))),128))])}}});export{Ul as default};
