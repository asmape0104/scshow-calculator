import{f as ke,r as h,g as z,h as se,i as be,o as v,w as he,a as e,j as d,b as ie,k as C,v as x,l as s,c as k,F as Q,m as Y,n as Ue,t as $,p as ve,q as le,d as X,u as Ve,e as xe,s as ue,x as ge}from"./8KF8KUO6.js";import{c as Me,m as D,a as _e,b as Se,s as re,d as W,e as $e,u as Ne,_ as Ce,f as me,g as pe,h as Te,i as Ae,j as Ee,k as Re,l as je,n as Be,o as De,p as Oe,q as Fe}from"./xvRBOQwQ.js";const Pe=b=>b<=2100?Math.floor((-5+Math.sqrt(25+20*b))/10):Math.floor(20+(b-2100)/200),ye=(b,N,A)=>(1+b/100)*(1+N*(A?2:1)/10),de=b=>b<10?1:b<20?1.1:b<30?1.2:b<40?1.3:b<50?1.4:1.5,Je=({notes:b,convertedMembers:N,center:A,appealSum:J,mentalSum:y,masteryLevel:p,playStyle:g="perfect",noLog:i=!1,noDamagedFormation:M=!1,noCuredFormation:S=!1,centerMember:w=N.find(E=>E.name===A)})=>{const E=w?.centerSkillCondition,q=w?.centerSkills||[],c=w?.centerAbilities||[],U=c.find(r=>r.type==="cooltime_reduce"),a=c.find(r=>r.type==="ap_reduce"),O=5-Number(U?.value.amount||0),f=Number(a?.value.amount||0),I=N.slice();let H=O,F=0,T=y,G=0;const R={_point:0,_lv:0,get point(){return this._point},set point(r){this._point=r,this._lv=Pe(r)},get lv(){return this._lv}},Z=[0],ee=[0];let n=0,t=0;const j=Me(b);let V=0,P=0;const l=new WeakMap,B=60/j;let o,u="";const oe=(r,_,K)=>{const ne=R.lv,we=T*100/y;e:for(const m of _){if(m.condition){const[L,ae,ce]=m.condition;let te=0;switch(L){case"skill_count":te=l.get(r)||0;break;case"total_skill_count":te=P;break;case"vol_lv":te=ne*(K?2:1);break;case"mental_rate":te=we;break;default:throw new Error(`条件式が不正です: ${L}`)}if(ce===void 0)throw new Error(`条件式が不正です: ${L}`);switch(ae){case"<=":if(!(te<=ce))continue e;break;case">=":if(!(te>=ce))continue e;break}}switch(m.type){case"vol_buff":ee[0]=(ee[0]||0)+(m.value||0),i||(u+=`${D[r.name]} vol_buff: +${m.value}
`);break;case"vol_up":{const L=ee[0]??0;ee[0]=0,R.point+=Math.ceil((m.value||0)*(1+L/100)),i||(u+=`${D[r.name]} vol_up: +${Math.ceil((m.value||0)*(1+L/100))}
`,u+=`now voltagePoint: ${R.point}
`);break}case"vol_down":R.point-=m.value||0,R.point<0&&(R.point=0),i||(u+=`${D[r.name]} vol_down: -${m.value||0}
`);break;case"score_buff":Z[0]=(Z[0]||0)+(m.value||0),i||(u+=`${D[r.name]} score_buff: +${m.value}
`);break;case"score_up":{const L=Z[0]??0;Z[0]=0;const ae=(m.value||0)/100*(1+L/100)*ye(p,R.lv,K);G+=Math.ceil(J*ae),i||(u+=`${D[r.name]} score_up: +${Math.ceil(J*ae)}
`);break}case"mental_up":T+=Math.ceil((m.value||0)/100*y),i||(u+=`${D[r.name]} mental_up: +${Math.ceil((m.value||0)/100*y)}
`);break;case"mental_down":T-=Math.ceil((m.value||0)/100*y),i||(u+=`${D[r.name]} mental_down: -${Math.ceil((m.value||0)/100*y)}
`),T<=0&&(T=1);break;case"ap_up":F+=Math.ceil((m.value||0)*de(V)*1e4),i||(u+=`${D[r.name]} ap_up: +${(m.value||0)*de(V)}
`);break;case"ap_down":F-=(m.value||0)*1e4,i||(u+=`${D[r.name]} ap_down: -${m.value||0}
`);break;case"reset":n=I.length-1,i||(u+=`${D[r.name]} reset
`);break;case"splice":I.splice(I.indexOf(r),1),n--,i||(u+=`${D[r.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${m.type}`)}}};w&&E==="start"&&oe(w,q,!1);const fe=r=>{if(I.length===0)return!1;const _=I[n];if(!_)throw new Error("メンバーが見つかりません");const K=Math.max(_.ap-f,0);return K*1e4<=F&&H<=0?(F-=K*1e4,l.set(_,(l.get(_)||0)+1),P++,oe(_,_.skills,r),n=I.length-1===n?0:n+1,H+=O,!0):!1};for(let r=0;r<b.length;r++){const _=b[r];if(o=b[r-1],!_)throw new Error("noteが見つかりません");for(H-=_.time-t,t=_.time;fe(o?.fever||!1););H=Math.max(0,H),w&&_.fever&&!o?.fever&&E==="fever_start"&&(i||(u+=`FEVER START
`),oe(w,q,!0)),!_.fever&&o?.fever&&(i||(u+=`FEVER END
`));for(let K=0;K<_.normalCount+_.slideCount;K++){if(g==="desperate"&&T*10>y){K<_.normalCount?T-=Math.ceil(y/15):T-=Math.ceil(y*2/75),i||(u+=`miss, apPoint: ${F}, mental: ${T}, vol_lv: ${R.lv*(_.fever?2:1)}
`),V=0;continue}V++,F+=Math.ceil(B*de(V)*1e4),fe(_.fever);const ne=Math.ceil(J/j*30*ye(p,R.lv,_.fever));if(G+=ne,i||(u+=`combo: ${V}, score: ${G} (+${ne}), apPoint: ${F}, mental: ${T}, vol_lv: ${R.lv*(_.fever?2:1)}
`),g==="perfect"&&M&&T<y)return i||(u+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:G,log:u};if(g==="desperate"&&S&&T*10>y)return i||(u+=`メンタルが10%超になったため計算を打ち切ります
`),{score:G,log:u}}}return w&&E==="end"&&oe(w,q,!1),{score:G,log:u}},qe={class:"my-2"},Ie={class:"input-group mb-3"},ze={class:"input-group-prepend"},He={class:"input-group-text"},Ke={style:{"min-height":"1.5em"}},We=["value"],Ge={class:"card my-2"},Le={class:"card-body"},Qe={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye={class:"card my-2"},Ze={class:"card-body"},et={key:0,class:"my-2"},tt={class:"alert alert-info"},lt={class:"card my-2"},st={class:"card-body"},ot={key:0,class:"my-2"},nt={class:"alert alert-info"},at=ke({__name:"MdCardSelect",props:{onClose:{}},setup(b){const N=h(""),A=U=>`[${U.series}] ${U.key!=="other"?me[U.key]:U.otherName}`,J=z(()=>_e.filter(U=>A(U).includes(N.value))),y=h(0),p=z(()=>_e[y.value]),g=z(()=>p.value?Se(p.value,M.value,S.value):null),i=z(()=>g.value?re(W(g.value).skills):""),M=h(14),S=h(14),w=z(()=>g.value?re(W(g.value).centerSkills):""),E=z(()=>g.value?$e(W(g.value).centerAbilities):""),q=Ne("skillCache",{}),c=U=>`${U.key}-${U.series}`;return se(p,()=>{p.value&&(M.value=q.value[c(p.value)]?.skillLevel||14,S.value=q.value[c(p.value)]?.centerSkillLevel||14)}),se([M,S],()=>{p.value&&(q.value[c(p.value)]={centerSkillLevel:S.value,skillLevel:M.value})}),(U,a)=>{const O=Ce;return v(),be(Te,{"on-close":U.onClose},{default:he(()=>[e("div",qe,[e("div",Ie,[e("div",ze,[e("div",He,[e("div",Ke,[ie(O,{icon:["fas","magnifying-glass"]})])])]),d(e("input",{"onUpdate:modelValue":a[0]||(a[0]=f=>C(N)?N.value=f:null),type:"text",class:"form-control"},null,512),[[x,s(N)]])]),d(e("select",{"onUpdate:modelValue":a[1]||(a[1]=f=>C(y)?y.value=f:null),class:"form-select"},[(v(!0),k(Q,null,Y(s(J),(f,I)=>(v(),k("option",{key:`${f.key}-${f.series}`,class:Ue(["card",{"bg-primary":s(p)?.key===f.key}]),value:I}," ["+$(f.series)+"] "+$(f.key!=="other"?s(me)[f.key]:f.otherName),11,We))),128))],512),[[ve,s(y)]])]),e("div",Ge,[a[6]||(a[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Le,[e("div",null,[a[5]||(a[5]=X(" スキルレベル： ",-1)),d(e("input",{"onUpdate:modelValue":a[2]||(a[2]=f=>C(M)?M.value=f:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(M)]])]),s(p)?(v(),k("div",Qe,[e("div",Xe,$(s(i)),1)])):le("",!0)])]),e("div",Ye,[a[8]||(a[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ze,[a[7]||(a[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),d(e("input",{"onUpdate:modelValue":a[3]||(a[3]=f=>C(S)?S.value=f:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(S)]]),s(p)?(v(),k("div",et,[e("div",tt," 【"+$(s(pe)(s(p).centerSkillCondition))+"】"+$(s(w)),1)])):le("",!0)])]),e("div",lt,[a[9]||(a[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",st,[s(p)?(v(),k("div",ot,[e("div",nt,$(s(E)),1)])):le("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=f=>U.onClose(s(g)))}," 選択 ")]),_:1},8,["on-close"])}}}),it=Object.assign(at,{__name:"MdCardSelect"}),rt={class:"container-md"},ct={class:"card my-2"},ut={class:"card-body"},dt={class:"card-header"},vt={class:"card-body"},pt={class:"d-flex gap-2 flex-wrap"},ft=["onClick"],_t=["onClick"],mt=["onClick"],yt=["onClick"],kt={class:"row my-2 align-items-center justify-content-start"},bt={class:"col-auto"},ht=["onUpdate:modelValue"],$t=["value"],Ct={key:0,class:"col-auto"},wt=["onUpdate:modelValue"],Ut={class:"row my-2 align-items-center justify-content-start"},Vt={class:"col-auto"},xt=["onUpdate:modelValue"],gt={class:"row my-2 align-items-center justify-content-start"},Mt={class:"col-auto"},St=["onUpdate:modelValue"],Nt={class:"row row-gap-1"},Tt={class:"col-md"},At=["onUpdate:modelValue"],Et={class:"col-md"},Rt=["onUpdate:modelValue"],jt={class:"col-md"},Bt=["onUpdate:modelValue"],Dt={class:"col-md"},Ot={class:"input-group"},Ft=["onUpdate:modelValue"],Pt={class:"my-2"},Jt={class:"row"},qt={class:"col-sm"},It=["onUpdate:modelValue"],zt={class:"col-sm"},Ht={class:"alert alert-secondary"},Kt={class:"my-2"},Wt={class:"row"},Gt={class:"col-sm"},Lt=["onUpdate:modelValue"],Qt=["value"],Xt=["onUpdate:modelValue"],Yt={class:"col-sm"},Zt={class:"alert alert-secondary"},el={class:"my-2"},tl={class:"row"},ll={class:"col-sm"},sl=["onUpdate:modelValue"],ol={class:"col-sm"},nl={class:"alert alert-secondary"},al={class:"row"},il={class:"col"},rl={class:"form-label"},cl={class:"col"},ul={class:"form-label"},dl={class:"card my-2"},vl={class:"card-body"},pl={class:"mb-2"},fl={class:"row"},_l={class:"col-auto"},ml={class:"col-auto"},yl={class:"mb-2"},kl=["value","id"],bl=["for"],hl={key:0},$l={class:"my-2"},Cl={class:"my-2"},Vl=ke({__name:"index",setup(b){const N=h(""),A=h(""),J=h(0),y=h(0),p=h("smile"),g=h([]),i=h("perfect"),M=h(80820),S=h(2960),w=h(50),E=h(""),q=h(0),c=h(Fe),U=(n,t)=>{const j=c.value[n];c.value[n]=c.value[t],c.value[t]=j},a=z(()=>c.value.filter(n=>n.key===A.value)),O=h(null),f=z(()=>{if(O.value)return c.value.find(n=>`${n.key}-${n.series}`===O.value)});se(a,()=>{O.value=a.value[0]?`${a.value[0].key}-${a.value[0].series}`:null});const I=()=>{const n=c.value.map(W),t=Oe(N.value,J.value),{score:j,log:V}=Je({notes:t,convertedMembers:n,center:A.value,appealSum:M.value,mentalSum:S.value,masteryLevel:w.value,playStyle:i.value,centerMember:f.value?W(f.value):void 0});q.value=j,E.value=V},H=z(()=>c.value.reduce((n,t)=>n+t.mental,0)),F=z(()=>{const n=c.value.map(W);return Ae(n,p.value,A.value)});se(H,()=>{c.value.every(n=>n.mental)&&(S.value=H.value)}),se(F,()=>{c.value.every(n=>n.smile&&n.pure&&n.cool)&&(M.value=F.value)}),Ve({title:"スクショウ計算機"});const{modals:T,openModal:G}=Ee(),R=async n=>{const t=await G(it);t&&c.value.splice(c.value.indexOf(n),1,t)},Z=n=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=j=>{const V=j.target.files?.[0];if(V){const P=new FileReader;P.onload=l=>{const B=JSON.parse(l.target?.result);c.value.splice(c.value.indexOf(n),1,B)},P.readAsText(V)}},t.click()},ee=n=>{const t=JSON.stringify(n,null,2),j=new Blob([t],{type:"application/json"}),V=URL.createObjectURL(j),P=document.createElement("a");P.href=V,P.download=`member_${n.name||"data"}.json`,P.click(),URL.revokeObjectURL(V)};return(n,t)=>{const j=xe,V=Re,P=Ce;return v(),k("div",rt,[t[29]||(t[29]=e("h1",null,"スクショウ計算機",-1)),ie(j,{to:"/auto-formation"},{default:he(()=>t[13]||(t[13]=[X("自動編成＞",-1)])),_:1,__:[13]}),ie(V,{"note-text":s(N),"onUpdate:noteText":t[0]||(t[0]=l=>C(N)?N.value=l:null),center:s(A),"onUpdate:center":t[1]||(t[1]=l=>C(A)?A.value=l:null),offset:s(J),"onUpdate:offset":t[2]||(t[2]=l=>C(J)?J.value=l:null),"combo-offset":s(y),"onUpdate:comboOffset":t[3]||(t[3]=l=>C(y)?y.value=l:null),attribute:s(p),"onUpdate:attribute":t[4]||(t[4]=l=>C(p)?p.value=l:null),"mastery-level":s(w),"onUpdate:masteryLevel":t[5]||(t[5]=l=>C(w)?w.value=l:null),singers:s(g),"onUpdate:singers":t[6]||(t[6]=l=>C(g)?g.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",ct,[t[22]||(t[22]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ut,[(v(!0),k(Q,null,Y(s(c),(l,B)=>(v(),k("div",{key:B,class:"card m-3"},[e("div",dt,$(B+1)+"人目 ",1),e("div",vt,[e("div",pt,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>R(l)}," カードを選択して入力 ",8,ft),e("button",{type:"button",class:"btn btn-primary",onClick:o=>Z(l)}," メンバーデータの読み込み ",8,_t),e("button",{type:"button",class:"btn btn-primary",onClick:o=>ee(l)}," メンバーデータの書き出し ",8,mt),(v(),k(Q,null,Y(6,o=>(v(),k(Q,{key:`swap-${o}`},[o-1!==B?(v(),k("button",{key:0,type:"button",class:"btn btn-success",onClick:u=>U(B,o-1)},[ie(P,{icon:["fas","arrow-right-arrow-left"]}),X(" "+$(o),1)],8,yt)):le("",!0)],64))),64))]),e("div",kt,[t[14]||(t[14]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",bt,[d(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(v(!0),k(Q,null,Y(s(je),o=>(v(),k("option",{key:o,value:o},$(s(D)[o]),9,$t))),128))],8,ht),[[ve,l.name]])]),l.name==="other"?(v(),k("div",Ct,[d(e("input",{"onUpdate:modelValue":o=>l.otherName=o,class:"form-control"},null,8,wt),[[x,l.otherName]])])):le("",!0)]),e("div",Ut,[t[15]||(t[15]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," シリーズ： ")],-1)),e("div",Vt,[d(e("input",{"onUpdate:modelValue":o=>l.series=o,class:"form-control"},null,8,xt),[[x,l.series]])])]),e("div",gt,[t[16]||(t[16]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",Mt,[d(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,St),[[x,l.ap,void 0,{number:!0}]])])]),t[21]||(t[21]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",Nt,[e("div",Tt,[d(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,At),[[x,l.smile,void 0,{number:!0}]])]),e("div",Et,[d(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Rt),[[x,l.pure,void 0,{number:!0}]])]),e("div",jt,[d(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,Bt),[[x,l.cool,void 0,{number:!0}]])]),e("div",Dt,[e("div",Ot,[t[17]||(t[17]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),d(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Ft),[[x,l.mental,void 0,{number:!0}]])])])]),e("div",Pt,[t[18]||(t[18]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Jt,[e("div",qt,[d(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,It),[[x,l.skill]])]),e("div",zt,[e("div",Ht,$(s(re)(s(W)(l).skills)),1)])])]),e("div",Kt,[t[19]||(t[19]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Wt,[e("div",Gt,[d(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(v(!0),k(Q,null,Y(s(Be),o=>(v(),k("option",{key:o,value:o},$(s(pe)(o)),9,Qt))),128))],8,Lt),[[ve,l.centerSkillCondition]]),d(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Xt),[[x,l.centerSkill]])]),e("div",Yt,[e("div",Zt," 【"+$(s(pe)(l.centerSkillCondition))+"】"+$(s(re)(s(W)(l).centerSkills)),1)])])]),e("div",el,[t[20]||(t[20]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",tl,[e("div",ll,[d(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,sl),[[x,l.centerAbilityText]])]),e("div",ol,[e("div",nl,$(s($e)(s(W)(l).centerAbilities)),1)])])])])]))),128)),e("div",al,[e("div",il,[e("label",rl,"総合アピール値（"+$(s(F))+"）：",1),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>C(M)?M.value=l:null),type:"number",class:"form-control"},null,512),[[x,s(M),void 0,{number:!0}]])]),e("div",cl,[e("label",ul,"総合メンタル値（"+$(s(H))+"）：",1),d(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>C(S)?S.value=l:null),type:"number",class:"form-control"},null,512),[[x,s(S),void 0,{number:!0}]])])])])]),e("div",dl,[t[28]||(t[28]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",vl,[e("div",pl,[t[25]||(t[25]=X(" プレイスタイル： ",-1)),e("div",fl,[e("div",_l,[e("label",null,[d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>C(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[ue,s(i)]]),t[23]||(t[23]=X(" 渾身 ",-1))])]),e("div",ml,[e("label",null,[d(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>C(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[ue,s(i)]]),t[24]||(t[24]=X(" 背水 ",-1))])])])]),e("div",yl,[t[26]||(t[26]=X(" センター： ",-1)),(v(!0),k(Q,null,Y(s(a),l=>(v(),k("div",{key:`${l.key}-${l.series}`},[d(e("input",{type:"radio",class:"form-check-input",value:`${l.key}-${l.series}`,"onUpdate:modelValue":t[11]||(t[11]=B=>C(O)?O.value=B:null),id:`${l.key}-${l.series}-center`},null,8,kl),[[ue,s(O)]]),e("label",{for:`${l.key}-${l.series}-center`,class:"form-check-label"},$(s(De)(l)),9,bl)]))),128)),s(a).length===0?(v(),k("div",hl," （センターなし） ")):le("",!0)]),e("button",{type:"button",class:"btn btn-primary",onClick:I}," 計算 "),e("div",$l," 計算結果: "+$(s(q)),1),e("div",Cl,[t[27]||(t[27]=X(" ログ： ",-1)),d(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=l=>C(E)?E.value=l:null),rows:"6",class:"form-control"},null,512),[[x,s(E)]])])])]),(v(!0),k(Q,null,Y(s(T),(l,B)=>(v(),be(ge(l.component),{key:`modal-${B}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{Vl as default};
