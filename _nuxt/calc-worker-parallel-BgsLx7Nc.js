(function(){"use strict";const dt=t=>t.reduce((e,a)=>e+a.normalCount+a.slideCount,0),mt=[...["kaho","sayaka","kozue","tsuzuri","rurino","megumi","ginko","kosuzu","hime","ceras","izumi"],"other"],S={kaho:"花帆",sayaka:"さやか",kozue:"梢",tsuzuri:"綴理",rurino:"瑠璃乃",megumi:"慈",ginko:"吟子",kosuzu:"小鈴",hime:"姫芽",ceras:"セラス",izumi:"泉",other:"その他"},ut={all:mt,g102:["kozue","tsuzuri","megumi"],g103:["kaho","sayaka","rurino"],g104:["ginko","kosuzu","hime"],g105:["ceras"],cerise:["kaho","kozue","ginko"],dollche:["sayaka","tsuzuri","kosuzu"],miracra:["rurino","megumi","hime"],edel:["ceras","izumi"],kaho_pivot:["kaho","kozue","ginko","sayaka","rurino"],sayaka_pivot:["sayaka","tsuzuri","kosuzu","kaho","rurino"],rurino_pivot:["rurino","megumi","hime","sayaka","kaho"]},nt=(t,e)=>e in ut?ut[e]?.includes(t):t===e,vt=t=>t<=2100?Math.floor((-5+Math.sqrt(25+20*t))/10):Math.floor(20+(t-2100)/200),it=(t,e,a)=>(1+t/100)*(1+e*(a?2:1)/10),at=t=>t<10?1:t<20?1.1:t<30?1.2:t<40?1.3:t<50?1.4:1.5,kt=({notes:t,convertedMembers:e,center:a,appealSum:r,mentalSum:o,masteryLevel:n,playStyle:c="perfect",noLog:l=!1,noDamagedFormation:v=!1,noCuredFormation:g=!1,centerMember:p=e.find(k=>k.name===a)})=>{const k=p?.centerSkillCondition,M=p?.centerSkills||[],A=p?.centerAbilities||[],$=A.filter(u=>u.type==="cooltime_reduce"||u.type==="cooltime_escalate"),i=A.filter(u=>u.type==="ap_reduce"||u.type==="ap_escalate"),_=A.find(u=>u.type==="ap_bonus_up"),f=A.find(u=>u.type==="voltage_bonus_up"),w=A.find(u=>u.type==="mental_max_change"),E=_?.value.amount||0,J=f?.value.amount||0,x=w?.value?w.value.amount*e.filter(u=>w?.value.target&&nt(u.name,w.value.target)).length:o,Y=5+$.reduce((u,s)=>u+(s.type==="cooltime_reduce"?-s.value.amount:s.value.amount),0),Q=i.reduce((u,s)=>u+(s.type==="ap_reduce"?s.value.amount:-s.value.amount),0),R=e.slice();let F=Y,P=0,C=x,O=0;const z={_point:0,_lv:0,get point(){return this._point},set point(u){this._point=u,this._lv=vt(u)},get lv(){return this._lv}},V=[0],D=[0];let h=0,b=0;const y=dt(t);let T=0,j=0;const K=new WeakMap,Rt=60/y;let Z,d="";const L=(u,s,I)=>{const tt=z.lv,Ot=C*100/x;t:for(const m of s){if(m.condition){const[N,et,ot]=m.condition;let H=0;switch(N){case"skill_count":H=K.get(u)||0;break;case"total_skill_count":H=j;break;case"vol_lv":H=tt*(I?2:1);break;case"mental_rate":H=Ot;break;default:throw new Error(`条件式が不正です: ${N}`)}if(ot===void 0)throw new Error(`条件式が不正です: ${N}`);switch(et){case"<=":if(!(H<=ot))continue t;break;case">=":if(!(H>=ot))continue t;break}}switch(m.type){case"vol_buff":D[0]=(D[0]||0)+(m.value||0),l||(d+=`${S[u.name]} vol_buff: +${m.value}
`);break;case"vol_up":{const N=(D[0]??0)+J;D[0]=0,z.point+=Math.ceil((m.value||0)*(1+N/100)),l||(d+=`${S[u.name]} vol_up: +${Math.ceil((m.value||0)*(1+N/100))}
`,d+=`now voltagePoint: ${z.point}
`);break}case"vol_down":{z.point-=m.value||0,z.point<0&&(z.point=0),l||(d+=`${S[u.name]} vol_down: -${m.value||0}
`);break}case"score_buff":V[0]=(V[0]||0)+(m.value||0),l||(d+=`${S[u.name]} score_buff: +${m.value}
`);break;case"score_up":{const N=V[0]??0;V[0]=0;const et=(m.value||0)/100*(1+N/100)*it(n,z.lv,I);O+=Math.ceil(r*et),l||(d+=`${S[u.name]} score_up: +${Math.ceil(r*et)}
`);break}case"mental_up":C+=Math.ceil((m.value||0)/100*x),l||(d+=`${S[u.name]} mental_up: +${Math.ceil((m.value||0)/100*x)}
`);break;case"mental_down":C-=Math.ceil((m.value||0)/100*x),l||(d+=`${S[u.name]} mental_down: -${Math.ceil((m.value||0)/100*x)}
`),C<=0&&(C=1);break;case"ap_up":P+=Math.ceil((m.value||0)*at(T)*(100+E)*100),l||(d+=`${S[u.name]} ap_up: +${(m.value||0)*at(T)*1+E/100}
`);break;case"ap_down":P-=(m.value||0)*1e4,l||(d+=`${S[u.name]} ap_down: -${m.value||0}
`);break;case"ap_change":P=(m.value||0)*1e4,l||(d+=`${S[u.name]} ap_change: ${m.value||0}
`);break;case"reset":h=R.length-1,l||(d+=`${S[u.name]} reset
`);break;case"splice":R.splice(R.indexOf(u),1),h--,l||(d+=`${S[u.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${m.type}`)}}};p&&k==="start"&&L(p,M,!1);const ft=u=>{if(R.length===0)return!1;const s=R[h];if(!s)throw new Error("メンバーが見つかりません");const I=Math.max(s.ap-Q,0);return I*1e4<=P&&F<=0?(P-=I*1e4,K.set(s,(K.get(s)||0)+1),j++,L(s,s.skills,u),h=R.length-1===h?0:h+1,F+=Y,!0):!1};for(let u=0;u<t.length;u++){const s=t[u];if(Z=t[u-1],!s)throw new Error("noteが見つかりません");for(F-=s.time-b,b=s.time;ft(Z?.fever||!1););F=Math.max(0,F),p&&s.fever&&!Z?.fever&&k==="fever_start"&&(l||(d+=`FEVER START
`),L(p,M,!0)),!s.fever&&Z?.fever&&(l||(d+=`FEVER END
`));for(let I=0;I<s.normalCount+s.slideCount;I++){if(c==="desperate"&&C*10>x){if(I<s.normalCount?C-=50+Math.floor(x/20):C-=Math.floor((50+x/20)*.4),l||(d+=`miss, apPoint: ${P}, mental: ${C}, vol_lv: ${z.lv*(s.fever?2:1)}
`),T=0,C<=0)return l||(d+=`MENTAL BREAK
`),{score:O,log:d};continue}T++,P+=Math.ceil(Rt*at(T)*1e4),ft(s.fever);const tt=Math.ceil(r/y*30*it(n,z.lv,s.fever));if(O+=tt,l||(d+=`combo: ${T}, score: ${O} (+${tt}), apPoint: ${P}, mental: ${C}, vol_lv: ${z.lv*(s.fever?2:1)}
`),c==="perfect"&&v&&C<x)return l||(d+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:O,log:d};if(c==="desperate"&&g&&C*10>x)return l||(d+=`メンタルが10%超になったため計算を打ち切ります
`),{score:O,log:d}}}return p&&k==="end"&&L(p,M,!1),{score:O,log:d}};var ht=`key	series	other_name	smile	pure	cool	mental	rarity	center_skill_condition	raw_center_skill_text	raw_skill_text	ap	center_ability_text
other	蓮ノ空女学院スクールアイドルクラブ102期生	大賀美沙知	5880	5700	5700	480	ur			ap_up(10);skill_count>=3 ^ splice()	0	
rurino	悠久の舞踏会		4320	7800	5160	480	ur	fever_start	ap_up(8);vol_lv >= 4 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(326.25);vol_lv >= 7 ^ score_buff(435);mental_down(10*)	10	appeal_up(g103, 200);ap_reduce(all, 2)
rurino	アイドゥーミー！		6960	6360	5880	520	ur	fever_start	ap_up(20); mental_rate <= 99 ^ vol_down(1000*)	mental_up(10*); mental_rate >= 100 ^ ap_up(15); mental_rate <= 99 ^ vol_down(1000*); skill_count >= 3 ^ splice()	5	appeal_up(miracra, 200)
megumi	久遠の銀河へ		7200	4920	4800	510	ur	fever_start	score_up(204.75); skill_count >= 6 ^ score_up(286.65)	total_skill_count <= 9 ^ ap_up(15*); total_skill_count >= 10 ^ score_up(522)	10	appeal_up(g102, 200);ap_reduce(all, 2)
kaho	アイドゥーミー！		6000	6240	6960	520	ur	end	score_up(418.5)	mental_up(10*); mental_rate >= 100 ^ score_up(1134); mental_rate <= 99 ^ vol_down(1000*)	12	appeal_up(all, 72)
sayaka	アイドゥーミー！		6120	6960	6120	520	ur	fever_start	score_up(877.5); mental_rate <= 99 ^ vol_down(1000*)	skill_count <= 1 ^ vol_buff(78.75); skill_count >= 2 ^ score_buff(243); mental_rate >= 100 ^ vol_up(945); mental_rate <= 99 ^ vol_down(1000*)	14	appeal_up(dollche, 200)
kozue	輪廻の銀河へ		5160	4680	7440	480	ur	fever_start	ap_up(8); skill_count >= 6 ^ ap_up(8)	skill_count <= 3 ^ vol_buff(324); skill_count <= 3 ^ reset(); skill_count >= 4 ^ score_buff(324)	10	appeal_up(g102, 200);ap_reduce(all, 2)
ceras	16th Birthday		5760	5760	5760	480	br	start	ap_up(10)	ap_up(5); vol_buff(54.45); reset(); skill_count >= 3 ^ splice()	0	appeal_up(ceras, 400)
tsuzuri	幸せのリボン		5760	5160	8520	500	lr	fever_start	vol_up(478)	vol_up(731); total_skill_count >= 10 ^ vol_up(1170); lr_tsuzuri(); splice()	20	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)
sayaka	真実の舞踏会		5160	4080	7920	490	ur	fever_start	vol_up(170); mental_rate >= 50 ^ vol_up(238)	vol_lv <= 8 ^ vol_up(326); vol_lv >= 7 ^ score_buff(558); vol_lv >= 7 ^ vol_down(50*)	10	appeal_up(g103, 200); ap_reduce(all, 2)
kaho	軌跡の舞踏会		7680	5760	3960	470	ur	end	score_up(204.75); vol_lv >= 4 ^ score_up(286.65)	vol_lv <= 8 ^ score_buff(243); vol_lv >= 7 ^ score_up(522)	10	appeal_up(g103, 200); ap_reduce(all, 2)
megumi	18th Birthday*		5760	5760	5760	480	br	fever_start	score_up(368.28); total_skill_count >= 6 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); skill_count <= 4 ^ ap_up(5*); skill_count <= 2 ^ ap_up(5*)	10	appeal_up(megumi, 400)
hime	BLAST!!		3720	7080	6240	500	ur	fever_start	mental_down(40*); score_up(326.25)	mental_rate >= 30 ^ mental_down(20*); mental_rate >= 30 ^ ap_up(8*); mental_rate >= 30 ^ score_buff(74.25); mental_rate <= 30 ^ score_up(918)	20	appeal_up(miracra, 200)
ginko	輝跡の舞踏会		4320	6720	6120	490	ur	fever_start	ap_up(8); vol_lv >= 4 ^ ap_up(8)	mental_rate <= 10 ^ score_buff(253.12); mental_rate <= 10 ^ vol_buff(253.12); mental_rate <= 10 ^ ap_up(10*); mental_down(50*)	10	appeal_up(g104, 200); ap_reduce(all, 2)
rurino	17th Birthday*		5760	5760	5760	480	br	fever_start	ap_up(12); mental_rate >= 50 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); mental_rate >= 50 ^ ap_up(5*); mental_rate >= 100 ^ ap_up(5*)	10	appeal_up(rurino, 400)
ceras	十六夜セレーネ		4560	5280	7320	490	ur	fever_start	vol_up(348)	vol_lv <= 8 ^ vol_up(243); vol_lv >= 7 ^ score_buff(324); skill_count <= 2 ^ reset()	12	appeal_up(edel, 200)
ceras	天地黎明		6960	6480	3840	480	ur	end	score_up(418.5)	skill_count <= 1 ^ vol_buff(697.5); skill_count >= 2 ^ score_up(502.2); skill_count >= 3 ^ ap_up(8)	17	appeal_up(all, 80)
kozue	奇跡の舞踏会		7200	5160	4920	480	ur	fever_start	ap_up(8); total_skill_count >= 6 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(243); vol_lv >= 7 ^ score_buff(324)	8	appeal_up(g102, 200); ap_reduce(all, 2)
ginko	37.5℃のファンタジー		6720	6120	4440	480	ur	start	mental_down(25); ap_up(5)	score_buff(170.62); mental_rate >= 30 ^ reset(); mental_rate <= 25 ^ ap_up(3)	7	appeal_up(all, 80)
izumi	天地黎明		7080	6240	3960	480	ur	start	vol_up(348)	skill_count <= 1 ^ score_buff(697.5); skill_count >= 2 ^ vol_up(418); skill_count >= 3 ^ ap_up(8)	18	appeal_up(all, 80)
kosuzu	アイマイメーデー		4200	6120	6960	480	ur	fever_start	vol_up(348)	vol_up(202); mental_rate >= 30 ^ mental_down(25*); mental_rate <= 25 ^ vol_up(435); mental_rate <= 25 ^ splice()	8	appeal_up(all, 80)
kozue	Prism Echo		7200	6720	6240	640	dr	start	ap_up(18)	score_buff(204.75); vol_buff(204.75); splice(); dr_ap_up(5)	12	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)
kaho	Prism Echo		7680	7200	6240	560	dr	end	score_up(502.2)	score_up(1053); splice(); dr_ap_up(5)	20	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)
sayaka	Prism Echo		6240	7680	6720	600	dr	start	vol_up(418)	vol_up(877); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)
tsuzuri	Prism Echo		6240	6720	7680	600	dr	start	vol_up(418)	vol_up(877); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)
rurino	Prism Echo		6720	7200	6240	640	dr	start	ap_up(12); mental_up(100)	score_buff(204.75);vol_buff(204.75);splice();dr_ap_up(5)	12	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)
megumi	Prism Echo		7680	7200	6240	560	dr	end	score_up(502.2)	score_up(1053); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)
kosuzu	レディバグ		4440	5520	6840	520	ur	fever_start	vol_up(170); mental_rate <= 75 ^ vol_up(204)	vol_up(478)	15	appeal_up(all, 80)
kaho	Ether Aria		8640	6720	5640	570	dr	end	score_up(502.2)	score_up(502.2); mental_rate >= 100 ^ score_up(1010.88); splice(); dr_ap_up(5)	20	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)
kozue	Ether Aria		6480	6480	8160	560	dr	start	ap_up(18)	score_buff(326.25); skill_count <= 3 ^ reset(); dr_ap_up(1)	12	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)
ginko	Ether Aria		5520	7800	7440	590	dr	start	mental_down(90)	mental_rate <= 1 ^ score_buff(652.5); mental_down(90*); skill_count >= 2 ^ splice(); dr_ap_up(3)	10	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)
sayaka	Ether Aria		6120	6240	8400	590	dr	start	vol_up(418)	vol_up(418); mental_rate <= 10 ^ vol_up(842); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)
tsuzuri	Ether Aria		6240	8400	6480	560	dr	start	vol_up(418)	vol_up(418); total_skill_count <= 3 ^ vol_up(936); splice(); dr_ap_up(5);  dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)
kosuzu	Ether Aria		7800	7440	5760	570	dr	start	vol_up(418)	vol_up(418); mental_rate <= 10 ^ vol_up(842); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)
rurino	Ether Aria		6240	8280	6480	570	dr	fever_start	ap_up(12); mental_up(100)	score_buff(204.75); mental_rate >= 100 ^ score_buff(368.55); mental_up(100); splice(); dr_ap_up(5)	12	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)
megumi	Ether Aria		8160	6360	6120	600	dr	end	score_up(502.2)	score_up(502.2); total_skill_count >= 15 ^ score_up(1123.2); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)
hime	Ether Aria		6600	6960	7440	570	dr	end	score_up(502.2)	score_up(502.2); mental_rate <= 10 ^ score_up(1010.88); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)
hime	Oracle Étude		5280	8400	7320	570	dr2	end	score_up(502.2)	score_up(502.2); mental_rate <= 1 ^ score_up(1512); mental_up(50); splice(); dr_ap_up(5)	20	appeal_up(hime, 320); ap_reduce(all, 2); cooltime_reduce(2)
rurino	Oracle Étude		6960	5400	8400	590	dr2	fever_start	ap_up(12); mental_up(100)	vol_buff(204.75); mental_rate >= 100 ^ vol_buff(368.55); mental_up(50*); reset(); splice(); dr_ap_up(5)	12	appeal_up(rurino, 320); ap_reduce(all, 2); cooltime_reduce(2)
kosuzu	Oracle Étude		7080	8640	5040	590	dr2	start	vol_up(418)	vol_up(418); mental_rate <= 1 ^ vol_up(1260); mental_rate >= 50 ^ vol_down(300*); splice(); dr_ap_up(5)	20	appeal_up(kosuzu, 320); ap_reduce(all, 2); cooltime_reduce(2)
ceras	Oracle Étude		8640	5160	7080	580	dr2	start	vol_up(418)	vol_up(326);vol_buff(326.25);skill_count <= 1 ^ ap_up(10);skill_count <= 1 ^ reset();skill_count >= 2 ^ splice();dr_ap_up(3)	16	appeal_up(ceras, 320);ap_reduce(all, 2);cooltime_reduce(2)
ginko	Oracle Étude		5280	7080	8520	580	dr2	start	mental_down(90)	mental_rate <= 1 ^ vol_buff(652.5);mental_down(90*);skill_count >= 2 ^ splice();dr_ap_up(3) 	12	appeal_up(ginko, 320);ap_reduce(all, 2);cooltime_reduce(2)
kozue	be proud		8640	5640	5040	510	lr	start	ap_up(15)	vol_buff(112.5); reset(); lr_kozue()	5	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)
megumi	やっぱ天使！		5580	8580	4800	540	lr	end	score_up(573.75)	score_up(326.25); total_skill_count >= 15 ^ score_buff(364.5); lr_megumi()	12	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)
rurino	Very! Very! COCO夏っ		6480	6060	4500	500	ur	start	ap_up(12)	skill_count <= 2 ^ vol_buff(627.75);skill_count <= 2 ^ reset();skill_count >= 3 ^ ap_up(15)	15	appeal_up(miracra, 200)
hime	Very! Very! COCO夏っ		6600	5880	4560	500	ur	fever_start	vol_up(525)	mental_rate <= 1 ^ score_up(1755);vol_down(5000*)	20	appeal_up(miracra, 200)
kosuzu	探求の舞踏会		6840	6000	4680	460	ur	fever_start	vol_up(170);mental_rate <= 50 ^ vol_up(238)	vol_up(271);mental_rate <= 10 ^ vol_up(489);mental_up(50*)	10	appeal_up(g104, 200);ap_reduce(all, 2)
hime	邂逅の舞踏会		5760	5280	6240	480	ur	end	score_up(204.75);vol_lv >= 4 ^ score_up(286.65)	score_up(326.25);mental_rate <= 10 ^ score_up(587.25);vol_down(100*)	10	appeal_up(g104, 200);ap_reduce(all, 2)
ginko	フルーツパンチ		7680	5760	3720	420	ur	start	ap_up(12)	mental_down(25*); mental_rate <= 1 ^ ap_up(6); reset(); skill_count >= 4 ^ splice()	4	appeal_up(cerise, 200)
ginko	可惜夜花火		4440	6000	6720	490	ur	start	ap_up(12)	mental_rate <= 10 ^ score_buff(860.62);mental_up(25*)	1	appeal_up(cerise, 200)
kosuzu	太陽であれ！		4080	6600	6720	470	ur	fever_start	vol_up(348)	mental_rate >= 1 ^ vol_buff(573.75);mental_rate <= 1 ^ vol_up(956);mental_rate <= 1 ^ splice()	15	appeal_up(dollche, 200)
rurino	18th Birthday		5760	5760	5760	480	br	start	ap_up(10)	mental_up(30*);vol_buff(54.45);score_buff(54.45);reset();skill_count >= 3 ^ splice()	0	appeal_up(rurino, 400)
rurino	ニャオシグナル		3960	5640	7440	500	ur	start	ap_up(12)	skill_count <= 1 ^ ap_up(25);skill_count >= 2 ^ ap_down(20*);vol_lv >= 10 ^ splice()	0	appeal_up(miracra, 200)
hime	ニャオシグナル		4080	5760	7200	500	ur	fever_start	score_up(418.5)	score_up(326.25);mental_rate <= 10 ^ score_buff(364.5)	12	appeal_up(miracra, 200)
ceras	フュージョンクラスト		4080	6840	6360	480	ur	start	vol_up(348)	vol_buff(170.62);skill_count >= 2 ^ vol_up(204);skill_count >= 3 ^ score_buff(238.87)	10	appeal_up(edel, 200)
izumi	フュージョンクラスト		3840	6840	6600	480	ur	fever_start	score_up(418.5)	vol_buff(170.62);skill_count >= 2 ^ score_buff(204.75);skill_count >= 3 ^ score_up(286.65)	10	appeal_up(edel, 200)
ceras	片翼のトリバガ		3600	6720	6960	480	ur	fever_start	ap_up(12)	skill_count <= 5 ^ ap_up(8);skill_count <= 5 ^ vol_buff(519.75);skill_count >= 6 ^ vol_up(1050);skill_count >= 6 ^ splice()	16	appeal_up(all, 80)
izumi	片翼のトリバガ		3600	6600	7080	480	ur	fever_start	ap_up(12)	skill_count <= 5 ^ ap_up(8);skill_count <= 5 ^ score_buff(519.75);skill_count >= 6 ^ score_up(1260)	16	appeal_up(all, 80)
kozue	18th Birthday		5760	5760	5760	480	br	fever_start	ap_up(12);total_skill_count >= 6 ^ ap_up(8)	score_buff(123.75);vol_buff(123.75);skill_count <= 4 ^ ap_up(5*);skill_count <= 2 ^ ap_up(5*)	10	appeal_up(kozue, 400)
ginko	青嵐の鯉流し		5880	6720	4800	470	ur	fever_start	ap_up(8);vol_lv >= 2 ^ ap_up(8)	score_buff(478.12)	15	appeal_up(all, 80)
hime	17th Birthday		5760	5760	5760	480	br	fever_start	ap_up(12)	mental_rate >= 1 ^ ap_up(5);mental_rate <= 1 ^ vol_buff(198);mental_rate <= 1 ^ score_buff(198)	5	appeal_up(hime, 400)
kaho	想造の地平から		7560	5280	4200	500	ur	fever_start	ap_up(12);total_skill_count >= 20 ^ vol_up(618)	total_skill_count <= 9 ^ score_up(388.8);total_skill_count >= 10 ^ score_up(1198.8);total_skill_count >= 20 ^ ap_up(12);gaia_kaho()	16	appeal_up(kaho_pivot, 180); ap_escalate(all, 1); ap_bonus_up(10); cooltime_reduce(3)
sayaka	醒悟の地平から		4440	5040	7560	500	ur	start	ap_up(12)	skill_count <= 1 ^ vol_up(1316);skill_count <= 1 ^ reset();skill_count >= 2 ^ score_buff(877.5);gaia_sayaka()	20	appeal_up(sayaka_pivot, 180);cooltime_escalate(3);ap_reduce(all, 8);voltage_bonus_up(1600)
rurino	眺望の地平から		4920	7560	4560	500	ur	start	ap_up(12);mental_down(100*)	mental_rate >= 1 ^ ap_up(5);mental_rate <= 1 ^ vol_buff(225);mental_rate <= 1 ^ score_buff(225);gaia_rurino()	12	appeal_up(rurino_pivot, 180);mental_max_change(rurino, 100); ap_reduce(all, 2); cooltime_reduce(2)
ginko	ユメワズライ		6240	5520	5520	480	ur	fever_start	ap_up(8)	vol_buff(236.25);mental_rate <= 10 ^ vol_buff(425.25)	15	appeal_up(all, 72)`;const bt=t=>t.replace(/_([a-z])/g,(e,a)=>a.toUpperCase()),G=(t=>{const e=t.split(/\r\n|\n|\r/).filter(o=>o.trim()!==""),a=e[0].split("	");return e.slice(1).map(o=>o.split("	")).map(o=>a.reduce((n,c,l)=>(n={...n,[bt(c)]:o[l]===""||isNaN(Number(o[l]))?o[l]:Number(o[l])},n),{}))})(ht),gt=["<=",">="],B=1e-6,st=Object.freeze({1:1,2:1.1,3:1.2,4:1.3,5:1.4,6:1.5,7:1.6,8:1.7,9:1.8,10:2,11:2.2,12:2.4,13:2.6,14:3}),W=Object.freeze({vol_buff:{unit:.01,fixed:2},vol_up:{unit:.01,fixed:2},vol_down:{unit:.01,fixed:2},score_up:{unit:.01,fixed:2},score_buff:{unit:.01,fixed:2},mental_up:{unit:5,fixed:0},mental_down:{unit:5,fixed:0},ap_up:{unit:1,fixed:0},ap_down:{unit:1,fixed:0},ap_change:{unit:1,fixed:0}}),U=Object.freeze({ur:[[1,.01],[60,.5],[80,.7],[100,1],[110,1.1],[120,1.2]],dr:[[1,.01],[100,.7],[120,1],[130,1.1],[140,1.2]],dr2:[[1,.5],[100,.7],[120,1],[130,1.1],[140,1.2]],br:[[1,.01],[80,.7],[100,1],[110,1.1],[120,1.2]],lr:[[1,.0169],[100,.7],[120,1],[130,1.1],[140,1.2]],sr:[[1,.01],[40,.5],[60,.7],[80,1],[90,1.1],[100,1.2]],r:[[1,.01],[60,1]]}),X=Object.freeze({ur:[[1,.2],[60,.5],[80,.7],[100,1],[120,1]],dr:[[1,.2],[100,.7],[120,1],[140,1]],dr2:[[1,.5],[100,.7],[120,1],[140,1]],br:[[1,.2],[80,.7],[100,1],[120,1]],lr:[[1,.205],[100,.7],[120,1],[140,1]],sr:[[1,.2],[40,.5],[60,.7],[80,1],[100,1]],r:[[1,.2],[60,1]]}),yt=Object.freeze({ur:[110,100,80,0],dr:[130,120,100,0],dr2:[130,120,100,0],br:[110,100,80,0],lr:[130,120,100,0],sr:[90,80,60,0],r:[70,60,40,0]}),wt=(t,e)=>yt[t.rarity].findIndex(a=>e>a)||0,q=(t,e,a,r=U[t.rarity][U[t.rarity].length-1][0],o=1)=>{const n=t.rawSkillText.replace(/([\w_]+)\(([\d.]*)(?<no_change>\*?)\)/g,($,i,_,f)=>{if(f)return`${i}(${_})`;if(i==="dr_ap_up")return`ap_up(${(e-10)*Number(_)})`;if(i==="lr_tsuzuri")return"total_skill_count <= 12 ^ ap_up(20)";if(i==="lr_kozue")return"skill_count >= 10 ^ splice()";if(i==="lr_megumi")return"ap_up(2)";if(i==="gaia_kaho")switch(e){case 14:return"score_buff(202.5)";case 13:return"score_buff(175.5)";case 12:return"score_buff(162)";default:return""}if(i==="gaia_sayaka")return"skill_count >= 2 ^ ap_down(10)";if(i==="gaia_rurino")return"mental_down(100)";if(!_)return`${i}()`;const w=Math.floor(Number(_)*st[e]/3/W[i].unit+B)*W[i].unit;return`${i}(${w.toFixed(W[i].fixed)})`}),c=t.rawCenterSkillText.replace(/([\w_]+)\(([\d.]+)(?<no_change>\*?)\)/g,($,i,_,f)=>{if(f)return`${i}(${_})`;const w=Math.floor(Number(_)*st[a]/3/W[i].unit+B)*W[i].unit;return`${i}(${w.toFixed(W[i].fixed)})`});let l=t.smile,v=t.pure,g=t.cool;const p=U[t.rarity];if(p){l/=p[p.length-1][1]||1,v/=p[p.length-1][1]||1,g/=p[p.length-1][1]||1;const $=p.findIndex(([_])=>_>=r),i=$-1;if(i!==-1){const[_,f]=U[t.rarity][i],[w,E]=U[t.rarity][$];l=Math.ceil(l*(f+(E-f)*(r-_)/(w-_))-B),v=Math.ceil(v*(f+(E-f)*(r-_)/(w-_))-B),g=Math.ceil(g*(f+(E-f)*(r-_)/(w-_))-B)}else{const[_,f]=U[t.rarity][$];l=Math.ceil(l*f-B),v=Math.ceil(v*f-B),g=Math.ceil(g*f-B)}}let k=t.mental;const M=X[t.rarity];if(M){k/=M[M.length-1][1]||1;const $=M.findIndex(([_])=>_>=r),i=$-1;if(i!==-1){const[_,f]=X[t.rarity][i],[w,E]=X[t.rarity][$];k=Math.ceil(k*(f+(E-f)*(r-_)/(w-_))-B)}else{const[_,f]=X[t.rarity][$];k=Math.ceil(k*f-B)}}const A=t.ap+wt(t,r);return{...t,smile:l,pure:v,cool:g,mental:k,ap:A,name:t.key,skill:n,centerSkillCondition:t.centerSkillCondition,centerSkill:c,lbCount:o}};q(G[0],14,14),q(G[6],14,14),q(G[5],14,14),q(G[7],14,14),q(G[4],14,14),q(G[1],14,14);const pt=t=>{if(!t)return;const e=gt.find(a=>t?.includes(a));if(e){const[a,r]=t.split(e).map(o=>o.trim());return!a||!r?void 0:[a,e,Number(r)]}else return},zt=(t,e)=>{switch(t){case"cooltime_reduce":case"cooltime_escalate":case"ap_bonus_up":case"voltage_bonus_up":return{target:"all",amount:Number(e[0])};default:return{target:e[0],amount:Number(e[1])}}},Mt=t=>{const e=[],a=[],r=[],o=t.skill.split(";").map(n=>n.trim());for(const n of o){if(!n)continue;const[c,l]=n.split("^").map(A=>A.trim()),v=l?c:void 0,g=l||c,[,p,k]=g.match(/^(\w+)\((.*)\)$/)||[],M={type:p,value:k?Number(k):void 0,condition:pt(v)};e.push(M)}if(t.centerSkill){const n=t.centerSkill.split(";").map(c=>c.trim());for(const c of n){const[l,v]=c.split("^").map($=>$.trim()),g=v?l:void 0,p=v||l,[,k,M]=p.match(/^(\w+)\((.*)\)$/)||[],A={type:k,value:M?Number(M):void 0,condition:pt(g)};a.push(A)}}if(t.centerAbilityText){const n=t.centerAbilityText.split(";").map(c=>c.trim());for(const c of n){const[,l,v]=c.match(/^(\w+)\((.*)\)$/)||[],g=v?v.split(",").map(k=>k.trim()):[],p={type:l,value:zt(l,g)};r.push(p)}}return{...t,skills:e,centerSkills:a,centerAbilities:r}},$t=(t,e,a)=>{const r=a?.centerAbilities.find(n=>n.type==="appeal_up"),o=t.reduce((n,c)=>{const l=r?nt(c.name,r?.value.target):!1,v=Math.ceil(c.smile*(l?(100+(r?.value.amount||0))/100:1)),g=Math.ceil(c.pure*(l?(100+(r?.value.amount||0))/100:1)),p=Math.ceil(c.cool*(l?(100+(r?.value.amount||0))/100:1));return{smile:n.smile+v,pure:n.pure+g,cool:n.cool+p}},{smile:0,pure:0,cool:0});return o.smile=Math.round(o.smile/(e==="smile"?1:10)),o.pure=Math.round(o.pure/(e==="pure"?1:10)),o.cool=Math.round(o.cool/(e==="cool"?1:10)),o.smile+o.pure+o.cool};function*xt(t,e,a,r){let o=0n;if(e===0)yield[],o++;else if(e===1){for(const n of t)if(o>=a&&o<r&&(yield[n]),o++,o>=r)return}else for(let n=0;n<t.length-e+1;n++){const c=t.slice(n+1);for(const l of _t(c,e-1))if(o>=a&&o<r&&(yield[t[n],...l]),o++,o>=r)return}}function*_t(t,e){if(e===0)yield[];else if(e===1)for(const a of t)yield[a];else for(let a=0;a<t.length-e+1;a++){const r=t.slice(a+1);for(const o of _t(r,e-1))yield[t[a],...o]}}function*ct(t){if(t.length===1)yield t;else for(let e=0;e<t.length;e++){const a=t.slice(0,e).concat(t.slice(e+1));for(const r of ct(a))yield[t[e],...r]}}const lt=t=>{let e=1;for(let a=1;a<=t;a++)e*=a;return e},Ct=(t,e)=>lt(t)/(lt(e)*lt(t-e)),rt=t=>{let e=1n;for(let a=1n;a<=t;a++)e*=a;return e},At=(t,e)=>rt(t)/(rt(e)*rt(t-e)),St=1e-6,Et=(t,e)=>e.reduce((r,o)=>{switch(t[o]){case 1:return r;case 2:return r+20;case 3:return r+27.5;case 4:return r+35;case 5:return r+42.5;case 6:return r+50;case 7:return r+55;case 8:return r+60;case 9:return r+65;case 10:return r+70}return r},100)/100,Tt=t=>Math.round(66/(7*t+10)*100+St)/100,Bt=t=>t!=="kozue"&&t!=="tsuzuri"&&t!=="megumi",Pt=t=>t===void 0?1:1+t*.1;self.onmessage=t=>{const{requiredMembers:e,optionalMembers:a,notes:r,center:o,attribute:n,masteryLevel:c,playStyle:l,formationRule:v,includingCenterOnly:g,noLog:p,noDamagedFormation:k,noCuredFormation:M,scoreComparisonRule:A,seasonFanLvs:$,singers:i,batchNum:_,batchIndex:f}=t.data;let w=0,E=0;const J=6-e.length,x=new WeakMap,Y=Ct(a.length,J);let Q=0;const R=At(BigInt(a.length),BigInt(J)),F=R/BigInt(_),P=BigInt(f)*F,C=f===_-1?R:BigInt(f+1)*F;t:for(const O of xt(a,J,P,C)){Q%100===0&&self.postMessage({message:"progress",data:{progress:Q/Y*100}}),Q++;const z=[...e,...O];if(g&&!z.some(h=>h.key===o))continue;switch(v){case"current":{if(new Set(z.map(b=>b.key!=="other"?b.key:b.otherName)).size!==6)continue t;break}case"new_grand_prix":{if(z.filter(y=>y.rarity==="dr"||y.rarity==="dr2").length>1)continue t;const b={};if(z.forEach(y=>{const T=y.key!=="other"?y.key:y.otherName;b[T]=(b[T]||0)+1}),Object.values(b).some(y=>y>=3))continue t;break}}const V=z.map(h=>{if(x.has(h))return x.get(h);const b=Mt(h);return x.set(h,b),b}),D=z.reduce((h,b)=>h+b.mental,0);for(const h of ct(V))try{const b=h.filter(y=>y.name===o);b.length===0&&b.push(void 0);for(const y of b){const T=$t(V,n,y),j=kt({notes:r,convertedMembers:h,center:o,appealSum:T,mentalSum:D,masteryLevel:c,playStyle:l,noLog:p,noDamagedFormation:k,noCuredFormation:M,centerMember:y}),K=Math.ceil(j.score*Tt(i.filter(Bt).length)*Et($,i)*Pt(y?.lbCount));(A==="score"&&j.score>w||A==="grandPrixPt"&&K>E)&&(w=j.score,E=K,self.postMessage({message:"calcScore",data:{...j,liveGrandPrixPt:E,members:h,centerMember:y}}))}}catch(b){console.error(b)}}self.postMessage({message:"end"})}})();
