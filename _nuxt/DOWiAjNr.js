import{n as c,u as W,o as q,a as U,p as z,b as B,_ as A}from"./Djlki0hQ.js";import{d as E,k as F,r as m,H as O,o as D,y as b,z as v,A as e,B as w,M as t,J as x,L as $,E as C,T as S,K as p,x as I,C as J,N as h,O as j,R as V,I as Q}from"./DiSg5hTn.js";const G={class:"row"},X={class:"col form-check-label"},Y={class:"col form-check-label"},Z={class:"col form-check-label"},ee=E({__name:"MMemberRow",props:{card:{}},emits:["update:skillLevel"],setup(N,{emit:y}){const L=N,k=y,g=F(()=>c(L.card)),n=m("optional"),i=W(g,{centerSkillLevel:10,skillLevel:10,selected:"optional"});return O(n,a=>{i.value.selected=a}),O(i,a=>{k("update:skillLevel",a)}),D(()=>{n.value=i.value.selected||"optional",k("update:skillLevel",i.value)}),(a,o)=>(v(),b("tr",null,[e("td",null,w(t(q)(a.card)),1),e("td",null,[x(e("input",{"onUpdate:modelValue":o[0]||(o[0]=u=>t(i).skillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[$,t(i).skillLevel,void 0,{number:!0}]])]),e("td",null,[x(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>t(i).centerSkillLevel=u),class:"form-control",type:"number",min:"1",max:"14"},null,512),[[$,t(i).centerSkillLevel,void 0,{number:!0}]])]),e("td",null,[e("div",G,[e("label",X,[x(e("input",{"onUpdate:modelValue":o[2]||(o[2]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"required"},null,512),[[S,t(n)]]),o[5]||(o[5]=C(" 必須 "))]),e("label",Y,[x(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"optional"},null,512),[[S,t(n)]]),o[6]||(o[6]=C(" 任意 "))]),e("label",Z,[x(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>p(n)?n.value=u:null),class:"form-check-input",type:"radio",value:"excluded"},null,512),[[S,t(n)]]),o[7]||(o[7]=C(" 除外 "))])])])]))}}),le=Object.assign(ee,{__name:"MMemberRow"}),te={class:"container-md"},oe={class:"card my-2"},se={class:"card-body"},ne={class:"table"},ae={class:"card my-2"},re={class:"card-body"},ue={key:2},ie={class:"card my-2"},de={class:"card-body"},ce=["value"],pe=E({__name:"auto-formation",setup(N){const y=m(""),L=m(""),k=m(0),g=m(0),n=m("smile"),i=m(50),a=m(Object.fromEntries(U.map(d=>[c(d),{centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),o=(d,l)=>{a.value[d]=l},u=m(null),f=m(null),R=m(Promise.resolve()),_=m("finished"),T=()=>{u.value=new Worker(new URL(""+new URL("calc-worker-CQgto78u.js",import.meta.url).href,import.meta.url),{type:"module"}),u.value.onmessage=d=>{switch(d.data.message){case"calcScore":R.value=R.value.then(async()=>{d.data.data.score>(f.value?.score||0)&&(f.value={score:d.data.data.score,members:d.data.data.members,log:d.data.data.log})});break;case"end":_.value="finished";break}}};D(()=>{T()});const H=()=>{f.value=null;const d=z(y.value,k.value),l=U.filter(r=>a.value[c(r)]&&a.value[c(r)].selected==="required").map(r=>B(r,a.value[c(r)]?.skillLevel||10,a.value[c(r)]?.centerSkillLevel||10));if(l.length>6){alert("必要メンバーが6人を超えています");return}const M=U.filter(r=>!a.value[c(r)]?.selected||a.value[c(r)].selected==="optional").map(r=>B(r,a.value[c(r)]?.skillLevel||10,a.value[c(r)]?.centerSkillLevel||10));_.value="running",u.value?.postMessage({requiredMembers:l,optionalMembers:M,notes:d,center:L.value,attribute:n.value,masteryLevel:i.value})},K=()=>{u.value?.terminate(),T(),_.value="finished"};return I({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"}]}),(d,l)=>{const M=A,r=le;return v(),b("div",te,[l[10]||(l[10]=e("h1",null,"スクショウ自動編成",-1)),J(M,{"note-text":t(y),"onUpdate:noteText":l[0]||(l[0]=s=>p(y)?y.value=s:null),center:t(L),"onUpdate:center":l[1]||(l[1]=s=>p(L)?L.value=s:null),offset:t(k),"onUpdate:offset":l[2]||(l[2]=s=>p(k)?k.value=s:null),"combo-offset":t(g),"onUpdate:comboOffset":l[3]||(l[3]=s=>p(g)?g.value=s:null),attribute:t(n),"onUpdate:attribute":l[4]||(l[4]=s=>p(n)?n.value=s:null),"mastery-level":t(i),"onUpdate:masteryLevel":l[5]||(l[5]=s=>p(i)?i.value=s:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",oe,[l[7]||(l[7]=e("div",{class:"card-header"}," メンバー ",-1)),e("div",se,[e("table",ne,[l[6]||(l[6]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"カード"),e("th",{scope:"col"},"スキルLv."),e("th",{scope:"col"},"センタースキルLv."),e("th",{scope:"col"},"選択")])],-1)),e("tbody",null,[(v(!0),b(h,null,j(t(U),s=>(v(),Q(r,{key:s.key,card:s,"onUpdate:skillLevel":P=>o(t(c)(s),P)},null,8,["card","onUpdate:skillLevel"]))),128))])])])]),e("div",ae,[l[9]||(l[9]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",re,[t(_)!=="running"?(v(),b("button",{key:0,type:"button",class:"btn btn-primary",onClick:H}," 計算 ")):V("",!0),t(_)==="running"?(v(),b("button",{key:1,type:"button",class:"btn btn-primary",onClick:K}," 中止 ")):V("",!0),t(f)?(v(),b("div",ue,[e("p",null,w(t(_)==="running"?"計算中...":"計算完了"),1),e("div",ie,[e("div",de,[e("p",null,"最高得点: "+w(t(f).score),1),l[8]||(l[8]=e("p",null,"メンバー:",-1)),e("ul",null,[(v(!0),b(h,null,j(t(f).members,s=>(v(),b("li",{key:t(c)(s)},w(t(q)(s)),1))),128))]),e("textarea",{class:"form-control",value:t(f).log,readonly:"",rows:"5"},null,8,ce)])])])):V("",!0)])])])}}});export{pe as default};
