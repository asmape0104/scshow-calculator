(function(){"use strict";const xt=t=>t.reduce((e,l)=>e+l.normalCount+l.slideCount,0),$t=[...["kaho","sayaka","kozue","tsuzuri","rurino","megumi","ginko","kosuzu","hime","ceras","izumi"],"other"],E={kaho:"花帆",sayaka:"さやか",kozue:"梢",tsuzuri:"綴理",rurino:"瑠璃乃",megumi:"慈",ginko:"吟子",kosuzu:"小鈴",hime:"姫芽",ceras:"セラス",izumi:"泉",other:"その他"},mt={all:$t,g102:["kozue","tsuzuri","megumi"],g103:["kaho","sayaka","rurino"],g104:["ginko","kosuzu","hime"],g105:["ceras"],cerise:["kaho","kozue","ginko"],dollche:["sayaka","tsuzuri","kosuzu"],miracra:["rurino","megumi","hime"],edel:["ceras","izumi"],kaho_pivot:["kaho","kozue","ginko","sayaka","rurino"],sayaka_pivot:["sayaka","tsuzuri","kosuzu","kaho","rurino"],rurino_pivot:["rurino","megumi","hime","sayaka","kaho"],kozue_pivot:["kaho","kozue","ginko","tsuzuri","megumi"],tsuzuri_pivot:["sayaka","tsuzuri","kosuzu","kozue","megumi"],megumi_pivot:["rurino","megumi","hime","tsuzuri","kozue"]},nt=(t,e)=>e in mt?mt[e]?.includes(t):t===e;var Ct=`key	series	other_name	smile	pure	cool	mental	rarity	center_skill_condition	raw_center_skill_text	raw_skill_text	ap	center_ability_text	image_normal	image_idolized
other	蓮ノ空女学院スクールアイドルクラブ102期生	大賀美沙知	5880	5700	5700	480	ur			ap_up(10);skill_count>=3 ^ splice()	0			
rurino	悠久の舞踏会		4320	7800	5160	480	ur	fever_start	ap_up(8);vol_lv >= 4 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(326.25);vol_lv >= 7 ^ score_buff(435);mental_down(10*)	10	appeal_up(g103, 200);ap_reduce(all, 2)		
rurino	アイドゥーミー！		6960	6360	5880	520	ur	fever_start	ap_up(20); mental_rate <= 99 ^ vol_down(1000*)	mental_up(10*); mental_rate >= 100 ^ ap_up(15); mental_rate <= 99 ^ vol_down(1000*); skill_count >= 3 ^ splice()	5	appeal_up(miracra, 200)		
megumi	久遠の銀河へ		7200	4920	4800	510	ur	fever_start	score_up(204.75); skill_count >= 6 ^ score_up(286.65)	total_skill_count <= 9 ^ ap_up(15*); total_skill_count >= 10 ^ score_up(522)	10	appeal_up(g102, 200);ap_reduce(all, 2)		
kaho	アイドゥーミー！		6000	6240	6960	520	ur	end	score_up(418.5)	mental_up(10*); mental_rate >= 100 ^ score_up(1134); mental_rate <= 99 ^ vol_down(1000*)	12	appeal_up(all, 72)		
sayaka	アイドゥーミー！		6120	6960	6120	520	ur	fever_start	score_up(877.5); mental_rate <= 99 ^ vol_down(1000*)	skill_count <= 1 ^ vol_buff(78.75); skill_count >= 2 ^ score_buff(243); mental_rate >= 100 ^ vol_up(945); mental_rate <= 99 ^ vol_down(1000*)	14	appeal_up(dollche, 200)		
kozue	輪廻の銀河へ		5160	4680	7440	480	ur	fever_start	ap_up(8); skill_count >= 6 ^ ap_up(8)	skill_count <= 3 ^ vol_buff(324); skill_count <= 3 ^ reset(); skill_count >= 4 ^ score_buff(324)	10	appeal_up(g102, 200);ap_reduce(all, 2)		
ceras	16th Birthday		5760	5760	5760	480	br	start	ap_up(10)	ap_up(5); vol_buff(54.45); reset(); skill_count >= 3 ^ splice()	0	appeal_up(ceras, 400)		
tsuzuri	幸せのリボン		5760	5160	8520	500	lr	fever_start	vol_up(478)	vol_up(731); total_skill_count >= 10 ^ vol_up(1170); lr_tsuzuri(); splice()	20	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)		
megumi	18th Birthday*		5760	5760	5760	480	br	fever_start	score_up(368.28); total_skill_count >= 6 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); skill_count <= 4 ^ ap_up(5*); skill_count <= 2 ^ ap_up(5*)	10	appeal_up(megumi, 400)		
hime	BLAST!!		3720	7080	6240	500	ur	fever_start	mental_down(40*); score_up(326.25)	mental_rate >= 30 ^ mental_down(20*); mental_rate >= 30 ^ ap_up(8*); mental_rate >= 30 ^ score_buff(74.25); mental_rate <= 30 ^ score_up(918)	20	appeal_up(miracra, 200)		
ginko	輝跡の舞踏会		4320	6720	6120	490	ur	fever_start	ap_up(8); vol_lv >= 4 ^ ap_up(8)	mental_rate <= 10 ^ score_buff(253.12); mental_rate <= 10 ^ vol_buff(253.12); mental_rate <= 10 ^ ap_up(10*); mental_down(50*)	10	appeal_up(g104, 200); ap_reduce(all, 2)		
rurino	17th Birthday*		5760	5760	5760	480	br	fever_start	ap_up(12); mental_rate >= 50 ^ ap_up(8)	score_buff(123.75); vol_buff(123.75); mental_rate >= 50 ^ ap_up(5*); mental_rate >= 100 ^ ap_up(5*)	10	appeal_up(rurino, 400)		
ceras	天地黎明		6960	6480	3840	480	ur	end	score_up(418.5)	skill_count <= 1 ^ vol_buff(697.5); skill_count >= 2 ^ score_up(502.2); skill_count >= 3 ^ ap_up(8)	17	appeal_up(all, 80)		
kozue	奇跡の舞踏会		7200	5160	4920	480	ur	fever_start	ap_up(8); total_skill_count >= 6 ^ ap_up(8)	vol_lv <= 8 ^ vol_buff(243); vol_lv >= 7 ^ score_buff(324)	8	appeal_up(g102, 200); ap_reduce(all, 2)		
ginko	37.5℃のファンタジー		6720	6120	4440	480	ur	start	mental_down(25); ap_up(5)	score_buff(170.625); mental_rate >= 30 ^ reset(); mental_rate <= 25 ^ ap_up(3*)	7	appeal_up(all, 80)		
izumi	天地黎明		7080	6240	3960	480	ur	start	vol_up(348)	skill_count <= 1 ^ score_buff(697.5); skill_count >= 2 ^ vol_up(418); skill_count >= 3 ^ ap_up(8)	18	appeal_up(all, 80)		
kozue	Prism Echo		7200	6720	6240	640	dr	start	ap_up(18)	score_buff(204.75); vol_buff(204.75); splice(); dr_ap_up(5)	12	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)		
kaho	Prism Echo		7680	7200	6240	560	dr	end	score_up(502.2)	score_up(1053); splice(); dr_ap_up(5)	20	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)		
sayaka	Prism Echo		6240	7680	6720	600	dr	start	vol_up(418)	vol_up(877); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)		
tsuzuri	Prism Echo		6240	6720	7680	600	dr	start	vol_up(418)	vol_up(877); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)		
rurino	Prism Echo		6720	7200	6240	640	dr	start	ap_up(12); mental_up(100)	score_buff(204.75);vol_buff(204.75);splice();dr_ap_up(5)	12	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)		
megumi	Prism Echo		7680	7200	6240	560	dr	end	score_up(502.2)	score_up(1053); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)		
kaho	Ether Aria		8640	6720	5640	570	dr	end	score_up(502.2)	score_up(502.2); mental_rate >= 100 ^ score_up(1010.88); splice(); dr_ap_up(5)	20	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)		
kozue	Ether Aria		6480	6480	8160	560	dr	start	ap_up(18)	score_buff(326.25); skill_count <= 3 ^ reset(); dr_ap_up(1)	12	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)		
ginko	Ether Aria		5520	7800	7440	590	dr	start	mental_down(90)	mental_rate <= 1 ^ score_buff(652.5); mental_down(90*); skill_count >= 2 ^ splice(); dr_ap_up(3)	10	appeal_up(cerise, 160); ap_reduce(all, 2); cooltime_reduce(2)		
sayaka	Ether Aria		6120	6240	8400	590	dr	start	vol_up(418)	vol_up(418); mental_rate <= 10 ^ vol_up(842); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)		
tsuzuri	Ether Aria		6240	8400	6480	560	dr	start	vol_up(418)	vol_up(418); total_skill_count <= 3 ^ vol_up(936); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)		
kosuzu	Ether Aria		7800	7440	5760	570	dr	start	vol_up(418)	vol_up(418); mental_rate <= 10 ^ vol_up(842); splice(); dr_ap_up(5)	20	appeal_up(dollche, 160); ap_reduce(all, 2); cooltime_reduce(2)		
rurino	Ether Aria		6240	8280	6480	570	dr	fever_start	ap_up(12); mental_up(100)	score_buff(204.75); mental_rate >= 100 ^ score_buff(368.55); mental_up(100); splice(); dr_ap_up(5)	12	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)		
megumi	Ether Aria		8160	6360	6120	600	dr	end	score_up(502.2)	score_up(502.2); total_skill_count >= 15 ^ score_up(1123.2); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)		
hime	Ether Aria		6600	6960	7440	570	dr	end	score_up(502.2)	score_up(502.2); mental_rate <= 10 ^ score_up(1010.88); splice(); dr_ap_up(5)	20	appeal_up(miracra, 160); ap_reduce(all, 2); cooltime_reduce(2)		
hime	Oracle Étude		5280	8400	7320	570	dr2	end	score_up(502.2)	score_up(502.2); mental_rate <= 1 ^ score_up(1512); mental_up(50); splice(); dr_ap_up(5)	20	appeal_up(hime, 320); ap_reduce(all, 2); cooltime_reduce(2)		
rurino	Oracle Étude		6960	5400	8400	590	dr2	fever_start	ap_up(12); mental_up(100)	vol_buff(204.75); mental_rate >= 100 ^ vol_buff(368.55); mental_up(50*); reset(); splice(); dr_ap_up(5)	12	appeal_up(rurino, 320); ap_reduce(all, 2); cooltime_reduce(2)		
kosuzu	Oracle Étude		7080	8640	5040	590	dr2	start	vol_up(418)	vol_up(418); mental_rate <= 1 ^ vol_up(1260); mental_rate >= 50 ^ vol_down(300*); splice(); dr_ap_up(5)	20	appeal_up(kosuzu, 320); ap_reduce(all, 2); cooltime_reduce(2)		
ceras	Oracle Étude		8640	5160	7080	580	dr2	start	vol_up(418)	vol_up(326);vol_buff(326.25);skill_count <= 1 ^ ap_up(10);skill_count <= 1 ^ reset();skill_count >= 2 ^ splice();dr_ap_up(3)	16	appeal_up(ceras, 320);ap_reduce(all, 2);cooltime_reduce(2)		
ginko	Oracle Étude		5280	7080	8520	580	dr2	start	mental_down(90)	mental_rate <= 1 ^ vol_buff(652.5);mental_down(90*);skill_count >= 2 ^ splice();dr_ap_up(3) 	12	appeal_up(ginko, 320);ap_reduce(all, 2);cooltime_reduce(2)		
sayaka	Oracle Étude		7200	4800	8760	590	dr2	start	vol_up(418)	vol_up(418);mental_rate >= 100 ^ vol_up(1134);mental_rate <= 50 ^ vol_down(300*);splice();dr_ap_up(5)	20	appeal_up(sayaka, 320);ap_reduce(all, 2);cooltime_reduce(2)		
izumi	Oracle Étude		8820	6300	5760	580	dr2	end	score_up(502.2)	score_up(391.5);score_buff(326.25);skill_count <= 1 ^ ap_up(10);skill_count >= 2 ^ splice();dr_ap_up(3)	16	appeal_up(izumi, 320);ap_reduce(all, 2);cooltime_reduce(2)		
kozue	be proud		8640	5640	5040	510	lr	start	ap_up(15)	vol_buff(112.5); reset(); lr_kozue()	5	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)		
megumi	やっぱ天使！		5580	8580	4800	540	lr	end	score_up(573.75)	score_up(326.25); total_skill_count >= 15 ^ score_buff(364.5); lr_megumi()	12	appeal_up(g102, 200); ap_reduce(all, 1); cooltime_reduce(2)		
rurino	Very! Very! COCO夏っ		6480	6060	4500	500	ur	start	ap_up(12)	skill_count <= 2 ^ vol_buff(627.75);skill_count <= 2 ^ reset();skill_count >= 3 ^ ap_up(15)	15	appeal_up(miracra, 200)		
hime	Very! Very! COCO夏っ		6600	5880	4560	500	ur	fever_start	vol_up(525)	mental_rate <= 1 ^ score_up(1755);vol_down(5000*)	20	appeal_up(miracra, 200)		
ginko	フルーツパンチ		7680	5760	3720	420	ur	start	ap_up(12)	mental_down(25*); mental_rate <= 1 ^ ap_up(6); reset(); skill_count >= 4 ^ splice()	4	appeal_up(cerise, 200)		
ginko	可惜夜花火		4440	6000	6720	490	ur	start	ap_up(12)	mental_rate <= 10 ^ score_buff(860.62);mental_up(25*)	1	appeal_up(cerise, 200)		
kosuzu	太陽であれ！		4080	6600	6720	470	ur	fever_start	vol_up(348)	mental_rate >= 1 ^ vol_buff(573.75);mental_rate <= 1 ^ vol_up(956);mental_rate <= 1 ^ splice()	15	appeal_up(dollche, 200)		
rurino	18th Birthday		5760	5760	5760	480	br	start	ap_up(10)	mental_up(30*);vol_buff(54.45);score_buff(54.45);reset();skill_count >= 3 ^ splice()	0	appeal_up(rurino, 400)		
ceras	フュージョンクラスト		4080	6840	6360	480	ur	start	vol_up(348)	vol_buff(170.62);skill_count >= 2 ^ vol_up(204);skill_count >= 3 ^ score_buff(238.87)	10	appeal_up(edel, 200)		
izumi	フュージョンクラスト		3840	6840	6600	480	ur	fever_start	score_up(418.5)	vol_buff(170.62);skill_count >= 2 ^ score_buff(204.75);skill_count >= 3 ^ score_up(286.65)	10	appeal_up(edel, 200)		
ceras	片翼のトリバガ		3600	6720	6960	480	ur	start	ap_up(12)	skill_count <= 5 ^ ap_up(8);skill_count <= 5 ^ vol_buff(519.75);skill_count >= 6 ^ vol_up(1050);skill_count >= 6 ^ splice()	16	appeal_up(all, 80)		
izumi	片翼のトリバガ		3600	6600	7080	480	ur	fever_start	ap_up(12)	skill_count <= 5 ^ ap_up(8);skill_count <= 5 ^ score_buff(519.75);skill_count >= 6 ^ score_up(1260)	16	appeal_up(all, 80)		
kozue	18th Birthday		5760	5760	5760	480	br	fever_start	ap_up(12);total_skill_count >= 6 ^ ap_up(8)	score_buff(123.75);vol_buff(123.75);skill_count <= 4 ^ ap_up(5*);skill_count <= 2 ^ ap_up(5*)	10	appeal_up(kozue, 400)		
hime	17th Birthday		5760	5760	5760	480	br	start	ap_up(12)	mental_rate >= 1 ^ ap_up(5);mental_rate <= 1 ^ vol_buff(198);mental_rate <= 1 ^ score_buff(198)	5	appeal_up(hime, 400)		
kaho	想造の地平から		7560	5280	4200	500	ur	fever_start	ap_up(12);total_skill_count >= 20 ^ vol_up(618)	total_skill_count <= 9 ^ score_up(388.8);total_skill_count >= 10 ^ score_up(1198.8);total_skill_count >= 20 ^ ap_up(12);gaia_kaho()	16	appeal_up(kaho_pivot, 180); ap_escalate(all, 1); ap_bonus_up(10); cooltime_reduce(3)		
sayaka	醒悟の地平から		4440	5040	7560	500	ur	start	ap_up(12)	skill_count <= 1 ^ vol_up(1316);skill_count <= 1 ^ reset();skill_count >= 2 ^ score_buff(877.5);gaia_sayaka()	20	appeal_up(sayaka_pivot, 180);cooltime_escalate(3);ap_reduce(all, 8);voltage_bonus_up(1600)		
rurino	眺望の地平から		4920	7560	4560	500	ur	start	ap_up(12);mental_down(100*)	mental_rate >= 1 ^ ap_up(5);mental_rate <= 1 ^ vol_buff(225);mental_rate <= 1 ^ score_buff(225);gaia_rurino()	12	appeal_up(rurino_pivot, 180);mental_max_change(rurino, 100); ap_reduce(all, 2); cooltime_reduce(2)		
kosuzu	ガランドFlash		4080	5640	7260	505	ur	fever_start	vol_up(348)	skill_count <= 5 ^ ap_down(10*);skill_count <= 5 ^ score_buff(519.75);skill_count >= 6 ^ score_up(1260)	6	appeal_up(dollche, 200)		
sayaka	ガランドFlash		4200	5280	7500	505	ur	start	ap_up(12)	skill_count <= 5 ^ ap_down(10*);skill_count <= 5 ^ vol_buff(519.75);skill_count >= 6 ^ vol_up(1050);skill_count >= 6 ^ splice()	6	appeal_up(dollche, 200)		
kozue	Reflection in the mirror/102		3336	4560	9960	420	lr	start	ap_up(18)	score_buff(309.37);vol_buff(309.37);cond_reflection102_kozue ^ ap_up(5)	11	appeal_up(kozue_pivot, 200);ap_reduce(all,1);cooltime_reduce(2)		
tsuzuri	Sparkly Spot/102		3504	9984	4848	380	lr	start	ap_up(12);mental_down(100)	cond_sparkly102_tsuzuri ^ vol_buff(697.5);mental_rate <= 1 ^ vol_up(1462);mental_rate >= 1 ^ vol_up(749);vol_up(390);splice()	20	appeal_up(tsuzuri_pivot, 180);mental_max_change(tsuzuri, 100);ap_reduce(all, 2); cooltime_reduce(2)		
megumi	On your mark/102		9912	3672	3624	580	lr	start	ap_up(18)	total_skill_count >= 25 ^ score_buff(697.5);cond_oym102_megumi ^ score_up(2173.5);score_up(630)	18	appeal_up(megumi_pivot, 180); ap_escalate(all, 1); ap_bonus_up(10); cooltime_reduce(3)		
rurino	Poupée en Lotus		6180	7260	3780	485	ur	start	ap_up(12)	skill_count <= 1 ^ ap_up(8);vol_buff(86.25);reset();skill_count >= 8 ^ splice()	2	appeal_up(all, 54)		
izumi	17th Birthday		5760	5760	5760	480	br	start	ap_up(15)	skill_count <= 8 ^ score_buff(65.34);skill_count >= 9 ^ score_buff(841.5)	0	appeal_up(izumi, 400)		
ceras	105/刹那&セラニャン		4980	6900	5160	500	ur	end	score_up(877.5)	skill_count <= 1 ^ score_up(1498.5);skill_count <= 2 ^ score_up(1348.65);skill_count <= 3 ^ score_up(1198.8);score_up(749.25)	18	appeal_up(edel, 200)		
rurino	Hip, hip, hooray!		7500	6060	3720	480	ur	start	ap_up(12)	score_buff(348.75);vol_buff(348.75);total_skill_count >= 15 ^ ap_up(10)	14	appeal_up(miracra, 200)		
kaho	軌跡の舞踏会		7680	5760	3960	470	ur	end	score_up(204.75); vol_lv >= 4 ^ score_up(286.65)	vol_lv <= 8 ^ score_buff(243); vol_lv >= 7 ^ score_up(522)	10	appeal_up(g103, 200); ap_reduce(all, 2)		
ginko	もういちど ルミナス		6180	6600	4500	480	ur	start	mental_down(100)	mental_rate <= 1 ^ ap_up(10);mental_down(100*);reset();skill_count >= 3 ^ splice()	1	appeal_up(g104, 200)		
kosuzu	壱雫空		4680	5820	6780	480	ur	fever_start	vol_up(348)	mental_rate <= 1 ^ vol_up(697);vol_buff(348.75);skill_count >= 3 ^ splice()	12	appeal_up(g104, 200)		
hime	キミがいなくちゃっ！		7080	6000	3960	500	ur	end	score_up(418.5)	mental_rate <= 1 ^ score_up(837);score_buff(348.75)	12	appeal_up(g104, 200)		
izumi	FIRE BIRD		4920	5580	7020	460	ur	end	score_up(418.5)	total_skill_count <= 15 ^ score_buff(749.25);total_skill_count >= 15 ^ score_up(1348.65)	18	appeal_up(edel, 200)		
rurino	Echoes Beyond		5160	7440	4320	510	ur	start	ap_up(12)	vol_lv <= 0 ^ score_buff(1050);ap_up(4);in_fever ^ splice()	1	appeal_up(miracra, 200)	https://imagedelivery.net/mhFAnVcvPu0Kgy9FuR_Gnw/a13970b6-c433-43fa-a4a5-563dc67c5900/public	https://imagedelivery.net/mhFAnVcvPu0Kgy9FuR_Gnw/a8f00106-438b-47f7-a6e4-e54a6cbac000/public
ginko	My Lucky Clover		4980	5640	4260	440	sr	start	ap_up(10)	reset();skill_count>=5 ^ splice();vol_buff(13.5)	0	appeal_up(all, 54)		
ceras	蓮ノ空歌留多		4500	5760	6900	490	ur	end	score_up(418.5)	score_buff(236.25);skill_count >= 5 ^ score_up(1348.65);skill_count >= 5 ^ ap_down(9*)	9	appeal_up(all, 80)		
izumi	蓮ノ空歌留多		4620	5700	6840	490	ur	fever_start	vol_up(348)	vol_buff(236.25); skill_count >= 5 ^ vol_up(1123); skill_count >= 5 ^ ap_down(9*); reset(); skill_count >= 7 ^ splice()	9	appeal_up(all, 80)		
ceras	再臨の車窓		3780	7440	6180	470	ur	fever_start	vol_up(731)	skill_count <= 4 ^ ap_up(8);skill_count <= 4 ^ reset();skill_count >= 5 ^ vol_up(627);galaxyexpress_edel_1();total_skill_count >= 25 ^ score_up(1755);total_skill_count >= 25 ^ galaxyexpress_edel_2()	4	appeal_up(edel, 320);ap_reduce(all, 2);cooltime_reduce(1)		
izumi	廻天の車窓		3840	7680	5880	470	ur	start	ap_up(20)	skill_count <= 4 ^ ap_up(8);skill_count <= 4 ^ reset();skill_count >= 5 ^ vol_buff(627.75);galaxyexpress_edel_1();total_skill_count >= 20 ^ score_buff(1462.5);total_skill_count >= 20 ^ galaxyexpress_edel_2()	4	appeal_up(edel, 320);ap_reduce(all, 2);cooltime_reduce(1)		`;const Mt=t=>t.replace(/_([a-z])/g,(e,l)=>l.toUpperCase()),vt=(t,e="")=>{const l=t.split(/\r\n|\n|\r/).filter(o=>o.trim()!==""),a=l[0].split("	");return l.slice(1).map(o=>o.split("	")).map(o=>a.reduce((i,p,r)=>{const m=Mt(p),c=m==="series"?o[r]+e:o[r];return i={...i,[m]:c===""||isNaN(Number(c))?c:Number(c)},i},{}))};var St=`key	series	other_name	smile	pure	cool	mental	rarity	center_skill_condition	raw_center_skill_text	raw_skill_text	ap	center_ability_text
other	Edelied	桂城泉＆セラス 柳田 リリエンフェルト	5040	5040	5040	420	sr			score_up(631.8)	20	
izumi	シアター生き様		7080	5340	4620	500	ur	fever_start	score_up(418.5)	total_skill_count >= 20 ^ score_up(837);score_up(103.5)	12	appeal_up(edel, 200)
ceras	シアター生き様		7200	5340	4500	500	ur	start	ap_up(12)	ap_up(8);vol_buff(61.87);total_skill_count >= 10 ^ splice()	2	appeal_up(edel, 200)
rurino	バイタルサイン		7260	5160	4860	480	ur	fever_start	vol_up(348)	skill_count <= 3 ^ vol_buff(138);skill_count <= 3 ^ reset();skill_count >= 4 ^ score_buff(138)	4	appeal_up(all, 80)
hime	バイタルサイン		7320	5040	4920	480	ur	fever_start	ap_up(12)	mental_rate <= 1 ^ score_up(837);mental_rate <= 1 ^ score_buff(341.25);mental_up(25*)	13	appeal_up(all, 80)
kaho	Poupée en Lotus		6180	7080	3960	485	ur	fever_start	ap_up(10);mental_up(50)	mental_rate >= 100 ^ score_up(587.25);total_skill_count >= 20 ^ score_up(652.5);score_up(326.25)	15	appeal_up(all, 54)
hime	Hip, hip, hooray!		7440	6240	3600	480	ur	end	score_up(418.5)	mental_rate <= 10 ^ score_buff(945);score_up(630)	16	appeal_up(miracra, 200)
rurino	ニャオシグニャル		3960	5640	7440	500	ur	start	ap_up(12)	skill_count <= 1 ^ ap_up(25);skill_count >= 2 ^ ap_down(20*);vol_lv >= 10 ^ splice()	0	appeal_up(miracra, 200)
hime	ニャオシグニャル		4080	5760	7200	500	ur	fever_start	score_up(418.5)	score_up(326.25);mental_rate <= 10 ^ score_buff(364.5)	12	appeal_up(miracra, 200)
kosuzu	探求の舞踏会		6840	6000	4680	460	ur	fever_start	vol_up(170);mental_rate <= 50 ^ vol_up(238)	vol_up(271);mental_rate <= 10 ^ vol_up(489);mental_up(50*)	10	appeal_up(g104, 200);ap_reduce(all, 2)
hime	邂逅の舞踏会		5760	5280	6240	480	ur	end	score_up(204.75);vol_lv >= 4 ^ score_up(286.65)	score_up(326.25);mental_rate <= 10 ^ score_up(587.25);vol_down(100*)	10	appeal_up(g104, 200);ap_reduce(all, 2)
kosuzu	レディバグ		4440	5520	6840	520	ur	fever_start	vol_up(170); mental_rate <= 75 ^ vol_up(204)	vol_up(478)	15	appeal_up(all, 80)
ginko	ハナムスビ		7320	5520	4320	490	ur	fever_start	ap_up(8);mental_rate<=50 ^ ap_up(8)	score_buff(236.25);mental_rate<=10 ^ score_buff(425.25)	15	appeal_up(cerise, 200)
izumi	令嬢モブ！		5520	3960	7920	470	ur	start	ap_up(12)	total_skill_count <= 9 ^ vol_buff(495);total_skill_count >= 10 ^ score_buff(765);total_skill_count >= 20 ^ ap_up(15);total_skill_count >= 20 ^ splice()	11	appeal_up(edel, 200)
ceras	令嬢モブ！		5640	3960	7800	470	ur	end	score_up(418.5)	total_skill_count <= 15 ^ vol_up(371);total_skill_count >= 15 ^ score_up(668.25);total_skill_count >= 20 ^ score_buff(618.75) 	11	appeal_up(edel, 200)
kaho	雪舞う空と二秒の永遠		4800	6000	8280	530	ur	end	score_up(418.5)	vol_lv <= 0 ^ score_buff(956.25);skill_count >= 2 ^ score_up(688.5)	15	appeal_up(cerise, 200)
sayaka	雪舞う空と二秒の永遠		4860	6000	8220	530	ur	fever_start	vol_up(348)	vol_lv <= 0 ^ vol_buff(956.25);skill_count >= 2 ^ vol_up(573)	15	appeal_up(dollche, 200)
rurino	雪舞う空と二秒の永遠		4740	6000	8340	530	ur	start	ap_up(12)	vol_lv <= 0 ^ ap_up(7);vol_lv >= 1 ^ splice()	1	appeal_up(all, 72)
ginko	青嵐の鯉流し		5880	6720	4800	470	ur	fever_start	ap_up(8);vol_lv >= 2 ^ ap_up(8)	score_buff(478.12)	15	appeal_up(all, 80)
ginko	ユメワズライ		6240	5520	5520	480	ur	fever_start	ap_up(8)	vol_buff(236.25);mental_rate <= 10 ^ vol_buff(425.25)	15	appeal_up(all, 72)
ceras	十六夜セレーネ		4560	5280	7320	490	ur	fever_start	vol_up(348)	vol_lv <= 8 ^ vol_up(243); vol_lv >= 7 ^ score_buff(324); skill_count <= 2 ^ reset()	12	appeal_up(edel, 200)
ginko	16th Birthday		5760	5760	5760	480	ur	fever_start	ap_up(12);mental_rate <= 50 ^ ap_up(8)	score_buff(123.75);vol_buff(123.75);mental_rate <= 75 ^ ap_up(5*);mental_rate <= 25 ^ ap_up(5*)	10	appeal_up(ginko, 400)
kaho	Sayo-shigure		5040	6000	6120	490	ur	end	score_up(418.5)	total_skill_count >= 15 ^ score_up(935.55);total_skill_count <= 15 ^ score_buff(519.75)	14	appeal_up(all, 80)
ginko	Sayo-shigure		4860	6060	6240	490	ur	start	ap_up(12)	mental_rate <= 1 ^ ap_up(14);mental_rate >= 1 ^ ap_down(14*);mental_rate >= 1 ^ vol_buff(877.5);mental_rate >= 1 ^ splice();skill_count >= 2 ^ splice()	0	appeal_up(all, 80)
ginko	Bloom the smile, Bloom the dream!		4800	7440	5160	470	ur	fever_start	ap_up(8);mental_rate <= 50 ^ ap_up(8)	vol_buff(271.87)	10	appeal_up(cerise, 200)
sayaka	真実の舞踏会		5160	4080	7920	490	ur	fever_start	vol_up(170); mental_rate >= 50 ^ vol_up(238)	vol_lv <= 8 ^ vol_up(326); vol_lv >= 7 ^ score_buff(558); vol_lv >= 7 ^ vol_down(50*)	10	appeal_up(g103, 200); ap_reduce(all, 2)
kosuzu	アイマイメーデー		4200	6120	6960	480	ur	fever_start	vol_up(348)	vol_up(202); mental_rate >= 30 ^ mental_down(25*); mental_rate <= 25 ^ vol_up(435); mental_rate <= 25 ^ splice()	8	appeal_up(all, 80)
kosuzu	一生に夢が咲くように		6960	5460	4740	490	ur	start	vol_up(349)	vol_up(348);skill_count <= 1 ^ vol_up(627);skill_count >= 2 ^ splice()	18	appeal_up(all, 72)
kosuzu	はじまりの羽音		4440	5520	7560	460	ur	start	mental_down(90)	vol_up(390);mental_rate <= 10 ^ vol_up(860);skill_count <= 1 ^ splice()	18	appeal_up(dollche, 200)
sayaka	はじまりの羽音		4200	5400	7920	460	ur	start	ap_up(12)	skill_count <= 3 ^ vol_buff(30);skill_count >= 4 ^ score_buff(30);skill_count >= 4 ^ ap_up(4)	0	appeal_up(dollche, 200)
hime	はじまりの羽音		4440	6000	6960	470	ur	fever_start	mental_down(60)	mental_rate >= 1 ^ mental_down(30*);mental_rate <= 1 ^ score_buff(543.75)	10	appeal_up(all, 72)
hime	Echoes Beyond		5220	7560	4140	510	ur	fever_start	mental_down(100)	score_up(749.25); mental_rate <= 1 ^ score_buff(405); mental_rate <= 10 ^ ap_down(8*)	16	appeal_up(miracra, 200)`;const H=vt(Ct);vt(St);const kt=t=>`${t.key}-${t.series}`,Bt=["<=",">="],At=t=>t!=null,O=1e-6,ht=Object.freeze({1:1,2:1.1,3:1.2,4:1.3,5:1.4,6:1.5,7:1.6,8:1.7,9:1.8,10:2,11:2.2,12:2.4,13:2.6,14:3}),X=Object.freeze({vol_buff:{unit:.01,fixed:2},vol_up:{unit:1,fixed:0},vol_down:{unit:.01,fixed:2},score_up:{unit:.01,fixed:2},score_buff:{unit:.01,fixed:2},mental_up:{unit:5,fixed:0},mental_down:{unit:5,fixed:0},ap_up:{unit:1,fixed:0},ap_down:{unit:1,fixed:0},ap_change:{unit:1,fixed:0}}),Y=Object.freeze({ur:[[1,.01],[60,.5],[80,.7],[100,1],[110,1.1],[120,1.2]],dr:[[1,.01],[100,.7],[120,1],[130,1.1],[140,1.2]],dr2:[[1,.5],[100,.7],[120,1],[130,1.1],[140,1.2]],br:[[1,.01],[80,.7],[100,1],[110,1.1],[120,1.2]],lr:[[1,.0169],[100,.7],[120,1],[130,1.1],[140,1.2]],sr:[[1,.01],[40,.5],[60,.7],[80,1],[90,1.1],[100,1.2]],r:[[1,.01],[60,1]]}),at=Object.freeze({ur:[[1,.2],[60,.5],[80,.7],[100,1],[120,1]],dr:[[1,.2],[100,.7],[120,1],[140,1]],dr2:[[1,.5],[100,.7],[120,1],[140,1]],br:[[1,.2],[80,.7],[100,1],[120,1]],lr:[[1,.205],[100,.7],[120,1],[140,1]],sr:[[1,.2],[40,.5],[60,.7],[80,1],[100,1]],r:[[1,.2],[60,1]]}),Pt=Object.freeze({ur:[110,100,80,0],dr:[130,120,100,0],dr2:[130,120,100,0],br:[110,100,80,0],lr:[130,120,100,0],sr:[90,80,60,0],r:[70,60,40,0]}),Et=(t,e)=>Pt[t.rarity].findIndex(l=>e>l)||0,J=(t,e,l,a=Y[t.rarity][Y[t.rarity].length-1][0],u=1)=>{const o=t.rawSkillText.replace(/([\w\d_]+)\s*\^/g,(g,_)=>_==="cond_reflection102_kozue"?"":_==="cond_sparkly102_tsuzuri"?"total_skill_count >= 20 ^":_==="cond_oym102_megumi"?"total_skill_count >= 25 && skill_count <= 3 ^":g).replace(/([\w\d_]+)\(([\d.]*)(?<no_change>\*?)\)/g,(g,_,d,v)=>{if(v)return`${_}(${d})`;if(_==="dr_ap_up")return`ap_up(${(e-10)*Number(d)})`;if(_==="lr_tsuzuri")return"total_skill_count <= 12 ^ ap_up(20)";if(_==="lr_kozue")return"skill_count >= 10 ^ splice(); ap_up(3)";if(_==="lr_megumi")return"ap_up(2)";if(_==="gaia_kaho")switch(e){case 14:return"score_buff(202.5)";case 13:return"score_buff(175.5)";case 12:return"score_buff(162)";default:return""}if(_==="gaia_sayaka")return"skill_count >= 2 ^ ap_down(10)";if(_==="gaia_rurino")return"mental_down(100)";if(_==="galaxyexpress_edel_1")return"ap_down(3)";if(_==="galaxyexpress_edel_2")return"ap_down(5)";if(!d)return`${_}()`;const S=Math.floor(Number(d)*ht[e]/3/X[_].unit+O)*X[_].unit;return`${_}(${S.toFixed(X[_].fixed)})`}),i=t.rawCenterSkillText.replace(/([\w_]+)\(([\d.]+)(?<no_change>\*?)\)/g,(g,_,d,v)=>{if(v)return`${_}(${d})`;const S=Math.floor(Number(d)*ht[l]/3/X[_].unit+O)*X[_].unit;return`${_}(${S.toFixed(X[_].fixed)})`});let p=t.smile,r=t.pure,m=t.cool;const c=Y[t.rarity];if(c){p/=c[c.length-1][1]||1,r/=c[c.length-1][1]||1,m/=c[c.length-1][1]||1;const g=c.findIndex(([d])=>d>=a),_=g-1;if(_!==-1){const[d,v]=Y[t.rarity][_],[S,I]=Y[t.rarity][g];p=Math.ceil(p*(v+(I-v)*(a-d)/(S-d))-O),r=Math.ceil(r*(v+(I-v)*(a-d)/(S-d))-O),m=Math.ceil(m*(v+(I-v)*(a-d)/(S-d))-O)}else{const[d,v]=Y[t.rarity][g];p=Math.ceil(p*v-O),r=Math.ceil(r*v-O),m=Math.ceil(m*v-O)}}let b=t.mental;const $=at[t.rarity];if($){b/=$[$.length-1][1]||1;const g=$.findIndex(([d])=>d>=a),_=g-1;if(_!==-1){const[d,v]=at[t.rarity][_],[S,I]=at[t.rarity][g];b=Math.ceil(b*(v+(I-v)*(a-d)/(S-d))-O)}else{const[d,v]=at[t.rarity][g];b=Math.ceil(b*v-O)}}const F=t.ap+Et(t,a);return{...t,smile:p,pure:r,cool:m,mental:b,ap:F,name:t.key,skill:o,centerSkillCondition:t.centerSkillCondition,centerSkill:i,lbCount:u}};J(H[0],14,14),J(H[6],14,14),J(H[5],14,14),J(H[7],14,14),J(H[4],14,14),J(H[1],14,14);const Rt=t=>{if(!t)return;const e=Bt.find(l=>t?.includes(l));if(e){const[l,a]=t.split(e).map(u=>u.trim());return!l||!a?void 0:{a:l,operator:e,b:Number(a)}}else return{a:t.trim(),operator:void 0,b:void 0}},bt=t=>t?t.split("&&").map(l=>l.trim()).map(l=>Rt(l)).filter(At):[],Tt=(t,e)=>{switch(t){case"cooltime_reduce":case"cooltime_escalate":case"ap_bonus_up":case"voltage_bonus_up":return{target:"all",amount:Number(e[0])};default:return{target:e[0],amount:Number(e[1])}}},gt=t=>{const e=[],l=[],a=[],u=t.skill.split(";").map(o=>o.trim());for(const o of u){if(!o)continue;const[i,p]=o.split("^").map(F=>F.trim()),r=p?i:void 0,m=p||i,[,c,b]=m.match(/^(\w+)\((.*)\)$/)||[],$={type:c,value:b?Number(b):void 0,conditions:bt(r)};e.push($)}if(t.centerSkill){const o=t.centerSkill.split(";").map(i=>i.trim());for(const i of o){const[p,r]=i.split("^").map(g=>g.trim()),m=r?p:void 0,c=r||p,[,b,$]=c.match(/^(\w+)\((.*)\)$/)||[],F={type:b,value:$?Number($):void 0,conditions:bt(m)};l.push(F)}}if(t.centerAbilityText){const o=t.centerAbilityText.split(";").map(i=>i.trim());for(const i of o){const[,p,r]=i.match(/^(\w+)\((.*)\)$/)||[],m=r?r.split(",").map(b=>b.trim()):[],c={type:p,value:Tt(p,m)};a.push(c)}}return{...t,skills:e,centerSkills:l,centerAbilities:a}},Ft=(t,e,l)=>{const a=l?.centerAbilities.find(o=>o.type==="appeal_up"),u=t.reduce((o,i)=>{const p=a?nt(i.name,a?.value.target):!1,r=Math.ceil(i.smile*(p?(100+(a?.value.amount||0))/100:1)),m=Math.ceil(i.pure*(p?(100+(a?.value.amount||0))/100:1)),c=Math.ceil(i.cool*(p?(100+(a?.value.amount||0))/100:1));return{smile:o.smile+r,pure:o.pure+m,cool:o.cool+c}},{smile:0,pure:0,cool:0});return u.smile=Math.round(u.smile/(e==="smile"?1:10)),u.pure=Math.round(u.pure/(e==="pure"?1:10)),u.cool=Math.round(u.cool/(e==="cool"?1:10)),u.smile+u.pure+u.cool},Ot=t=>t.some(e=>e.skills.some(l=>l.type==="vol_up"))&&t.some(e=>e.skills.some(l=>l.type==="score_up")),It=t=>t.some(e=>e.skills.some(l=>l.type==="score_buff")),Vt=({mentalMaxAbility:t,convertedMembers:e,friendMember:l,mentalSum:a})=>t?.value?t.value.amount*(e.filter(u=>t?.value.target&&nt(u.name,t.value.target)).length+(l&&nt(l.name,t.value.target)?1:0)):a,_t=t=>50+Math.floor(t/20),pt=t=>Math.floor((50+t/20)*.4),Nt=(t,e,l,a)=>{if(a<=l)return null;const u=Math.floor((a-1)/t);let o=null;for(let i=0;i<=u;i++){const p=Math.max(0,Math.ceil((l-t*i)/e)),r=Math.ceil((a-t*i)/e)-1;if(p<=r){const m=i+p;(!o||m<o.sum)&&(o={x:i,y:p,sum:m})}}return o},rt=({currentMental:t,mentalMax:e})=>{const l=Nt(_t(e),pt(e),t-e/100,t);return l?{normal:l.x,hold:l.y}:void 0},jt=(t,e)=>{const l=new Map;return t.forEach(a=>{const u=a.key!=="other"?a.key:a.otherName;l.set(u,(l.get(u)||0)+1)}),l.values().every(a=>a<=e)},Gt=t=>t<=2100?Math.floor((-5+Math.sqrt(25+20*t))/10):Math.floor(20+(t-2100)/200),yt=(t,e,l)=>(1+t/100)*(1+e*(l?2:1)/10),st=t=>t<10?1:t<20?1.1:t<30?1.2:t<40?1.3:t<50?1.4:1.5;class Ut{_point=0;_lv=0;get point(){return this._point}set point(e){this._point=e,this._lv=Gt(e)}get lv(){return this._lv}}const Dt=({notes:t,convertedMembers:e,friendMember:l,center:a,appealSum:u,mentalSum:o,masteryLevel:i,playStyle:p="perfect",noLog:r=!1,noDamagedFormation:m=!1,centerMember:c=e.find(b=>b.name===a)})=>{const b=c?.centerSkillCondition,$=c?.centerSkills||[],F=l?.centerSkillCondition,g=l?.centerSkills||[],_=c?.centerAbilities||[],d=_.filter(n=>n.type==="cooltime_reduce"||n.type==="cooltime_escalate"),v=_.filter(n=>n.type==="ap_reduce"||n.type==="ap_escalate"),S=_.find(n=>n.type==="ap_bonus_up"),I=_.find(n=>n.type==="voltage_bonus_up"),tt=_.find(n=>n.type==="mental_max_change"),et=S?.value.amount||0,lt=I?.value.amount||0,y=Vt({mentalMaxAbility:tt,convertedMembers:e,friendMember:l,mentalSum:o}),N=5+d.reduce((n,s)=>n+(s.type==="cooltime_reduce"?-s.value.amount:s.value.amount),0),ct=v.reduce((n,s)=>n+(s.type==="ap_reduce"?s.value.amount:-s.value.amount),0),V=e.slice();let D=N,C=0,k=y,j=0;const M=new Ut,Q=[0],q=[0];let G=0,B=0;const R=xt(t);let P=0,ot=0;const w=new WeakMap,z=60/R;let A,f="";const ft=rt({currentMental:k,mentalMax:y});let x=rt({currentMental:k,mentalMax:y});const U=(n,s,T)=>{const ut=M.lv,te=k*100/y;t:for(const h of s){for(const Z of h.conditions){const{a:W,operator:ee,b:dt}=Z;if(dt!=null){let L=0;switch(W){case"skill_count":L=w.get(n)||0;break;case"total_skill_count":L=ot;break;case"vol_lv":L=ut*(T?2:1);break;case"mental_rate":L=te;break;default:throw new Error(`条件式が不正です: ${W} ${n.name} ${n.key}`)}switch(ee){case"<=":if(!(L<=dt))continue t;break;case">=":if(!(L>=dt))continue t;break}}else switch(W){case"in_fever":if(!T)continue t;break;default:throw new Error(`条件式が不正です: ${W} ${n.series}`)}}switch(h.type){case"vol_buff":q[0]=(q[0]||0)+(h.value||0),r||(f+=`${E[n.name]} vol_buff: +${h.value}
`);break;case"vol_up":{const Z=(q[0]??0)+lt;q[0]=0,M.point+=Math.ceil((h.value||0)*(1+Z/100)),r||(f+=`${E[n.name]} vol_up: +${Math.ceil((h.value||0)*(1+Z/100))}
`,f+=`now voltagePoint: ${M.point}
`);break}case"vol_down":{M.point-=h.value||0,M.point<0&&(M.point=0),r||(f+=`${E[n.name]} vol_down: -${h.value||0}
`);break}case"score_buff":Q[0]=(Q[0]||0)+(h.value||0),r||(f+=`${E[n.name]} score_buff: +${h.value}
`);break;case"score_up":{const Z=Q[0]??0;Q[0]=0;const W=(h.value||0)/100*(1+Z/100)*yt(i,M.lv,T);j+=Math.ceil(u*W),r||(f+=`${E[n.name]} score_up: +${Math.ceil(u*W)}
`);break}case"mental_up":k+=Math.ceil((h.value||0)/100*y),r||(f+=`${E[n.name]} mental_up: +${Math.ceil((h.value||0)/100*y)}
`),p==="desperate1"&&(x=rt({currentMental:k,mentalMax:y}));break;case"mental_down":k-=Math.ceil((h.value||0)/100*y),r||(f+=`${E[n.name]} mental_down: -${Math.ceil((h.value||0)/100*y)}
`),k<=0&&(k=1),p==="desperate1"&&(x=rt({currentMental:k,mentalMax:y}));break;case"ap_up":C+=Math.ceil((h.value||0)*st(P)*(100+et)*100),r||(f+=`${E[n.name]} ap_up: +${(h.value||0)*st(P)*1+et/100}
`);break;case"ap_down":C-=(h.value||0)*1e4,C<0&&(C=0),r||(f+=`${E[n.name]} ap_down: -${h.value||0}
`);break;case"ap_change":C=(h.value||0)*1e4,r||(f+=`${E[n.name]} ap_change: ${h.value||0}
`);break;case"reset":G=V.length-1,r||(f+=`${E[n.name]} reset
`);break;case"splice":V.splice(V.indexOf(n),1),G--,r||(f+=`${E[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${h.type}`)}}};c&&b==="start"&&U(c,$,!1),l&&F==="start"&&U(l,g,!1);const K=n=>{if(V.length===0)return!1;const s=V[G];if(!s)throw new Error("メンバーが見つかりません");const T=Math.max(s.ap-ct,0);return T*1e4<=C&&D<=0?(C-=T*1e4,w.set(s,(w.get(s)||0)+1),ot++,U(s,s.skills,n),G=V.length-1===G?0:G+1,D+=N,!0):!1};for(let n=0;n<t.length;n++){const s=t[n];if(A=t[n-1],!s)throw new Error("noteが見つかりません");for(D-=s.time-B,B=s.time;K(A?.fever||!1););if(D=Math.max(0,D),s.fever&&!A?.fever&&(r||(f+=`FEVER START
`),c&&b==="fever_start"&&U(c,$,!0),l&&F==="fever_start"&&U(l,g,!0)),!s.fever&&A?.fever&&(r||(f+=`FEVER END
`)),p==="desperate1"&&!x)return r||(f+=`1%以下達成不可
`),{score:j,log:f};for(let T=0;T<s.normalCount+s.slideCount;T++){if(p==="desperate"&&k*10>y){if(T<s.normalCount?k-=_t(y):k-=pt(y),r||(f+=`miss, apPoint: ${C}, mental: ${k}, vol_lv: ${M.lv*(s.fever?2:1)}
`),P=0,k<=0)return r||(f+=`MENTAL BREAK
`),{score:j,log:f};continue}if(p==="desperate1"&&x){if(T<s.normalCount&&x.normal>0){x.normal--,k-=_t(y),P=0,r||(f+=`miss, apPoint: ${C}, mental: ${k}, vol_lv: ${M.lv*(s.fever?2:1)}
`);continue}else if(T>=s.normalCount&&x.hold>0){x.hold--,k-=pt(y),P=0,r||(f+=`miss, apPoint: ${C}, mental: ${k}, vol_lv: ${M.lv*(s.fever?2:1)}
`);continue}}P++,C+=Math.ceil(z*st(P)*1e4),K(s.fever);const ut=Math.ceil(u/R*35*yt(i,M.lv,s.fever));if(j+=ut,r||(f+=`combo: ${P}, score: ${j} (+${ut}), apPoint: ${C}, mental: ${k}, vol_lv: ${M.lv*(s.fever?2:1)}
`),p==="perfect"&&m&&k<y)return r||(f+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:j,log:f}}}return c&&b==="end"&&U(c,$,!1),l&&F==="end"&&U(l,g,!1),{score:j,log:f,desperate1ProgramInitial:p==="desperate1"?ft:void 0}};function*qt(t,e,l,a){let u=0n;if(e===0)yield[],u++;else if(e===1){for(const o of t)if(u>=l&&u<a&&(yield[o]),u++,u>=a)return}else for(let o=0;o<t.length-e+1;o++){const i=t.slice(o+1);for(const p of wt(i,e-1))if(u>=l&&u<a&&(yield[t[o],...p]),u++,u>=a)return}}function*wt(t,e){if(e===0)yield[];else if(e===1)for(const l of t)yield[l];else for(let l=0;l<t.length-e+1;l++){const a=t.slice(l+1);for(const u of wt(a,e-1))yield[t[l],...u]}}function*zt(t){if(t.length===1)yield t;else for(let e=0;e<t.length;e++){const l=t.slice(0,e).concat(t.slice(e+1));for(const a of zt(l))yield[t[e],...a]}}const it=t=>{let e=1;for(let l=1;l<=t;l++)e*=l;return e},Kt=(t,e)=>it(t)/(it(e)*it(t-e)),Wt=t=>{let e=1n;for(let l=1n;l<=t;l++)e*=l;return e},Ht=(t,e)=>{let l=1n;for(let a=0n;a<e;a++)l*=t-a;return l},Xt=(t,e)=>Ht(t,e)/Wt(e),Yt=1e-6,Jt=(t,e)=>e.reduce((a,u)=>{switch(t[u]){case 1:return a;case 2:return a+20;case 3:return a+27.5;case 4:return a+35;case 5:return a+42.5;case 6:return a+50;case 7:return a+55;case 8:return a+60;case 9:return a+65;case 10:return a+70}return a},100)/100,Qt=t=>Math.round(66/(7*t+10)*100+Yt)/100,Zt=t=>t!=="kozue"&&t!=="tsuzuri"&&t!=="megumi",Lt=t=>t===void 0?1:1+t*.1;self.onmessage=t=>{const{requiredMembers:e,optionalMembers:l,friendMembers:a,notes:u,center:o,attribute:i,masteryLevel:p,playStyle:r,formationRule:m,includingCenterOnly:c,includeFriendOnlyCenter:b,noLog:$,noDamagedFormation:F,scoreComparisonRule:g,requireVolUpAndScoreUp:_,requireScoreBuff:d,seasonFanLvs:v,singers:S,batchNum:I,batchIndex:tt}=t.data;let et=0,lt=0;const y=6-e.length,N=new WeakMap,ct=Kt(l.length,y);let V=0;const D=Xt(BigInt(l.length),BigInt(y)),C=D/BigInt(I),k=BigInt(tt)*C,j=tt===I-1?D:BigInt(tt+1)*C,M=a.filter(B=>b?B.key===o:!0).filter(B=>B.rarity!=="dr"&&B.rarity!=="dr2").map(B=>{if(N.has(B))return N.get(B);const R=gt(B);return N.set(B,R),R});M.push(void 0);const Q=Qt(S.filter(Zt).length)*Jt(v,S);let q=0,G=0;t:for(const B of qt(l,y,k,j)){V%50===0&&self.postMessage({message:"progress",data:{progress:V/ct*100}}),V++;const R=[...e,...B];if(c&&!R.some(w=>w.key===o))continue;switch(m){case"current":{if(new Set(R.map(z=>z.key!=="other"?z.key:z.otherName)).size!==6)continue t;break}case"new_grand_prix":{if(R.filter(z=>z.rarity==="dr"||z.rarity==="dr2").length>1||!jt(R,2))continue t;break}}const P=R.map(w=>{if(N.has(w))return N.get(w);const z=gt(w);return N.set(w,z),z});if(_&&!Ot(P)||d&&!It(P))continue;const ot=R.reduce((w,z)=>w+z.mental,0);for(const w of zt(P))try{let z=!1;for(const A of M){if(A&&w.some(x=>kt(x)===kt(A))||z&&!A)continue;const f=w.filter(x=>x.name===o);f.length===0&&f.push(void 0);const ft=P.concat(A?[A]:[]);for(const x of f){const U=Ft(ft,i,x),K=Dt({notes:u,convertedMembers:w,friendMember:A?.key===o?A:void 0,center:o,appealSum:U,mentalSum:ot+(A?.mental||0),masteryLevel:p,playStyle:r,noLog:$,noDamagedFormation:F,centerMember:x});if(q%1e4===0){const s=performance.now();console.log(`timeForPerformance: ${s-G}ms`),G=s}q++;const n=Math.ceil(K.score*Q*Lt(x?.lbCount));z=!0,(g==="score"&&K.score>et||g==="grandPrixPt"&&n>lt)&&(et=K.score,lt=n,self.postMessage({message:"calcScore",data:{...K,liveGrandPrixPt:lt,members:w,friendMember:A,centerMember:x}}))}}}catch(z){console.error(z)}}self.postMessage({message:"end"})}})();
