import{c as he,m as g,a as ue,b as $e,s as L,d as P,e as _e,u as Ce,f as ve,g as ne,_ as we,h as Me,i as Ve,j as Ue,k as xe,l as Se,p as ge,n as Te}from"./BxZzD8_0.js";import{f as me,r as h,g as O,h as ee,i as ye,o as V,w as Ae,a as e,j as m,k as M,v as x,l as s,c as S,F as G,m as J,n as Ne,t as $,p as ae,q as se,d as K,u as Ee,b as De,s as pe,x as Be}from"./BIWDJk_7.js";const Re=y=>y<=2100?Math.floor((-5+Math.sqrt(25+20*y))/10):Math.floor(20+(y-2100)/200),fe=(y,U,T)=>(1+y/100)*(1+U*(T?2:1)/10),oe=y=>y<10?1:y<20?1.1:y<30?1.2:y<40?1.3:y<50?1.4:1.5,Fe=({notes:y,convertedMembers:U,center:T,appealSum:A,mentalSum:f,masteryLevel:d,playStyle:k="perfect",noLog:i=!1,noDamagedFormation:C=!1})=>{const r=U.find(a=>a.name===T),N=r?.centerSkillCondition,F=r?.centerSkills||[],w=r?.centerAbilities||[],q=w.find(a=>a.type==="cooltime_reduce"),b=w.find(a=>a.type==="ap_reduce"),n=5-Number(q?.value.amount||0),p=Number(b?.value.amount||0),E=U.slice();let z=n,c=0,t=f,D=0;const l={_point:0,_lv:0,get point(){return this._point},set point(a){this._point=a,this._lv=Re(a)},get lv(){return this._lv}},B=[0],o=[0];let H=0,ie=0;const re=he(y);let W=0,ce=0;const te=new WeakMap,ke=60/re;let Q,_="";const X=(a,u,R)=>{const Y=l.lv,be=t*100/f;e:for(const v of u){if(v.condition){const[j,Z,le]=v.condition;let I=0;switch(j){case"skill_count":I=te.get(a)||0;break;case"total_skill_count":I=ce;break;case"vol_lv":I=Y*(R?2:1);break;case"mental_rate":I=be;break;default:throw new Error(`条件式が不正です: ${j}`)}if(le===void 0)throw new Error(`条件式が不正です: ${j}`);switch(Z){case"<=":if(!(I<=le))continue e;break;case">=":if(!(I>=le))continue e;break}}switch(v.type){case"vol_buff":o[0]=(o[0]||0)+(v.value||0),i||(_+=`${g[a.name]} vol_buff: +${v.value}
`);break;case"vol_up":{const j=o[0]??0;o[0]=0,l.point+=Math.ceil((v.value||0)*(1+j/100)),i||(_+=`${g[a.name]} vol_up: +${Math.ceil((v.value||0)*(1+j/100))}
`,_+=`now voltagePoint: ${l.point}
`);break}case"vol_down":l.point-=v.value||0,l.point<0&&(l.point=0),i||(_+=`${g[a.name]} vol_down: -${v.value||0}
`);break;case"score_buff":B[0]=(B[0]||0)+(v.value||0),i||(_+=`${g[a.name]} score_buff: +${v.value}
`);break;case"score_up":{const j=B[0]??0;B[0]=0;const Z=(v.value||0)/100*(1+j/100)*fe(d,l.lv,R);D+=Math.ceil(A*Z),i||(_+=`${g[a.name]} score_up: +${Math.ceil(A*Z)}
`);break}case"mental_up":t+=Math.ceil((v.value||0)/100*f),i||(_+=`${g[a.name]} mental_up: +${Math.ceil((v.value||0)/100*f)}
`);break;case"mental_down":t-=Math.ceil((v.value||0)/100*f),i||(_+=`${g[a.name]} mental_down: -${Math.ceil((v.value||0)/100*f)}
`),t<=0&&(t=1);break;case"ap_up":c+=Math.ceil((v.value||0)*oe(W)*1e4),i||(_+=`${g[a.name]} ap_up: +${(v.value||0)*oe(W)}
`);break;case"ap_down":c-=(v.value||0)*1e4,i||(_+=`${g[a.name]} ap_down: -${v.value||0}
`);break;case"reset":H=E.length-1,i||(_+=`${g[a.name]} reset
`);break;case"splice":E.splice(E.indexOf(a),1),H--,i||(_+=`${g[a.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};r&&N==="start"&&X(r,F,!1);const de=a=>{if(E.length===0)return!1;const u=E[H];if(!u)throw new Error("メンバーが見つかりません");const R=Math.max(u.ap-p,0);return R*1e4<=c&&z<=0?(c-=R*1e4,te.set(u,(te.get(u)||0)+1),ce++,X(u,u.skills,a),H=E.length-1===H?0:H+1,z+=n,!0):!1};for(let a=0;a<y.length;a++){const u=y[a];if(Q=y[a-1],!u)throw new Error("noteが見つかりません");for(z-=u.time-ie,ie=u.time;de(Q?.fever||!1););z=Math.max(0,z),r&&u.fever&&!Q?.fever&&N==="fever_start"&&(i||(_+=`FEVER START
`),X(r,F,!0)),!u.fever&&Q?.fever&&(i||(_+=`FEVER END
`));for(let R=0;R<u.normalCount+u.slideCount;R++){if(k==="desperate"&&t*10>f){R<u.normalCount?t-=Math.ceil(f/15):t-=Math.ceil(f*2/75),i||(_+=`miss, apPoint: ${c}, mental: ${t}, vol_lv: ${l.lv*(u.fever?2:1)}
`);continue}W++,c+=Math.ceil(ke*oe(W)*1e4),de(u.fever);const Y=Math.ceil(A/re*30*fe(d,l.lv,u.fever));if(D+=Y,i||(_+=`combo: ${W}, score: ${D} (+${Y}), apPoint: ${c}, mental: ${t}, vol_lv: ${l.lv*(u.fever?2:1)}
`),k==="perfect"&&C&&t<f)return i||(_+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:D,log:_}}}return r&&N==="end"&&X(r,F,!1),{score:D,log:_}},je={class:"my-2"},Oe={class:"input-group mb-3"},Pe=["value"],qe={class:"card my-2"},ze={class:"card-body"},He={key:0,class:"my-2"},Ie={class:"alert alert-info"},We={class:"card my-2"},Ge={class:"card-body"},Je={key:0,class:"my-2"},Ke={class:"alert alert-info"},Qe={class:"card my-2"},Xe={class:"card-body"},Ye={key:0,class:"my-2"},Ze={class:"alert alert-info"},Le=me({__name:"MdCardSelect",props:{onClose:{}},setup(y){const U=h(""),T=b=>`[${b.series}] ${b.key!=="other"?ve[b.key]:b.otherName}`,A=O(()=>ue.filter(b=>T(b).includes(U.value))),f=h(0),d=O(()=>ue[f.value]),k=O(()=>d.value?$e(d.value,C.value,r.value):null),i=O(()=>k.value?L(P(k.value).skills):""),C=h(14),r=h(14),N=O(()=>k.value?L(P(k.value).centerSkills):""),F=O(()=>k.value?_e(P(k.value).centerAbilities):""),w=Ce("skillCache",{}),q=b=>`${b.key}-${b.series}`;return ee(d,()=>{d.value&&(C.value=w.value[q(d.value)]?.skillLevel||14,r.value=w.value[q(d.value)]?.centerSkillLevel||14)}),ee([C,r],()=>{d.value&&(w.value[q(d.value)]={centerSkillLevel:r.value,skillLevel:C.value})}),(b,n)=>(V(),ye(we,{"on-close":b.onClose},{default:Ae(()=>[e("div",je,[e("div",Oe,[n[5]||(n[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),m(e("input",{"onUpdate:modelValue":n[0]||(n[0]=p=>M(U)?U.value=p:null),type:"text",class:"form-control"},null,512),[[x,s(U)]])]),m(e("select",{"onUpdate:modelValue":n[1]||(n[1]=p=>M(f)?f.value=p:null),class:"form-select"},[(V(!0),S(G,null,J(s(A),(p,E)=>(V(),S("option",{key:`${p.key}-${p.series}`,class:Ne(["card",{"bg-primary":s(d)?.key===p.key}]),value:E}," ["+$(p.series)+"] "+$(p.key!=="other"?s(ve)[p.key]:p.otherName),11,Pe))),128))],512),[[ae,s(f)]])]),e("div",qe,[n[7]||(n[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",ze,[e("div",null,[n[6]||(n[6]=K(" スキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":n[2]||(n[2]=p=>M(C)?C.value=p:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(C)]])]),s(d)?(V(),S("div",He,[e("div",Ie,$(s(i)),1)])):se("",!0)])]),e("div",We,[n[9]||(n[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ge,[n[8]||(n[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":n[3]||(n[3]=p=>M(r)?r.value=p:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(r)]]),s(d)?(V(),S("div",Je,[e("div",Ke," 【"+$(s(ne)(s(d).centerSkillCondition))+"】"+$(s(N)),1)])):se("",!0)])]),e("div",Qe,[n[10]||(n[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Xe,[s(d)?(V(),S("div",Ye,[e("div",Ze,$(s(F)),1)])):se("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:n[4]||(n[4]=p=>b.onClose(s(k)))}," 選択 ")]),_:1},8,["on-close"]))}}),et=Object.assign(Le,{__name:"MdCardSelect"}),tt={class:"container-md"},lt={class:"card my-2"},st={class:"card-body"},ot={class:"card-header"},nt={class:"card-body"},at=["onClick"],it={class:"row my-2 align-items-center justify-content-start"},rt={class:"col-auto"},ct=["onUpdate:modelValue"],dt=["value"],ut={class:"row my-2 align-items-center justify-content-start"},vt={class:"col-auto"},pt=["onUpdate:modelValue"],ft={class:"row row-gap-1"},_t={class:"col-md"},mt=["onUpdate:modelValue"],yt={class:"col-md"},kt=["onUpdate:modelValue"],bt={class:"col-md"},ht=["onUpdate:modelValue"],$t={class:"col-md"},Ct={class:"input-group"},wt=["onUpdate:modelValue"],Mt={class:"my-2"},Vt={class:"row"},Ut={class:"col-sm"},xt=["onUpdate:modelValue"],St={class:"col-sm"},gt={class:"alert alert-secondary"},Tt={class:"my-2"},At={class:"row"},Nt={class:"col-sm"},Et=["onUpdate:modelValue"],Dt=["value"],Bt=["onUpdate:modelValue"],Rt={class:"col-sm"},Ft={class:"alert alert-secondary"},jt={class:"my-2"},Ot={class:"row"},Pt={class:"col-sm"},qt=["onUpdate:modelValue"],zt={class:"col-sm"},Ht={class:"alert alert-secondary"},It={class:"row"},Wt={class:"col"},Gt={class:"form-label"},Jt={class:"col"},Kt={class:"form-label"},Qt={class:"card my-2"},Xt={class:"card-body"},Yt={class:"mb-2"},Zt={class:"row"},Lt={class:"col-auto"},el={class:"col-auto"},tl={class:"my-2"},ll={class:"my-2"},nl=me({__name:"index",setup(y){const U=h(""),T=h(""),A=h(0),f=h(0),d=h("smile"),k=h("perfect"),i=h(80820),C=h(2960),r=h(50),N=h(""),F=h(0),w=h(Te),q=()=>{const c=w.value.map(P),t=ge(U.value,A.value),{score:D,log:l}=Fe({notes:t,convertedMembers:c,center:T.value,appealSum:i.value,mentalSum:C.value,masteryLevel:r.value,playStyle:k.value});F.value=D,N.value=l},b=O(()=>w.value.reduce((c,t)=>c+t.mental,0)),n=O(()=>{const c=w.value.map(P);return Me(c,d.value,T.value)});ee(b,()=>{w.value.every(c=>c.mental)&&(C.value=b.value)}),ee(n,()=>{w.value.every(c=>c.smile&&c.pure&&c.cool)&&(i.value=n.value)}),Ee({title:"スクショウ計算機"});const{modals:p,openModal:E}=Ve(),z=async c=>{const t=await E(et);t&&w.value.splice(w.value.indexOf(c),1,t)};return(c,t)=>{const D=Ue;return V(),S("div",tt,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),De(D,{"note-text":s(U),"onUpdate:noteText":t[0]||(t[0]=l=>M(U)?U.value=l:null),center:s(T),"onUpdate:center":t[1]||(t[1]=l=>M(T)?T.value=l:null),offset:s(A),"onUpdate:offset":t[2]||(t[2]=l=>M(A)?A.value=l:null),"combo-offset":s(f),"onUpdate:comboOffset":t[3]||(t[3]=l=>M(f)?f.value=l:null),attribute:s(d),"onUpdate:attribute":t[4]||(t[4]=l=>M(d)?d.value=l:null),"mastery-level":s(r),"onUpdate:masteryLevel":t[5]||(t[5]=l=>M(r)?r.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",lt,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",st,[(V(!0),S(G,null,J(s(w),(l,B)=>(V(),S("div",{key:B,class:"card m-3"},[e("div",ot,$(B+1)+"人目 ",1),e("div",nt,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>z(l)}," カードを選択して入力 ",8,at)]),e("div",it,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",rt,[m(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(V(!0),S(G,null,J(s(xe),o=>(V(),S("option",{key:o,value:o},$(s(g)[o]),9,dt))),128))],8,ct),[[ae,l.name]])])]),e("div",ut,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",vt,[m(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,pt),[[x,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",ft,[e("div",_t,[m(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,mt),[[x,l.smile,void 0,{number:!0}]])]),e("div",yt,[m(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,kt),[[x,l.pure,void 0,{number:!0}]])]),e("div",bt,[m(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,ht),[[x,l.cool,void 0,{number:!0}]])]),e("div",$t,[e("div",Ct,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),m(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,wt),[[x,l.mental,void 0,{number:!0}]])])])]),e("div",Mt,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Vt,[e("div",Ut,[m(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,xt),[[x,l.skill]])]),e("div",St,[e("div",gt,$(s(L)(s(P)(l).skills)),1)])])]),e("div",Tt,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",At,[e("div",Nt,[m(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(V(!0),S(G,null,J(s(Se),o=>(V(),S("option",{key:o,value:o},$(s(ne)(o)),9,Dt))),128))],8,Et),[[ae,l.centerSkillCondition]]),m(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Bt),[[x,l.centerSkill]])]),e("div",Rt,[e("div",Ft," 【"+$(s(ne)(l.centerSkillCondition))+"】"+$(s(L)(s(P)(l).centerSkills)),1)])])]),e("div",jt,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Ot,[e("div",Pt,[m(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,qt),[[x,l.centerAbilityText]])]),e("div",zt,[e("div",Ht,$(s(_e)(s(P)(l).centerAbilities)),1)])])])])]))),128)),e("div",It,[e("div",Wt,[e("label",Gt,"総合アピール値（"+$(s(n))+"）：",1),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>M(i)?i.value=l:null),type:"number",class:"form-control"},null,512),[[x,s(i),void 0,{number:!0}]])]),e("div",Jt,[e("label",Kt,"総合メンタル値（"+$(s(b))+"）：",1),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>M(C)?C.value=l:null),type:"number",class:"form-control"},null,512),[[x,s(C),void 0,{number:!0}]])])])])]),e("div",Qt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Xt,[e("div",Yt,[t[21]||(t[21]=K(" プレイスタイル： ",-1)),e("div",Zt,[e("div",Lt,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>M(k)?k.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[pe,s(k)]]),t[19]||(t[19]=K(" 渾身 ",-1))])]),e("div",el,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>M(k)?k.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[pe,s(k)]]),t[20]||(t[20]=K(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:q}," 計算 "),e("div",tl," 計算結果: "+$(s(F)),1),e("div",ll,[t[22]||(t[22]=K(" ログ： ",-1)),m(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>M(N)?N.value=l:null),rows:"6",class:"form-control"},null,512),[[x,s(N)]])])])]),(V(!0),S(G,null,J(s(p),(l,B)=>(V(),ye(Be(l.component),{key:`modal-${B}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{nl as default};
