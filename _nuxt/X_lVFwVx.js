import{c as ke,m as N,a as ue,b as be,s as Y,d as F,e as _e,u as $e,f as ve,g as se,h as he,i as Ce,_ as Me,j as we,k as Ve,p as Ue,l as ge}from"./DXJlEXv5.js";import{d as ae,y as T,z as w,A as e,F as Se,G as xe,_ as Te,r as $,k as R,H as Z,I as me,D as Ae,J as m,K as V,L as x,M as o,N as H,O as q,P as Ne,B as M,Q as ne,R as le,E as J,x as Le,C as Ee,S as pe,T as De}from"./DDsgP9r6.js";const Be=r=>r<=2100?Math.floor((-5+Math.sqrt(25+20*r))/10):Math.floor(20+(r-2100)/200),fe=(r,y,k)=>(1+r/100)*(1+y*(k?2:1)/10),oe=r=>r<10?1:r<20?1.1:r<30?1.2:r<40?1.3:r<50?1.4:1.5,Oe=({notes:r,convertedMembers:y,center:k,appealSum:U,mentalSum:v,masteryLevel:u,comboOffset:f,playStyle:A="perfect"})=>{const d=y.find(n=>n.name===k),h=d?.centerSkillCondition,L=d?.centerSkills||[],P=d?.centerAbilities||[],g=P.find(n=>n.type==="cooltime_reduce"),j=P.find(n=>n.type==="ap_reduce"),_=5-Number(g?.value[0]||0),a=Number(j?.value[1]||0),c=y.slice();let E=_,D=0,i=v,t=0;const S={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=Be(n)},get lv(){return this._lv}},l=[0],B=[0];let s=0,ie=0;const re=ke(r);let z=0,ce=0;const ee=new WeakMap,ye=60/(re-(f||0));let K,b="";const Q=(n,C)=>{const G=S.lv,W=i*100/v;e:for(const p of C){if(p.condition){const[O,X,te]=p.condition;let I=0;switch(O){case"skill_count":I=ee.get(n)||0;break;case"total_skill_count":I=ce;break;case"vol_lv":I=G;break;case"mental_rate":I=W;break;default:throw new Error(`条件式が不正です: ${O}`)}if(te===void 0)throw new Error(`条件式が不正です: ${O}`);switch(X){case"<=":if(!(I<=te))continue e;break;case">=":if(!(I>=te))continue e;break}}switch(p.type){case"vol_buff":B[0]=(B[0]||0)+(p.value||0),b+=`${N[n.name]} vol_buff: +${p.value}
`;break;case"vol_up":{const O=B[0]??0;B[0]=0,S.point+=Math.ceil((p.value||0)*(1+O/100)),b+=`${N[n.name]} vol_up: +${Math.ceil((p.value||0)*(1+O/100))}
`,b+=`now voltagePoint: ${S.point}
`;break}case"vol_down":S.point-=p.value||0,S.point<0&&(S.point=0),b+=`${N[n.name]} vol_down: -${p.value||0}
`;break;case"score_buff":l[0]=(l[0]||0)+(p.value||0),b+=`${N[n.name]} score_buff: +${p.value}
`;break;case"score_up":{const O=l[0]??0;l[0]=0;const X=(p.value||0)/100*(1+O/100)*fe(u,S.lv,K?.fever||!1);t+=Math.ceil(U*X),b+=`${N[n.name]} score_up: +${Math.ceil(U*X)}
`;break}case"mental_up":i+=Math.ceil((p.value||0)/100*v),b+=`${N[n.name]} mental_up: +${Math.ceil((p.value||0)/100*v)}
`;break;case"mental_down":i-=Math.ceil((p.value||0)/100*v),b+=`${N[n.name]} mental_down: -${Math.ceil((p.value||0)/100*v)}
`,i<=0&&(i=1);break;case"ap_up":D+=Math.ceil((p.value||0)*oe(z)*1e4)/1e4,b+=`${N[n.name]} ap_up: +${(p.value||0)*oe(z)}
`;break;case"ap_down":D-=p.value||0,b+=`${N[n.name]} ap_down: -${p.value||0}
`;break;case"reset":s=c.length-1,b+=`${N[n.name]} reset
`;break;case"splice":c.splice(c.indexOf(n),1),s--,b+=`${N[n.name]} splice
`;break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};d&&h==="start"&&Q(d,L);const de=()=>{const n=c[s];if(!n)throw new Error("メンバーが見つかりません");const C=Math.max(n.ap-a,0);return C<=D&&E<=0?(D-=C,ee.set(n,(ee.get(n)||0)+1),ce++,Q(n,n.skills),s=c.length-1===s?0:s+1,E+=_,!0):!1};for(let n=0;n<r.length;n++){const C=r[n];if(K=r[n-1],!C)throw new Error("noteが見つかりません");for(d&&C.fever&&!K?.fever&&h==="fever_start"&&(b+=`FEVER START
`,Q(d,L)),!C.fever&&K?.fever&&(b+=`FEVER END
`),E-=C.time-ie,ie=C.time;de(););E=Math.max(0,E);for(let G=0;G<C.normalCount+C.slideCount;G++){if(A==="desperate"&&i*10>v){G<C.normalCount?i-=Math.ceil(v/15):i-=Math.ceil(v*2/75),b+=`miss, ap: ${D}, mental: ${i}, vol_lv: ${S.lv*(C.fever?2:1)}
`;continue}z++,D+=Math.ceil(ye*oe(z)*1e4)/1e4,de();const W=Math.ceil(U/re*30*fe(u,S.lv,C.fever));t+=W,b+=`combo: ${z}, score: ${t} (+${W}), ap: ${D}, mental: ${i}, vol_lv: ${S.lv*(C.fever?2:1)}
`}}return d&&h==="end"&&Q(d,L),{score:t,log:b}},Re={class:"card-body"},Fe=ae({__name:"MPopup",props:{onClose:{type:Function,default:()=>{}}},setup(r){return(y,k)=>(w(),T("div",{class:"popup-wrapper",onClick:k[1]||(k[1]=U=>y.onClose(null))},[e("div",{class:"popup card overflow-scroll h-100 w-100",onClick:k[0]||(k[0]=xe(()=>{},["stop"]))},[e("div",Re,[Se(y.$slots,"default",{},void 0)])])]))}}),Pe=Object.assign(Te(Fe,[["__scopeId","data-v-eec55aae"]]),{__name:"MPopup"}),je={class:"my-2"},Ie={class:"input-group mb-3"},ze=["value"],Ge={class:"card my-2"},He={class:"card-body"},qe={key:0,class:"my-2"},Je={class:"alert alert-info"},Ke={class:"card my-2"},Qe={class:"card-body"},We={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye={class:"card my-2"},Ze={class:"card-body"},et={key:0,class:"my-2"},tt={class:"alert alert-info"},lt=ae({__name:"MdCardSelect",props:{onClose:{}},setup(r){const y=$(""),k=_=>`[${_.series}] ${_.key!=="other"?ve[_.key]:_.otherName}`,U=R(()=>ue.filter(_=>k(_).includes(y.value))),v=$(0),u=R(()=>ue[v.value]),f=R(()=>u.value?be(u.value,d.value,h.value):null),A=R(()=>f.value?Y(F(f.value).skills):""),d=$(14),h=$(14),L=R(()=>f.value?Y(F(f.value).centerSkills):""),P=R(()=>f.value?_e(F(f.value).centerAbilities):""),g=$e("skillCache",{}),j=_=>`${_.key}-${_.series}`;return Z(u,()=>{u.value&&(d.value=g.value[j(u.value)]?.skillLevel||14,h.value=g.value[j(u.value)]?.centerSkillLevel||14)}),Z([d,h],()=>{u.value&&(g.value[j(u.value)]={centerSkillLevel:h.value,skillLevel:d.value})}),(_,a)=>(w(),me(Pe,{"on-close":_.onClose},{default:Ae(()=>[e("div",je,[e("div",Ie,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),m(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>V(y)?y.value=c:null),type:"text",class:"form-control"},null,512),[[x,o(y)]])]),m(e("select",{"onUpdate:modelValue":a[1]||(a[1]=c=>V(v)?v.value=c:null),class:"form-select"},[(w(!0),T(H,null,q(o(U),(c,E)=>(w(),T("option",{key:`${c.key}-${c.series}`,class:Ne(["card",{"bg-primary":o(u)?.key===c.key}]),value:E}," ["+M(c.series)+"] "+M(c.key!=="other"?o(ve)[c.key]:c.otherName),11,ze))),128))],512),[[ne,o(v)]])]),e("div",Ge,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",He,[e("div",null,[a[6]||(a[6]=J(" スキルレベル： ")),m(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>V(d)?d.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,o(d)]])]),o(u)?(w(),T("div",qe,[e("div",Je,M(o(A)),1)])):le("",!0)])]),e("div",Ke,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Qe,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":a[3]||(a[3]=c=>V(h)?h.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,o(h)]]),o(u)?(w(),T("div",We,[e("div",Xe," 【"+M(o(se)(o(u).centerSkillCondition))+"】"+M(o(L)),1)])):le("",!0)])]),e("div",Ye,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Ze,[o(u)?(w(),T("div",et,[e("div",tt,M(o(P)),1)])):le("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=c=>_.onClose(o(f)))}," 選択 ")]),_:1},8,["on-close"]))}}),ot=Object.assign(lt,{__name:"MdCardSelect"}),st=he(()=>{const r=$([]);return{modals:r,openModal:k=>{let U;const v=new Promise(A=>{U=A}),f={component:k,onClose:A=>{r.value.splice(r.value.indexOf(f),1),U(A)}};return r.value.push(f),v}}}),nt={class:"container-md"},at={class:"card my-2"},it={class:"card-body"},rt={class:"card-header"},ct={class:"card-body"},dt=["onClick"],ut={class:"row my-2 align-items-center justify-content-start"},vt={class:"col-auto"},pt=["onUpdate:modelValue"],ft=["value"],_t={class:"row my-2 align-items-center justify-content-start"},mt={class:"col-auto"},yt=["onUpdate:modelValue"],kt={class:"row row-gap-1"},bt={class:"col-md"},$t=["onUpdate:modelValue"],ht={class:"col-md"},Ct=["onUpdate:modelValue"],Mt={class:"col-md"},wt=["onUpdate:modelValue"],Vt={class:"col-md"},Ut={class:"input-group"},gt=["onUpdate:modelValue"],St={class:"my-2"},xt={class:"row"},Tt={class:"col-sm"},At=["onUpdate:modelValue"],Nt={class:"col-sm"},Lt={class:"alert alert-secondary"},Et={class:"my-2"},Dt={class:"row"},Bt={class:"col-sm"},Ot=["onUpdate:modelValue"],Rt=["value"],Ft=["onUpdate:modelValue"],Pt={class:"col-sm"},jt={class:"alert alert-secondary"},It={class:"my-2"},zt={class:"row"},Gt={class:"col-sm"},Ht=["onUpdate:modelValue"],qt={class:"col-sm"},Jt={class:"alert alert-secondary"},Kt={class:"row"},Qt={class:"col"},Wt={class:"form-label"},Xt={class:"col"},Yt={class:"form-label"},Zt={class:"card my-2"},el={class:"card-body"},tl={class:"mb-2"},ll={class:"row"},ol={class:"col-auto"},sl={class:"col-auto"},nl={class:"my-2"},al={class:"my-2"},cl=ae({__name:"index",setup(r){const y=$(""),k=$(""),U=$(0),v=$(0),u=$("smile"),f=$("perfect"),A=$(80820),d=$(2960),h=$(50),L=$(""),P=$(0),g=$(ge),j=()=>{const i=g.value.map(F),t=Ue(y.value,U.value),{score:S,log:l}=Oe({notes:t,convertedMembers:i,center:k.value,appealSum:A.value,mentalSum:d.value,masteryLevel:h.value,comboOffset:v.value,playStyle:f.value});P.value=S,L.value=l},_=R(()=>g.value.reduce((i,t)=>i+t.mental,0)),a=R(()=>{const i=g.value.map(F);return Ce(i,u.value,k.value)});Z(_,()=>{g.value.every(i=>i.mental)&&(d.value=_.value)}),Z(a,()=>{g.value.every(i=>i.smile&&i.pure&&i.cool)&&(A.value=a.value)}),Le({title:"スクショウ計算機"});const{modals:c,openModal:E}=st(),D=async i=>{const t=await E(ot);t&&g.value.splice(g.value.indexOf(i),1,t)};return(i,t)=>{const S=Me;return w(),T("div",nt,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),Ee(S,{"note-text":o(y),"onUpdate:noteText":t[0]||(t[0]=l=>V(y)?y.value=l:null),center:o(k),"onUpdate:center":t[1]||(t[1]=l=>V(k)?k.value=l:null),offset:o(U),"onUpdate:offset":t[2]||(t[2]=l=>V(U)?U.value=l:null),"combo-offset":o(v),"onUpdate:comboOffset":t[3]||(t[3]=l=>V(v)?v.value=l:null),attribute:o(u),"onUpdate:attribute":t[4]||(t[4]=l=>V(u)?u.value=l:null),"mastery-level":o(h),"onUpdate:masteryLevel":t[5]||(t[5]=l=>V(h)?h.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",at,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",it,[(w(!0),T(H,null,q(o(g),(l,B)=>(w(),T("div",{key:B,class:"card m-3"},[e("div",rt,M(B+1)+"人目 ",1),e("div",ct,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:s=>D(l)}," カードを選択して入力 ",8,dt)]),e("div",ut,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",vt,[m(e("select",{"onUpdate:modelValue":s=>l.name=s,class:"form-select"},[(w(!0),T(H,null,q(o(we),s=>(w(),T("option",{key:s,value:s},M(o(N)[s]),9,ft))),128))],8,pt),[[ne,l.name]])])]),e("div",_t,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",mt,[m(e("input",{"onUpdate:modelValue":s=>l.ap=s,type:"number",class:"form-control"},null,8,yt),[[x,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",kt,[e("div",bt,[m(e("input",{"onUpdate:modelValue":s=>l.smile=s,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,$t),[[x,l.smile,void 0,{number:!0}]])]),e("div",ht,[m(e("input",{"onUpdate:modelValue":s=>l.pure=s,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Ct),[[x,l.pure,void 0,{number:!0}]])]),e("div",Mt,[m(e("input",{"onUpdate:modelValue":s=>l.cool=s,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,wt),[[x,l.cool,void 0,{number:!0}]])]),e("div",Vt,[e("div",Ut,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),m(e("input",{"onUpdate:modelValue":s=>l.mental=s,type:"number",class:"form-control",placeholder:"メンタル"},null,8,gt),[[x,l.mental,void 0,{number:!0}]])])])]),e("div",St,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",xt,[e("div",Tt,[m(e("textarea",{"onUpdate:modelValue":s=>l.skill=s,class:"form-control"},null,8,At),[[x,l.skill]])]),e("div",Nt,[e("div",Lt,M(o(Y)(o(F)(l).skills)),1)])])]),e("div",Et,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Dt,[e("div",Bt,[m(e("select",{"onUpdate:modelValue":s=>l.centerSkillCondition=s,class:"form-select"},[(w(!0),T(H,null,q(o(Ve),s=>(w(),T("option",{key:s,value:s},M(o(se)(s)),9,Rt))),128))],8,Ot),[[ne,l.centerSkillCondition]]),m(e("textarea",{"onUpdate:modelValue":s=>l.centerSkill=s,class:"form-control"},null,8,Ft),[[x,l.centerSkill]])]),e("div",Pt,[e("div",jt," 【"+M(o(se)(l.centerSkillCondition))+"】"+M(o(Y)(o(F)(l).centerSkills)),1)])])]),e("div",It,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",zt,[e("div",Gt,[m(e("textarea",{"onUpdate:modelValue":s=>l.centerAbilityText=s,class:"form-control"},null,8,Ht),[[x,l.centerAbilityText]])]),e("div",qt,[e("div",Jt,M(o(_e)(o(F)(l).centerAbilities)),1)])])])])]))),128)),e("div",Kt,[e("div",Qt,[e("label",Wt,"総合アピール値（"+M(o(a))+"）：",1),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>V(A)?A.value=l:null),type:"number",class:"form-control"},null,512),[[x,o(A),void 0,{number:!0}]])]),e("div",Xt,[e("label",Yt,"総合メンタル値（"+M(o(_))+"）：",1),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>V(d)?d.value=l:null),type:"number",class:"form-control"},null,512),[[x,o(d),void 0,{number:!0}]])])])])]),e("div",Zt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",el,[e("div",tl,[t[21]||(t[21]=J(" プレイスタイル： ")),e("div",ll,[e("div",ol,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>V(f)?f.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[pe,o(f)]]),t[19]||(t[19]=J(" 渾身 "))])]),e("div",sl,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>V(f)?f.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[pe,o(f)]]),t[20]||(t[20]=J(" 背水 "))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:j}," 計算 "),e("div",nl," 計算結果: "+M(o(P)),1),e("div",al,[t[22]||(t[22]=J(" ログ： ")),m(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>V(L)?L.value=l:null),rows:"6",class:"form-control"},null,512),[[x,o(L)]])])])]),(w(!0),T(H,null,q(o(c),(l,B)=>(w(),me(De(l.component),{key:`modal-${B}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{cl as default};
