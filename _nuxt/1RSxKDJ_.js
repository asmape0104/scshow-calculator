import{u as Te,a as Re,t as d,v as $e,k as De,q as Pe,b as ne,w as he,x as Ee,l as Ne,_ as qe,p as D}from"./TXHRYTyK.js";import{u as re,_ as ue,a as ze,b as Ae,c as Be,d as We,M as je}from"./DujJSskl.js";import{f as ie,r as s,c as C,o as y,a as t,b as p,l as o,k as a,h as Ge,g as I,y as Ie,u as Ke,j as m,v as Je,w as se,t as L,q as Z,d as _,s as T,z as P,F as ee,m as te,i as ae,A as He,B as Qe,C as Ye,x as Xe}from"./xD7Xdv9q.js";const Ze={class:"card my-2"},et={class:"card-body"},tt={class:"d-flex gap-2 align-items-center"},lt=ie({__name:"OCardOperation",setup(de){const c=s("none"),{skillCaches:f}=re(),K=()=>{f.forEach(r=>{r.value.mark===c.value&&(console.log("setSelectedMarkToRequired",r.value.mark),r.value={...r.value,selected:"required"})})},M=()=>{f.forEach(r=>{r.value.mark===c.value&&(r.value={...r.value,selected:"optional"})})},S=()=>{f.forEach(r=>{r.value.mark===c.value&&(r.value={...r.value,selected:"excluded"})})},F=()=>{confirm("マークをリセットしますか？")&&f.forEach(r=>{r.value={...r.value,mark:"none"}})};return(r,k)=>{const O=ue;return y(),C("div",Ze,[k[2]||(k[2]=t("div",{class:"card-header"}," カード操作 ",-1)),t("div",et,[t("div",tt,[t("div",null,[p(O,{modelValue:o(c),"onUpdate:modelValue":k[0]||(k[0]=x=>a(c)?c.value=x:null),class:""},null,8,["modelValue"])]),k[1]||(k[1]=t("div",null,"をすべて",-1)),t("button",{class:"btn btn-primary",onClick:K},"必須に"),t("button",{class:"btn btn-primary",onClick:M},"任意に"),t("button",{class:"btn btn-primary",onClick:S},"除外に")]),t("div",{class:"mt-2"},[t("button",{class:"btn btn-primary",onClick:F},"マークリセット")])])])}}}),ot=Object.assign(lt,{__name:"OCardOperation"}),nt={class:"container-md"},st={class:"card my-2"},at={class:"card-body"},rt={class:"table"},ut={scope:"col"},it={class:"d-flex align-items-end"},dt={class:""},vt={class:"input-group"},ct={class:"input-group-prepend"},mt={class:"input-group-text"},pt={style:{"min-height":"1.5em"}},ft={style:{"text-align":"right"}},kt={class:"d-flex gap-2"},bt=["disabled"],gt={class:"card my-2"},yt={class:"card-body"},_t={class:"mb-2"},xt={class:"row"},Ct={class:"col-auto"},wt={class:"col-auto"},Lt={class:"mb-2"},Ut={class:"row"},Vt={class:"col-auto"},Mt={class:"col-auto"},St={class:"mb-2"},Ft={class:"row"},Ot={class:"col-auto"},Tt={class:"col-auto"},Rt={class:"mb-2"},$t={class:"form-check"},Dt={class:"form-check-label",for:"parallel"},Pt={class:"form-check"},ht={class:"form-check"},Et={class:"form-check"},Nt={class:"form-check"},qt={key:2},zt={class:"card my-2"},At={class:"card-body"},Bt=["value"],Wt={class:"d-flex gap-2 align-items-center"},Kt=ie({__name:"auto-formation",setup(de){const c=s("finished"),f=s(void 0),K=async()=>{if(f.value)try{await f.value.release(),f.value=void 0}catch{}if("wakeLock"in navigator)try{f.value=await navigator.wakeLock.request("screen")}catch(n){console.error(n)}};Ge(c,async n=>{if(n==="finished")try{await f.value?.release(),f.value=void 0}catch{}});const M=s(""),S=s(""),F=s(0),r=s(0),k=s("smile"),O=s(50),x=s("perfect"),U=s("current"),V=s("score"),h=s(!0),E=s([]),N=Te("seasonFanLvs",{kaho:1,sayaka:1,rurino:1,ginko:1,kosuzu:1,hime:1,ceras:1,izumi:1,kozue:1,tsuzuri:1,megumi:1}),q=s(""),z=s(!0),A=s(!0),B=s(!1),W=s(!1),b=s([...Re]),v=s(Object.fromEntries(b.value.map(n=>[d(n),{level:$e[n.rarity]||1,centerSkillLevel:10,skillLevel:10,selected:"optional"}]))),ve=(n,e)=>{v.value[n]=e},ce=I(()=>b.value.filter(n=>v.value[d(n)]?.selected==="required").length),me=I(()=>b.value.filter(n=>v.value[d(n)]?.selected==="excluded").length),pe=I(()=>b.value.filter(n=>v.value[d(n)]?.selected==="optional").length),R=s([]),J=s([]),H=s(0),Q=s(1);Ie(()=>{Q.value=navigator.hardwareConcurrency||4});const g=s(null),fe=I(()=>J.value.reduce((n,e)=>n+e,0)),le=s(Promise.resolve()),ke=n=>{R.value=Array.from({length:n},()=>new Worker(new URL(""+new URL("calc-worker-parallel-VbB7FMK6.js",import.meta.url).href,import.meta.url),{type:"module"})),R.value.forEach((e,w)=>{e.onmessage=i=>{switch(i.data.message){case"calcScore":le.value=le.value.then(async()=>{i.data.data.score>(g.value?.score||0)&&(g.value={score:i.data.data.score,liveGrandPrixPt:i.data.data.liveGrandPrixPt,members:i.data.data.members,centerMember:i.data.data.centerMember,log:i.data.data.log})});break;case"progress":J.value[w]=i.data.data.progress;break;case"end":H.value++,H.value===R.value.length&&(c.value="finished");break}}})},be=()=>{const n=h.value?Q.value:1;ke(n),K(),g.value=null,J.value=Array.from({length:n.value},()=>0),H.value=0;const e=Pe(M.value,F.value),w=b.value.filter(u=>v.value[d(u)]&&v.value[d(u)].selected==="required").map(u=>ne(u,v.value[d(u)]?.skillLevel||10,v.value[d(u)]?.centerSkillLevel||10,v.value[d(u)]?.level||1));if(w.length>6){$("必要メンバーが6人を超えています");return}const i=b.value.filter(u=>!v.value[d(u)]?.selected||v.value[d(u)].selected==="optional").map(u=>ne(u,v.value[d(u)]?.skillLevel||10,v.value[d(u)]?.centerSkillLevel||10,v.value[d(u)]?.level||1));c.value="running",R.value.forEach((u,G)=>{u.postMessage(JSON.parse(JSON.stringify({requiredMembers:w,optionalMembers:i,notes:e,center:S.value,attribute:k.value,masteryLevel:O.value,playStyle:x.value,formationRule:U.value,includingCenterOnly:z.value,noLog:A.value,noDamagedFormation:B.value,noCuredFormation:W.value,scoreComparisonRule:V.value,seasonFanLvs:N.value,singers:E.value,batchNum:n,batchIndex:G})))})},ge=()=>{R.value.forEach(n=>{n.terminate()}),c.value="finished"},$=n=>{window.alert(n)},{modals:ye,openModal:_e}=De(),xe=async n=>{await _e(je,{card:n,displayLevel:v.value[d(n)]?.level||1})},Y=s(null),Ce=()=>{const n=Y.value?.files?.[0];if(n){const e=new FileReader;e.onload=w=>{const i=w.target?.result;b.value=b.value.concat(he(i))},e.readAsText(n)}},we=s(null),oe=s(!1),Le=()=>{b.value=b.value.concat(Ee),oe.value=!0},j=s("none"),{skillCaches:Ue}=re(),Ve=()=>{g.value?.members.forEach(n=>{const e=Ue.get(d(n));e&&(e.value={...e.value,mark:j.value})})};return Ke({title:"スクショウ自動編成",meta:[{name:"twitter:title",content:"スクショウ自動編成"},{name:"description",content:"スクショウの編成を自動で計算します"}]}),(n,e)=>{const w=Ne,i=qe,u=Ae,G=ze,Me=ot,Se=Be,Fe=ue,Oe=We;return y(),C("div",nt,[e[55]||(e[55]=t("h1",null,"スクショウ自動編成",-1)),e[56]||(e[56]=t("a",{href:"https://note.com/asmape/n/nefd46574f4e3",target:"_blank"},"note",-1)),p(w,{"note-text":o(M),"onUpdate:noteText":e[0]||(e[0]=l=>a(M)?M.value=l:null),center:o(S),"onUpdate:center":e[1]||(e[1]=l=>a(S)?S.value=l:null),offset:o(F),"onUpdate:offset":e[2]||(e[2]=l=>a(F)?F.value=l:null),"combo-offset":o(r),"onUpdate:comboOffset":e[3]||(e[3]=l=>a(r)?r.value=l:null),attribute:o(k),"onUpdate:attribute":e[4]||(e[4]=l=>a(k)?k.value=l:null),"mastery-level":o(O),"onUpdate:masteryLevel":e[5]||(e[5]=l=>a(O)?O.value=l:null),singers:o(E),"onUpdate:singers":e[6]||(e[6]=l=>a(E)?E.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),t("div",st,[e[36]||(e[36]=t("div",{class:"card-header"}," メンバー ",-1)),t("div",at,[t("table",rt,[t("thead",null,[t("tr",null,[t("th",ut,[t("div",it,[e[27]||(e[27]=t("div",{style:{"margin-right":"8px"}}," カード ",-1)),t("div",dt,[t("div",vt,[t("div",ct,[t("div",mt,[t("div",pt,[p(i,{icon:["fas","magnifying-glass"]})])])]),m(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a(q)?q.value=l:null),type:"text",class:"form-control"},null,512),[[Je,o(q)]])])])])]),e[28]||(e[28]=t("th",{scope:"col"},"AP",-1)),e[29]||(e[29]=t("th",{scope:"col"},"Lv.",-1)),e[30]||(e[30]=t("th",{scope:"col"},"スキルLv.",-1)),e[31]||(e[31]=t("th",{scope:"col"},"センターSLv.",-1)),e[32]||(e[32]=t("th",{scope:"col"},"凸数",-1)),e[33]||(e[33]=t("th",{scope:"col"},"選択",-1)),e[34]||(e[34]=t("th",{scope:"col"},"マーク",-1))])]),t("tbody",null,[p(G,{"fallback-tag":"tr"},{default:se(()=>[(y(!0),C(ee,null,te(o(b),l=>m((y(),ae(u,{key:o(D)(l),card:l,"open-card-details-modal":xe,"onUpdate:skillLevel":X=>ve(o(d)(l),X)},null,8,["card","onUpdate:skillLevel"])),[[He,o(D)(l).toLowerCase().includes(o(q).toLowerCase())]])),128))]),_:1})])]),t("div",ft," 必須："+L(o(ce))+" 任意："+L(o(pe))+" 除外："+L(o(me)),1),t("div",kt,[t("button",{type:"button",class:"btn btn-primary",onClick:e[8]||(e[8]=l=>o(Y)?.click())}," TSVインポート "),t("button",{type:"button",class:"btn btn-primary",disabled:o(oe),onClick:e[9]||(e[9]=l=>Le())}," 後衛カード追加 ",8,bt)]),e[35]||(e[35]=t("div",null,[t("a",{href:"https://docs.google.com/spreadsheets/d/13moGCQN2fd9_kxc5g3M9go98Sw6Y8fO25nDxKFoDsDk/edit?gid=1837505339#gid=1837505339",target:"_blank"}," 後衛カード一覧 ")],-1)),t("input",{ref_key:"tsvFileInput",ref:Y,type:"file",class:"d-none",onChange:Ce},null,544)])]),p(Me),p(G,null,{default:se(()=>[p(Se,{"season-fan-lvs":o(N),"onUpdate:seasonFanLvs":e[10]||(e[10]=l=>a(N)?N.value=l:null)},null,8,["season-fan-lvs"])]),_:1}),t("div",gt,[e[54]||(e[54]=t("div",{class:"card-header"}," 計算 ",-1)),t("div",yt,[t("div",_t,[e[39]||(e[39]=_(" プレイスタイル： ",-1)),t("div",xt,[t("div",Ct,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>a(x)?x.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[T,o(x)]]),e[37]||(e[37]=_(" 渾身 ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[12]||(e[12]=l=>$("フルコンを目指すプレイ"))},[p(i,{icon:"circle-info"})])]),t("div",wt,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>a(x)?x.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[T,o(x)]]),e[38]||(e[38]=_(" 背水 ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[14]||(e[14]=l=>$("メンタルが10%以下になるようミスをするプレイ"))},[p(i,{icon:"circle-info"})])])])]),t("div",Lt,[e[42]||(e[42]=_(" 編成ルール ",-1)),t("div",Ut,[t("div",Vt,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>a(U)?U.value=l:null),class:"form-check-input",type:"radio",value:"current"},null,512),[[T,o(U)]]),e[40]||(e[40]=_(" 現状のルール ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[16]||(e[16]=l=>$(`・メンバー1人あたり1種類まで
・カード制限なし`))},[p(i,{icon:"circle-info"})])]),t("div",Mt,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>a(U)?U.value=l:null),class:"form-check-input",type:"radio",value:"new_grand_prix"},null,512),[[T,o(U)]]),e[41]||(e[41]=_(" 新ライグラルール ",-1))]),t("a",{style:{"vertical-align":"super","font-size":"0.8em"},onClick:e[18]||(e[18]=l=>$(`・メンバー1人あたり2種類まで
・DRは1枚まで`))},[p(i,{icon:"circle-info"})])])])]),t("div",St,[e[45]||(e[45]=_(" スコア比較基準 ",-1)),t("div",Ft,[t("div",Ot,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>a(V)?V.value=l:null),class:"form-check-input",type:"radio",value:"score"},null,512),[[T,o(V)]]),e[43]||(e[43]=_(" スコア ",-1))])]),t("div",Tt,[t("label",null,[m(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>a(V)?V.value=l:null),class:"form-check-input",type:"radio",value:"grandPrixPt"},null,512),[[T,o(V)]]),e[44]||(e[44]=_(" グランプリpt ",-1))])])])]),t("div",Rt,[e[50]||(e[50]=_(" オプション： ",-1)),t("div",$t,[m(t("input",{id:"parallel","onUpdate:modelValue":e[21]||(e[21]=l=>a(h)?h.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[P,o(h)]]),t("label",Dt," マルチスレッド ("+L(o(Q))+"スレッド) ",1)]),t("div",Pt,[m(t("input",{id:"includingCenterOnly","onUpdate:modelValue":e[22]||(e[22]=l=>a(z)?z.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[P,o(z)]]),e[46]||(e[46]=t("label",{class:"form-check-label",for:"includingCenterOnly"}," センターのメンバーを含まない編成は計算しない ",-1))]),t("div",ht,[m(t("input",{id:"noLog","onUpdate:modelValue":e[23]||(e[23]=l=>a(A)?A.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[P,o(A)]]),e[47]||(e[47]=t("label",{class:"form-check-label",for:"noLog"}," ログを出力しない（効果大） ",-1))]),t("div",Et,[m(t("input",{id:"noDamagedFormation","onUpdate:modelValue":e[24]||(e[24]=l=>a(B)?B.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[P,o(B)]]),e[48]||(e[48]=t("label",{class:"form-check-label",for:"noDamagedFormation"}," 途中でメンタルが100%未満になった場合計算を打ち切る（渾身選択時以外は自動で無効） ",-1))]),t("div",Nt,[m(t("input",{id:"noCuredFormation","onUpdate:modelValue":e[25]||(e[25]=l=>a(W)?W.value=l:null),class:"form-check-input",type:"checkbox"},null,512),[[P,o(W)]]),e[49]||(e[49]=t("label",{class:"form-check-label",for:"noCuredFormation"}," 途中でメンタルが10%超になった場合計算を打ち切る（背水選択時以外は自動で無効） ",-1))])]),o(c)!=="running"?(y(),C("button",{key:0,type:"button",class:"btn btn-primary",onClick:be}," 計算 ")):Z("",!0),o(c)==="running"?(y(),C("button",{key:1,type:"button",class:"btn btn-primary",onClick:ge}," 中止 ")):Z("",!0),o(g)?(y(),C("div",qt,[t("p",{ref_key:"progressView",ref:we},L(o(c)==="running"?`計算中... ${o(fe).toFixed(2)}%`:"計算完了"),513),t("div",zt,[t("div",At,[t("p",null,"最高得点: "+L(o(g).score)+" ("+L(o(g).liveGrandPrixPt)+"pt)",1),e[53]||(e[53]=t("p",null,"メンバー:",-1)),t("ul",null,[(y(!0),C(ee,null,te(o(g).members,l=>(y(),C("li",{key:o(d)(l),style:Qe({fontWeight:o(g).centerMember&&o(D)(l)===o(D)(o(g).centerMember)?"bold":"normal"})},L(o(D)(l)),5))),128))]),t("textarea",{class:"form-control",value:o(g).log,readonly:"",rows:"5"},null,8,Bt),t("div",Wt,[e[51]||(e[51]=t("div",null,"編成に使用したカードを",-1)),t("div",null,[p(Fe,{modelValue:o(j),"onUpdate:modelValue":e[26]||(e[26]=l=>a(j)?j.value=l:null),class:""},null,8,["modelValue"])]),e[52]||(e[52]=t("div",null,"にする",-1)),t("button",{class:"btn btn-primary",onClick:Ve},"実行")])])])])):Z("",!0)])]),p(Oe),(y(!0),C(ee,null,te(o(ye),(l,X)=>(y(),ae(Xe(l.component),Ye({key:`modal-${X}`,"on-close":l.onClose},{ref_for:!0},l.args),null,16,["on-close"]))),128))])}}});export{Kt as default};
