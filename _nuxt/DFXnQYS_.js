import{c as ke,m as T,a as de,b as be,s as Z,d as O,e as fe,u as he,f as ue,g as oe,_ as $e,h as Ce,i as we,j as Me,k as Ve,l as Ue,p as xe,n as Se}from"./kpWgoozj.js";import{f as me,r as $,g as j,h as L,i as _e,o as M,w as ge,a as e,j as f,k as w,v as S,l as s,c as g,F as W,m as G,n as Te,t as C,p as ne,q as le,d as J,u as Ae,b as Ne,s as ve,x as Ee}from"./C45eJsRV.js";const De=m=>m<=2100?Math.floor((-5+Math.sqrt(25+20*m))/10):Math.floor(20+(m-2100)/200),pe=(m,V,A)=>(1+m/100)*(1+V*(A?2:1)/10),se=m=>m<10?1:m<20?1.1:m<30?1.2:m<40?1.3:m<50?1.4:1.5,Be=({notes:m,convertedMembers:V,center:A,appealSum:N,mentalSum:_,masteryLevel:u,playStyle:y="perfect",noLog:c=!1})=>{const d=V.find(n=>n.name===A),b=d?.centerSkillCondition,E=d?.centerSkills||[],P=d?.centerAbilities||[],U=P.find(n=>n.type==="cooltime_reduce"),q=P.find(n=>n.type==="ap_reduce"),p=5-Number(U?.value.amount||0),a=Number(q?.value.amount||0),i=V.slice();let D=p,B=0,r=_,t=0;const x={_point:0,_lv:0,get point(){return this._point},set point(n){this._point=n,this._lv=De(n)},get lv(){return this._lv}},l=[0],R=[0];let o=0,ae=0;const ie=ke(m);let H=0,re=0;const ee=new WeakMap,ye=60/ie;let K,k="";const Q=(n,h)=>{const I=x.lv,X=r*100/_;e:for(const v of h){if(v.condition){const[F,Y,te]=v.condition;let z=0;switch(F){case"skill_count":z=ee.get(n)||0;break;case"total_skill_count":z=re;break;case"vol_lv":z=I;break;case"mental_rate":z=X;break;default:throw new Error(`条件式が不正です: ${F}`)}if(te===void 0)throw new Error(`条件式が不正です: ${F}`);switch(Y){case"<=":if(!(z<=te))continue e;break;case">=":if(!(z>=te))continue e;break}}switch(v.type){case"vol_buff":R[0]=(R[0]||0)+(v.value||0),c||(k+=`${T[n.name]} vol_buff: +${v.value}
`);break;case"vol_up":{const F=R[0]??0;R[0]=0,x.point+=Math.ceil((v.value||0)*(1+F/100)),c||(k+=`${T[n.name]} vol_up: +${Math.ceil((v.value||0)*(1+F/100))}
`,k+=`now voltagePoint: ${x.point}
`);break}case"vol_down":x.point-=v.value||0,x.point<0&&(x.point=0),c||(k+=`${T[n.name]} vol_down: -${v.value||0}
`);break;case"score_buff":l[0]=(l[0]||0)+(v.value||0),c||(k+=`${T[n.name]} score_buff: +${v.value}
`);break;case"score_up":{const F=l[0]??0;l[0]=0;const Y=(v.value||0)/100*(1+F/100)*pe(u,x.lv,K?.fever||!1);t+=Math.ceil(N*Y),c||(k+=`${T[n.name]} score_up: +${Math.ceil(N*Y)}
`);break}case"mental_up":r+=Math.ceil((v.value||0)/100*_),c||(k+=`${T[n.name]} mental_up: +${Math.ceil((v.value||0)/100*_)}
`);break;case"mental_down":r-=Math.ceil((v.value||0)/100*_),c||(k+=`${T[n.name]} mental_down: -${Math.ceil((v.value||0)/100*_)}
`),r<=0&&(r=1);break;case"ap_up":B+=Math.ceil((v.value||0)*se(H)*1e4),c||(k+=`${T[n.name]} ap_up: +${(v.value||0)*se(H)}
`);break;case"ap_down":B-=(v.value||0)*1e4,c||(k+=`${T[n.name]} ap_down: -${v.value||0}
`);break;case"reset":o=i.length-1,c||(k+=`${T[n.name]} reset
`);break;case"splice":i.splice(i.indexOf(n),1),o--,c||(k+=`${T[n.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${v.type}`)}}};d&&b==="start"&&Q(d,E);const ce=()=>{if(i.length===0)return!1;const n=i[o];if(!n)throw new Error("メンバーが見つかりません");const h=Math.max(n.ap-a,0);return h*1e4<=B&&D<=0?(B-=h*1e4,ee.set(n,(ee.get(n)||0)+1),re++,Q(n,n.skills),o=i.length-1===o?0:o+1,D+=p,!0):!1};for(let n=0;n<m.length;n++){const h=m[n];if(K=m[n-1],!h)throw new Error("noteが見つかりません");for(d&&h.fever&&!K?.fever&&b==="fever_start"&&(c||(k+=`FEVER START
`),Q(d,E)),!h.fever&&K?.fever&&(c||(k+=`FEVER END
`)),D-=h.time-ae,ae=h.time;ce(););D=Math.max(0,D);for(let I=0;I<h.normalCount+h.slideCount;I++){if(y==="desperate"&&r*10>_){I<h.normalCount?r-=Math.ceil(_/15):r-=Math.ceil(_*2/75),c||(k+=`miss, apPoint: ${B}, mental: ${r}, vol_lv: ${x.lv*(h.fever?2:1)}
`);continue}H++,B+=Math.ceil(ye*se(H)*1e4),ce();const X=Math.ceil(N/ie*30*pe(u,x.lv,h.fever));t+=X,c||(k+=`combo: ${H}, score: ${t} (+${X}), apPoint: ${B}, mental: ${r}, vol_lv: ${x.lv*(h.fever?2:1)}
`)}}return d&&b==="end"&&Q(d,E),{score:t,log:k}},Re={class:"my-2"},Fe={class:"input-group mb-3"},je=["value"],Oe={class:"card my-2"},Pe={class:"card-body"},qe={key:0,class:"my-2"},ze={class:"alert alert-info"},He={class:"card my-2"},Ie={class:"card-body"},We={key:0,class:"my-2"},Ge={class:"alert alert-info"},Je={class:"card my-2"},Ke={class:"card-body"},Qe={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye=me({__name:"MdCardSelect",props:{onClose:{}},setup(m){const V=$(""),A=p=>`[${p.series}] ${p.key!=="other"?ue[p.key]:p.otherName}`,N=j(()=>de.filter(p=>A(p).includes(V.value))),_=$(0),u=j(()=>de[_.value]),y=j(()=>u.value?be(u.value,d.value,b.value):null),c=j(()=>y.value?Z(O(y.value).skills):""),d=$(14),b=$(14),E=j(()=>y.value?Z(O(y.value).centerSkills):""),P=j(()=>y.value?fe(O(y.value).centerAbilities):""),U=he("skillCache",{}),q=p=>`${p.key}-${p.series}`;return L(u,()=>{u.value&&(d.value=U.value[q(u.value)]?.skillLevel||14,b.value=U.value[q(u.value)]?.centerSkillLevel||14)}),L([d,b],()=>{u.value&&(U.value[q(u.value)]={centerSkillLevel:b.value,skillLevel:d.value})}),(p,a)=>(M(),_e($e,{"on-close":p.onClose},{default:ge(()=>[e("div",Re,[e("div",Fe,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),f(e("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>w(V)?V.value=i:null),type:"text",class:"form-control"},null,512),[[S,s(V)]])]),f(e("select",{"onUpdate:modelValue":a[1]||(a[1]=i=>w(_)?_.value=i:null),class:"form-select"},[(M(!0),g(W,null,G(s(N),(i,D)=>(M(),g("option",{key:`${i.key}-${i.series}`,class:Te(["card",{"bg-primary":s(u)?.key===i.key}]),value:D}," ["+C(i.series)+"] "+C(i.key!=="other"?s(ue)[i.key]:i.otherName),11,je))),128))],512),[[ne,s(_)]])]),e("div",Oe,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Pe,[e("div",null,[a[6]||(a[6]=J(" スキルレベル： ",-1)),f(e("input",{"onUpdate:modelValue":a[2]||(a[2]=i=>w(d)?d.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(d)]])]),s(u)?(M(),g("div",qe,[e("div",ze,C(s(c)),1)])):le("",!0)])]),e("div",He,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ie,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),f(e("input",{"onUpdate:modelValue":a[3]||(a[3]=i=>w(b)?b.value=i:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[S,s(b)]]),s(u)?(M(),g("div",We,[e("div",Ge," 【"+C(s(oe)(s(u).centerSkillCondition))+"】"+C(s(E)),1)])):le("",!0)])]),e("div",Je,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Ke,[s(u)?(M(),g("div",Qe,[e("div",Xe,C(s(P)),1)])):le("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=i=>p.onClose(s(y)))}," 選択 ")]),_:1},8,["on-close"]))}}),Ze=Object.assign(Ye,{__name:"MdCardSelect"}),Le={class:"container-md"},et={class:"card my-2"},tt={class:"card-body"},lt={class:"card-header"},st={class:"card-body"},ot=["onClick"],nt={class:"row my-2 align-items-center justify-content-start"},at={class:"col-auto"},it=["onUpdate:modelValue"],rt=["value"],ct={class:"row my-2 align-items-center justify-content-start"},dt={class:"col-auto"},ut=["onUpdate:modelValue"],vt={class:"row row-gap-1"},pt={class:"col-md"},ft=["onUpdate:modelValue"],mt={class:"col-md"},_t=["onUpdate:modelValue"],yt={class:"col-md"},kt=["onUpdate:modelValue"],bt={class:"col-md"},ht={class:"input-group"},$t=["onUpdate:modelValue"],Ct={class:"my-2"},wt={class:"row"},Mt={class:"col-sm"},Vt=["onUpdate:modelValue"],Ut={class:"col-sm"},xt={class:"alert alert-secondary"},St={class:"my-2"},gt={class:"row"},Tt={class:"col-sm"},At=["onUpdate:modelValue"],Nt=["value"],Et=["onUpdate:modelValue"],Dt={class:"col-sm"},Bt={class:"alert alert-secondary"},Rt={class:"my-2"},Ft={class:"row"},jt={class:"col-sm"},Ot=["onUpdate:modelValue"],Pt={class:"col-sm"},qt={class:"alert alert-secondary"},zt={class:"row"},Ht={class:"col"},It={class:"form-label"},Wt={class:"col"},Gt={class:"form-label"},Jt={class:"card my-2"},Kt={class:"card-body"},Qt={class:"mb-2"},Xt={class:"row"},Yt={class:"col-auto"},Zt={class:"col-auto"},Lt={class:"my-2"},el={class:"my-2"},sl=me({__name:"index",setup(m){const V=$(""),A=$(""),N=$(0),_=$(0),u=$("smile"),y=$("perfect"),c=$(80820),d=$(2960),b=$(50),E=$(""),P=$(0),U=$(Se),q=()=>{const r=U.value.map(O),t=xe(V.value,N.value),{score:x,log:l}=Be({notes:t,convertedMembers:r,center:A.value,appealSum:c.value,mentalSum:d.value,masteryLevel:b.value,playStyle:y.value});P.value=x,E.value=l},p=j(()=>U.value.reduce((r,t)=>r+t.mental,0)),a=j(()=>{const r=U.value.map(O);return Ce(r,u.value,A.value)});L(p,()=>{U.value.every(r=>r.mental)&&(d.value=p.value)}),L(a,()=>{U.value.every(r=>r.smile&&r.pure&&r.cool)&&(c.value=a.value)}),Ae({title:"スクショウ計算機"});const{modals:i,openModal:D}=we(),B=async r=>{const t=await D(Ze);t&&U.value.splice(U.value.indexOf(r),1,t)};return(r,t)=>{const x=Me;return M(),g("div",Le,[t[24]||(t[24]=e("h1",null,"スクショウ計算機",-1)),Ne(x,{"note-text":s(V),"onUpdate:noteText":t[0]||(t[0]=l=>w(V)?V.value=l:null),center:s(A),"onUpdate:center":t[1]||(t[1]=l=>w(A)?A.value=l:null),offset:s(N),"onUpdate:offset":t[2]||(t[2]=l=>w(N)?N.value=l:null),"combo-offset":s(_),"onUpdate:comboOffset":t[3]||(t[3]=l=>w(_)?_.value=l:null),attribute:s(u),"onUpdate:attribute":t[4]||(t[4]=l=>w(u)?u.value=l:null),"mastery-level":s(b),"onUpdate:masteryLevel":t[5]||(t[5]=l=>w(b)?b.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",et,[t[18]||(t[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",tt,[(M(!0),g(W,null,G(s(U),(l,R)=>(M(),g("div",{key:R,class:"card m-3"},[e("div",lt,C(R+1)+"人目 ",1),e("div",st,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>B(l)}," カードを選択して入力 ",8,ot)]),e("div",nt,[t[11]||(t[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",at,[f(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(M(!0),g(W,null,G(s(Ve),o=>(M(),g("option",{key:o,value:o},C(s(T)[o]),9,rt))),128))],8,it),[[ne,l.name]])])]),e("div",ct,[t[12]||(t[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",dt,[f(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,ut),[[S,l.ap,void 0,{number:!0}]])])]),t[17]||(t[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",vt,[e("div",pt,[f(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,ft),[[S,l.smile,void 0,{number:!0}]])]),e("div",mt,[f(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,_t),[[S,l.pure,void 0,{number:!0}]])]),e("div",yt,[f(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,kt),[[S,l.cool,void 0,{number:!0}]])]),e("div",bt,[e("div",ht,[t[13]||(t[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),f(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,$t),[[S,l.mental,void 0,{number:!0}]])])])]),e("div",Ct,[t[14]||(t[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",wt,[e("div",Mt,[f(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,Vt),[[S,l.skill]])]),e("div",Ut,[e("div",xt,C(s(Z)(s(O)(l).skills)),1)])])]),e("div",St,[t[15]||(t[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",gt,[e("div",Tt,[f(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(M(!0),g(W,null,G(s(Ue),o=>(M(),g("option",{key:o,value:o},C(s(oe)(o)),9,Nt))),128))],8,At),[[ne,l.centerSkillCondition]]),f(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,Et),[[S,l.centerSkill]])]),e("div",Dt,[e("div",Bt," 【"+C(s(oe)(l.centerSkillCondition))+"】"+C(s(Z)(s(O)(l).centerSkills)),1)])])]),e("div",Rt,[t[16]||(t[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Ft,[e("div",jt,[f(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,Ot),[[S,l.centerAbilityText]])]),e("div",Pt,[e("div",qt,C(s(fe)(s(O)(l).centerAbilities)),1)])])])])]))),128)),e("div",zt,[e("div",Ht,[e("label",It,"総合アピール値（"+C(s(a))+"）：",1),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>w(c)?c.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(c),void 0,{number:!0}]])]),e("div",Wt,[e("label",Gt,"総合メンタル値（"+C(s(p))+"）：",1),f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>w(d)?d.value=l:null),type:"number",class:"form-control"},null,512),[[S,s(d),void 0,{number:!0}]])])])])]),e("div",Jt,[t[23]||(t[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",Kt,[e("div",Qt,[t[21]||(t[21]=J(" プレイスタイル： ",-1)),e("div",Xt,[e("div",Yt,[e("label",null,[f(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>w(y)?y.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[ve,s(y)]]),t[19]||(t[19]=J(" 渾身 ",-1))])]),e("div",Zt,[e("label",null,[f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>w(y)?y.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[ve,s(y)]]),t[20]||(t[20]=J(" 背水 ",-1))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:q}," 計算 "),e("div",Lt," 計算結果: "+C(s(P)),1),e("div",el,[t[22]||(t[22]=J(" ログ： ",-1)),f(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>w(E)?E.value=l:null),rows:"6",class:"form-control"},null,512),[[S,s(E)]])])])]),(M(!0),g(W,null,G(s(i),(l,R)=>(M(),_e(Ee(l.component),{key:`modal-${R}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{sl as default};
