import{c as Ce,m as B,a as pe,b as we,s as ae,d as z,e as me,u as Ue,_ as Ve,f as fe,g as de,h as ge,i as xe,j as Me,k as Se,l as Te,n as Ae,o as Ne,p as je,q as Ee}from"./C3LKAyD0.js";import{f as ye,r as $,g as P,h as ee,i as ke,o as h,w as Re,a as e,j as m,b as be,k as C,v as A,l as s,c as V,F as Q,m as X,n as Be,t as w,p as ue,q as ne,d as Y,u as De,s as re,x as Oe}from"./DrHPQvCy.js";const Fe=b=>b<=2100?Math.floor((-5+Math.sqrt(25+20*b))/10):Math.floor(20+(b-2100)/200),_e=(b,S,N)=>(1+b/100)*(1+S*(N?2:1)/10),ce=b=>b<10?1:b<20?1.1:b<30?1.2:b<40?1.3:b<50?1.4:1.5,Pe=({notes:b,convertedMembers:S,center:N,appealSum:D,mentalSum:f,masteryLevel:c,playStyle:g="perfect",noLog:i=!1,noDamagedFormation:x=!1,noCuredFormation:M=!1,centerMember:U=S.find(j=>j.name===N)})=>{const j=U?.centerSkillCondition,O=U?.centerSkills||[],y=U?.centerAbilities||[],d=y.find(r=>r.type==="cooltime_reduce"),n=y.find(r=>r.type==="ap_reduce"),W=5-Number(d?.value.amount||0),_=Number(n?.value.amount||0),E=S.slice();let J=W,q=0,T=f,H=0;const R={_point:0,_lv:0,get point(){return this._point},set point(r){this._point=r,this._lv=Fe(r)},get lv(){return this._lv}},G=[0],a=[0];let t=0,F=0;const l=Ce(b);let k=0,o=0;const Z=new WeakMap,$e=60/l;let te,u="";const le=(r,v,I)=>{const se=R.lv,he=T*100/f;e:for(const p of v){if(p.condition){const[K,oe,ie]=p.condition;let L=0;switch(K){case"skill_count":L=Z.get(r)||0;break;case"total_skill_count":L=o;break;case"vol_lv":L=se*(I?2:1);break;case"mental_rate":L=he;break;default:throw new Error(`条件式が不正です: ${K}`)}if(ie===void 0)throw new Error(`条件式が不正です: ${K}`);switch(oe){case"<=":if(!(L<=ie))continue e;break;case">=":if(!(L>=ie))continue e;break}}switch(p.type){case"vol_buff":a[0]=(a[0]||0)+(p.value||0),i||(u+=`${B[r.name]} vol_buff: +${p.value}
`);break;case"vol_up":{const K=a[0]??0;a[0]=0,R.point+=Math.ceil((p.value||0)*(1+K/100)),i||(u+=`${B[r.name]} vol_up: +${Math.ceil((p.value||0)*(1+K/100))}
`,u+=`now voltagePoint: ${R.point}
`);break}case"vol_down":R.point-=p.value||0,R.point<0&&(R.point=0),i||(u+=`${B[r.name]} vol_down: -${p.value||0}
`);break;case"score_buff":G[0]=(G[0]||0)+(p.value||0),i||(u+=`${B[r.name]} score_buff: +${p.value}
`);break;case"score_up":{const K=G[0]??0;G[0]=0;const oe=(p.value||0)/100*(1+K/100)*_e(c,R.lv,I);H+=Math.ceil(D*oe),i||(u+=`${B[r.name]} score_up: +${Math.ceil(D*oe)}
`);break}case"mental_up":T+=Math.ceil((p.value||0)/100*f),i||(u+=`${B[r.name]} mental_up: +${Math.ceil((p.value||0)/100*f)}
`);break;case"mental_down":T-=Math.ceil((p.value||0)/100*f),i||(u+=`${B[r.name]} mental_down: -${Math.ceil((p.value||0)/100*f)}
`),T<=0&&(T=1);break;case"ap_up":q+=Math.ceil((p.value||0)*ce(k)*1e4),i||(u+=`${B[r.name]} ap_up: +${(p.value||0)*ce(k)}
`);break;case"ap_down":q-=(p.value||0)*1e4,i||(u+=`${B[r.name]} ap_down: -${p.value||0}
`);break;case"reset":t=E.length-1,i||(u+=`${B[r.name]} reset
`);break;case"splice":E.splice(E.indexOf(r),1),t--,i||(u+=`${B[r.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};U&&j==="start"&&le(U,O,!1);const ve=r=>{if(E.length===0)return!1;const v=E[t];if(!v)throw new Error("メンバーが見つかりません");const I=Math.max(v.ap-_,0);return I*1e4<=q&&J<=0?(q-=I*1e4,Z.set(v,(Z.get(v)||0)+1),o++,le(v,v.skills,r),t=E.length-1===t?0:t+1,J+=W,!0):!1};for(let r=0;r<b.length;r++){const v=b[r];if(te=b[r-1],!v)throw new Error("noteが見つかりません");for(J-=v.time-F,F=v.time;ve(te?.fever||!1););J=Math.max(0,J),U&&v.fever&&!te?.fever&&j==="fever_start"&&(i||(u+=`FEVER START
`),le(U,O,!0)),!v.fever&&te?.fever&&(i||(u+=`FEVER END
`));for(let I=0;I<v.normalCount+v.slideCount;I++){if(g==="desperate"&&T*10>f){I<v.normalCount?T-=Math.ceil(f/15):T-=Math.ceil(f*2/75),i||(u+=`miss, apPoint: ${q}, mental: ${T}, vol_lv: ${R.lv*(v.fever?2:1)}
`);continue}k++,q+=Math.ceil($e*ce(k)*1e4),ve(v.fever);const se=Math.ceil(D/l*30*_e(c,R.lv,v.fever));if(H+=se,i||(u+=`combo: ${k}, score: ${H} (+${se}), apPoint: ${q}, mental: ${T}, vol_lv: ${R.lv*(v.fever?2:1)}
`),g==="perfect"&&x&&T<f)return i||(u+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:H,log:u};if(g==="desperate"&&M&&T*10>f)return i||(u+=`メンタルが10%超になったため計算を打ち切ります
`),{score:H,log:u}}}return U&&j==="end"&&le(U,O,!1),{score:H,log:u}},Je={class:"my-2"},qe={class:"input-group mb-3"},Ie={class:"input-group-prepend"},ze={class:"input-group-text"},He={style:{"min-height":"1.5em"}},Ke=["value"],We={class:"card my-2"},Ge={class:"card-body"},Le={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},et={class:"alert alert-info"},tt={class:"card my-2"},lt={class:"card-body"},st={key:0,class:"my-2"},ot={class:"alert alert-info"},nt=ye({__name:"MdCardSelect",props:{onClose:{}},setup(b){const S=$(""),N=d=>`[${d.series}] ${d.key!=="other"?fe[d.key]:d.otherName}`,D=P(()=>pe.filter(d=>N(d).includes(S.value))),f=$(0),c=P(()=>pe[f.value]),g=P(()=>c.value?we(c.value,x.value,M.value):null),i=P(()=>g.value?ae(z(g.value).skills):""),x=$(14),M=$(14),U=P(()=>g.value?ae(z(g.value).centerSkills):""),j=P(()=>g.value?me(z(g.value).centerAbilities):""),O=Ue("skillCache",{}),y=d=>`${d.key}-${d.series}`;return ee(c,()=>{c.value&&(x.value=O.value[y(c.value)]?.skillLevel||14,M.value=O.value[y(c.value)]?.centerSkillLevel||14)}),ee([x,M],()=>{c.value&&(O.value[y(c.value)]={centerSkillLevel:M.value,skillLevel:x.value})}),(d,n)=>{const W=Ve;return h(),ke(ge,{"on-close":d.onClose},{default:Re(()=>[e("div",Je,[e("div",qe,[e("div",Ie,[e("div",ze,[e("div",He,[be(W,{icon:["fas","magnifying-glass"]})])])]),m(e("input",{"onUpdate:modelValue":n[0]||(n[0]=_=>C(S)?S.value=_:null),type:"text",class:"form-control"},null,512),[[A,s(S)]])]),m(e("select",{"onUpdate:modelValue":n[1]||(n[1]=_=>C(f)?f.value=_:null),class:"form-select"},[(h(!0),V(Q,null,X(s(D),(_,E)=>(h(),V("option",{key:`${_.key}-${_.series}`,class:Be(["card",{"bg-primary":s(c)?.key===_.key}]),value:E}," ["+w(_.series)+"] "+w(_.key!=="other"?s(fe)[_.key]:_.otherName),11,Ke))),128))],512),[[ue,s(f)]])]),e("div",We,[n[6]||(n[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Ge,[e("div",null,[n[5]||(n[5]=Y(" スキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":n[2]||(n[2]=_=>C(x)?x.value=_:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[A,s(x)]])]),s(c)?(h(),V("div",Le,[e("div",Qe,w(s(i)),1)])):ne("",!0)])]),e("div",Xe,[n[8]||(n[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ye,[n[7]||(n[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),m(e("input",{"onUpdate:modelValue":n[3]||(n[3]=_=>C(M)?M.value=_:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[A,s(M)]]),s(c)?(h(),V("div",Ze,[e("div",et," 【"+w(s(de)(s(c).centerSkillCondition))+"】"+w(s(U)),1)])):ne("",!0)])]),e("div",tt,[n[9]||(n[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",lt,[s(c)?(h(),V("div",st,[e("div",ot,w(s(j)),1)])):ne("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:n[4]||(n[4]=_=>d.onClose(s(g)))}," 選択 ")]),_:1},8,["on-close"])}}}),at=Object.assign(nt,{__name:"MdCardSelect"}),it={class:"container-md"},rt={class:"card my-2"},ct={class:"card-body"},dt={class:"card-header"},ut={class:"card-body"},vt={class:"d-flex gap-2"},pt=["onClick"],ft=["onClick"],_t=["onClick"],mt={class:"row my-2 align-items-center justify-content-start"},yt={class:"col-auto"},kt=["onUpdate:modelValue"],bt=["value"],$t={class:"row my-2 align-items-center justify-content-start"},ht={class:"col-auto"},Ct=["onUpdate:modelValue"],wt={class:"row row-gap-1"},Ut={class:"col-md"},Vt=["onUpdate:modelValue"],gt={class:"col-md"},xt=["onUpdate:modelValue"],Mt={class:"col-md"},St=["onUpdate:modelValue"],Tt={class:"col-md"},At={class:"input-group"},Nt=["onUpdate:modelValue"],jt={class:"my-2"},Et={class:"row"},Rt={class:"col-sm"},Bt=["onUpdate:modelValue"],Dt={class:"col-sm"},Ot={class:"alert alert-secondary"},Ft={class:"my-2"},Pt={class:"row"},Jt={class:"col-sm"},qt=["onUpdate:modelValue"],It=["value"],zt=["onUpdate:modelValue"],Ht={class:"col-sm"},Kt={class:"alert alert-secondary"},Wt={class:"my-2"},Gt={class:"row"},Lt={class:"col-sm"},Qt=["onUpdate:modelValue"],Xt={class:"col-sm"},Yt={class:"alert alert-secondary"},Zt={class:"row"},el={class:"col"},tl={class:"form-label"},ll={class:"col"},sl={class:"form-label"},ol={class:"card my-2"},nl={class:"card-body"},al={class:"mb-2"},il={class:"row"},rl={class:"col-auto"},cl={class:"col-auto"},dl={class:"mb-2"},ul=["value","id"],vl=["for"],pl={key:0},fl={class:"my-2"},_l={class:"my-2"},kl=ye({__name:"index",setup(b){const S=$(""),N=$(""),D=$(0),f=$(0),c=$("smile"),g=$([]),i=$("perfect"),x=$(80820),M=$(2960),U=$(50),j=$(""),O=$(0),y=$(Ee),d=P(()=>y.value.filter(a=>a.key===N.value)),n=$(null),W=P(()=>{if(n.value)return y.value.find(a=>`${a.key}-${a.series}`===n.value)});ee(d,()=>{n.value=d.value[0]?`${d.value[0].key}-${d.value[0].series}`:null});const _=()=>{const a=y.value.map(z),t=je(S.value,D.value),{score:F,log:l}=Pe({notes:t,convertedMembers:a,center:N.value,appealSum:x.value,mentalSum:M.value,masteryLevel:U.value,playStyle:i.value,centerMember:W.value?z(W.value):void 0});O.value=F,j.value=l},E=P(()=>y.value.reduce((a,t)=>a+t.mental,0)),J=P(()=>{const a=y.value.map(z);return xe(a,c.value,N.value)});ee(E,()=>{y.value.every(a=>a.mental)&&(M.value=E.value)}),ee(J,()=>{y.value.every(a=>a.smile&&a.pure&&a.cool)&&(x.value=J.value)}),De({title:"スクショウ計算機"});const{modals:q,openModal:T}=Me(),H=async a=>{const t=await T(at);t&&y.value.splice(y.value.indexOf(a),1,t)},R=a=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=F=>{const l=F.target.files?.[0];if(l){const k=new FileReader;k.onload=o=>{const Z=JSON.parse(o.target?.result);y.value.splice(y.value.indexOf(a),1,Z)},k.readAsText(l)}},t.click()},G=a=>{const t=JSON.stringify(a,null,2),F=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(F),k=document.createElement("a");k.href=l,k.download=`member_${a.name||"data"}.json`,k.click(),URL.revokeObjectURL(l)};return(a,t)=>{const F=Se;return h(),V("div",it,[t[27]||(t[27]=e("h1",null,"スクショウ計算機",-1)),be(F,{"note-text":s(S),"onUpdate:noteText":t[0]||(t[0]=l=>C(S)?S.value=l:null),center:s(N),"onUpdate:center":t[1]||(t[1]=l=>C(N)?N.value=l:null),offset:s(D),"onUpdate:offset":t[2]||(t[2]=l=>C(D)?D.value=l:null),"combo-offset":s(f),"onUpdate:comboOffset":t[3]||(t[3]=l=>C(f)?f.value=l:null),attribute:s(c),"onUpdate:attribute":t[4]||(t[4]=l=>C(c)?c.value=l:null),"mastery-level":s(U),"onUpdate:masteryLevel":t[5]||(t[5]=l=>C(U)?U.value=l:null),singers:s(g),"onUpdate:singers":t[6]||(t[6]=l=>C(g)?g.value=l:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",rt,[t[20]||(t[20]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ct,[(h(!0),V(Q,null,X(s(y),(l,k)=>(h(),V("div",{key:k,class:"card m-3"},[e("div",dt,w(k+1)+"人目 ",1),e("div",ut,[e("div",vt,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>H(l)}," カードを選択して入力 ",8,pt),e("button",{type:"button",class:"btn btn-primary",onClick:o=>R(l)}," メンバーデータの読み込み ",8,ft),e("button",{type:"button",class:"btn btn-primary",onClick:o=>G(l)}," メンバーデータの書き出し ",8,_t)]),e("div",mt,[t[13]||(t[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",yt,[m(e("select",{"onUpdate:modelValue":o=>l.name=o,class:"form-select"},[(h(!0),V(Q,null,X(s(Te),o=>(h(),V("option",{key:o,value:o},w(s(B)[o]),9,bt))),128))],8,kt),[[ue,l.name]])])]),e("div",$t,[t[14]||(t[14]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",ht,[m(e("input",{"onUpdate:modelValue":o=>l.ap=o,type:"number",class:"form-control"},null,8,Ct),[[A,l.ap,void 0,{number:!0}]])])]),t[19]||(t[19]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",wt,[e("div",Ut,[m(e("input",{"onUpdate:modelValue":o=>l.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,Vt),[[A,l.smile,void 0,{number:!0}]])]),e("div",gt,[m(e("input",{"onUpdate:modelValue":o=>l.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,xt),[[A,l.pure,void 0,{number:!0}]])]),e("div",Mt,[m(e("input",{"onUpdate:modelValue":o=>l.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,St),[[A,l.cool,void 0,{number:!0}]])]),e("div",Tt,[e("div",At,[t[15]||(t[15]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),m(e("input",{"onUpdate:modelValue":o=>l.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Nt),[[A,l.mental,void 0,{number:!0}]])])])]),e("div",jt,[t[16]||(t[16]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Et,[e("div",Rt,[m(e("textarea",{"onUpdate:modelValue":o=>l.skill=o,class:"form-control"},null,8,Bt),[[A,l.skill]])]),e("div",Dt,[e("div",Ot,w(s(ae)(s(z)(l).skills)),1)])])]),e("div",Ft,[t[17]||(t[17]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Pt,[e("div",Jt,[m(e("select",{"onUpdate:modelValue":o=>l.centerSkillCondition=o,class:"form-select"},[(h(!0),V(Q,null,X(s(Ae),o=>(h(),V("option",{key:o,value:o},w(s(de)(o)),9,It))),128))],8,qt),[[ue,l.centerSkillCondition]]),m(e("textarea",{"onUpdate:modelValue":o=>l.centerSkill=o,class:"form-control"},null,8,zt),[[A,l.centerSkill]])]),e("div",Ht,[e("div",Kt," 【"+w(s(de)(l.centerSkillCondition))+"】"+w(s(ae)(s(z)(l).centerSkills)),1)])])]),e("div",Wt,[t[18]||(t[18]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",Gt,[e("div",Lt,[m(e("textarea",{"onUpdate:modelValue":o=>l.centerAbilityText=o,class:"form-control"},null,8,Qt),[[A,l.centerAbilityText]])]),e("div",Xt,[e("div",Yt,w(s(me)(s(z)(l).centerAbilities)),1)])])])])]))),128)),e("div",Zt,[e("div",el,[e("label",tl,"総合アピール値（"+w(s(J))+"）：",1),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>C(x)?x.value=l:null),type:"number",class:"form-control"},null,512),[[A,s(x),void 0,{number:!0}]])]),e("div",ll,[e("label",sl,"総合メンタル値（"+w(s(E))+"）：",1),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>C(M)?M.value=l:null),type:"number",class:"form-control"},null,512),[[A,s(M),void 0,{number:!0}]])])])])]),e("div",ol,[t[26]||(t[26]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",nl,[e("div",al,[t[23]||(t[23]=Y(" プレイスタイル： ",-1)),e("div",il,[e("div",rl,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>C(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[re,s(i)]]),t[21]||(t[21]=Y(" 渾身 ",-1))])]),e("div",cl,[e("label",null,[m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>C(i)?i.value=l:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[re,s(i)]]),t[22]||(t[22]=Y(" 背水 ",-1))])])])]),e("div",dl,[t[24]||(t[24]=Y(" センター： ",-1)),(h(!0),V(Q,null,X(s(d),l=>(h(),V("div",{key:`${l.key}-${l.series}`},[m(e("input",{type:"radio",class:"form-check-input",value:`${l.key}-${l.series}`,"onUpdate:modelValue":t[11]||(t[11]=k=>C(n)?n.value=k:null),id:`${l.key}-${l.series}-center`},null,8,ul),[[re,s(n)]]),e("label",{for:`${l.key}-${l.series}-center`,class:"form-check-label"},w(s(Ne)(l)),9,vl)]))),128)),s(d).length===0?(h(),V("div",pl," （センターなし） ")):ne("",!0)]),e("button",{type:"button",class:"btn btn-primary",onClick:_}," 計算 "),e("div",fl," 計算結果: "+w(s(O)),1),e("div",_l,[t[25]||(t[25]=Y(" ログ： ",-1)),m(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=l=>C(j)?j.value=l:null),rows:"6",class:"form-control"},null,512),[[A,s(j)]])])])]),(h(!0),V(Q,null,X(s(q),(l,k)=>(h(),ke(Oe(l.component),{key:`modal-${k}`,"on-close":l.onClose},null,40,["on-close"]))),128))])}}});export{kl as default};
