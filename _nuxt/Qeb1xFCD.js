import{c as be,m as N,a as ve,b as $e,s as Z,d as F,e as _e,u as he,f as pe,g as ne,h as Ce,i as Me,_ as we,j as Ve,k as Ue,p as Se,l as ge}from"./DqdEsHwg.js";import{d as re,y as T,z as w,A as e,F as xe,G as Te,_ as Ae,r as $,k as R,H as ee,I as ye,D as Ne,J as _,K as V,L as x,M as s,N as H,O as q,P as Le,B as M,Q as ae,R as se,E as J,x as Ee,C as De,S as fe,T as Be}from"./Fa-MyB08.js";const Y=i=>i<=2100?Math.floor((-5+Math.sqrt(25+20*i))/10):Math.floor(20+(i-2100)/200),me=(i,y,k)=>(1+i/100)*(1+Y(y)*(k?2:1)/10),oe=i=>i<10?1:i<20?1.1:i<30?1.2:i<40?1.3:i<50?1.4:1.5,Oe=({notes:i,convertedMembers:y,center:k,appealSum:U,mentalSum:v,masteryLevel:u,comboOffset:f,playStyle:A="perfect"})=>{const d=y.find(n=>n.name===k),h=d?.centerSkillCondition,L=d?.centerSkills||[],P=d?.centerAbilities||[],S=P.find(n=>n.type==="cooltime_reduce"),j=P.find(n=>n.type==="ap_reduce"),m=5-Number(S?.value[0]||0),a=Number(j?.value[1]||0),c=y.slice();let E=m,D=0,r=v,l=0,g=0;const t=[],B=[];let o=0,ie=0;const ce=be(i);let z=0,de=0;const le=new WeakMap,ke=60/(ce-(f||0));let K,b="";const Q=(n,C)=>{const G=Y(g),W=r*100/v;e:for(const p of C){if(p.condition){const[O,X,te]=p.condition;let I=0;switch(O){case"skill_count":I=le.get(n)||0;break;case"total_skill_count":I=de;break;case"vol_lv":I=G;break;case"mental_rate":I=W;break;default:throw new Error(`条件式が不正です: ${O}`)}if(te===void 0)throw new Error(`条件式が不正です: ${O}`);switch(X){case"<=":if(!(I<=te))continue e;break;case">=":if(!(I>=te))continue e;break}}switch(p.type){case"vol_buff":B[0]=(B[0]||0)+(p.value||0),b+=`${N[n.name]} vol_buff: +${p.value}
`;break;case"vol_up":{const O=B.shift()||0;g+=Math.ceil((p.value||0)*(1+O/100)),b+=`${N[n.name]} vol_up: +${Math.ceil((p.value||0)*(1+O/100))}
`,b+=`now voltagePoint: ${g}
`;break}case"vol_down":g-=p.value||0,g<0&&(g=0),b+=`${N[n.name]} vol_down: -${p.value||0}
`;break;case"score_buff":t[0]=(t[0]||0)+(p.value||0),b+=`${N[n.name]} score_buff: +${p.value}
`;break;case"score_up":{const O=t.shift()||0,X=(p.value||0)/100*(1+O/100)*me(u,g,K?.fever||!1);l+=Math.ceil(U*X),b+=`${N[n.name]} score_up: +${Math.ceil(U*X)}
`;break}case"mental_up":r+=Math.ceil((p.value||0)/100*v),b+=`${N[n.name]} mental_up: +${Math.ceil((p.value||0)/100*v)}
`;break;case"mental_down":r-=Math.ceil((p.value||0)/100*v),b+=`${N[n.name]} mental_down: -${Math.ceil((p.value||0)/100*v)}
`,r<=0&&(r=1);break;case"ap_up":D+=Math.ceil((p.value||0)*oe(z)*1e4)/1e4,b+=`${N[n.name]} ap_up: +${(p.value||0)*oe(z)}
`;break;case"ap_down":D-=p.value||0,b+=`${N[n.name]} ap_down: -${p.value||0}
`;break;case"reset":o=c.length-1,b+=`${N[n.name]} reset
`;break;case"splice":c.splice(c.indexOf(n),1),o--,b+=`${N[n.name]} splice
`;break;default:throw new Error(`skill typeが不正です: ${p.type}`)}}};d&&h==="start"&&Q(d,L);const ue=()=>{const n=c[o];if(!n)throw new Error("メンバーが見つかりません");const C=Math.max(n.ap-a,0);return C<=D&&E<=0?(D-=C,le.set(n,(le.get(n)||0)+1),de++,Q(n,n.skills),o=c.length-1===o?0:o+1,E+=m,!0):!1};for(let n=0;n<i.length;n++){const C=i[n];if(K=i[n-1],!C)throw new Error("noteが見つかりません");for(d&&C.fever&&!K?.fever&&h==="fever_start"&&(b+=`FEVER START
`,Q(d,L)),!C.fever&&K?.fever&&(b+=`FEVER END
`),E-=C.time-ie,ie=C.time;ue(););E=Math.max(0,E);for(let G=0;G<C.normalCount+C.slideCount;G++){if(A==="desperate"&&r*10>v){G<C.normalCount?r-=Math.ceil(v/15):r-=Math.ceil(v*2/75),b+=`miss, ap: ${D}, mental: ${r}, vol_lv: ${Y(g)*(C.fever?2:1)}
`;continue}z++,D+=Math.ceil(ke*oe(z)*1e4)/1e4,ue();const W=Math.ceil(U/ce*30*me(u,g,C.fever));l+=W,b+=`combo: ${z}, score: ${l} (+${W}), ap: ${D}, mental: ${r}, vol_lv: ${Y(g)*(C.fever?2:1)}
`}}return d&&h==="end"&&Q(d,L),{score:l,log:b}},Re={class:"card-body"},Fe=re({__name:"MPopup",props:{onClose:{type:Function,default:()=>{}}},setup(i){return(y,k)=>(w(),T("div",{class:"popup-wrapper",onClick:k[1]||(k[1]=U=>y.onClose(null))},[e("div",{class:"popup card overflow-scroll h-100 w-100",onClick:k[0]||(k[0]=Te(()=>{},["stop"]))},[e("div",Re,[xe(y.$slots,"default",{},void 0)])])]))}}),Pe=Object.assign(Ae(Fe,[["__scopeId","data-v-eec55aae"]]),{__name:"MPopup"}),je={class:"my-2"},Ie={class:"input-group mb-3"},ze=["value"],Ge={class:"card my-2"},He={class:"card-body"},qe={key:0,class:"my-2"},Je={class:"alert alert-info"},Ke={class:"card my-2"},Qe={class:"card-body"},We={key:0,class:"my-2"},Xe={class:"alert alert-info"},Ye={class:"card my-2"},Ze={class:"card-body"},el={key:0,class:"my-2"},ll={class:"alert alert-info"},tl=re({__name:"MdCardSelect",props:{onClose:{}},setup(i){const y=$(""),k=m=>`[${m.series}] ${m.key!=="other"?pe[m.key]:m.otherName}`,U=R(()=>ve.filter(m=>k(m).includes(y.value))),v=$(0),u=R(()=>ve[v.value]),f=R(()=>u.value?$e(u.value,d.value,h.value):null),A=R(()=>f.value?Z(F(f.value).skills):""),d=$(14),h=$(14),L=R(()=>f.value?Z(F(f.value).centerSkills):""),P=R(()=>f.value?_e(F(f.value).centerAbilities):""),S=he("skillCache",{}),j=m=>`${m.key}-${m.series}`;return ee(u,()=>{u.value&&(d.value=S.value[j(u.value)]?.skillLevel||14,h.value=S.value[j(u.value)]?.centerSkillLevel||14)}),ee([d,h],()=>{u.value&&(S.value[j(u.value)]={centerSkillLevel:h.value,skillLevel:d.value})}),(m,a)=>(w(),ye(Pe,{"on-close":m.onClose},{default:Ne(()=>[e("div",je,[e("div",Ie,[a[5]||(a[5]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text"},"検索")],-1)),_(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>V(y)?y.value=c:null),type:"text",class:"form-control"},null,512),[[x,s(y)]])]),_(e("select",{"onUpdate:modelValue":a[1]||(a[1]=c=>V(v)?v.value=c:null),class:"form-select"},[(w(!0),T(H,null,q(s(U),(c,E)=>(w(),T("option",{key:`${c.key}-${c.series}`,class:Le(["card",{"bg-primary":s(u)?.key===c.key}]),value:E}," ["+M(c.series)+"] "+M(c.key!=="other"?s(pe)[c.key]:c.otherName),11,ze))),128))],512),[[ae,s(v)]])]),e("div",Ge,[a[7]||(a[7]=e("div",{class:"card-header"}," スキル ",-1)),e("div",He,[e("div",null,[a[6]||(a[6]=J(" スキルレベル： ")),_(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>V(d)?d.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(d)]])]),s(u)?(w(),T("div",qe,[e("div",Je,M(s(A)),1)])):se("",!0)])]),e("div",Ke,[a[9]||(a[9]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Qe,[a[8]||(a[8]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),_(e("input",{"onUpdate:modelValue":a[3]||(a[3]=c=>V(h)?h.value=c:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[x,s(h)]]),s(u)?(w(),T("div",We,[e("div",Xe," 【"+M(s(ne)(s(u).centerSkillCondition))+"】"+M(s(L)),1)])):se("",!0)])]),e("div",Ye,[a[10]||(a[10]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",Ze,[s(u)?(w(),T("div",el,[e("div",ll,M(s(P)),1)])):se("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=c=>m.onClose(s(f)))}," 選択 ")]),_:1},8,["on-close"]))}}),sl=Object.assign(tl,{__name:"MdCardSelect"}),ol=Ce(()=>{const i=$([]);return{modals:i,openModal:k=>{let U;const v=new Promise(A=>{U=A}),f={component:k,onClose:A=>{i.value.splice(i.value.indexOf(f),1),U(A)}};return i.value.push(f),v}}}),nl={class:"container-md"},al={class:"card my-2"},rl={class:"card-body"},il={class:"card-header"},cl={class:"card-body"},dl=["onClick"],ul={class:"row my-2 align-items-center justify-content-start"},vl={class:"col-auto"},pl=["onUpdate:modelValue"],fl=["value"],ml={class:"row my-2 align-items-center justify-content-start"},_l={class:"col-auto"},yl=["onUpdate:modelValue"],kl={class:"row row-gap-1"},bl={class:"col-md"},$l=["onUpdate:modelValue"],hl={class:"col-md"},Cl=["onUpdate:modelValue"],Ml={class:"col-md"},wl=["onUpdate:modelValue"],Vl={class:"col-md"},Ul={class:"input-group"},Sl=["onUpdate:modelValue"],gl={class:"my-2"},xl={class:"row"},Tl={class:"col-sm"},Al=["onUpdate:modelValue"],Nl={class:"col-sm"},Ll={class:"alert alert-secondary"},El={class:"my-2"},Dl={class:"row"},Bl={class:"col-sm"},Ol=["onUpdate:modelValue"],Rl=["value"],Fl=["onUpdate:modelValue"],Pl={class:"col-sm"},jl={class:"alert alert-secondary"},Il={class:"my-2"},zl={class:"row"},Gl={class:"col-sm"},Hl=["onUpdate:modelValue"],ql={class:"col-sm"},Jl={class:"alert alert-secondary"},Kl={class:"row"},Ql={class:"col"},Wl={class:"form-label"},Xl={class:"col"},Yl={class:"form-label"},Zl={class:"card my-2"},et={class:"card-body"},lt={class:"mb-2"},tt={class:"row"},st={class:"col-auto"},ot={class:"col-auto"},nt={class:"my-2"},at={class:"my-2"},ct=re({__name:"index",setup(i){const y=$(""),k=$(""),U=$(0),v=$(0),u=$("smile"),f=$("perfect"),A=$(80820),d=$(2960),h=$(50),L=$(""),P=$(0),S=$(ge),j=()=>{const r=S.value.map(F),l=Se(y.value,U.value),{score:g,log:t}=Oe({notes:l,convertedMembers:r,center:k.value,appealSum:A.value,mentalSum:d.value,masteryLevel:h.value,comboOffset:v.value,playStyle:f.value});P.value=g,L.value=t},m=R(()=>S.value.reduce((r,l)=>r+l.mental,0)),a=R(()=>{const r=S.value.map(F);return Me(r,u.value,k.value)});ee(m,()=>{S.value.every(r=>r.mental)&&(d.value=m.value)}),ee(a,()=>{S.value.every(r=>r.smile&&r.pure&&r.cool)&&(A.value=a.value)}),Ee({title:"スクショウ計算機"});const{modals:c,openModal:E}=ol(),D=async r=>{const l=await E(sl);l&&S.value.splice(S.value.indexOf(r),1,l)};return(r,l)=>{const g=we;return w(),T("div",nl,[l[24]||(l[24]=e("h1",null,"スクショウ計算機",-1)),De(g,{"note-text":s(y),"onUpdate:noteText":l[0]||(l[0]=t=>V(y)?y.value=t:null),center:s(k),"onUpdate:center":l[1]||(l[1]=t=>V(k)?k.value=t:null),offset:s(U),"onUpdate:offset":l[2]||(l[2]=t=>V(U)?U.value=t:null),"combo-offset":s(v),"onUpdate:comboOffset":l[3]||(l[3]=t=>V(v)?v.value=t:null),attribute:s(u),"onUpdate:attribute":l[4]||(l[4]=t=>V(u)?u.value=t:null),"mastery-level":s(h),"onUpdate:masteryLevel":l[5]||(l[5]=t=>V(h)?h.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level"]),e("div",al,[l[18]||(l[18]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",rl,[(w(!0),T(H,null,q(s(S),(t,B)=>(w(),T("div",{key:B,class:"card m-3"},[e("div",il,M(B+1)+"人目 ",1),e("div",cl,[e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>D(t)}," カードを選択して入力 ",8,dl)]),e("div",ul,[l[11]||(l[11]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",vl,[_(e("select",{"onUpdate:modelValue":o=>t.name=o,class:"form-select"},[(w(!0),T(H,null,q(s(Ve),o=>(w(),T("option",{key:o,value:o},M(s(N)[o]),9,fl))),128))],8,pl),[[ae,t.name]])])]),e("div",ml,[l[12]||(l[12]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",_l,[_(e("input",{"onUpdate:modelValue":o=>t.ap=o,type:"number",class:"form-control"},null,8,yl),[[x,t.ap,void 0,{number:!0}]])])]),l[17]||(l[17]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",kl,[e("div",bl,[_(e("input",{"onUpdate:modelValue":o=>t.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,$l),[[x,t.smile,void 0,{number:!0}]])]),e("div",hl,[_(e("input",{"onUpdate:modelValue":o=>t.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Cl),[[x,t.pure,void 0,{number:!0}]])]),e("div",Ml,[_(e("input",{"onUpdate:modelValue":o=>t.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,wl),[[x,t.cool,void 0,{number:!0}]])]),e("div",Vl,[e("div",Ul,[l[13]||(l[13]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),_(e("input",{"onUpdate:modelValue":o=>t.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Sl),[[x,t.mental,void 0,{number:!0}]])])])]),e("div",gl,[l[14]||(l[14]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",xl,[e("div",Tl,[_(e("textarea",{"onUpdate:modelValue":o=>t.skill=o,class:"form-control"},null,8,Al),[[x,t.skill]])]),e("div",Nl,[e("div",Ll,M(s(Z)(s(F)(t).skills)),1)])])]),e("div",El,[l[15]||(l[15]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Dl,[e("div",Bl,[_(e("select",{"onUpdate:modelValue":o=>t.centerSkillCondition=o,class:"form-select"},[(w(!0),T(H,null,q(s(Ue),o=>(w(),T("option",{key:o,value:o},M(s(ne)(o)),9,Rl))),128))],8,Ol),[[ae,t.centerSkillCondition]]),_(e("textarea",{"onUpdate:modelValue":o=>t.centerSkill=o,class:"form-control"},null,8,Fl),[[x,t.centerSkill]])]),e("div",Pl,[e("div",jl," 【"+M(s(ne)(t.centerSkillCondition))+"】"+M(s(Z)(s(F)(t).centerSkills)),1)])])]),e("div",Il,[l[16]||(l[16]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",zl,[e("div",Gl,[_(e("textarea",{"onUpdate:modelValue":o=>t.centerAbilityText=o,class:"form-control"},null,8,Hl),[[x,t.centerAbilityText]])]),e("div",ql,[e("div",Jl,M(s(_e)(s(F)(t).centerAbilities)),1)])])])])]))),128)),e("div",Kl,[e("div",Ql,[e("label",Wl,"総合アピール値（"+M(s(a))+"）：",1),_(e("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>V(A)?A.value=t:null),type:"number",class:"form-control"},null,512),[[x,s(A),void 0,{number:!0}]])]),e("div",Xl,[e("label",Yl,"総合メンタル値（"+M(s(m))+"）：",1),_(e("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>V(d)?d.value=t:null),type:"number",class:"form-control"},null,512),[[x,s(d),void 0,{number:!0}]])])])])]),e("div",Zl,[l[23]||(l[23]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",et,[e("div",lt,[l[21]||(l[21]=J(" プレイスタイル： ")),e("div",tt,[e("div",st,[e("label",null,[_(e("input",{"onUpdate:modelValue":l[8]||(l[8]=t=>V(f)?f.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[fe,s(f)]]),l[19]||(l[19]=J(" 渾身 "))])]),e("div",ot,[e("label",null,[_(e("input",{"onUpdate:modelValue":l[9]||(l[9]=t=>V(f)?f.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[fe,s(f)]]),l[20]||(l[20]=J(" 背水 "))])])])]),e("button",{type:"button",class:"btn btn-primary",onClick:j}," 計算 "),e("div",nt," 計算結果: "+M(s(P)),1),e("div",at,[l[22]||(l[22]=J(" ログ： ")),_(e("textarea",{"onUpdate:modelValue":l[10]||(l[10]=t=>V(L)?L.value=t:null),rows:"6",class:"form-control"},null,512),[[x,s(L)]])])])]),(w(!0),T(H,null,q(s(c),(t,B)=>(w(),ye(Be(t.component),{key:`modal-${B}`,"on-close":t.onClose},null,40,["on-close"]))),128))])}}});export{ct as default};
