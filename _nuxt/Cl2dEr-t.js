import{c as we,m as D,a as _e,b as Ue,s as ie,d as K,e as ke,u as Ve,_ as be,f as me,g as de,h as ge,i as xe,j as Me,k as Se,l as Ne,n as Te,o as Ae,p as Ee,q as Re}from"./D4Yox7jf.js";import{f as he,r as h,g as I,h as se,i as $e,o as d,w as je,a as e,j as u,b as ve,k as C,v as V,l as s,c as k,F as L,m as Q,n as Be,t as $,p as pe,q as te,d as X,u as De,s as ce,x as Oe}from"./CgYI_Let.js";const Fe=b=>b<=2100?Math.floor((-5+Math.sqrt(25+20*b))/10):Math.floor(20+(b-2100)/200),ye=(b,N,E)=>(1+b/100)*(1+N*(E?2:1)/10),ue=b=>b<10?1:b<20?1.1:b<30?1.2:b<40?1.3:b<50?1.4:1.5,Pe=({notes:b,convertedMembers:N,center:E,appealSum:P,mentalSum:y,masteryLevel:v,playStyle:g="perfect",noLog:i=!1,noDamagedFormation:x=!1,noCuredFormation:M=!1,centerMember:w=N.find(R=>R.name===E)})=>{const R=w?.centerSkillCondition,J=w?.centerSkills||[],c=w?.centerAbilities||[],U=c.find(r=>r.type==="cooltime_reduce"),a=c.find(r=>r.type==="ap_reduce"),O=5-Number(U?.value.amount||0),p=Number(a?.value.amount||0),q=N.slice();let z=O,F=0,T=y,W=0;const j={_point:0,_lv:0,get point(){return this._point},set point(r){this._point=r,this._lv=Fe(r)},get lv(){return this._lv}},Y=[0],Z=[0];let n=0,l=0;const B=we(b);let S=0,t=0;const A=new WeakMap,o=60/B;let le,f="";const oe=(r,_,H)=>{const ne=j.lv,Ce=T*100/y;e:for(const m of _){if(m.condition){const[G,ae,re]=m.condition;let ee=0;switch(G){case"skill_count":ee=A.get(r)||0;break;case"total_skill_count":ee=t;break;case"vol_lv":ee=ne*(H?2:1);break;case"mental_rate":ee=Ce;break;default:throw new Error(`条件式が不正です: ${G}`)}if(re===void 0)throw new Error(`条件式が不正です: ${G}`);switch(ae){case"<=":if(!(ee<=re))continue e;break;case">=":if(!(ee>=re))continue e;break}}switch(m.type){case"vol_buff":Z[0]=(Z[0]||0)+(m.value||0),i||(f+=`${D[r.name]} vol_buff: +${m.value}
`);break;case"vol_up":{const G=Z[0]??0;Z[0]=0,j.point+=Math.ceil((m.value||0)*(1+G/100)),i||(f+=`${D[r.name]} vol_up: +${Math.ceil((m.value||0)*(1+G/100))}
`,f+=`now voltagePoint: ${j.point}
`);break}case"vol_down":j.point-=m.value||0,j.point<0&&(j.point=0),i||(f+=`${D[r.name]} vol_down: -${m.value||0}
`);break;case"score_buff":Y[0]=(Y[0]||0)+(m.value||0),i||(f+=`${D[r.name]} score_buff: +${m.value}
`);break;case"score_up":{const G=Y[0]??0;Y[0]=0;const ae=(m.value||0)/100*(1+G/100)*ye(v,j.lv,H);W+=Math.ceil(P*ae),i||(f+=`${D[r.name]} score_up: +${Math.ceil(P*ae)}
`);break}case"mental_up":T+=Math.ceil((m.value||0)/100*y),i||(f+=`${D[r.name]} mental_up: +${Math.ceil((m.value||0)/100*y)}
`);break;case"mental_down":T-=Math.ceil((m.value||0)/100*y),i||(f+=`${D[r.name]} mental_down: -${Math.ceil((m.value||0)/100*y)}
`),T<=0&&(T=1);break;case"ap_up":F+=Math.ceil((m.value||0)*ue(S)*1e4),i||(f+=`${D[r.name]} ap_up: +${(m.value||0)*ue(S)}
`);break;case"ap_down":F-=(m.value||0)*1e4,i||(f+=`${D[r.name]} ap_down: -${m.value||0}
`);break;case"reset":n=q.length-1,i||(f+=`${D[r.name]} reset
`);break;case"splice":q.splice(q.indexOf(r),1),n--,i||(f+=`${D[r.name]} splice
`);break;default:throw new Error(`skill typeが不正です: ${m.type}`)}}};w&&R==="start"&&oe(w,J,!1);const fe=r=>{if(q.length===0)return!1;const _=q[n];if(!_)throw new Error("メンバーが見つかりません");const H=Math.max(_.ap-p,0);return H*1e4<=F&&z<=0?(F-=H*1e4,A.set(_,(A.get(_)||0)+1),t++,oe(_,_.skills,r),n=q.length-1===n?0:n+1,z+=O,!0):!1};for(let r=0;r<b.length;r++){const _=b[r];if(le=b[r-1],!_)throw new Error("noteが見つかりません");for(z-=_.time-l,l=_.time;fe(le?.fever||!1););z=Math.max(0,z),w&&_.fever&&!le?.fever&&R==="fever_start"&&(i||(f+=`FEVER START
`),oe(w,J,!0)),!_.fever&&le?.fever&&(i||(f+=`FEVER END
`));for(let H=0;H<_.normalCount+_.slideCount;H++){if(g==="desperate"&&T*10>y){H<_.normalCount?T-=Math.ceil(y/15):T-=Math.ceil(y*2/75),i||(f+=`miss, apPoint: ${F}, mental: ${T}, vol_lv: ${j.lv*(_.fever?2:1)}
`);continue}S++,F+=Math.ceil(o*ue(S)*1e4),fe(_.fever);const ne=Math.ceil(P/B*30*ye(v,j.lv,_.fever));if(W+=ne,i||(f+=`combo: ${S}, score: ${W} (+${ne}), apPoint: ${F}, mental: ${T}, vol_lv: ${j.lv*(_.fever?2:1)}
`),g==="perfect"&&x&&T<y)return i||(f+=`メンタルが100%未満になったため計算を打ち切ります
`),{score:W,log:f};if(g==="desperate"&&M&&T*10>y)return i||(f+=`メンタルが10%超になったため計算を打ち切ります
`),{score:W,log:f}}}return w&&R==="end"&&oe(w,J,!1),{score:W,log:f}},Je={class:"my-2"},qe={class:"input-group mb-3"},Ie={class:"input-group-prepend"},ze={class:"input-group-text"},He={style:{"min-height":"1.5em"}},Ke=["value"],We={class:"card my-2"},Ge={class:"card-body"},Le={key:0,class:"my-2"},Qe={class:"alert alert-info"},Xe={class:"card my-2"},Ye={class:"card-body"},Ze={key:0,class:"my-2"},et={class:"alert alert-info"},tt={class:"card my-2"},lt={class:"card-body"},st={key:0,class:"my-2"},ot={class:"alert alert-info"},nt=he({__name:"MdCardSelect",props:{onClose:{}},setup(b){const N=h(""),E=U=>`[${U.series}] ${U.key!=="other"?me[U.key]:U.otherName}`,P=I(()=>_e.filter(U=>E(U).includes(N.value))),y=h(0),v=I(()=>_e[y.value]),g=I(()=>v.value?Ue(v.value,x.value,M.value):null),i=I(()=>g.value?ie(K(g.value).skills):""),x=h(14),M=h(14),w=I(()=>g.value?ie(K(g.value).centerSkills):""),R=I(()=>g.value?ke(K(g.value).centerAbilities):""),J=Ve("skillCache",{}),c=U=>`${U.key}-${U.series}`;return se(v,()=>{v.value&&(x.value=J.value[c(v.value)]?.skillLevel||14,M.value=J.value[c(v.value)]?.centerSkillLevel||14)}),se([x,M],()=>{v.value&&(J.value[c(v.value)]={centerSkillLevel:M.value,skillLevel:x.value})}),(U,a)=>{const O=be;return d(),$e(ge,{"on-close":U.onClose},{default:je(()=>[e("div",Je,[e("div",qe,[e("div",Ie,[e("div",ze,[e("div",He,[ve(O,{icon:["fas","magnifying-glass"]})])])]),u(e("input",{"onUpdate:modelValue":a[0]||(a[0]=p=>C(N)?N.value=p:null),type:"text",class:"form-control"},null,512),[[V,s(N)]])]),u(e("select",{"onUpdate:modelValue":a[1]||(a[1]=p=>C(y)?y.value=p:null),class:"form-select"},[(d(!0),k(L,null,Q(s(P),(p,q)=>(d(),k("option",{key:`${p.key}-${p.series}`,class:Be(["card",{"bg-primary":s(v)?.key===p.key}]),value:q}," ["+$(p.series)+"] "+$(p.key!=="other"?s(me)[p.key]:p.otherName),11,Ke))),128))],512),[[pe,s(y)]])]),e("div",We,[a[6]||(a[6]=e("div",{class:"card-header"}," スキル ",-1)),e("div",Ge,[e("div",null,[a[5]||(a[5]=X(" スキルレベル： ",-1)),u(e("input",{"onUpdate:modelValue":a[2]||(a[2]=p=>C(x)?x.value=p:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[V,s(x)]])]),s(v)?(d(),k("div",Le,[e("div",Qe,$(s(i)),1)])):te("",!0)])]),e("div",Xe,[a[8]||(a[8]=e("div",{class:"card-header"}," センタースキル ",-1)),e("div",Ye,[a[7]||(a[7]=e("label",{class:"form-label"}," センタースキルレベル： ",-1)),u(e("input",{"onUpdate:modelValue":a[3]||(a[3]=p=>C(M)?M.value=p:null),type:"number",class:"form-control",min:"1",max:"14"},null,512),[[V,s(M)]]),s(v)?(d(),k("div",Ze,[e("div",et," 【"+$(s(de)(s(v).centerSkillCondition))+"】"+$(s(w)),1)])):te("",!0)])]),e("div",tt,[a[9]||(a[9]=e("div",{class:"card-header"}," センター特性 ",-1)),e("div",lt,[s(v)?(d(),k("div",st,[e("div",ot,$(s(R)),1)])):te("",!0)])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=p=>U.onClose(s(g)))}," 選択 ")]),_:1},8,["on-close"])}}}),at=Object.assign(nt,{__name:"MdCardSelect"}),it={class:"container-md"},rt={class:"card my-2"},ct={class:"card-body"},ut={class:"card-header"},dt={class:"card-body"},vt={class:"d-flex gap-2 flex-wrap"},pt=["onClick"],ft=["onClick"],_t=["onClick"],mt=["onClick"],yt={class:"row my-2 align-items-center justify-content-start"},kt={class:"col-auto"},bt=["onUpdate:modelValue"],ht=["value"],$t={key:0,class:"col-auto"},Ct=["onUpdate:modelValue"],wt={class:"row my-2 align-items-center justify-content-start"},Ut={class:"col-auto"},Vt=["onUpdate:modelValue"],gt={class:"row my-2 align-items-center justify-content-start"},xt={class:"col-auto"},Mt=["onUpdate:modelValue"],St={class:"row row-gap-1"},Nt={class:"col-md"},Tt=["onUpdate:modelValue"],At={class:"col-md"},Et=["onUpdate:modelValue"],Rt={class:"col-md"},jt=["onUpdate:modelValue"],Bt={class:"col-md"},Dt={class:"input-group"},Ot=["onUpdate:modelValue"],Ft={class:"my-2"},Pt={class:"row"},Jt={class:"col-sm"},qt=["onUpdate:modelValue"],It={class:"col-sm"},zt={class:"alert alert-secondary"},Ht={class:"my-2"},Kt={class:"row"},Wt={class:"col-sm"},Gt=["onUpdate:modelValue"],Lt=["value"],Qt=["onUpdate:modelValue"],Xt={class:"col-sm"},Yt={class:"alert alert-secondary"},Zt={class:"my-2"},el={class:"row"},tl={class:"col-sm"},ll=["onUpdate:modelValue"],sl={class:"col-sm"},ol={class:"alert alert-secondary"},nl={class:"row"},al={class:"col"},il={class:"form-label"},rl={class:"col"},cl={class:"form-label"},ul={class:"card my-2"},dl={class:"card-body"},vl={class:"mb-2"},pl={class:"row"},fl={class:"col-auto"},_l={class:"col-auto"},ml={class:"mb-2"},yl=["value","id"],kl=["for"],bl={key:0},hl={class:"my-2"},$l={class:"my-2"},Ul=he({__name:"index",setup(b){const N=h(""),E=h(""),P=h(0),y=h(0),v=h("smile"),g=h([]),i=h("perfect"),x=h(80820),M=h(2960),w=h(50),R=h(""),J=h(0),c=h(Re),U=(n,l)=>{const B=c.value[n];c.value[n]=c.value[l],c.value[l]=B},a=I(()=>c.value.filter(n=>n.key===E.value)),O=h(null),p=I(()=>{if(O.value)return c.value.find(n=>`${n.key}-${n.series}`===O.value)});se(a,()=>{O.value=a.value[0]?`${a.value[0].key}-${a.value[0].series}`:null});const q=()=>{const n=c.value.map(K),l=Ee(N.value,P.value),{score:B,log:S}=Pe({notes:l,convertedMembers:n,center:E.value,appealSum:x.value,mentalSum:M.value,masteryLevel:w.value,playStyle:i.value,centerMember:p.value?K(p.value):void 0});J.value=B,R.value=S},z=I(()=>c.value.reduce((n,l)=>n+l.mental,0)),F=I(()=>{const n=c.value.map(K);return xe(n,v.value,E.value)});se(z,()=>{c.value.every(n=>n.mental)&&(M.value=z.value)}),se(F,()=>{c.value.every(n=>n.smile&&n.pure&&n.cool)&&(x.value=F.value)}),De({title:"スクショウ計算機"});const{modals:T,openModal:W}=Me(),j=async n=>{const l=await W(at);l&&c.value.splice(c.value.indexOf(n),1,l)},Y=n=>{const l=document.createElement("input");l.type="file",l.accept=".json",l.onchange=B=>{const S=B.target.files?.[0];if(S){const t=new FileReader;t.onload=A=>{const o=JSON.parse(A.target?.result);c.value.splice(c.value.indexOf(n),1,o)},t.readAsText(S)}},l.click()},Z=n=>{const l=JSON.stringify(n,null,2),B=new Blob([l],{type:"application/json"}),S=URL.createObjectURL(B),t=document.createElement("a");t.href=S,t.download=`member_${n.name||"data"}.json`,t.click(),URL.revokeObjectURL(S)};return(n,l)=>{const B=Se,S=be;return d(),k("div",it,[l[28]||(l[28]=e("h1",null,"スクショウ計算機",-1)),ve(B,{"note-text":s(N),"onUpdate:noteText":l[0]||(l[0]=t=>C(N)?N.value=t:null),center:s(E),"onUpdate:center":l[1]||(l[1]=t=>C(E)?E.value=t:null),offset:s(P),"onUpdate:offset":l[2]||(l[2]=t=>C(P)?P.value=t:null),"combo-offset":s(y),"onUpdate:comboOffset":l[3]||(l[3]=t=>C(y)?y.value=t:null),attribute:s(v),"onUpdate:attribute":l[4]||(l[4]=t=>C(v)?v.value=t:null),"mastery-level":s(w),"onUpdate:masteryLevel":l[5]||(l[5]=t=>C(w)?w.value=t:null),singers:s(g),"onUpdate:singers":l[6]||(l[6]=t=>C(g)?g.value=t:null)},null,8,["note-text","center","offset","combo-offset","attribute","mastery-level","singers"]),e("div",rt,[l[21]||(l[21]=e("div",{class:"card-header"}," メンバーデータ ",-1)),e("div",ct,[(d(!0),k(L,null,Q(s(c),(t,A)=>(d(),k("div",{key:A,class:"card m-3"},[e("div",ut,$(A+1)+"人目 ",1),e("div",dt,[e("div",vt,[e("button",{type:"button",class:"btn btn-primary",onClick:o=>j(t)}," カードを選択して入力 ",8,pt),e("button",{type:"button",class:"btn btn-primary",onClick:o=>Y(t)}," メンバーデータの読み込み ",8,ft),e("button",{type:"button",class:"btn btn-primary",onClick:o=>Z(t)}," メンバーデータの書き出し ",8,_t),(d(),k(L,null,Q(6,o=>(d(),k(L,{key:`swap-${o}`},[o-1!==A?(d(),k("button",{key:0,type:"button",class:"btn btn-success",onClick:le=>U(A,o-1)},[ve(S,{icon:["fas","arrow-right-arrow-left"]}),X(" "+$(o),1)],8,mt)):te("",!0)],64))),64))]),e("div",yt,[l[13]||(l[13]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," メンバー： ")],-1)),e("div",kt,[u(e("select",{"onUpdate:modelValue":o=>t.name=o,class:"form-select"},[(d(!0),k(L,null,Q(s(Ne),o=>(d(),k("option",{key:o,value:o},$(s(D)[o]),9,ht))),128))],8,bt),[[pe,t.name]])]),t.name==="other"?(d(),k("div",$t,[u(e("input",{"onUpdate:modelValue":o=>t.otherName=o,class:"form-control"},null,8,Ct),[[V,t.otherName]])])):te("",!0)]),e("div",wt,[l[14]||(l[14]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," シリーズ： ")],-1)),e("div",Ut,[u(e("input",{"onUpdate:modelValue":o=>t.series=o,class:"form-control"},null,8,Vt),[[V,t.series]])])]),e("div",gt,[l[15]||(l[15]=e("div",{class:"col-auto"},[e("label",{class:"form-label"}," 消費AP： ")],-1)),e("div",xt,[u(e("input",{"onUpdate:modelValue":o=>t.ap=o,type:"number",class:"form-control"},null,8,Mt),[[V,t.ap,void 0,{number:!0}]])])]),l[20]||(l[20]=e("div",{class:"my-2"}," ステータス： ",-1)),e("div",St,[e("div",Nt,[u(e("input",{"onUpdate:modelValue":o=>t.smile=o,type:"number",class:"form-control",style:{"background-color":"#ffddee"},placeholder:"スマイル"},null,8,Tt),[[V,t.smile,void 0,{number:!0}]])]),e("div",At,[u(e("input",{"onUpdate:modelValue":o=>t.pure=o,type:"number",class:"form-control",style:{"background-color":"#ddffdd"},placeholder:"ピュア"},null,8,Et),[[V,t.pure,void 0,{number:!0}]])]),e("div",Rt,[u(e("input",{"onUpdate:modelValue":o=>t.cool=o,type:"number",class:"form-control",style:{"background-color":"#ddddff"},placeholder:"クール"},null,8,jt),[[V,t.cool,void 0,{number:!0}]])]),e("div",Bt,[e("div",Dt,[l[16]||(l[16]=e("div",{class:"input-group-prepend"},[e("span",{class:"input-group-text",style:{color:"#22ddaa"}},"♡")],-1)),u(e("input",{"onUpdate:modelValue":o=>t.mental=o,type:"number",class:"form-control",placeholder:"メンタル"},null,8,Ot),[[V,t.mental,void 0,{number:!0}]])])])]),e("div",Ft,[l[17]||(l[17]=e("label",{class:"form-label"}," スキル： ",-1)),e("div",Pt,[e("div",Jt,[u(e("textarea",{"onUpdate:modelValue":o=>t.skill=o,class:"form-control"},null,8,qt),[[V,t.skill]])]),e("div",It,[e("div",zt,$(s(ie)(s(K)(t).skills)),1)])])]),e("div",Ht,[l[18]||(l[18]=e("label",{class:"form-label"}," センタースキル： ",-1)),e("div",Kt,[e("div",Wt,[u(e("select",{"onUpdate:modelValue":o=>t.centerSkillCondition=o,class:"form-select"},[(d(!0),k(L,null,Q(s(Te),o=>(d(),k("option",{key:o,value:o},$(s(de)(o)),9,Lt))),128))],8,Gt),[[pe,t.centerSkillCondition]]),u(e("textarea",{"onUpdate:modelValue":o=>t.centerSkill=o,class:"form-control"},null,8,Qt),[[V,t.centerSkill]])]),e("div",Xt,[e("div",Yt," 【"+$(s(de)(t.centerSkillCondition))+"】"+$(s(ie)(s(K)(t).centerSkills)),1)])])]),e("div",Zt,[l[19]||(l[19]=e("label",{class:"form-label"}," センター特性： ",-1)),e("div",el,[e("div",tl,[u(e("textarea",{"onUpdate:modelValue":o=>t.centerAbilityText=o,class:"form-control"},null,8,ll),[[V,t.centerAbilityText]])]),e("div",sl,[e("div",ol,$(s(ke)(s(K)(t).centerAbilities)),1)])])])])]))),128)),e("div",nl,[e("div",al,[e("label",il,"総合アピール値（"+$(s(F))+"）：",1),u(e("input",{"onUpdate:modelValue":l[7]||(l[7]=t=>C(x)?x.value=t:null),type:"number",class:"form-control"},null,512),[[V,s(x),void 0,{number:!0}]])]),e("div",rl,[e("label",cl,"総合メンタル値（"+$(s(z))+"）：",1),u(e("input",{"onUpdate:modelValue":l[8]||(l[8]=t=>C(M)?M.value=t:null),type:"number",class:"form-control"},null,512),[[V,s(M),void 0,{number:!0}]])])])])]),e("div",ul,[l[27]||(l[27]=e("div",{class:"card-header"}," 計算 ",-1)),e("div",dl,[e("div",vl,[l[24]||(l[24]=X(" プレイスタイル： ",-1)),e("div",pl,[e("div",fl,[e("label",null,[u(e("input",{"onUpdate:modelValue":l[9]||(l[9]=t=>C(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"perfect"},null,512),[[ce,s(i)]]),l[22]||(l[22]=X(" 渾身 ",-1))])]),e("div",_l,[e("label",null,[u(e("input",{"onUpdate:modelValue":l[10]||(l[10]=t=>C(i)?i.value=t:null),class:"form-check-input",type:"radio",value:"desperate"},null,512),[[ce,s(i)]]),l[23]||(l[23]=X(" 背水 ",-1))])])])]),e("div",ml,[l[25]||(l[25]=X(" センター： ",-1)),(d(!0),k(L,null,Q(s(a),t=>(d(),k("div",{key:`${t.key}-${t.series}`},[u(e("input",{type:"radio",class:"form-check-input",value:`${t.key}-${t.series}`,"onUpdate:modelValue":l[11]||(l[11]=A=>C(O)?O.value=A:null),id:`${t.key}-${t.series}-center`},null,8,yl),[[ce,s(O)]]),e("label",{for:`${t.key}-${t.series}-center`,class:"form-check-label"},$(s(Ae)(t)),9,kl)]))),128)),s(a).length===0?(d(),k("div",bl," （センターなし） ")):te("",!0)]),e("button",{type:"button",class:"btn btn-primary",onClick:q}," 計算 "),e("div",hl," 計算結果: "+$(s(J)),1),e("div",$l,[l[26]||(l[26]=X(" ログ： ",-1)),u(e("textarea",{"onUpdate:modelValue":l[12]||(l[12]=t=>C(R)?R.value=t:null),rows:"6",class:"form-control"},null,512),[[V,s(R)]])])])]),(d(!0),k(L,null,Q(s(T),(t,A)=>(d(),$e(Oe(t.component),{key:`modal-${A}`,"on-close":t.onClose},null,40,["on-close"]))),128))])}}});export{Ul as default};
